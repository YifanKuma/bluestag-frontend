<html>
<head>
<title>autoprefixer.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #0037a6;}
.s4 { color: #1750eb;}
.s5 { color: #8c8c8c; font-style: italic;}
.s6 { color: #264eff;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
autoprefixer.js</font>
</center></td></tr></table>
<pre><span class="s0">let </span><span class="s1">browserslist = require(</span><span class="s2">'browserslist'</span><span class="s1">)</span>
<span class="s0">let </span><span class="s1">{ agents } = require(</span><span class="s2">'caniuse-lite/dist/unpacker/agents'</span><span class="s1">)</span>
<span class="s0">let </span><span class="s1">pico = require(</span><span class="s2">'picocolors'</span><span class="s1">)</span>

<span class="s0">let </span><span class="s1">dataPrefixes = require(</span><span class="s2">'../data/prefixes'</span><span class="s1">)</span>
<span class="s0">let </span><span class="s1">Browsers = require(</span><span class="s2">'./browsers'</span><span class="s1">)</span>
<span class="s0">let </span><span class="s1">getInfo = require(</span><span class="s2">'./info'</span><span class="s1">)</span>
<span class="s0">let </span><span class="s1">Prefixes = require(</span><span class="s2">'./prefixes'</span><span class="s1">)</span>

<span class="s0">let </span><span class="s1">autoprefixerData = { browsers: agents, prefixes: dataPrefixes }</span>

<span class="s0">const </span><span class="s1">WARNING =</span>
  <span class="s2">'</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  Replace Autoprefixer `browsers` option to Browserslist config.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  Use `browserslist` key in `package.json` or `.browserslistrc` file.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  Using `browsers` option can cause errors. Browserslist config can</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  be used for Babel, Autoprefixer, postcss-normalize and other tools.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  If you really need to use option, rename it to `overrideBrowserslist`.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  Learn more at:</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  https://github.com/browserslist/browserslist#readme</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'  https://twitter.com/browserslist</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
  <span class="s2">'</span><span class="s3">\n</span><span class="s2">'</span>

<span class="s0">function </span><span class="s1">isPlainObject(obj) {</span>
  <span class="s0">return </span><span class="s1">Object.prototype.toString.apply(obj) === </span><span class="s2">'[object Object]'</span>
<span class="s1">}</span>

<span class="s0">let </span><span class="s1">cache = </span><span class="s0">new </span><span class="s1">Map()</span>

<span class="s0">function </span><span class="s1">timeCapsule(result, prefixes) {</span>
  <span class="s0">if </span><span class="s1">(prefixes.browsers.selected.length === </span><span class="s4">0</span><span class="s1">) {</span>
    <span class="s0">return</span>
  <span class="s1">}</span>
  <span class="s0">if </span><span class="s1">(prefixes.add.selectors.length &gt; </span><span class="s4">0</span><span class="s1">) {</span>
    <span class="s0">return</span>
  <span class="s1">}</span>
  <span class="s0">if </span><span class="s1">(Object.keys(prefixes.add).length &gt; </span><span class="s4">2</span><span class="s1">) {</span>
    <span class="s0">return</span>
  <span class="s1">}</span>
  <span class="s5">/* c8 ignore next 11 */</span>
  <span class="s1">result.warn(</span>
    <span class="s2">'Autoprefixer target browsers do not need any prefixes.' </span><span class="s1">+</span>
      <span class="s2">'You do not need Autoprefixer anymore.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'Check your Browserslist config to be sure that your targets ' </span><span class="s1">+</span>
      <span class="s2">'are set up correctly.</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'  Learn more at:</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'  https://github.com/postcss/autoprefixer#readme</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'  https://github.com/browserslist/browserslist#readme</span><span class="s3">\n</span><span class="s2">' </span><span class="s1">+</span>
      <span class="s2">'</span><span class="s3">\n</span><span class="s2">'</span>
  <span class="s1">)</span>
<span class="s1">}</span>

<span class="s1">module.exports = plugin</span>

<span class="s0">function </span><span class="s1">plugin(...reqs) {</span>
  <span class="s0">let </span><span class="s1">options</span>
  <span class="s0">if </span><span class="s1">(reqs.length === </span><span class="s4">1 </span><span class="s1">&amp;&amp; isPlainObject(reqs[</span><span class="s4">0</span><span class="s1">])) {</span>
    <span class="s1">options = reqs[</span><span class="s4">0</span><span class="s1">]</span>
    <span class="s1">reqs = undefined</span>
  <span class="s1">} </span><span class="s0">else if </span><span class="s1">(reqs.length === </span><span class="s4">0 </span><span class="s1">|| (reqs.length === </span><span class="s4">1 </span><span class="s1">&amp;&amp; !reqs[</span><span class="s4">0</span><span class="s1">])) {</span>
    <span class="s1">reqs = undefined</span>
  <span class="s1">} </span><span class="s0">else if </span><span class="s1">(reqs.length &lt;= </span><span class="s4">2 </span><span class="s1">&amp;&amp; (Array.isArray(reqs[</span><span class="s4">0</span><span class="s1">]) || !reqs[</span><span class="s4">0</span><span class="s1">])) {</span>
    <span class="s1">options = reqs[</span><span class="s4">1</span><span class="s1">]</span>
    <span class="s1">reqs = reqs[</span><span class="s4">0</span><span class="s1">]</span>
  <span class="s1">} </span><span class="s0">else if </span><span class="s1">(</span><span class="s0">typeof </span><span class="s1">reqs[reqs.length - </span><span class="s4">1</span><span class="s1">] === </span><span class="s2">'object'</span><span class="s1">) {</span>
    <span class="s1">options = reqs.pop()</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(!options) {</span>
    <span class="s1">options = {}</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(options.browser) {</span>
    <span class="s0">throw new </span><span class="s1">Error(</span>
      <span class="s2">'Change `browser` option to `overrideBrowserslist` in Autoprefixer'</span>
    <span class="s1">)</span>
  <span class="s1">} </span><span class="s0">else if </span><span class="s1">(options.browserslist) {</span>
    <span class="s0">throw new </span><span class="s1">Error(</span>
      <span class="s2">'Change `browserslist` option to `overrideBrowserslist` in Autoprefixer'</span>
    <span class="s1">)</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(options.overrideBrowserslist) {</span>
    <span class="s1">reqs = options.overrideBrowserslist</span>
  <span class="s1">} </span><span class="s0">else if </span><span class="s1">(options.browsers) {</span>
    <span class="s0">if </span><span class="s1">(</span><span class="s0">typeof </span><span class="s1">console !== </span><span class="s2">'undefined' </span><span class="s1">&amp;&amp; console.warn) {</span>
      <span class="s1">console.warn(</span>
        <span class="s1">pico.red(WARNING.replace(</span><span class="s6">/`[^`]+`/g</span><span class="s1">, i =&gt; pico.yellow(i.slice(</span><span class="s4">1</span><span class="s1">, -</span><span class="s4">1</span><span class="s1">))))</span>
      <span class="s1">)</span>
    <span class="s1">}</span>
    <span class="s1">reqs = options.browsers</span>
  <span class="s1">}</span>

  <span class="s0">let </span><span class="s1">brwlstOpts = {</span>
    <span class="s1">env: options.env,</span>
    <span class="s1">ignoreUnknownVersions: options.ignoreUnknownVersions,</span>
    <span class="s1">stats: options.stats</span>
  <span class="s1">}</span>

  <span class="s0">function </span><span class="s1">loadPrefixes(opts) {</span>
    <span class="s0">let </span><span class="s1">d = autoprefixerData</span>
    <span class="s0">let </span><span class="s1">browsers = </span><span class="s0">new </span><span class="s1">Browsers(d.browsers, reqs, opts, brwlstOpts)</span>
    <span class="s0">let </span><span class="s1">key = browsers.selected.join(</span><span class="s2">', '</span><span class="s1">) + JSON.stringify(options)</span>

    <span class="s0">if </span><span class="s1">(!cache.has(key)) {</span>
      <span class="s1">cache.set(key, </span><span class="s0">new </span><span class="s1">Prefixes(d.prefixes, browsers, options))</span>
    <span class="s1">}</span>

    <span class="s0">return </span><span class="s1">cache.get(key)</span>
  <span class="s1">}</span>

  <span class="s0">return </span><span class="s1">{</span>
    <span class="s1">browsers: reqs,</span>

    <span class="s1">info(opts) {</span>
      <span class="s1">opts = opts || {}</span>
      <span class="s1">opts.from = opts.from || process.cwd()</span>
      <span class="s0">return </span><span class="s1">getInfo(loadPrefixes(opts))</span>
    <span class="s1">},</span>

    <span class="s1">options,</span>

    <span class="s1">postcssPlugin: </span><span class="s2">'autoprefixer'</span><span class="s1">,</span>
    <span class="s1">prepare(result) {</span>
      <span class="s0">let </span><span class="s1">prefixes = loadPrefixes({</span>
        <span class="s1">env: options.env,</span>
        <span class="s1">from: result.opts.from</span>
      <span class="s1">})</span>

      <span class="s0">return </span><span class="s1">{</span>
        <span class="s1">OnceExit(root) {</span>
          <span class="s1">timeCapsule(result, prefixes)</span>
          <span class="s0">if </span><span class="s1">(options.remove !== </span><span class="s0">false</span><span class="s1">) {</span>
            <span class="s1">prefixes.processor.remove(root, result)</span>
          <span class="s1">}</span>
          <span class="s0">if </span><span class="s1">(options.add !== </span><span class="s0">false</span><span class="s1">) {</span>
            <span class="s1">prefixes.processor.add(root, result)</span>
          <span class="s1">}</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">plugin.postcss = </span><span class="s0">true</span>

<span class="s5">/**</span>
 <span class="s5">* Autoprefixer data</span>
 <span class="s5">*/</span>
<span class="s1">plugin.data = autoprefixerData</span>

<span class="s5">/**</span>
 <span class="s5">* Autoprefixer default browsers</span>
 <span class="s5">*/</span>
<span class="s1">plugin.defaults = browserslist.defaults</span>

<span class="s5">/**</span>
 <span class="s5">* Inspect with default Autoprefixer</span>
 <span class="s5">*/</span>
<span class="s1">plugin.info = () =&gt; plugin().info()</span>
</pre>
</body>
</html>