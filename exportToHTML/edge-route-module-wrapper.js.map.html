<html>
<head>
<title>edge-route-module-wrapper.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
edge-route-module-wrapper.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/web/edge-route-module-wrapper.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { NextRequest } from './spec-extension/request'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">AppRouteRouteHandlerContext,</span><span class="s3">\n  </span><span class="s1">AppRouteRouteModule,</span><span class="s3">\n</span><span class="s1">} from '../route-modules/app-route/module'</span><span class="s3">\n\n</span><span class="s1">import './globals'</span><span class="s3">\n\n</span><span class="s1">import { adapter, type AdapterOptions } from './adapter'</span><span class="s3">\n</span><span class="s1">import { IncrementalCache } from '../lib/incremental-cache'</span><span class="s3">\n</span><span class="s1">import { RouteMatcher } from '../route-matchers/route-matcher'</span><span class="s3">\n</span><span class="s1">import type { NextFetchEvent } from './spec-extension/fetch-event'</span><span class="s3">\n</span><span class="s1">import { internal_getCurrentFunctionWaitUntil } from './internal-edge-wait-until'</span><span class="s3">\n</span><span class="s1">import { getServerUtils } from '../server-utils'</span><span class="s3">\n</span><span class="s1">import { searchParamsToUrlQuery } from '../../shared/lib/router/utils/querystring'</span><span class="s3">\n</span><span class="s1">import { CloseController, trackStreamConsumed } from './web-on-close'</span><span class="s3">\n</span><span class="s1">import { getEdgePreviewProps } from './get-edge-preview-props'</span><span class="s3">\n</span><span class="s1">import type { NextConfigComplete } from '../config-shared'</span><span class="s3">\n\n</span><span class="s1">export interface WrapOptions {</span><span class="s3">\n  </span><span class="s1">nextConfig: NextConfigComplete</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* EdgeRouteModuleWrapper is a wrapper around a route module.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* Note that this class should only be used in the edge runtime.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export class EdgeRouteModuleWrapper {</span><span class="s3">\n  </span><span class="s1">private readonly matcher: RouteMatcher</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The constructor is wrapped with private to ensure that it can only be</span><span class="s3">\n   </span><span class="s1">* constructed by the static wrap method.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* @param routeModule the route module to wrap</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">private constructor(</span><span class="s3">\n    </span><span class="s1">private readonly routeModule: AppRouteRouteModule,</span><span class="s3">\n    </span><span class="s1">private readonly nextConfig: NextConfigComplete</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// TODO: (wyattjoh) possibly allow the module to define it's own matcher</span><span class="s3">\n    </span><span class="s1">this.matcher = new RouteMatcher(routeModule.definition)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* This will wrap a module with the EdgeModuleWrapper and return a function</span><span class="s3">\n   </span><span class="s1">* that can be used as a handler for the edge runtime.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* @param module the module to wrap</span><span class="s3">\n   </span><span class="s1">* @param options any options that should be passed to the adapter and</span><span class="s3">\n   </span><span class="s1">*                override the ones passed from the runtime</span><span class="s3">\n   </span><span class="s1">* @returns a function that can be used as a handler for the edge runtime</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">public static wrap(routeModule: AppRouteRouteModule, options: WrapOptions) {</span><span class="s3">\n    </span><span class="s1">// Create the module wrapper.</span><span class="s3">\n    </span><span class="s1">const wrapper = new EdgeRouteModuleWrapper(routeModule, options.nextConfig)</span><span class="s3">\n\n    </span><span class="s1">// Return the wrapping function.</span><span class="s3">\n    </span><span class="s1">return (opts: AdapterOptions) =&gt; {</span><span class="s3">\n      </span><span class="s1">return adapter({</span><span class="s3">\n        </span><span class="s1">...opts,</span><span class="s3">\n        </span><span class="s1">IncrementalCache,</span><span class="s3">\n        </span><span class="s1">// Bind the handler method to the wrapper so it still has context.</span><span class="s3">\n        </span><span class="s1">handler: wrapper.handler.bind(wrapper),</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private async handler(</span><span class="s3">\n    </span><span class="s1">request: NextRequest,</span><span class="s3">\n    </span><span class="s1">evt: NextFetchEvent</span><span class="s3">\n  </span><span class="s1">): Promise&lt;Response&gt; {</span><span class="s3">\n    </span><span class="s1">const utils = getServerUtils({</span><span class="s3">\n      </span><span class="s1">pageIsDynamic: this.matcher.isDynamic,</span><span class="s3">\n      </span><span class="s1">page: this.matcher.definition.pathname,</span><span class="s3">\n      </span><span class="s1">basePath: request.nextUrl.basePath,</span><span class="s3">\n      </span><span class="s1">// We don't need the `handleRewrite` util, so can just pass an empty object</span><span class="s3">\n      </span><span class="s1">rewrites: {},</span><span class="s3">\n      </span><span class="s1">// only used for rewrites, so setting an arbitrary default value here</span><span class="s3">\n      </span><span class="s1">caseSensitive: false,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const { params } = utils.normalizeDynamicRouteParams(</span><span class="s3">\n      </span><span class="s1">searchParamsToUrlQuery(request.nextUrl.searchParams),</span><span class="s3">\n      </span><span class="s1">false</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">const waitUntil = evt.waitUntil.bind(evt)</span><span class="s3">\n    </span><span class="s1">const closeController = new CloseController()</span><span class="s3">\n\n    </span><span class="s1">const previewProps = getEdgePreviewProps()</span><span class="s3">\n\n    </span><span class="s1">// Create the context for the handler. This contains the params from the</span><span class="s3">\n    </span><span class="s1">// match (if any).</span><span class="s3">\n    </span><span class="s1">const context: AppRouteRouteHandlerContext = {</span><span class="s3">\n      </span><span class="s1">params,</span><span class="s3">\n      </span><span class="s1">prerenderManifest: {</span><span class="s3">\n        </span><span class="s1">version: 4,</span><span class="s3">\n        </span><span class="s1">routes: {},</span><span class="s3">\n        </span><span class="s1">dynamicRoutes: {},</span><span class="s3">\n        </span><span class="s1">preview: previewProps,</span><span class="s3">\n        </span><span class="s1">notFoundRoutes: [],</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">renderOpts: {</span><span class="s3">\n        </span><span class="s1">supportsDynamicResponse: true,</span><span class="s3">\n        </span><span class="s1">waitUntil,</span><span class="s3">\n        </span><span class="s1">onClose: closeController.onClose.bind(closeController),</span><span class="s3">\n        </span><span class="s1">onAfterTaskError: undefined,</span><span class="s3">\n        </span><span class="s1">experimental: {</span><span class="s3">\n          </span><span class="s1">cacheComponents: !!process.env.__NEXT_CACHE_COMPONENTS,</span><span class="s3">\n          </span><span class="s1">authInterrupts: !!process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">cacheLifeProfiles: this.nextConfig.experimental.cacheLife,</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">sharedContext: {</span><span class="s3">\n        </span><span class="s1">buildId: '', // TODO: Populate this properly.</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Get the response from the handler.</span><span class="s3">\n    </span><span class="s1">let res = await this.routeModule.handle(request, context)</span><span class="s3">\n\n    </span><span class="s1">const waitUntilPromises = [internal_getCurrentFunctionWaitUntil()]</span><span class="s3">\n    </span><span class="s1">if (context.renderOpts.pendingWaitUntil) {</span><span class="s3">\n      </span><span class="s1">waitUntilPromises.push(context.renderOpts.pendingWaitUntil)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">evt.waitUntil(Promise.all(waitUntilPromises))</span><span class="s3">\n\n    </span><span class="s1">if (!res.body) {</span><span class="s3">\n      </span><span class="s1">// we can delay running it until a bit later --</span><span class="s3">\n      </span><span class="s1">// if it's needed, we'll have a `waitUntil` lock anyway.</span><span class="s3">\n      </span><span class="s1">setTimeout(() =&gt; closeController.dispatchClose(), 0)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">// NOTE: if this is a streaming response, onClose may be called later,</span><span class="s3">\n      </span><span class="s1">// so we can't rely on `closeController.listeners` -- it might be 0 at this point.</span><span class="s3">\n      </span><span class="s1">const trackedBody = trackStreamConsumed(res.body, () =&gt;</span><span class="s3">\n        </span><span class="s1">closeController.dispatchClose()</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">res = new Response(trackedBody, {</span><span class="s3">\n        </span><span class="s1">status: res.status,</span><span class="s3">\n        </span><span class="s1">statusText: res.statusText,</span><span class="s3">\n        </span><span class="s1">headers: res.headers,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return res</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;EdgeRouteModuleWrapper&quot;</span><span class="s0">,</span><span class="s1">&quot;routeModule&quot;</span><span class="s0">,</span><span class="s1">&quot;nextConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;matcher&quot;</span><span class="s0">,</span><span class="s1">&quot;RouteMatcher&quot;</span><span class="s0">,</span><span class="s1">&quot;definition&quot;</span><span class="s0">,</span><span class="s1">&quot;wrap&quot;</span><span class="s0">,</span><span class="s1">&quot;options&quot;</span><span class="s0">,</span><span class="s1">&quot;wrapper&quot;</span><span class="s0">,</span><span class="s1">&quot;opts&quot;</span><span class="s0">,</span><span class="s1">&quot;adapter&quot;</span><span class="s0">,</span><span class="s1">&quot;IncrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;handler&quot;</span><span class="s0">,</span><span class="s1">&quot;bind&quot;</span><span class="s0">,</span><span class="s1">&quot;request&quot;</span><span class="s0">,</span><span class="s1">&quot;evt&quot;</span><span class="s0">,</span><span class="s1">&quot;utils&quot;</span><span class="s0">,</span><span class="s1">&quot;getServerUtils&quot;</span><span class="s0">,</span><span class="s1">&quot;pageIsDynamic&quot;</span><span class="s0">,</span><span class="s1">&quot;isDynamic&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;basePath&quot;</span><span class="s0">,</span><span class="s1">&quot;nextUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;rewrites&quot;</span><span class="s0">,</span><span class="s1">&quot;caseSensitive&quot;</span><span class="s0">,</span><span class="s1">&quot;params&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeDynamicRouteParams&quot;</span><span class="s0">,</span><span class="s1">&quot;searchParamsToUrlQuery&quot;</span><span class="s0">,</span><span class="s1">&quot;searchParams&quot;</span><span class="s0">,</span><span class="s1">&quot;waitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;closeController&quot;</span><span class="s0">,</span><span class="s1">&quot;CloseController&quot;</span><span class="s0">,</span><span class="s1">&quot;previewProps&quot;</span><span class="s0">,</span><span class="s1">&quot;getEdgePreviewProps&quot;</span><span class="s0">,</span><span class="s1">&quot;context&quot;</span><span class="s0">,</span><span class="s1">&quot;prerenderManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;routes&quot;</span><span class="s0">,</span><span class="s1">&quot;dynamicRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;preview&quot;</span><span class="s0">,</span><span class="s1">&quot;notFoundRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;renderOpts&quot;</span><span class="s0">,</span><span class="s1">&quot;supportsDynamicResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;onClose&quot;</span><span class="s0">,</span><span class="s1">&quot;onAfterTaskError&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;experimental&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;__NEXT_CACHE_COMPONENTS&quot;</span><span class="s0">,</span><span class="s1">&quot;authInterrupts&quot;</span><span class="s0">,</span><span class="s1">&quot;__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheLifeProfiles&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheLife&quot;</span><span class="s0">,</span><span class="s1">&quot;sharedContext&quot;</span><span class="s0">,</span><span class="s1">&quot;buildId&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;handle&quot;</span><span class="s0">,</span><span class="s1">&quot;waitUntilPromises&quot;</span><span class="s0">,</span><span class="s1">&quot;internal_getCurrentFunctionWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;setTimeout&quot;</span><span class="s0">,</span><span class="s1">&quot;dispatchClose&quot;</span><span class="s0">,</span><span class="s1">&quot;trackedBody&quot;</span><span class="s0">,</span><span class="s1">&quot;trackStreamConsumed&quot;</span><span class="s0">,</span><span class="s1">&quot;Response&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;statusText&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>