<html>
<head>
<title>work-unit-async-storage.external.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
work-unit-async-storage.external.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/app-render/work-unit-async-storage.external.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { AsyncLocalStorage } from 'async_hooks'</span><span class="s3">\n</span><span class="s1">import type { DraftModeProvider } from '../async-storage/draft-mode-provider'</span><span class="s3">\n</span><span class="s1">import type { ResponseCookies } from '../web/spec-extension/cookies'</span><span class="s3">\n</span><span class="s1">import type { ReadonlyHeaders } from '../web/spec-extension/adapters/headers'</span><span class="s3">\n</span><span class="s1">import type { ReadonlyRequestCookies } from '../web/spec-extension/adapters/request-cookies'</span><span class="s3">\n</span><span class="s1">import type { CacheSignal } from './cache-signal'</span><span class="s3">\n</span><span class="s1">import type { DynamicTrackingState } from './dynamic-rendering'</span><span class="s3">\n</span><span class="s1">import type { FallbackRouteParams } from '../request/fallback-params'</span><span class="s3">\n\n</span><span class="s1">// Share the instance module in the next-shared layer</span><span class="s3">\n</span><span class="s1">import { workUnitAsyncStorageInstance } from './work-unit-async-storage-instance' with { 'turbopack-transition': 'next-shared' }</span><span class="s3">\n</span><span class="s1">import type { ServerComponentsHmrCache } from '../response-cache'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">RenderResumeDataCache,</span><span class="s3">\n  </span><span class="s1">PrerenderResumeDataCache,</span><span class="s3">\n</span><span class="s1">} from '../resume-data-cache/resume-data-cache'</span><span class="s3">\n</span><span class="s1">import type { Params } from '../request/params'</span><span class="s3">\n</span><span class="s1">import type { ImplicitTags } from '../lib/implicit-tags'</span><span class="s3">\n</span><span class="s1">import type { WorkStore } from './work-async-storage.external'</span><span class="s3">\n</span><span class="s1">import { NEXT_HMR_REFRESH_HASH_COOKIE } from '../../client/components/app-router-headers'</span><span class="s3">\n</span><span class="s1">import { InvariantError } from '../../shared/lib/invariant-error'</span><span class="s3">\n\n</span><span class="s1">export type WorkUnitPhase = 'action' | 'render' | 'after'</span><span class="s3">\n\n</span><span class="s1">export interface CommonWorkUnitStore {</span><span class="s3">\n  </span><span class="s1">/** NOTE: Will be mutated as phases change */</span><span class="s3">\n  </span><span class="s1">phase: WorkUnitPhase</span><span class="s3">\n  </span><span class="s1">readonly implicitTags: ImplicitTags</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface RequestStore extends CommonWorkUnitStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'request'</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The URL of the request. This only specifies the pathname and the search</span><span class="s3">\n   </span><span class="s1">* part of the URL.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly url: {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* The pathname of the requested URL.</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">readonly pathname: string</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* The search part of the requested URL. If the request did not provide a</span><span class="s3">\n     </span><span class="s1">* search part, this will be an empty string.</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">readonly search: string</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">readonly headers: ReadonlyHeaders</span><span class="s3">\n  </span><span class="s1">// This is mutable because we need to reassign it when transitioning from the action phase to the render phase.</span><span class="s3">\n  </span><span class="s1">// The cookie object itself is deliberately read only and thus can't be updated.</span><span class="s3">\n  </span><span class="s1">cookies: ReadonlyRequestCookies</span><span class="s3">\n  </span><span class="s1">readonly mutableCookies: ResponseCookies</span><span class="s3">\n  </span><span class="s1">readonly userspaceMutableCookies: ResponseCookies</span><span class="s3">\n  </span><span class="s1">readonly draftMode: DraftModeProvider</span><span class="s3">\n  </span><span class="s1">readonly isHmrRefresh?: boolean</span><span class="s3">\n  </span><span class="s1">readonly serverComponentsHmrCache?: ServerComponentsHmrCache</span><span class="s3">\n\n  </span><span class="s1">readonly rootParams: Params</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The resume data cache for this request. This will be a immutable cache.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">renderResumeDataCache: RenderResumeDataCache | null</span><span class="s3">\n\n  </span><span class="s1">// DEV-only</span><span class="s3">\n  </span><span class="s1">usedDynamic?: boolean</span><span class="s3">\n  </span><span class="s1">prerenderPhase?: boolean</span><span class="s3">\n  </span><span class="s1">devFallbackParams?: FallbackRouteParams | null</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* The Prerender store is for tracking information related to prerenders.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* It can be used for both RSC and SSR prerendering and should be scoped as close</span><span class="s3">\n </span><span class="s1">* to the individual `renderTo...` API call as possible. To keep the type simple</span><span class="s3">\n </span><span class="s1">* we don't distinguish between RSC and SSR prerendering explicitly but instead</span><span class="s3">\n </span><span class="s1">* use conditional object properties to infer which mode we are in. For instance cache tracking</span><span class="s3">\n </span><span class="s1">* only needs to happen during the RSC prerender when we are prospectively prerendering</span><span class="s3">\n </span><span class="s1">* to fill all caches.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type PrerenderStoreModern =</span><span class="s3">\n  </span><span class="s1">| PrerenderStoreModernClient</span><span class="s3">\n  </span><span class="s1">| PrerenderStoreModernServer</span><span class="s3">\n  </span><span class="s1">| PrerenderStoreModernRuntime</span><span class="s3">\n\n</span><span class="s1">/** Like `PrerenderStoreModern`, but only including static prerenders (i.e. not runtime prerenders) */</span><span class="s3">\n</span><span class="s1">export type StaticPrerenderStoreModern = Exclude&lt;</span><span class="s3">\n  </span><span class="s1">PrerenderStoreModern,</span><span class="s3">\n  </span><span class="s1">PrerenderStoreModernRuntime</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">export interface PrerenderStoreModernClient</span><span class="s3">\n  </span><span class="s1">extends PrerenderStoreModernCommon,</span><span class="s3">\n    </span><span class="s1">StaticPrerenderStoreCommon {</span><span class="s3">\n  </span><span class="s1">readonly type: 'prerender-client'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PrerenderStoreModernServer</span><span class="s3">\n  </span><span class="s1">extends PrerenderStoreModernCommon,</span><span class="s3">\n    </span><span class="s1">StaticPrerenderStoreCommon {</span><span class="s3">\n  </span><span class="s1">readonly type: 'prerender'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PrerenderStoreModernRuntime</span><span class="s3">\n  </span><span class="s1">extends PrerenderStoreModernCommon {</span><span class="s3">\n  </span><span class="s1">readonly type: 'prerender-runtime'</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* A runtime prerender resolves APIs in two tasks:</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* 1. Static data (available in a static prerender)</span><span class="s3">\n   </span><span class="s1">* 2. Runtime data (available in a runtime prerender)</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* This separation is achieved by awaiting this promise in </span><span class="s3">\&quot;</span><span class="s1">runtime</span><span class="s3">\&quot; </span><span class="s1">APIs.</span><span class="s3">\n   </span><span class="s1">* In the final prerender, the promise will be resolved during the second task,</span><span class="s3">\n   </span><span class="s1">* and the render will be aborted in the task that follows it.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly runtimeStagePromise: Promise&lt;void&gt; | null</span><span class="s3">\n\n  </span><span class="s1">readonly cookies: RequestStore['cookies']</span><span class="s3">\n  </span><span class="s1">readonly draftMode: RequestStore['draftMode']</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface RevalidateStore {</span><span class="s3">\n  </span><span class="s1">// Collected revalidate times and tags for this document during the prerender.</span><span class="s3">\n  </span><span class="s1">revalidate: number // in seconds. 0 means dynamic. INFINITE_CACHE and higher means never revalidate.</span><span class="s3">\n  </span><span class="s1">expire: number // server expiration time</span><span class="s3">\n  </span><span class="s1">stale: number // client expiration time</span><span class="s3">\n  </span><span class="s1">tags: null | string[]</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">interface PrerenderStoreModernCommon</span><span class="s3">\n  </span><span class="s1">extends CommonWorkUnitStore,</span><span class="s3">\n    </span><span class="s1">RevalidateStore {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The render signal is aborted after React's `prerender` function is aborted</span><span class="s3">\n   </span><span class="s1">* (using a separate signal), which happens in two cases:</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* 1. When all caches are filled during the prospective prerender.</span><span class="s3">\n   </span><span class="s1">* 2. When the final prerender is aborted immediately after the prerender was</span><span class="s3">\n   </span><span class="s1">*    started.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* It can be used to reject any pending I/O, including hanging promises. This</span><span class="s3">\n   </span><span class="s1">* allows React to properly track the async I/O in dev mode, which yields</span><span class="s3">\n   </span><span class="s1">* better owner stacks for dynamic validation errors.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly renderSignal: AbortSignal</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* This is the AbortController which represents the boundary between Prerender</span><span class="s3">\n   </span><span class="s1">* and dynamic. In some renders it is the same as the controller for React,</span><span class="s3">\n   </span><span class="s1">* but in others it is a separate controller. It should be aborted whenever we</span><span class="s3">\n   </span><span class="s1">* are no longer in the prerender phase of rendering. Typically this is after</span><span class="s3">\n   </span><span class="s1">* one task, or when you call a sync API which requires the prerender to end</span><span class="s3">\n   </span><span class="s1">* immediately.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly controller: AbortController</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* When not null, this signal is used to track cache reads during prerendering</span><span class="s3">\n   </span><span class="s1">* and to await all cache reads completing, before aborting the prerender.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly cacheSignal: null | CacheSignal</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* During some prerenders we want to track dynamic access.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly dynamicTracking: null | DynamicTrackingState</span><span class="s3">\n\n  </span><span class="s1">readonly rootParams: Params</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* A mutable resume data cache for this prerender.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">prerenderResumeDataCache: PrerenderResumeDataCache | null</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* An immutable resume data cache for this prerender. This may be provided</span><span class="s3">\n   </span><span class="s1">* instead of the `prerenderResumeDataCache` if the prerender is not supposed</span><span class="s3">\n   </span><span class="s1">* to fill caches, and only read from prefilled caches, e.g. when prerendering</span><span class="s3">\n   </span><span class="s1">* an optional fallback shell.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">renderResumeDataCache: RenderResumeDataCache | null</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The HMR refresh hash is only provided in dev mode. It is needed for the dev</span><span class="s3">\n   </span><span class="s1">* warmup render to ensure that the cache keys will be identical for the</span><span class="s3">\n   </span><span class="s1">* subsequent dynamic render.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly hmrRefreshHash: string | undefined</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Only available in dev mode.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly captureOwnerStack: undefined | (() =&gt; string | null)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">interface StaticPrerenderStoreCommon {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The set of unknown route parameters. Accessing these will be tracked as</span><span class="s3">\n   </span><span class="s1">* a dynamic access.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly fallbackRouteParams: FallbackRouteParams | null</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* When true, the page is prerendered as a fallback shell, while allowing any</span><span class="s3">\n   </span><span class="s1">* dynamic accesses to result in an empty shell. This is the case when there</span><span class="s3">\n   </span><span class="s1">* are also routes prerendered with a more complete set of params.</span><span class="s3">\n   </span><span class="s1">* Prerendering those routes would catch any invalid dynamic accesses.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly allowEmptyStaticShell: boolean</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PrerenderStorePPR</span><span class="s3">\n  </span><span class="s1">extends CommonWorkUnitStore,</span><span class="s3">\n    </span><span class="s1">RevalidateStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'prerender-ppr'</span><span class="s3">\n  </span><span class="s1">readonly rootParams: Params</span><span class="s3">\n  </span><span class="s1">readonly dynamicTracking: null | DynamicTrackingState</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The set of unknown route parameters. Accessing these will be tracked as</span><span class="s3">\n   </span><span class="s1">* a dynamic access.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly fallbackRouteParams: FallbackRouteParams | null</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The resume data cache for this prerender.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">prerenderResumeDataCache: PrerenderResumeDataCache</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PrerenderStoreLegacy</span><span class="s3">\n  </span><span class="s1">extends CommonWorkUnitStore,</span><span class="s3">\n    </span><span class="s1">RevalidateStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'prerender-legacy'</span><span class="s3">\n  </span><span class="s1">readonly rootParams: Params</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type PrerenderStore =</span><span class="s3">\n  </span><span class="s1">| PrerenderStoreLegacy</span><span class="s3">\n  </span><span class="s1">| PrerenderStorePPR</span><span class="s3">\n  </span><span class="s1">| PrerenderStoreModern</span><span class="s3">\n\n</span><span class="s1">// /** Like `PrerenderStoreModern`, but only including static prerenders (i.e. not runtime prerenders) */</span><span class="s3">\n</span><span class="s1">export type StaticPrerenderStore = Exclude&lt;</span><span class="s3">\n  </span><span class="s1">PrerenderStore,</span><span class="s3">\n  </span><span class="s1">PrerenderStoreModernRuntime</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">export interface CommonCacheStore</span><span class="s3">\n  </span><span class="s1">extends Omit&lt;CommonWorkUnitStore, 'implicitTags'&gt; {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* A cache work unit store might not always have an outer work unit store,</span><span class="s3">\n   </span><span class="s1">* from which implicit tags could be inherited.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly implicitTags: ImplicitTags | undefined</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Draft mode is only available if the outer work unit store is a request</span><span class="s3">\n   </span><span class="s1">* store and draft mode is enabled.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly draftMode: DraftModeProvider | undefined</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface CommonUseCacheStore extends CommonCacheStore, RevalidateStore {</span><span class="s3">\n  </span><span class="s1">explicitRevalidate: undefined | number // explicit revalidate time from cacheLife() calls</span><span class="s3">\n  </span><span class="s1">explicitExpire: undefined | number // server expiration time</span><span class="s3">\n  </span><span class="s1">explicitStale: undefined | number // client expiration time</span><span class="s3">\n  </span><span class="s1">readonly hmrRefreshHash: string | undefined</span><span class="s3">\n  </span><span class="s1">readonly isHmrRefresh: boolean</span><span class="s3">\n  </span><span class="s1">readonly serverComponentsHmrCache: ServerComponentsHmrCache | undefined</span><span class="s3">\n  </span><span class="s1">readonly forceRevalidate: boolean</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PublicUseCacheStore extends CommonUseCacheStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'cache'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface PrivateUseCacheStore extends CommonUseCacheStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'private-cache'</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* A runtime prerender resolves APIs in two tasks:</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* 1. Static data (available in a static prerender)</span><span class="s3">\n   </span><span class="s1">* 2. Runtime data (available in a runtime prerender)</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* This separation is achieved by awaiting this promise in </span><span class="s3">\&quot;</span><span class="s1">runtime</span><span class="s3">\&quot; </span><span class="s1">APIs.</span><span class="s3">\n   </span><span class="s1">* In the final prerender, the promise will be resolved during the second task,</span><span class="s3">\n   </span><span class="s1">* and the render will be aborted in the task that follows it.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly runtimeStagePromise: Promise&lt;void&gt; | null</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* As opposed to the public cache store, the private cache store is allowed to</span><span class="s3">\n   </span><span class="s1">* access the request cookies.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly cookies: ReadonlyRequestCookies</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Private caches don't currently need to track root params in the cache key</span><span class="s3">\n   </span><span class="s1">* because they're not persisted anywhere, so we can allow root params access</span><span class="s3">\n   </span><span class="s1">* (unlike public caches)</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">readonly rootParams: Params</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type UseCacheStore = PublicUseCacheStore | PrivateUseCacheStore</span><span class="s3">\n\n</span><span class="s1">export interface UnstableCacheStore extends CommonCacheStore {</span><span class="s3">\n  </span><span class="s1">readonly type: 'unstable-cache'</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* The Cache store is for tracking information inside a </span><span class="s3">\&quot;</span><span class="s1">use cache</span><span class="s3">\&quot; </span><span class="s1">or</span><span class="s3">\n </span><span class="s1">* unstable_cache context. A cache store shadows an outer request store (if</span><span class="s3">\n </span><span class="s1">* present) as a work unit, so that we never accidentally expose any request or</span><span class="s3">\n </span><span class="s1">* page specific information to cache functions, unless it's explicitly desired.</span><span class="s3">\n </span><span class="s1">* For those exceptions, the data is copied over from the request store to the</span><span class="s3">\n </span><span class="s1">* cache store, instead of generally making the request store available to cache</span><span class="s3">\n </span><span class="s1">* functions.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type CacheStore = UseCacheStore | UnstableCacheStore</span><span class="s3">\n\n</span><span class="s1">export type WorkUnitStore = RequestStore | CacheStore | PrerenderStore</span><span class="s3">\n\n</span><span class="s1">export type WorkUnitAsyncStorage = AsyncLocalStorage&lt;WorkUnitStore&gt;</span><span class="s3">\n\n</span><span class="s1">export { workUnitAsyncStorageInstance as workUnitAsyncStorage }</span><span class="s3">\n\n</span><span class="s1">export function throwForMissingRequestStore(callingExpression: string): never {</span><span class="s3">\n  </span><span class="s1">throw new Error(</span><span class="s3">\n    </span><span class="s1">`</span><span class="s3">\\</span><span class="s1">`${callingExpression}</span><span class="s3">\\</span><span class="s1">` was called outside a request scope. Read more: https://nextjs.org/docs/messages/next-dynamic-api-wrong-context`</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function throwInvariantForMissingStore(): never {</span><span class="s3">\n  </span><span class="s1">throw new InvariantError('Expected workUnitAsyncStorage to have a store.')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getPrerenderResumeDataCache(</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): PrerenderResumeDataCache | null {</span><span class="s3">\n  </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n    </span><span class="s1">case 'prerender':</span><span class="s3">\n    </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n    </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">return workUnitStore.prerenderResumeDataCache</span><span class="s3">\n    </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">// TODO eliminate fetch caching in client scope and stop exposing this data</span><span class="s3">\n      </span><span class="s1">// cache during SSR.</span><span class="s3">\n      </span><span class="s1">return workUnitStore.prerenderResumeDataCache</span><span class="s3">\n    </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n    </span><span class="s1">case 'request':</span><span class="s3">\n    </span><span class="s1">case 'cache':</span><span class="s3">\n    </span><span class="s1">case 'private-cache':</span><span class="s3">\n    </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">default:</span><span class="s3">\n      </span><span class="s1">return workUnitStore satisfies never</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getRenderResumeDataCache(</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): RenderResumeDataCache | null {</span><span class="s3">\n  </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n    </span><span class="s1">case 'request':</span><span class="s3">\n      </span><span class="s1">return workUnitStore.renderResumeDataCache</span><span class="s3">\n    </span><span class="s1">case 'prerender':</span><span class="s3">\n    </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n    </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">if (workUnitStore.renderResumeDataCache) {</span><span class="s3">\n        </span><span class="s1">// If we are in a prerender, we might have a render resume data cache</span><span class="s3">\n        </span><span class="s1">// that is used to read from prefilled caches.</span><span class="s3">\n        </span><span class="s1">return workUnitStore.renderResumeDataCache</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// fallthrough</span><span class="s3">\n    </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">// Otherwise we return the mutable resume data cache here as an immutable</span><span class="s3">\n      </span><span class="s1">// version of the cache as it can also be used for reading.</span><span class="s3">\n      </span><span class="s1">return workUnitStore.prerenderResumeDataCache</span><span class="s3">\n    </span><span class="s1">case 'cache':</span><span class="s3">\n    </span><span class="s1">case 'private-cache':</span><span class="s3">\n    </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n    </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">default:</span><span class="s3">\n      </span><span class="s1">return workUnitStore satisfies never</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getHmrRefreshHash(</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore,</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): string | undefined {</span><span class="s3">\n  </span><span class="s1">if (workStore.dev) {</span><span class="s3">\n    </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n      </span><span class="s1">case 'cache':</span><span class="s3">\n      </span><span class="s1">case 'private-cache':</span><span class="s3">\n      </span><span class="s1">case 'prerender':</span><span class="s3">\n      </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n        </span><span class="s1">return workUnitStore.hmrRefreshHash</span><span class="s3">\n      </span><span class="s1">case 'request':</span><span class="s3">\n        </span><span class="s1">return workUnitStore.cookies.get(NEXT_HMR_REFRESH_HASH_COOKIE)?.value</span><span class="s3">\n      </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n      </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">workUnitStore satisfies never</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return undefined</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function isHmrRefresh(</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore,</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): boolean {</span><span class="s3">\n  </span><span class="s1">if (workStore.dev) {</span><span class="s3">\n    </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n      </span><span class="s1">case 'cache':</span><span class="s3">\n      </span><span class="s1">case 'private-cache':</span><span class="s3">\n      </span><span class="s1">case 'request':</span><span class="s3">\n        </span><span class="s1">return workUnitStore.isHmrRefresh ?? false</span><span class="s3">\n      </span><span class="s1">case 'prerender':</span><span class="s3">\n      </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n      </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n      </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">workUnitStore satisfies never</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getServerComponentsHmrCache(</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore,</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): ServerComponentsHmrCache | undefined {</span><span class="s3">\n  </span><span class="s1">if (workStore.dev) {</span><span class="s3">\n    </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n      </span><span class="s1">case 'cache':</span><span class="s3">\n      </span><span class="s1">case 'private-cache':</span><span class="s3">\n      </span><span class="s1">case 'request':</span><span class="s3">\n        </span><span class="s1">return workUnitStore.serverComponentsHmrCache</span><span class="s3">\n      </span><span class="s1">case 'prerender':</span><span class="s3">\n      </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n      </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n      </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">workUnitStore satisfies never</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return undefined</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Returns a draft mode provider only if draft mode is enabled.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function getDraftModeProviderForCacheScope(</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore,</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): DraftModeProvider | undefined {</span><span class="s3">\n  </span><span class="s1">if (workStore.isDraftMode) {</span><span class="s3">\n    </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n      </span><span class="s1">case 'cache':</span><span class="s3">\n      </span><span class="s1">case 'private-cache':</span><span class="s3">\n      </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n      </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n      </span><span class="s1">case 'request':</span><span class="s3">\n        </span><span class="s1">return workUnitStore.draftMode</span><span class="s3">\n      </span><span class="s1">case 'prerender':</span><span class="s3">\n      </span><span class="s1">case 'prerender-client':</span><span class="s3">\n      </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n      </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">workUnitStore satisfies never</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return undefined</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getCacheSignal(</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): CacheSignal | null {</span><span class="s3">\n  </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n    </span><span class="s1">case 'prerender':</span><span class="s3">\n    </span><span class="s1">case 'prerender-client':</span><span class="s3">\n    </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n      </span><span class="s1">return workUnitStore.cacheSignal</span><span class="s3">\n    </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n    </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n    </span><span class="s1">case 'request':</span><span class="s3">\n    </span><span class="s1">case 'cache':</span><span class="s3">\n    </span><span class="s1">case 'private-cache':</span><span class="s3">\n    </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">default:</span><span class="s3">\n      </span><span class="s1">return workUnitStore satisfies never</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getRuntimeStagePromise(</span><span class="s3">\n  </span><span class="s1">workUnitStore: WorkUnitStore</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; | null {</span><span class="s3">\n  </span><span class="s1">switch (workUnitStore.type) {</span><span class="s3">\n    </span><span class="s1">case 'prerender-runtime':</span><span class="s3">\n    </span><span class="s1">case 'private-cache':</span><span class="s3">\n      </span><span class="s1">return workUnitStore.runtimeStagePromise</span><span class="s3">\n    </span><span class="s1">case 'prerender':</span><span class="s3">\n    </span><span class="s1">case 'prerender-client':</span><span class="s3">\n    </span><span class="s1">case 'prerender-ppr':</span><span class="s3">\n    </span><span class="s1">case 'prerender-legacy':</span><span class="s3">\n    </span><span class="s1">case 'request':</span><span class="s3">\n    </span><span class="s1">case 'cache':</span><span class="s3">\n    </span><span class="s1">case 'unstable-cache':</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">default:</span><span class="s3">\n      </span><span class="s1">return workUnitStore satisfies never</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;getCacheSignal&quot;</span><span class="s0">,</span><span class="s1">&quot;getDraftModeProviderForCacheScope&quot;</span><span class="s0">,</span><span class="s1">&quot;getHmrRefreshHash&quot;</span><span class="s0">,</span><span class="s1">&quot;getPrerenderResumeDataCache&quot;</span><span class="s0">,</span><span class="s1">&quot;getRenderResumeDataCache&quot;</span><span class="s0">,</span><span class="s1">&quot;getRuntimeStagePromise&quot;</span><span class="s0">,</span><span class="s1">&quot;getServerComponentsHmrCache&quot;</span><span class="s0">,</span><span class="s1">&quot;isHmrRefresh&quot;</span><span class="s0">,</span><span class="s1">&quot;throwForMissingRequestStore&quot;</span><span class="s0">,</span><span class="s1">&quot;throwInvariantForMissingStore&quot;</span><span class="s0">,</span><span class="s1">&quot;workUnitAsyncStorage&quot;</span><span class="s0">,</span><span class="s1">&quot;workUnitAsyncStorageInstance&quot;</span><span class="s0">,</span><span class="s1">&quot;callingExpression&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;InvariantError&quot;</span><span class="s0">,</span><span class="s1">&quot;workUnitStore&quot;</span><span class="s0">,</span><span class="s1">&quot;type&quot;</span><span class="s0">,</span><span class="s1">&quot;prerenderResumeDataCache&quot;</span><span class="s0">,</span><span class="s1">&quot;renderResumeDataCache&quot;</span><span class="s0">,</span><span class="s1">&quot;workStore&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;hmrRefreshHash&quot;</span><span class="s0">,</span><span class="s1">&quot;cookies&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_HMR_REFRESH_HASH_COOKIE&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;serverComponentsHmrCache&quot;</span><span class="s0">,</span><span class="s1">&quot;isDraftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;draftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheSignal&quot;</span><span class="s0">,</span><span class="s1">&quot;runtimeStagePromise&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>