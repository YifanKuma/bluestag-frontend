<html>
<head>
<title>inline-static-env.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
inline-static-env.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/lib/inline-static-env.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import fs from 'fs'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import crypto from 'crypto'</span><span class="s3">\n</span><span class="s1">import { promisify } from 'util'</span><span class="s3">\n</span><span class="s1">import globOriginal from 'next/dist/compiled/glob'</span><span class="s3">\n</span><span class="s1">import { Sema } from 'next/dist/compiled/async-sema'</span><span class="s3">\n</span><span class="s1">import type { NextConfigComplete } from '../server/config-shared'</span><span class="s3">\n</span><span class="s1">import { getNextConfigEnv, getStaticEnv } from './static-env'</span><span class="s3">\n\n</span><span class="s1">const glob = promisify(globOriginal)</span><span class="s3">\n\n</span><span class="s1">export async function inlineStaticEnv({</span><span class="s3">\n  </span><span class="s1">distDir,</span><span class="s3">\n  </span><span class="s1">config,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">distDir: string</span><span class="s3">\n  </span><span class="s1">config: NextConfigComplete</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">const nextConfigEnv = getNextConfigEnv(config)</span><span class="s3">\n  </span><span class="s1">const staticEnv = getStaticEnv(config)</span><span class="s3">\n\n  </span><span class="s1">const serverDir = path.join(distDir, 'server')</span><span class="s3">\n  </span><span class="s1">const serverChunks = await glob('**/*.{js,json,js.map}', {</span><span class="s3">\n    </span><span class="s1">cwd: serverDir,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">const clientDir = path.join(distDir, 'static')</span><span class="s3">\n  </span><span class="s1">const clientChunks = await glob('**/*.{js,json,js.map}', {</span><span class="s3">\n    </span><span class="s1">cwd: clientDir,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">const manifestChunks = await glob('*.{js,json,js.map}', {</span><span class="s3">\n    </span><span class="s1">cwd: distDir,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">const inlineSema = new Sema(8)</span><span class="s3">\n  </span><span class="s1">const nextConfigEnvKeys = Object.keys(nextConfigEnv).map((item) =&gt;</span><span class="s3">\n    </span><span class="s1">item.split('process.env.').pop()</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const builtRegEx = new RegExp(</span><span class="s3">\n    </span><span class="s1">`[</span><span class="s3">\\\\</span><span class="s1">w]{1,}(</span><span class="s3">\\\\</span><span class="s1">.env)?</span><span class="s3">\\\\</span><span class="s1">.(?:NEXT_PUBLIC_[</span><span class="s3">\\\\</span><span class="s1">w]{1,}${nextConfigEnvKeys.length ? '|' + nextConfigEnvKeys.join('|') : ''})`,</span><span class="s3">\n    </span><span class="s1">'g'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">const changedClientFiles: Array&lt;{ file: string; content: string }&gt; = []</span><span class="s3">\n  </span><span class="s1">const filesToCheck = new Set&lt;string&gt;(</span><span class="s3">\n    </span><span class="s1">manifestChunks.map((f) =&gt; path.join(distDir, f))</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">for (const [parentDir, files] of [</span><span class="s3">\n    </span><span class="s1">[serverDir, serverChunks],</span><span class="s3">\n    </span><span class="s1">[clientDir, clientChunks],</span><span class="s3">\n  </span><span class="s1">] as const) {</span><span class="s3">\n    </span><span class="s1">await Promise.all(</span><span class="s3">\n      </span><span class="s1">files.map(async (file) =&gt; {</span><span class="s3">\n        </span><span class="s1">await inlineSema.acquire()</span><span class="s3">\n        </span><span class="s1">const filepath = path.join(parentDir, file)</span><span class="s3">\n        </span><span class="s1">const content = await fs.promises.readFile(filepath, 'utf8')</span><span class="s3">\n        </span><span class="s1">const newContent = content.replace(builtRegEx, (match) =&gt; {</span><span class="s3">\n          </span><span class="s1">let normalizedMatch = `process.env.${match.split('.').pop()}`</span><span class="s3">\n\n          </span><span class="s1">if (staticEnv[normalizedMatch]) {</span><span class="s3">\n            </span><span class="s1">return JSON.stringify(staticEnv[normalizedMatch])</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">return match</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">await fs.promises.writeFile(filepath, newContent)</span><span class="s3">\n\n        </span><span class="s1">if (content !== newContent &amp;&amp; parentDir === clientDir) {</span><span class="s3">\n          </span><span class="s1">changedClientFiles.push({ file, content: newContent })</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">filesToCheck.add(filepath)</span><span class="s3">\n        </span><span class="s1">inlineSema.release()</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const hashChanges: Array&lt;{</span><span class="s3">\n    </span><span class="s1">originalHash: string</span><span class="s3">\n    </span><span class="s1">newHash: string</span><span class="s3">\n  </span><span class="s1">}&gt; = []</span><span class="s3">\n\n  </span><span class="s1">// hashes need updating for any changed client files</span><span class="s3">\n  </span><span class="s1">for (const { file, content } of changedClientFiles) {</span><span class="s3">\n    </span><span class="s1">// hash is 16 chars currently for all client chunks</span><span class="s3">\n    </span><span class="s1">const originalHash = file.match(/([a-z0-9]{16})</span><span class="s3">\\</span><span class="s1">./)?.[1] || ''</span><span class="s3">\n\n    </span><span class="s1">if (!originalHash) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">`Invariant: client chunk changed but failed to detect hash ${file}`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">const newHash = crypto</span><span class="s3">\n      </span><span class="s1">.createHash('sha256')</span><span class="s3">\n      </span><span class="s1">.update(content)</span><span class="s3">\n      </span><span class="s1">.digest('hex')</span><span class="s3">\n      </span><span class="s1">.substring(0, 16)</span><span class="s3">\n\n    </span><span class="s1">hashChanges.push({ originalHash, newHash })</span><span class="s3">\n\n    </span><span class="s1">const filepath = path.join(clientDir, file)</span><span class="s3">\n    </span><span class="s1">const newFilepath = filepath.replace(originalHash, newHash)</span><span class="s3">\n\n    </span><span class="s1">filesToCheck.delete(filepath)</span><span class="s3">\n    </span><span class="s1">filesToCheck.add(newFilepath)</span><span class="s3">\n\n    </span><span class="s1">await fs.promises.rename(filepath, newFilepath)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// update build-manifest and webpack-runtime with new hashes</span><span class="s3">\n  </span><span class="s1">for (let file of filesToCheck) {</span><span class="s3">\n    </span><span class="s1">const content = await fs.promises.readFile(file, 'utf-8')</span><span class="s3">\n    </span><span class="s1">let newContent = content</span><span class="s3">\n\n    </span><span class="s1">for (const { originalHash, newHash } of hashChanges) {</span><span class="s3">\n      </span><span class="s1">newContent = newContent.replaceAll(originalHash, newHash)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (content !== newContent) {</span><span class="s3">\n      </span><span class="s1">await fs.promises.writeFile(file, newContent)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;inlineStaticEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;glob&quot;</span><span class="s0">,</span><span class="s1">&quot;promisify&quot;</span><span class="s0">,</span><span class="s1">&quot;globOriginal&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;nextConfigEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;getNextConfigEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;staticEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;getStaticEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;serverDir&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;serverChunks&quot;</span><span class="s0">,</span><span class="s1">&quot;cwd&quot;</span><span class="s0">,</span><span class="s1">&quot;clientDir&quot;</span><span class="s0">,</span><span class="s1">&quot;clientChunks&quot;</span><span class="s0">,</span><span class="s1">&quot;manifestChunks&quot;</span><span class="s0">,</span><span class="s1">&quot;inlineSema&quot;</span><span class="s0">,</span><span class="s1">&quot;Sema&quot;</span><span class="s0">,</span><span class="s1">&quot;nextConfigEnvKeys&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;item&quot;</span><span class="s0">,</span><span class="s1">&quot;split&quot;</span><span class="s0">,</span><span class="s1">&quot;pop&quot;</span><span class="s0">,</span><span class="s1">&quot;builtRegEx&quot;</span><span class="s0">,</span><span class="s1">&quot;RegExp&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;changedClientFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;filesToCheck&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;f&quot;</span><span class="s0">,</span><span class="s1">&quot;parentDir&quot;</span><span class="s0">,</span><span class="s1">&quot;files&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;acquire&quot;</span><span class="s0">,</span><span class="s1">&quot;filepath&quot;</span><span class="s0">,</span><span class="s1">&quot;content&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;promises&quot;</span><span class="s0">,</span><span class="s1">&quot;readFile&quot;</span><span class="s0">,</span><span class="s1">&quot;newContent&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;match&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizedMatch&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;writeFile&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;release&quot;</span><span class="s0">,</span><span class="s1">&quot;hashChanges&quot;</span><span class="s0">,</span><span class="s1">&quot;originalHash&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;newHash&quot;</span><span class="s0">,</span><span class="s1">&quot;crypto&quot;</span><span class="s0">,</span><span class="s1">&quot;createHash&quot;</span><span class="s0">,</span><span class="s1">&quot;update&quot;</span><span class="s0">,</span><span class="s1">&quot;digest&quot;</span><span class="s0">,</span><span class="s1">&quot;substring&quot;</span><span class="s0">,</span><span class="s1">&quot;newFilepath&quot;</span><span class="s0">,</span><span class="s1">&quot;delete&quot;</span><span class="s0">,</span><span class="s1">&quot;rename&quot;</span><span class="s0">,</span><span class="s1">&quot;replaceAll&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>