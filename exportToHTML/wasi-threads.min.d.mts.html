<html>
<head>
<title>wasi-threads.min.d.mts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
wasi-threads.min.d.mts</font>
</center></td></tr></table>
<pre><span class="s0">/// &lt;reference types=&quot;node&quot; /&gt;</span>

<span class="s2">import </span><span class="s1">type { Worker as Worker_2 } from </span><span class="s3">'worker_threads'</span><span class="s1">;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">BaseOptions {</span>
    <span class="s1">wasi: WASIInstance;</span>
    <span class="s1">version?: </span><span class="s3">'preview1'</span><span class="s1">;</span>
    <span class="s1">wasm64?: boolean;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ChildThreadOptions </span><span class="s2">extends </span><span class="s1">BaseOptions {</span>
    <span class="s1">childThread: </span><span class="s2">true</span><span class="s1">;</span>
    <span class="s1">postMessage?: (data: any) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">CleanupThreadPayload {</span>
    <span class="s1">tid: number;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">CommandInfo&lt;T </span><span class="s2">extends </span><span class="s1">CommandType&gt; {</span>
    <span class="s1">type: T;</span>
    <span class="s1">payload: CommandPayloadMap[T];</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">CommandPayloadMap {</span>
    <span class="s1">load: LoadPayload;</span>
    <span class="s1">loaded: LoadedPayload;</span>
    <span class="s1">start: StartPayload;</span>
    <span class="s3">'cleanup-thread'</span><span class="s1">: CleanupThreadPayload;</span>
    <span class="s3">'terminate-all-threads'</span><span class="s1">: TerminateAllThreadsPayload;</span>
    <span class="s3">'spawn-thread'</span><span class="s1">: SpawnThreadPayload;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type CommandType = keyof CommandPayloadMap;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">function </span><span class="s1">createInstanceProxy(instance: WebAssembly.Instance, memory?: WebAssembly.Memory | (() =&gt; WebAssembly.Memory)): WebAssembly.Instance;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">function </span><span class="s1">isSharedArrayBuffer(value: any): value is SharedArrayBuffer;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">function </span><span class="s1">isTrapError(e: Error): e is WebAssembly.RuntimeError;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">LoadedPayload {</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">LoadPayload {</span>
    <span class="s1">wasmModule: WebAssembly.Module;</span>
    <span class="s1">wasmMemory: WebAssembly.Memory;</span>
    <span class="s1">sab?: Int32Array;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">MainThreadBaseOptions </span><span class="s2">extends </span><span class="s1">BaseOptions {</span>
    <span class="s1">waitThreadStart?: boolean | number;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type MainThreadOptions = MainThreadOptionsWithThreadManager | MainThreadOptionsCreateThreadManager;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">MainThreadOptionsCreateThreadManager </span><span class="s2">extends </span><span class="s1">MainThreadBaseOptions, ThreadManagerOptionsMain {</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">MainThreadOptionsWithThreadManager </span><span class="s2">extends </span><span class="s1">MainThreadBaseOptions {</span>
    <span class="s1">threadManager?: ThreadManager | (() =&gt; ThreadManager);</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">MessageEventData&lt;T </span><span class="s2">extends </span><span class="s1">CommandType&gt; {</span>
    <span class="s1">__emnapi__: CommandInfo&lt;T&gt;;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ReuseWorkerOptions {</span>
    <span class="s0">/**</span>
     <span class="s0">* </span><span class="s4">@see </span><span class="s0">{</span><span class="s4">@link </span><span class="s0">https://emscripten.org/docs/tools_reference/settings_reference.html#pthread-pool-size | PTHREAD_POOL_SIZE}</span>
     <span class="s0">*/</span>
    <span class="s1">size: number;</span>
    <span class="s0">/**</span>
     <span class="s0">* </span><span class="s4">@see </span><span class="s0">{</span><span class="s4">@link </span><span class="s0">https://emscripten.org/docs/tools_reference/settings_reference.html#pthread-pool-size-strict | PTHREAD_POOL_SIZE_STRICT}</span>
     <span class="s0">*/</span>
    <span class="s1">strict?: boolean;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">SpawnThreadPayload {</span>
    <span class="s1">startArg: number;</span>
    <span class="s1">errorOrTid: number;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">StartPayload {</span>
    <span class="s1">tid: number;</span>
    <span class="s1">arg: number;</span>
    <span class="s1">sab?: Int32Array;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">StartResult {</span>
    <span class="s1">exitCode: number;</span>
    <span class="s1">instance: WebAssembly.Instance;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">TerminateAllThreadsPayload {</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">class </span><span class="s1">ThreadManager {</span>
    <span class="s1">unusedWorkers: WorkerLike[];</span>
    <span class="s1">runningWorkers: WorkerLike[];</span>
    <span class="s1">pthreads: Record&lt;number, WorkerLike&gt;;</span>
    <span class="s1">get nextWorkerID(): number;</span>
    <span class="s1">wasmModule: WebAssembly.Module | </span><span class="s2">null</span><span class="s1">;</span>
    <span class="s1">wasmMemory: WebAssembly.Memory | </span><span class="s2">null</span><span class="s1">;</span>
    <span class="s2">private </span><span class="s1">readonly messageEvents;</span>
    <span class="s2">private </span><span class="s1">readonly _childThread;</span>
    <span class="s2">private </span><span class="s1">readonly _onCreateWorker;</span>
    <span class="s2">private </span><span class="s1">readonly _reuseWorker;</span>
    <span class="s2">private </span><span class="s1">readonly _beforeLoad?;</span>
    <span class="s0">/* Excluded from this release type: printErr */</span>
    <span class="s1">constructor(options: ThreadManagerOptions);</span>
    <span class="s1">init(): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">initMainThread(): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s2">private </span><span class="s1">preparePool;</span>
    <span class="s1">shouldPreloadWorkers(): boolean;</span>
    <span class="s1">loadWasmModuleToAllWorkers(): Promise&lt;WorkerLike[]&gt;;</span>
    <span class="s1">preloadWorkers(): Promise&lt;WorkerLike[]&gt;;</span>
    <span class="s1">setup(wasmModule: WebAssembly.Module, wasmMemory: WebAssembly.Memory): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">markId(worker: WorkerLike): number;</span>
    <span class="s1">returnWorkerToPool(worker: WorkerLike): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">loadWasmModuleToWorker(worker: WorkerLike, sab?: Int32Array): Promise&lt;WorkerLike&gt;;</span>
    <span class="s1">allocateUnusedWorker(): WorkerLike;</span>
    <span class="s1">getNewWorker(sab?: Int32Array): WorkerLike | undefined;</span>
    <span class="s1">cleanThread(worker: WorkerLike, tid: number, force?: boolean): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">terminateWorker(worker: WorkerLike): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">terminateAllThreads(): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">addMessageEventListener(worker: WorkerLike, onMessage: (e: WorkerMessageEvent) =&gt; </span><span class="s2">void</span><span class="s1">): () =&gt; </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">fireMessageEvent(worker: WorkerLike, e: WorkerMessageEvent): </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type ThreadManagerOptions = ThreadManagerOptionsMain | ThreadManagerOptionsChild;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ThreadManagerOptionsBase {</span>
    <span class="s1">printErr?: (message: string) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ThreadManagerOptionsChild </span><span class="s2">extends </span><span class="s1">ThreadManagerOptionsBase {</span>
    <span class="s1">childThread: </span><span class="s2">true</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ThreadManagerOptionsMain </span><span class="s2">extends </span><span class="s1">ThreadManagerOptionsBase {</span>
    <span class="s1">beforeLoad?: (worker: WorkerLike) =&gt; any;</span>
    <span class="s1">reuseWorker?: boolean | number | ReuseWorkerOptions;</span>
    <span class="s1">onCreateWorker: WorkerFactory;</span>
    <span class="s1">childThread?: </span><span class="s2">false</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">class </span><span class="s1">ThreadMessageHandler {</span>
    <span class="s2">protected </span><span class="s1">instance: WebAssembly.Instance | undefined;</span>
    <span class="s2">private </span><span class="s1">messagesBeforeLoad;</span>
    <span class="s2">protected </span><span class="s1">postMessage: (message: any) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s2">protected </span><span class="s1">onLoad?: (data: LoadPayload) =&gt; WebAssembly.WebAssemblyInstantiatedSource | PromiseLike&lt;WebAssembly.WebAssemblyInstantiatedSource&gt;;</span>
    <span class="s2">protected </span><span class="s1">onError: (error: Error, type: WorkerMessageType) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">constructor(options?: ThreadMessageHandlerOptions);</span>
    <span class="s0">/** </span><span class="s4">@virtual </span><span class="s0">*/</span>
    <span class="s1">instantiate(data: LoadPayload): WebAssembly.WebAssemblyInstantiatedSource | PromiseLike&lt;WebAssembly.WebAssemblyInstantiatedSource&gt;;</span>
    <span class="s0">/** </span><span class="s4">@virtual </span><span class="s0">*/</span>
    <span class="s1">handle(e: WorkerMessageEvent&lt;MessageEventData&lt;WorkerMessageType&gt;&gt;): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s2">private </span><span class="s1">_load;</span>
    <span class="s2">private </span><span class="s1">_start;</span>
    <span class="s2">protected </span><span class="s1">_loaded(err: Error | </span><span class="s2">null</span><span class="s1">, source: WebAssembly.WebAssemblyInstantiatedSource | </span><span class="s2">null</span><span class="s1">, payload: LoadPayload): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s2">protected </span><span class="s1">handleAfterLoad&lt;E </span><span class="s2">extends </span><span class="s1">WorkerMessageEvent&gt;(e: E, f: (e: E) =&gt; </span><span class="s2">void</span><span class="s1">): </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">ThreadMessageHandlerOptions {</span>
    <span class="s1">onLoad?: (data: LoadPayload) =&gt; WebAssembly.WebAssemblyInstantiatedSource | PromiseLike&lt;WebAssembly.WebAssemblyInstantiatedSource&gt;;</span>
    <span class="s1">onError?: (error: Error, type: WorkerMessageType) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">postMessage?: (message: any) =&gt; </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">WASIInstance {</span>
    <span class="s1">readonly wasiImport?: Record&lt;string, any&gt;;</span>
    <span class="s1">initialize(instance: object): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">start(instance: object): number;</span>
    <span class="s1">getImportObject?(): any;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">class </span><span class="s1">WASIThreads {</span>
    <span class="s1">PThread: ThreadManager | undefined;</span>
    <span class="s2">private </span><span class="s1">wasmMemory;</span>
    <span class="s2">private </span><span class="s1">wasmInstance;</span>
    <span class="s2">private </span><span class="s1">readonly threadSpawn;</span>
    <span class="s1">readonly childThread: boolean;</span>
    <span class="s2">private </span><span class="s1">readonly postMessage;</span>
    <span class="s1">readonly wasi: WASIInstance;</span>
    <span class="s1">constructor(options: WASIThreadsOptions);</span>
    <span class="s1">getImportObject(): {</span>
        <span class="s1">wasi: WASIThreadsImports;</span>
    <span class="s1">};</span>
    <span class="s1">setup(wasmInstance: WebAssembly.Instance, wasmModule: WebAssembly.Module, wasmMemory?: WebAssembly.Memory): </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">preloadWorkers(): Promise&lt;WorkerLike[]&gt;;</span>
    <span class="s0">/**</span>
     <span class="s0">* It's ok to call this method to a WASI command module.</span>
     <span class="s0">*</span>
     <span class="s0">* in child thread, must call this method instead of {</span><span class="s4">@link </span><span class="s0">WASIThreads.start} even if it's a WASI command module</span>
     <span class="s0">*</span>
     <span class="s0">* </span><span class="s4">@returns </span><span class="s0">A proxied WebAssembly instance if in child thread, other wise the original instance</span>
     <span class="s0">*/</span>
    <span class="s1">initialize(instance: WebAssembly.Instance, module: WebAssembly.Module, memory?: WebAssembly.Memory): WebAssembly.Instance;</span>
    <span class="s0">/**</span>
     <span class="s0">* Equivalent to calling {</span><span class="s4">@link </span><span class="s0">WASIThreads.initialize} and then calling {</span><span class="s4">@link </span><span class="s0">WASIInstance.start}</span>
     <span class="s0">* ```js</span>
     <span class="s0">* this.initialize(instance, module, memory)</span>
     <span class="s0">* this.wasi.start(instance)</span>
     <span class="s0">* ```</span>
     <span class="s0">*/</span>
    <span class="s1">start(instance: WebAssembly.Instance, module: WebAssembly.Module, memory?: WebAssembly.Memory): StartResult;</span>
    <span class="s1">terminateAllThreads(): </span><span class="s2">void</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">WASIThreadsImports {</span>
    <span class="s3">'thread-spawn'</span><span class="s1">: (startArg: number, errorOrTid?: number) =&gt; number;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type WASIThreadsOptions = MainThreadOptions | ChildThreadOptions;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type WorkerFactory = (ctx: {</span>
    <span class="s1">type: string;</span>
    <span class="s1">name: string;</span>
<span class="s1">}) =&gt; WorkerLike;</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type WorkerLike = (Worker | Worker_2) &amp; {</span>
    <span class="s1">whenLoaded?: Promise&lt;WorkerLike&gt;;</span>
    <span class="s1">loaded?: boolean;</span>
    <span class="s1">__emnapi_tid?: number;</span>
<span class="s1">};</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare </span><span class="s2">interface </span><span class="s1">WorkerMessageEvent&lt;T = any&gt; {</span>
    <span class="s1">data: T;</span>
<span class="s1">}</span>

<span class="s0">/** </span><span class="s4">@public </span><span class="s0">*/</span>
<span class="s2">export </span><span class="s1">declare type WorkerMessageType = </span><span class="s3">'load' </span><span class="s1">| </span><span class="s3">'start'</span><span class="s1">;</span>

<span class="s2">export </span><span class="s1">{ }</span>
</pre>
</body>
</html>