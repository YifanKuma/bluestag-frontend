<html>
<head>
<title>common.h</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #00627a;}
.s4 { color: #067d17;}
.s5 { color: #1750eb; font-style: italic;}
.s6 { color: #0037a6; font-style: italic;}
.s7 { color: #000000;}
.s8 { color: #871094; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
common.h</font>
</center></td></tr></table>
<pre><span class="s0">// Copyright 2013 Lovell Fuller and others.</span>
<span class="s0">// SPDX-License-Identifier: Apache-2.0</span>

<span class="s2">#ifndef </span><span class="s3">SRC_COMMON_H_</span>
<span class="s2">#define </span><span class="s3">SRC_COMMON_H_</span>

<span class="s2">#include </span><span class="s4">&lt;string&gt;</span>
<span class="s2">#include </span><span class="s4">&lt;tuple&gt;</span>
<span class="s2">#include </span><span class="s4">&lt;vector&gt;</span>
<span class="s2">#include </span><span class="s4">&lt;atomic&gt;</span>

<span class="s2">#include </span><span class="s4">&lt;napi.h&gt;</span>
<span class="s2">#include </span><span class="s4">&lt;vips/vips8&gt;</span>

<span class="s0">// Verify platform and compiler compatibility</span>

<span class="s2">#if </span><span class="s1">(</span><span class="s3">VIPS_MAJOR_VERSION </span><span class="s2">&lt; </span><span class="s5">8</span><span class="s1">) </span><span class="s2">|| </span><span class="s6">\ 
  </span><span class="s1">(</span><span class="s3">VIPS_MAJOR_VERSION </span><span class="s2">== </span><span class="s5">8 </span><span class="s2">&amp;&amp; </span><span class="s3">VIPS_MINOR_VERSION </span><span class="s2">&lt; </span><span class="s5">17</span><span class="s1">) </span><span class="s2">|| </span><span class="s6">\ 
  </span><span class="s1">(</span><span class="s3">VIPS_MAJOR_VERSION </span><span class="s2">== </span><span class="s5">8 </span><span class="s2">&amp;&amp; </span><span class="s3">VIPS_MINOR_VERSION </span><span class="s2">== </span><span class="s5">17 </span><span class="s2">&amp;&amp; </span><span class="s3">VIPS_MICRO_VERSION </span><span class="s2">&lt; </span><span class="s5">2</span><span class="s1">)</span>
<span class="s2">#error </span><span class="s4">&quot;libvips version 8.17.2+ is required - please see https://sharp.pixelplumbing.com/install&quot;</span>
<span class="s2">#endif</span>

<span class="s2">#if defined</span><span class="s1">(</span><span class="s3">__has_include</span><span class="s1">)</span>
<span class="s2">#if !</span>__has_include<span class="s1">(</span><span class="s2">&lt;</span><span class="s3">filesystem</span><span class="s2">&gt;</span><span class="s1">)</span>
<span class="s2">#error </span><span class="s4">&quot;C++17 compiler required - please see https://sharp.pixelplumbing.com/install&quot;</span>
<span class="s2">#endif</span>
<span class="s2">#endif</span>

<span class="s2">using </span>vips<span class="s1">::VImage;</span>

<span class="s2">namespace </span>sharp <span class="s1">{</span>

  <span class="s2">struct </span>InputDescriptor <span class="s1">{  </span><span class="s0">// NOLINT(runtime/indentation_namespace)</span>
    std<span class="s1">::string name;</span>
    std<span class="s1">::string file;</span>
    <span class="s2">bool </span><span class="s1">autoOrient;</span>
    <span class="s2">char *</span><span class="s1">buffer;</span>
    <span class="s1">VipsFailOn failOn;</span>
    <span class="s2">uint64_t </span><span class="s1">limitInputPixels;</span>
    <span class="s2">bool </span><span class="s1">unlimited;</span>
    <span class="s1">VipsAccess access;</span>
    <span class="s2">size_t </span><span class="s1">bufferLength;</span>
    <span class="s2">bool </span><span class="s1">isBuffer;</span>
    <span class="s2">double </span><span class="s1">density;</span>
    <span class="s2">bool </span><span class="s1">ignoreIcc;</span>
    <span class="s1">VipsBandFormat rawDepth;</span>
    <span class="s2">int </span><span class="s1">rawChannels;</span>
    <span class="s2">int </span><span class="s1">rawWidth;</span>
    <span class="s2">int </span><span class="s1">rawHeight;</span>
    <span class="s2">bool </span><span class="s1">rawPremultiplied;</span>
    <span class="s2">int </span><span class="s1">rawPageHeight;</span>
    <span class="s2">int </span><span class="s1">pages;</span>
    <span class="s2">int </span><span class="s1">page;</span>
    <span class="s2">int </span><span class="s1">createChannels;</span>
    <span class="s2">int </span><span class="s1">createWidth;</span>
    <span class="s2">int </span><span class="s1">createHeight;</span>
    <span class="s2">int </span><span class="s1">createPageHeight;</span>
    std<span class="s1">::vector</span><span class="s2">&lt;double&gt; </span><span class="s1">createBackground;</span>
    std<span class="s1">::string createNoiseType;</span>
    <span class="s2">double </span><span class="s1">createNoiseMean;</span>
    <span class="s2">double </span><span class="s1">createNoiseSigma;</span>
    std<span class="s1">::string textValue;</span>
    std<span class="s1">::string textFont;</span>
    std<span class="s1">::string textFontfile;</span>
    <span class="s2">int </span><span class="s1">textWidth;</span>
    <span class="s2">int </span><span class="s1">textHeight;</span>
    <span class="s1">VipsAlign textAlign;</span>
    <span class="s2">bool </span><span class="s1">textJustify;</span>
    <span class="s2">int </span><span class="s1">textDpi;</span>
    <span class="s2">bool </span><span class="s1">textRgba;</span>
    <span class="s2">int </span><span class="s1">textSpacing;</span>
    <span class="s1">VipsTextWrap textWrap;</span>
    <span class="s2">int </span><span class="s1">textAutofitDpi;</span>
    <span class="s2">bool </span><span class="s1">joinAnimated;</span>
    <span class="s2">int </span><span class="s1">joinAcross;</span>
    <span class="s2">int </span><span class="s1">joinShim;</span>
    std<span class="s1">::vector</span><span class="s2">&lt;double&gt; </span><span class="s1">joinBackground;</span>
    <span class="s1">VipsAlign joinHalign;</span>
    <span class="s1">VipsAlign joinValign;</span>
    std<span class="s1">::string svgStylesheet;</span>
    <span class="s2">bool </span><span class="s1">svgHighBitdepth;</span>
    <span class="s2">int </span><span class="s1">tiffSubifd;</span>
    <span class="s2">int </span><span class="s1">openSlideLevel;</span>
    std<span class="s1">::vector</span><span class="s2">&lt;double&gt; </span><span class="s1">pdfBackground;</span>
    <span class="s2">bool </span><span class="s1">jp2Oneshot;</span>

    <span class="s3">InputDescriptor</span><span class="s1">():</span>
      <span class="s3">autoOrient</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">buffer</span><span class="s1">(</span><span class="s8">nullptr</span><span class="s1">),</span>
      <span class="s3">failOn</span><span class="s1">(VIPS_FAIL_ON_WARNING),</span>
      <span class="s3">limitInputPixels</span><span class="s1">(</span><span class="s2">0x</span><span class="s5">3FFF </span><span class="s2">* 0x</span><span class="s5">3FFF</span><span class="s1">),</span>
      <span class="s3">unlimited</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">access</span><span class="s1">(VIPS_ACCESS_SEQUENTIAL),</span>
      <span class="s3">bufferLength</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">isBuffer</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">density</span><span class="s1">(</span><span class="s5">72.0</span><span class="s1">),</span>
      <span class="s3">ignoreIcc</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">rawDepth</span><span class="s1">(VIPS_FORMAT_UCHAR),</span>
      <span class="s3">rawChannels</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">rawWidth</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">rawHeight</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">rawPremultiplied</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">rawPageHeight</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">pages</span><span class="s1">(</span><span class="s5">1</span><span class="s1">),</span>
      <span class="s3">page</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">createChannels</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">createWidth</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">createHeight</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">createPageHeight</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">createBackground</span><span class="s1">{ </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">255.0 </span><span class="s1">},</span>
      <span class="s3">createNoiseMean</span><span class="s1">(</span><span class="s5">0.0</span><span class="s1">),</span>
      <span class="s3">createNoiseSigma</span><span class="s1">(</span><span class="s5">0.0</span><span class="s1">),</span>
      <span class="s3">textWidth</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">textHeight</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">textAlign</span><span class="s1">(VIPS_ALIGN_LOW),</span>
      <span class="s3">textJustify</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">textDpi</span><span class="s1">(</span><span class="s5">72</span><span class="s1">),</span>
      <span class="s3">textRgba</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">textSpacing</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">textWrap</span><span class="s1">(VIPS_TEXT_WRAP_WORD),</span>
      <span class="s3">textAutofitDpi</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">joinAnimated</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">joinAcross</span><span class="s1">(</span><span class="s5">1</span><span class="s1">),</span>
      <span class="s3">joinShim</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">joinBackground</span><span class="s1">{ </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">0.0</span><span class="s1">, </span><span class="s5">255.0 </span><span class="s1">},</span>
      <span class="s3">joinHalign</span><span class="s1">(VIPS_ALIGN_LOW),</span>
      <span class="s3">joinValign</span><span class="s1">(VIPS_ALIGN_LOW),</span>
      <span class="s3">svgHighBitdepth</span><span class="s1">(</span><span class="s8">false</span><span class="s1">),</span>
      <span class="s3">tiffSubifd</span><span class="s1">(</span><span class="s2">-</span><span class="s5">1</span><span class="s1">),</span>
      <span class="s3">openSlideLevel</span><span class="s1">(</span><span class="s5">0</span><span class="s1">),</span>
      <span class="s3">pdfBackground</span><span class="s1">{ </span><span class="s5">255.0</span><span class="s1">, </span><span class="s5">255.0</span><span class="s1">, </span><span class="s5">255.0</span><span class="s1">, </span><span class="s5">255.0 </span><span class="s1">},</span>
      <span class="s3">jp2Oneshot</span><span class="s1">(</span><span class="s8">false</span><span class="s1">) {}</span>
  <span class="s1">};</span>

  <span class="s0">// Convenience methods to access the attributes of a Napi::Object</span>
  <span class="s1">bool </span><span class="s3">HasAttr</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  std<span class="s1">::string </span><span class="s3">AttrAsStr</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  std<span class="s1">::string </span><span class="s3">AttrAsStr</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span><span class="s2">unsigned int const </span>attr<span class="s1">);</span>
  <span class="s1">uint32_t </span><span class="s3">AttrAsUint32</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  <span class="s1">int32_t </span><span class="s3">AttrAsInt32</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  <span class="s1">int32_t </span><span class="s3">AttrAsInt32</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span><span class="s2">unsigned int const </span>attr<span class="s1">);</span>
  <span class="s1">double </span><span class="s3">AttrAsDouble</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  <span class="s1">double </span><span class="s3">AttrAsDouble</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span><span class="s2">unsigned int const </span>attr<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">AttrAsBool</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  std<span class="s1">::vector&lt;double&gt; </span><span class="s3">AttrAsVectorOfDouble</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  std<span class="s1">::vector&lt;int32_t&gt; </span><span class="s3">AttrAsInt32Vector</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">);</span>
  <span class="s2">template </span><span class="s1">&lt;</span><span class="s2">class </span>T<span class="s1">&gt; T </span><span class="s3">AttrAsEnum</span><span class="s1">(</span>Napi<span class="s1">::</span>Object obj<span class="s1">, </span>std<span class="s1">::</span>string attr<span class="s1">, </span>GType type<span class="s1">) {</span>
    <span class="s2">return static_cast&lt;</span><span class="s1">T</span><span class="s2">&gt;</span><span class="s1">(</span>
      <span class="s3">vips_enum_from_nick</span><span class="s1">(</span><span class="s8">nullptr</span><span class="s1">, type, </span><span class="s3">AttrAsStr</span><span class="s1">(obj, attr).</span><span class="s3">data</span><span class="s1">()));</span>
  <span class="s1">}</span>

  <span class="s0">// Create an InputDescriptor instance from a Napi::Object describing an input image</span>
  <span class="s1">InputDescriptor</span><span class="s2">* </span><span class="s3">CreateInputDescriptor</span><span class="s1">(</span>Napi<span class="s1">::</span>Object input<span class="s1">);</span>

  <span class="s2">enum class </span>ImageType <span class="s1">{</span>
    JPEG<span class="s1">,</span>
    PNG<span class="s1">,</span>
    WEBP<span class="s1">,</span>
    JP2<span class="s1">,</span>
    TIFF<span class="s1">,</span>
    GIF<span class="s1">,</span>
    SVG<span class="s1">,</span>
    HEIF<span class="s1">,</span>
    PDF<span class="s1">,</span>
    MAGICK<span class="s1">,</span>
    OPENSLIDE<span class="s1">,</span>
    PPM<span class="s1">,</span>
    FITS<span class="s1">,</span>
    EXR<span class="s1">,</span>
    JXL<span class="s1">,</span>
    RAD<span class="s1">,</span>
    DCRAW<span class="s1">,</span>
    VIPS<span class="s1">,</span>
    RAW<span class="s1">,</span>
    UNKNOWN<span class="s1">,</span>
    MISSING
  <span class="s1">};</span>

  <span class="s2">enum class </span>Canvas <span class="s1">{</span>
      CROP<span class="s1">,</span>
      EMBED<span class="s1">,</span>
      MAX<span class="s1">,</span>
      MIN<span class="s1">,</span>
      IGNORE_ASPECT
  <span class="s1">};</span>

  <span class="s0">// How many tasks are in the queue?</span>
  <span class="s2">extern </span>std<span class="s1">::atomic</span><span class="s2">&lt;int&gt; </span><span class="s1">counterQueue;</span>

  <span class="s0">// How many tasks are being processed?</span>
  <span class="s2">extern </span>std<span class="s1">::atomic</span><span class="s2">&lt;int&gt; </span><span class="s1">counterProcess;</span>

  <span class="s0">// Filename extension checkers</span>
  <span class="s1">bool </span><span class="s3">IsJpeg</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsPng</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsWebp</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsJp2</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsGif</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsTiff</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsHeic</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsHeif</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsAvif</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsJxl</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsDz</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsDzZip</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>
  <span class="s1">bool </span><span class="s3">IsV</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Trim space from end of string. 
  */</span>
  std<span class="s1">::string </span><span class="s3">TrimEnd</span><span class="s1">(</span>std<span class="s1">::</span>string <span class="s2">const &amp;</span>str<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Provide a string identifier for the given image type. 
  */</span>
  std<span class="s1">::string </span><span class="s3">ImageTypeId</span><span class="s1">(</span>ImageType <span class="s2">const </span>imageType<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Determine image format of a buffer. 
  */</span>
  <span class="s1">ImageType </span><span class="s3">DetermineImageType</span><span class="s1">(</span><span class="s2">void *</span>buffer<span class="s1">, </span><span class="s2">size_t const </span>length<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Determine image format of a file. 
  */</span>
  <span class="s1">ImageType </span><span class="s3">DetermineImageType</span><span class="s1">(</span><span class="s2">char const *</span>file<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Format-specific options builder 
  */</span>
  vips<span class="s1">::VOption</span><span class="s2">* </span><span class="s3">GetOptionsForImageType</span><span class="s1">(</span>ImageType imageType<span class="s1">, </span>InputDescriptor <span class="s2">*</span>descriptor<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Open an image from the given InputDescriptor (filesystem, compressed buffer, raw pixel data) 
  */</span>
  std<span class="s1">::tuple&lt;VImage, ImageType&gt; </span><span class="s3">OpenInput</span><span class="s1">(</span>InputDescriptor <span class="s2">*</span>descriptor<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Does this image have an embedded profile? 
  */</span>
  <span class="s1">bool </span><span class="s3">HasProfile</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Get copy of embedded profile. 
  */</span>
  std<span class="s1">::pair&lt;char*, size_t&gt; </span><span class="s3">GetProfile</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Set embedded profile. 
  */</span>
  <span class="s1">VImage </span><span class="s3">SetProfile</span><span class="s1">(</span>VImage image<span class="s1">, </span>std<span class="s1">::</span>pair<span class="s1">&lt;</span><span class="s2">char*</span><span class="s1">, </span><span class="s2">size_t</span><span class="s1">&gt; </span>icc<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Remove all EXIF-related image fields. 
  */</span>
  <span class="s1">VImage </span><span class="s3">RemoveExif</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Get EXIF Orientation of image, if any. 
  */</span>
  <span class="s1">int </span><span class="s3">ExifOrientation</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Set EXIF Orientation of image. 
  */</span>
  <span class="s1">VImage </span><span class="s3">SetExifOrientation</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">int const </span>orientation<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Remove EXIF Orientation from image. 
  */</span>
  <span class="s1">VImage </span><span class="s3">RemoveExifOrientation</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Set animation properties if necessary. 
  */</span>
  <span class="s1">VImage </span><span class="s3">SetAnimationProperties</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">int </span>nPages<span class="s1">, </span><span class="s2">int </span>pageHeight<span class="s1">, </span>std<span class="s1">::</span>vector<span class="s1">&lt;</span><span class="s2">int</span><span class="s1">&gt; </span>delay<span class="s1">, </span><span class="s2">int </span>loop<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Remove animation properties from image. 
  */</span>
  <span class="s1">VImage </span><span class="s3">RemoveAnimationProperties</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Remove GIF palette from image. 
  */</span>
  <span class="s1">VImage </span><span class="s3">RemoveGifPalette</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Does this image have a non-default density? 
  */</span>
  <span class="s1">bool </span><span class="s3">HasDensity</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Get pixels/mm resolution as pixels/inch density. 
  */</span>
  <span class="s1">int </span><span class="s3">GetDensity</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Set pixels/mm resolution based on a pixels/inch density. 
  */</span>
  <span class="s1">VImage </span><span class="s3">SetDensity</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">const double </span>density<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Multi-page images can have a page height. Fetch it, and sanity check it. 
    If page-height is not set, it defaults to the image height 
  */</span>
  <span class="s1">int </span><span class="s3">GetPageHeight</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Check the proposed format supports the current dimensions. 
  */</span>
  <span class="s1">void </span><span class="s3">AssertImageTypeDimensions</span><span class="s1">(</span>VImage image<span class="s1">, </span>ImageType <span class="s2">const </span>imageType<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Called when a Buffer undergoes GC, required to support mixed runtime libraries in Windows 
  */</span>
  <span class="s2">extern </span>std<span class="s1">::function</span><span class="s2">&lt;void</span><span class="s1">(</span><span class="s2">void*</span><span class="s1">, </span><span class="s2">char*</span><span class="s1">)</span><span class="s2">&gt; </span><span class="s1">FreeCallback;</span>

  <span class="s0">/*</span>
    <span class="s0">Called with warnings from the glib-registered &quot;VIPS&quot; domain 
  */</span>
  <span class="s1">void </span><span class="s3">VipsWarningCallback</span><span class="s1">(</span><span class="s2">char const* </span>log_domain<span class="s1">, </span>GLogLevelFlags log_level<span class="s1">, </span><span class="s2">char const* </span>message<span class="s1">, </span><span class="s2">void* </span>ignore<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Pop the oldest warning message from the queue 
  */</span>
  std<span class="s1">::string </span><span class="s3">VipsWarningPop</span><span class="s1">();</span>

  <span class="s0">/*</span>
    <span class="s0">Attach an event listener for progress updates, used to detect timeout 
  */</span>
  <span class="s1">void </span><span class="s3">SetTimeout</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">int const </span>timeoutSeconds<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Event listener for progress updates, used to detect timeout 
  */</span>
  <span class="s1">void </span><span class="s3">VipsProgressCallBack</span><span class="s1">(</span>VipsImage <span class="s2">*</span>image<span class="s1">, </span>VipsProgress <span class="s2">*</span>progress<span class="s1">, </span><span class="s2">int *</span>timeoutSeconds<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Calculate the (left, top) coordinates of the output image 
    within the input image, applying the given gravity during an embed. 
  */</span>
  std<span class="s1">::tuple&lt;int, int&gt; </span><span class="s3">CalculateEmbedPosition</span><span class="s1">(</span><span class="s2">int const </span>inWidth<span class="s1">, </span><span class="s2">int const </span>inHeight<span class="s1">,</span>
    <span class="s2">int const </span>outWidth<span class="s1">, </span><span class="s2">int const </span>outHeight<span class="s1">, </span><span class="s2">int const </span>gravity<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Calculate the (left, top) coordinates of the output image 
    within the input image, applying the given gravity. 
  */</span>
  std<span class="s1">::tuple&lt;int, int&gt; </span><span class="s3">CalculateCrop</span><span class="s1">(</span><span class="s2">int const </span>inWidth<span class="s1">, </span><span class="s2">int const </span>inHeight<span class="s1">,</span>
    <span class="s2">int const </span>outWidth<span class="s1">, </span><span class="s2">int const </span>outHeight<span class="s1">, </span><span class="s2">int const </span>gravity<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Calculate the (left, top) coordinates of the output image 
    within the input image, applying the given x and y offsets of the output image. 
  */</span>
  std<span class="s1">::tuple&lt;int, int&gt; </span><span class="s3">CalculateCrop</span><span class="s1">(</span><span class="s2">int const </span>inWidth<span class="s1">, </span><span class="s2">int const </span>inHeight<span class="s1">,</span>
    <span class="s2">int const </span>outWidth<span class="s1">, </span><span class="s2">int const </span>outHeight<span class="s1">, </span><span class="s2">int const </span>x<span class="s1">, </span><span class="s2">int const </span>y<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Are pixel values in this image 16-bit integer? 
  */</span>
  <span class="s1">bool </span><span class="s3">Is16Bit</span><span class="s1">(</span>VipsInterpretation <span class="s2">const </span>interpretation<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Convert RGBA value to another colourspace 
  */</span>
  std<span class="s1">::vector&lt;double&gt; </span><span class="s3">GetRgbaAsColourspace</span><span class="s1">(</span>std<span class="s1">::</span>vector<span class="s1">&lt;</span><span class="s2">double</span><span class="s1">&gt; </span><span class="s2">const </span>rgba<span class="s1">,</span>
    VipsInterpretation <span class="s2">const </span>interpretation<span class="s1">, </span><span class="s2">bool </span>premultiply<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Apply the alpha channel to a given colour 
   */</span>
  std<span class="s1">::tuple&lt;VImage, std::vector&lt;double&gt;&gt; </span><span class="s3">ApplyAlpha</span><span class="s1">(</span>VImage image<span class="s1">, </span>std<span class="s1">::</span>vector<span class="s1">&lt;</span><span class="s2">double</span><span class="s1">&gt; </span>colour<span class="s1">, </span><span class="s2">bool </span>premultiply<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Removes alpha channels, if any. 
  */</span>
  <span class="s1">VImage </span><span class="s3">RemoveAlpha</span><span class="s1">(</span>VImage image<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Ensures alpha channel, if missing. 
  */</span>
  <span class="s1">VImage </span><span class="s3">EnsureAlpha</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">double const </span>value<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Calculate the horizontal and vertical shrink factors, taking the canvas mode into account. 
  */</span>
  std<span class="s1">::pair&lt;double, double&gt; </span><span class="s3">ResolveShrink</span><span class="s1">(</span><span class="s2">int </span>width<span class="s1">, </span><span class="s2">int </span>height<span class="s1">, </span><span class="s2">int </span>targetWidth<span class="s1">, </span><span class="s2">int </span>targetHeight<span class="s1">,</span>
    Canvas canvas<span class="s1">, </span><span class="s2">bool </span>withoutEnlargement<span class="s1">, </span><span class="s2">bool </span>withoutReduction<span class="s1">);</span>

  <span class="s0">/*</span>
    <span class="s0">Ensure decoding remains sequential. 
  */</span>
  <span class="s1">VImage </span><span class="s3">StaySequential</span><span class="s1">(</span>VImage image<span class="s1">, </span><span class="s2">bool </span>condition <span class="s2">= </span><span class="s8">true</span><span class="s1">);</span>

<span class="s1">}  </span><span class="s0">// namespace sharp</span>

<span class="s2">#endif  </span><span class="s0">// SRC_COMMON_H_</span>
</pre>
</body>
</html>