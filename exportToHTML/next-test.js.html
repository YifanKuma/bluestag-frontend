<html>
<head>
<title>next-test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
next-test.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s3">0 </span><span class="s1">&amp;&amp; (module.exports = {</span>
    <span class="s1">SUPPORTED_TEST_RUNNERS_LIST: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s1">nextTest: </span><span class="s2">null</span>
<span class="s1">});</span>
<span class="s2">function </span><span class="s1">_export(target, all) {</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">name </span><span class="s2">in </span><span class="s1">all)Object.defineProperty(target, name, {</span>
        <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
        <span class="s1">get: all[name]</span>
    <span class="s1">});</span>
<span class="s1">}</span>
<span class="s1">_export(exports, {</span>
    <span class="s1">SUPPORTED_TEST_RUNNERS_LIST: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">SUPPORTED_TEST_RUNNERS_LIST;</span>
    <span class="s1">},</span>
    <span class="s1">nextTest: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">nextTest;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_fs = require(</span><span class="s0">&quot;fs&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_getprojectdir = require(</span><span class="s0">&quot;../lib/get-project-dir&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_utils = require(</span><span class="s0">&quot;../server/lib/utils&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_config = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;../server/config&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_constants = require(</span><span class="s0">&quot;../shared/lib/constants&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_hasnecessarydependencies = require(</span><span class="s0">&quot;../lib/has-necessary-dependencies&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_installdependencies = require(</span><span class="s0">&quot;../lib/install-dependencies&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_findup = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;next/dist/compiled/find-up&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_findpagesdir = require(</span><span class="s0">&quot;../lib/find-pages-dir&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_verifytypescriptsetup = require(</span><span class="s0">&quot;../lib/verify-typescript-setup&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_path = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;path&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_crossspawn = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;next/dist/compiled/cross-spawn&quot;</span><span class="s1">));</span>
<span class="s2">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s2">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">const </span><span class="s1">SUPPORTED_TEST_RUNNERS_LIST = [</span>
    <span class="s0">'playwright'</span>
<span class="s1">];</span>
<span class="s2">const </span><span class="s1">requiredPackagesByTestRunner = {</span>
    <span class="s1">playwright: [</span>
        <span class="s1">{</span>
            <span class="s1">file: </span><span class="s0">'playwright'</span><span class="s1">,</span>
            <span class="s1">pkg: </span><span class="s0">'@playwright/test'</span><span class="s1">,</span>
            <span class="s1">exportsRestrict: </span><span class="s2">false</span>
        <span class="s1">}</span>
    <span class="s1">]</span>
<span class="s1">};</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">nextTest(directory, testRunnerArgs = [], options = {}) {</span>
    <span class="s4">// The following mess is in order to support an existing Next.js CLI pattern of optionally, passing a project `directory` as the first argument to execute the command on.</span>
    <span class="s4">// This is problematic for `next test` because as a wrapper around a test runner's `test` command, it needs to pass through any additional arguments and options.</span>
    <span class="s4">// Thus, `directory` could either be a valid Next.js project directory (that the user intends to run `next test` on), or it is the first argument for the test runner.</span>
    <span class="s4">// Unfortunately, since many test runners support passing a path (to a test file or directory containing test files), we must check if `directory` is both a valid path and a valid Next.js project.</span>
    <span class="s2">let </span><span class="s1">baseDir, nextConfig;</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s4">// if directory is `undefined` or a valid path this will succeed.</span>
        <span class="s1">baseDir = (</span><span class="s3">0</span><span class="s1">, _getprojectdir.getProjectDir)(directory, </span><span class="s2">false</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span>
        <span class="s4">// if that failed, then `directory` is not a valid path, so it must have meant to be the first item for `testRunnerArgs`</span>
        <span class="s4">// @ts-expect-error directory is a string here since `getProjectDir` will succeed if its undefined</span>
        <span class="s1">testRunnerArgs.unshift(directory);</span>
        <span class="s4">// intentionally set baseDir to the resolved '.' path</span>
        <span class="s1">baseDir = (</span><span class="s3">0</span><span class="s1">, _getprojectdir.getProjectDir)();</span>
    <span class="s1">}</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s4">// but, `baseDir` might not be a Next.js project directory, it could be a path-like argument for the test runner (i.e. `playwright test test/foo.spec.js`)</span>
        <span class="s4">// if this succeeds, it means that `baseDir` is a Next.js project directory</span>
        <span class="s1">nextConfig = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _config.default)(_constants.PHASE_PRODUCTION_BUILD, baseDir);</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span>
        <span class="s4">// if it doesn't, then most likely `baseDir` is not a Next.js project directory</span>
        <span class="s4">// @ts-expect-error directory is a string here since `getProjectDir` will succeed if its undefined</span>
        <span class="s1">testRunnerArgs.unshift(directory);</span>
        <span class="s4">// intentionally set baseDir to the resolved '.' path</span>
        <span class="s1">baseDir = (</span><span class="s3">0</span><span class="s1">, _getprojectdir.getProjectDir)();</span>
        <span class="s1">nextConfig = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _config.default)(_constants.PHASE_PRODUCTION_BUILD, baseDir) </span><span class="s4">// let this error bubble up if the `basePath` is still not a valid Next.js project</span>
        <span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s4">// set the test runner. priority is CLI option &gt; next config &gt; default 'playwright'</span>
    <span class="s2">const </span><span class="s1">configuredTestRunner = (options == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: options.testRunner) ?? </span><span class="s4">// --test-runner='foo'</span>
    <span class="s1">nextConfig.experimental.defaultTestRunner ?? </span><span class="s4">// { experimental: { defaultTestRunner: 'foo' }}</span>
    <span class="s0">'playwright'</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(!nextConfig.experimental.testProxy) {</span>
        <span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _utils.printAndExit)(</span><span class="s0">`</span><span class="s5">\`</span><span class="s0">next experimental-test</span><span class="s5">\` </span><span class="s0">requires the </span><span class="s5">\`</span><span class="s0">experimental.testProxy: true</span><span class="s5">\` </span><span class="s0">configuration option.`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s4">// execute test runner specific function</span>
    <span class="s2">switch</span><span class="s1">(configuredTestRunner){</span>
        <span class="s2">case </span><span class="s0">'playwright'</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">runPlaywright(baseDir, nextConfig, testRunnerArgs);</span>
        <span class="s2">default</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _utils.printAndExit)(</span><span class="s0">`Test runner </span><span class="s1">${configuredTestRunner} </span><span class="s0">is not supported.`</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">checkRequiredDeps(baseDir, testRunner) {</span>
    <span class="s2">const </span><span class="s1">deps = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _hasnecessarydependencies.hasNecessaryDependencies)(baseDir, requiredPackagesByTestRunner[testRunner]);</span>
    <span class="s2">if </span><span class="s1">(deps.missing.length &gt; </span><span class="s3">0</span><span class="s1">) {</span>
        <span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _installdependencies.installDependencies)(baseDir, deps.missing, </span><span class="s2">true</span><span class="s1">);</span>
        <span class="s2">const </span><span class="s1">playwright = (</span><span class="s3">0</span><span class="s1">, _crossspawn.default)(_path.default.join(baseDir, </span><span class="s0">'node_modules'</span><span class="s1">, </span><span class="s0">'.bin'</span><span class="s1">, </span><span class="s0">'playwright'</span><span class="s1">), [</span>
            <span class="s0">'install'</span>
        <span class="s1">], {</span>
            <span class="s1">cwd: baseDir,</span>
            <span class="s1">shell: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">stdio: </span><span class="s0">'inherit'</span><span class="s1">,</span>
            <span class="s1">env: {</span>
                <span class="s1">...process.env</span>
            <span class="s1">}</span>
        <span class="s1">});</span>
        <span class="s2">return new </span><span class="s1">Promise((resolve, reject)=&gt;{</span>
            <span class="s1">playwright.on(</span><span class="s0">'close'</span><span class="s1">, (c)=&gt;resolve(c));</span>
            <span class="s1">playwright.on(</span><span class="s0">'error'</span><span class="s1">, (err)=&gt;reject(err));</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">runPlaywright(baseDir, nextConfig, testRunnerArgs) {</span>
    <span class="s2">await </span><span class="s1">checkRequiredDeps(baseDir, </span><span class="s0">'playwright'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">playwrightConfigFile = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _findup.default)([</span>
        <span class="s0">'playwright.config.js'</span><span class="s1">,</span>
        <span class="s0">'playwright.config.ts'</span>
    <span class="s1">], {</span>
        <span class="s1">cwd: baseDir</span>
    <span class="s1">});</span>
    <span class="s2">if </span><span class="s1">(!playwrightConfigFile) {</span>
        <span class="s2">const </span><span class="s1">{ pagesDir, appDir } = (</span><span class="s3">0</span><span class="s1">, _findpagesdir.findPagesDir)(baseDir);</span>
        <span class="s2">const </span><span class="s1">{ version: typeScriptVersion } = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _verifytypescriptsetup.verifyTypeScriptSetup)({</span>
            <span class="s1">dir: baseDir,</span>
            <span class="s1">distDir: nextConfig.distDir,</span>
            <span class="s1">intentDirs: [</span>
                <span class="s1">pagesDir,</span>
                <span class="s1">appDir</span>
            <span class="s1">].filter(Boolean),</span>
            <span class="s1">typeCheckPreflight: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">tsconfigPath: nextConfig.typescript.tsconfigPath,</span>
            <span class="s1">disableStaticImages: nextConfig.images.disableStaticImages,</span>
            <span class="s1">hasAppDir: !!appDir,</span>
            <span class="s1">hasPagesDir: !!pagesDir</span>
        <span class="s1">});</span>
        <span class="s2">const </span><span class="s1">isUsingTypeScript = !!typeScriptVersion;</span>
        <span class="s2">const </span><span class="s1">playwrightConfigFilename = isUsingTypeScript ? </span><span class="s0">'playwright.config.ts' </span><span class="s1">: </span><span class="s0">'playwright.config.js'</span><span class="s1">;</span>
        <span class="s1">(</span><span class="s3">0</span><span class="s1">, _fs.writeFileSync)(_path.default.join(baseDir, playwrightConfigFilename), defaultPlaywrightConfig(isUsingTypeScript));</span>
        <span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _utils.printAndExit)(</span><span class="s0">`Successfully generated </span><span class="s1">${playwrightConfigFilename}</span><span class="s0">. Create your first test and then run </span><span class="s5">\`</span><span class="s0">next experimental-test</span><span class="s5">\`</span><span class="s0">.`</span><span class="s1">, </span><span class="s3">0</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s2">const </span><span class="s1">playwright = (</span><span class="s3">0</span><span class="s1">, _crossspawn.default)(_path.default.join(baseDir, </span><span class="s0">'node_modules'</span><span class="s1">, </span><span class="s0">'.bin'</span><span class="s1">, </span><span class="s0">'playwright'</span><span class="s1">), [</span>
            <span class="s0">'test'</span><span class="s1">,</span>
            <span class="s1">...testRunnerArgs</span>
        <span class="s1">], {</span>
            <span class="s1">cwd: baseDir,</span>
            <span class="s1">shell: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">stdio: </span><span class="s0">'inherit'</span><span class="s1">,</span>
            <span class="s1">env: {</span>
                <span class="s1">...process.env</span>
            <span class="s1">}</span>
        <span class="s1">});</span>
        <span class="s2">return new </span><span class="s1">Promise((resolve, reject)=&gt;{</span>
            <span class="s1">playwright.on(</span><span class="s0">'close'</span><span class="s1">, (c)=&gt;resolve(c));</span>
            <span class="s1">playwright.on(</span><span class="s0">'error'</span><span class="s1">, (err)=&gt;reject(err));</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">defaultPlaywrightConfig(typescript) {</span>
    <span class="s2">const </span><span class="s1">comment = </span><span class="s0">`/* 
 * Specify any additional Playwright config options here. 
 * They will be merged with Next.js' default Playwright config. 
 * You can access the default config by importing </span><span class="s5">\`</span><span class="s0">defaultPlaywrightConfig</span><span class="s5">\` </span><span class="s0">from </span><span class="s5">\`</span><span class="s0">'next/experimental/testmode/playwright'</span><span class="s5">\`</span><span class="s0">. 
 */`</span><span class="s1">;</span>
    <span class="s2">return </span><span class="s1">typescript ? </span><span class="s0">`import { defineConfig } from 'next/experimental/testmode/playwright';</span><span class="s5">\n\n</span><span class="s1">${comment}</span><span class="s5">\n</span><span class="s0">export default defineConfig({});` </span><span class="s1">: </span><span class="s0">`const { defineConfig } = require('next/experimental/testmode/playwright');</span><span class="s5">\n\n</span><span class="s1">${comment}</span><span class="s5">\n</span><span class="s0">module.exports = defineConfig({});`</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s4">//# sourceMappingURL=next-test.js.map</span></pre>
</body>
</html>