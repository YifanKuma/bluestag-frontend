<html>
<head>
<title>TSNonNullExpression.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
TSNonNullExpression.js</font>
</center></td></tr></table>
<pre><span class="s0">const </span><span class="s1">extractValueFromThisExpression = require(</span><span class="s2">'./ThisExpression'</span><span class="s1">).default;</span>
<span class="s0">const </span><span class="s1">extractValueFromCallExpression = require(</span><span class="s2">'./CallExpression'</span><span class="s1">).default;</span>

<span class="s0">function </span><span class="s1">navigate(obj, prop, value) {</span>
  <span class="s0">if </span><span class="s1">(value.computed) {</span>
    <span class="s0">return </span><span class="s1">value.optional ? </span><span class="s2">`</span><span class="s1">${obj}</span><span class="s2">?.[</span><span class="s1">${prop}</span><span class="s2">]` </span><span class="s1">: </span><span class="s2">`</span><span class="s1">${obj}</span><span class="s2">[</span><span class="s1">${prop}</span><span class="s2">]`</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s0">return </span><span class="s1">value.optional ? </span><span class="s2">`</span><span class="s1">${obj}</span><span class="s2">?.</span><span class="s1">${prop}</span><span class="s2">` </span><span class="s1">: </span><span class="s2">`</span><span class="s1">${obj}</span><span class="s2">.</span><span class="s1">${prop}</span><span class="s2">`</span><span class="s1">;</span>
<span class="s1">}</span>

<span class="s3">/**</span>
 <span class="s3">* Extractor function for a TSNonNullExpression type value node.</span>
 <span class="s3">* A TSNonNullExpression is accessing a TypeScript Non-Null Assertion</span>
 <span class="s3">* Operator !</span>
 <span class="s3">*</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">- value - AST Value object with type `TSNonNullExpression`</span>
 <span class="s3">* </span><span class="s4">@returns </span><span class="s3">- The extracted value converted to correct type</span>
 <span class="s3">*  and maintaing `obj.property` convention.</span>
 <span class="s3">*/</span>
<span class="s0">export default function </span><span class="s1">extractValueFromTSNonNullExpression(value) {</span>
  <span class="s3">// eslint-disable-next-line global-require</span>
  <span class="s3">// const getValue = require('.').default;</span>
  <span class="s0">const </span><span class="s1">errorMessage = </span><span class="s2">'The prop value with an expression type of TSNonNullExpression could not be resolved. Please file an issue ( https://github.com/jsx-eslint/jsx-ast-utils/issues/new ) to get this fixed immediately.'</span><span class="s1">;</span>

  <span class="s3">// it's just the name</span>
  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'Identifier'</span><span class="s1">) {</span>
    <span class="s0">const </span><span class="s1">{ name } = value;</span>
    <span class="s0">return </span><span class="s1">name;</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'Literal'</span><span class="s1">) {</span>
    <span class="s0">return </span><span class="s1">value.value;</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'TSAsExpression'</span><span class="s1">) {</span>
    <span class="s0">return </span><span class="s1">extractValueFromTSNonNullExpression(value.expression);</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'CallExpression'</span><span class="s1">) {</span>
    <span class="s0">return </span><span class="s1">extractValueFromCallExpression(value);</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'ThisExpression'</span><span class="s1">) {</span>
    <span class="s0">return </span><span class="s1">extractValueFromThisExpression();</span>
  <span class="s1">}</span>

  <span class="s3">// does not contains properties &amp; is not parenthesized</span>
  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'TSNonNullExpression' </span><span class="s1">&amp;&amp; (!value.extra || value.extra.parenthesized === </span><span class="s0">false</span><span class="s1">)) {</span>
    <span class="s0">const </span><span class="s1">{ expression } = value;</span>
    <span class="s0">return </span><span class="s2">`</span><span class="s1">${extractValueFromTSNonNullExpression(expression)}${</span><span class="s2">'!'</span><span class="s1">}</span><span class="s2">`</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s3">// does not contains properties &amp; is parenthesized</span>
  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'TSNonNullExpression' </span><span class="s1">&amp;&amp; value.extra &amp;&amp; value.extra.parenthesized === </span><span class="s0">true</span><span class="s1">) {</span>
    <span class="s0">const </span><span class="s1">{ expression } = value;</span>
    <span class="s0">return </span><span class="s2">`</span><span class="s1">${</span><span class="s2">'('</span><span class="s1">}${extractValueFromTSNonNullExpression(expression)}${</span><span class="s2">'!'</span><span class="s1">}${</span><span class="s2">')'</span><span class="s1">}</span><span class="s2">`</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s0">if </span><span class="s1">(value.type === </span><span class="s2">'MemberExpression'</span><span class="s1">) {</span>
    <span class="s3">// contains a property &amp; is not parenthesized</span>
    <span class="s0">if </span><span class="s1">((!value.extra || value.extra.parenthesized === </span><span class="s0">false</span><span class="s1">)) {</span>
      <span class="s0">return </span><span class="s1">navigate(</span>
        <span class="s1">extractValueFromTSNonNullExpression(value.object),</span>
        <span class="s1">extractValueFromTSNonNullExpression(value.property),</span>
        <span class="s1">value,</span>
      <span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">// contains a property &amp; is parenthesized</span>
    <span class="s0">if </span><span class="s1">(value.extra &amp;&amp; value.extra.parenthesized === </span><span class="s0">true</span><span class="s1">) {</span>
      <span class="s0">const </span><span class="s1">result = navigate(</span>
        <span class="s1">extractValueFromTSNonNullExpression(value.object),</span>
        <span class="s1">extractValueFromTSNonNullExpression(value.property),</span>
        <span class="s1">value,</span>
      <span class="s1">);</span>
      <span class="s0">return </span><span class="s2">`(</span><span class="s1">${result}</span><span class="s2">)`</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s3">// try to fail silently, if specs for TSNonNullExpression change</span>
  <span class="s3">// not throw, only log error. Similar to how it was done previously</span>
  <span class="s0">if </span><span class="s1">(value.expression) {</span>
    <span class="s0">let </span><span class="s1">{ expression } = value;</span>
    <span class="s0">while </span><span class="s1">(expression) {</span>
      <span class="s0">if </span><span class="s1">(expression.type === </span><span class="s2">'Identifier'</span><span class="s1">) {</span>
        <span class="s3">// eslint-disable-next-line no-console</span>
        <span class="s1">console.error(errorMessage);</span>
        <span class="s0">return </span><span class="s1">expression.name;</span>
      <span class="s1">}</span>
      <span class="s1">({ expression } = expression);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s3">// eslint-disable-next-line no-console</span>
  <span class="s1">console.error(errorMessage);</span>
  <span class="s0">return </span><span class="s2">''</span><span class="s1">;</span>
<span class="s1">}</span>
</pre>
</body>
</html>