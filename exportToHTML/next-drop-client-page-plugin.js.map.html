<html>
<head>
<title>next-drop-client-page-plugin.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
next-drop-client-page-plugin.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/build/webpack/plugins/next-drop-client-page-plugin.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { webpack } from 'next/dist/compiled/webpack/webpack'</span><span class="s3">\n</span><span class="s1">import { STRING_LITERAL_DROP_BUNDLE } from '../../../shared/lib/constants'</span><span class="s3">\n\n</span><span class="s1">export const ampFirstEntryNamesMap: WeakMap&lt;webpack.Compilation, string[]&gt; =</span><span class="s3">\n  </span><span class="s1">new WeakMap()</span><span class="s3">\n\n</span><span class="s1">const PLUGIN_NAME = 'DropAmpFirstPagesPlugin'</span><span class="s3">\n\n</span><span class="s1">// Prevents outputting client pages when they are not needed</span><span class="s3">\n</span><span class="s1">export class DropClientPage implements webpack.WebpackPluginInstance {</span><span class="s3">\n  </span><span class="s1">ampPages = new Set()</span><span class="s3">\n\n  </span><span class="s1">apply(compiler: webpack.Compiler) {</span><span class="s3">\n    </span><span class="s1">compiler.hooks.compilation.tap(</span><span class="s3">\n      </span><span class="s1">PLUGIN_NAME,</span><span class="s3">\n      </span><span class="s1">(compilation: any, { normalModuleFactory }: any) =&gt; {</span><span class="s3">\n        </span><span class="s1">// Recursively look up the issuer till it ends up at the root</span><span class="s3">\n        </span><span class="s1">function findEntryModule(mod: any): webpack.Module | null {</span><span class="s3">\n          </span><span class="s1">const queue = new Set([mod])</span><span class="s3">\n          </span><span class="s1">for (const module of queue) {</span><span class="s3">\n            </span><span class="s1">const incomingConnections =</span><span class="s3">\n              </span><span class="s1">compilation.moduleGraph.getIncomingConnections(module)</span><span class="s3">\n\n            </span><span class="s1">for (const incomingConnection of incomingConnections) {</span><span class="s3">\n              </span><span class="s1">if (!incomingConnection.originModule) return module</span><span class="s3">\n              </span><span class="s1">queue.add(incomingConnection.originModule)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">function handler(parser: any) {</span><span class="s3">\n          </span><span class="s1">function markAsAmpFirst() {</span><span class="s3">\n            </span><span class="s1">const entryModule = findEntryModule(parser.state.module)</span><span class="s3">\n\n            </span><span class="s1">if (!entryModule) {</span><span class="s3">\n              </span><span class="s1">return</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// @ts-ignore buildInfo exists on Module</span><span class="s3">\n            </span><span class="s1">entryModule.buildInfo.NEXT_ampFirst = true</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">parser.hooks.preDeclarator.tap(PLUGIN_NAME, (declarator: any) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (declarator?.id?.name === STRING_LITERAL_DROP_BUNDLE) {</span><span class="s3">\n              </span><span class="s1">markAsAmpFirst()</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">normalModuleFactory.hooks.parser</span><span class="s3">\n          </span><span class="s1">.for('javascript/auto')</span><span class="s3">\n          </span><span class="s1">.tap(PLUGIN_NAME, handler)</span><span class="s3">\n\n        </span><span class="s1">normalModuleFactory.hooks.parser</span><span class="s3">\n          </span><span class="s1">.for('javascript/esm')</span><span class="s3">\n          </span><span class="s1">.tap(PLUGIN_NAME, handler)</span><span class="s3">\n\n        </span><span class="s1">normalModuleFactory.hooks.parser</span><span class="s3">\n          </span><span class="s1">.for('javascript/dynamic')</span><span class="s3">\n          </span><span class="s1">.tap(PLUGIN_NAME, handler)</span><span class="s3">\n\n        </span><span class="s1">if (!ampFirstEntryNamesMap.has(compilation)) {</span><span class="s3">\n          </span><span class="s1">ampFirstEntryNamesMap.set(compilation, [])</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const ampFirstEntryNamesItem = ampFirstEntryNamesMap.get(</span><span class="s3">\n          </span><span class="s1">compilation</span><span class="s3">\n        </span><span class="s1">) as string[]</span><span class="s3">\n\n        </span><span class="s1">compilation.hooks.seal.tap(PLUGIN_NAME, () =&gt; {</span><span class="s3">\n          </span><span class="s1">for (const [name, entryData] of compilation.entries) {</span><span class="s3">\n            </span><span class="s1">for (const dependency of entryData.dependencies) {</span><span class="s3">\n              </span><span class="s1">const module = compilation.moduleGraph.getModule(dependency)</span><span class="s3">\n              </span><span class="s1">if (module?.buildInfo?.NEXT_ampFirst) {</span><span class="s3">\n                </span><span class="s1">ampFirstEntryNamesItem.push(name)</span><span class="s3">\n                </span><span class="s1">compilation.entries.delete(name)</span><span class="s3">\n              </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;DropClientPage&quot;</span><span class="s0">,</span><span class="s1">&quot;ampFirstEntryNamesMap&quot;</span><span class="s0">,</span><span class="s1">&quot;WeakMap&quot;</span><span class="s0">,</span><span class="s1">&quot;PLUGIN_NAME&quot;</span><span class="s0">,</span><span class="s1">&quot;apply&quot;</span><span class="s0">,</span><span class="s1">&quot;compiler&quot;</span><span class="s0">,</span><span class="s1">&quot;hooks&quot;</span><span class="s0">,</span><span class="s1">&quot;compilation&quot;</span><span class="s0">,</span><span class="s1">&quot;tap&quot;</span><span class="s0">,</span><span class="s1">&quot;normalModuleFactory&quot;</span><span class="s0">,</span><span class="s1">&quot;findEntryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;mod&quot;</span><span class="s0">,</span><span class="s1">&quot;queue&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;module&quot;</span><span class="s0">,</span><span class="s1">&quot;incomingConnections&quot;</span><span class="s0">,</span><span class="s1">&quot;moduleGraph&quot;</span><span class="s0">,</span><span class="s1">&quot;getIncomingConnections&quot;</span><span class="s0">,</span><span class="s1">&quot;incomingConnection&quot;</span><span class="s0">,</span><span class="s1">&quot;originModule&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;handler&quot;</span><span class="s0">,</span><span class="s1">&quot;parser&quot;</span><span class="s0">,</span><span class="s1">&quot;markAsAmpFirst&quot;</span><span class="s0">,</span><span class="s1">&quot;entryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;state&quot;</span><span class="s0">,</span><span class="s1">&quot;buildInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_ampFirst&quot;</span><span class="s0">,</span><span class="s1">&quot;preDeclarator&quot;</span><span class="s0">,</span><span class="s1">&quot;declarator&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;STRING_LITERAL_DROP_BUNDLE&quot;</span><span class="s0">,</span><span class="s1">&quot;for&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;ampFirstEntryNamesItem&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;seal&quot;</span><span class="s0">,</span><span class="s1">&quot;entryData&quot;</span><span class="s0">,</span><span class="s1">&quot;entries&quot;</span><span class="s0">,</span><span class="s1">&quot;dependency&quot;</span><span class="s0">,</span><span class="s1">&quot;dependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;getModule&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;delete&quot;</span><span class="s0">,</span><span class="s1">&quot;ampPages&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;IASaA,cAAc;eAAdA;;IANAC,qBAAqB;eAArBA;;;2BAF8B;AAEpC,MAAMA,wBACX,IAAIC;AAEN,MAAMC,cAAc;AAGb,MAAMH;IAGXI,MAAMC,QAA0B,EAAE;QAChCA,SAASC,KAAK,CAACC,WAAW,CAACC,GAAG,CAC5BL,aACA,CAACI,aAAkB,EAAEE,mBAAmB,EAAO;YAC7C,6DAA6D;YAC7D,SAASC,gBAAgBC,GAAQ;gBAC/B,MAAMC,QAAQ,IAAIC,IAAI;oBAACF;iBAAI;gBAC3B,KAAK,MAAMG,WAAUF,MAAO;oBAC1B,MAAMG,sBACJR,YAAYS,WAAW,CAACC,sBAAsB,CAACH;oBAEjD,KAAK,MAAMI,sBAAsBH,oBAAqB;wBACpD,IAAI,CAACG,mBAAmBC,YAAY,EAAE,OAAOL;wBAC7CF,MAAMQ,GAAG,CAACF,mBAAmBC,YAAY;oBAC3C;gBACF;gBAEA,OAAO;YACT;YAEA,SAASE,QAAQC,MAAW;gBAC1B,SAASC;oBACP,MAAMC,cAAcd,gBAAgBY,OAAOG,KAAK,CAACX,MAAM;oBAEvD,IAAI,CAACU,aAAa;wBAChB;oBACF;oBAEA,wCAAwC;oBACxCA,YAAYE,SAAS,CAACC,aAAa,GAAG;gBACxC;gBAEAL,OAAOhB,KAAK,CAACsB,aAAa,CAACpB,GAAG,CAACL,aAAa,CAAC0B;wBACvCA;oBAAJ,IAAIA,CAAAA,+BAAAA,iBAAAA,WAAYC,EAAE,qBAAdD,eAAgBE,IAAI,MAAKC,qCAA0B,EAAE;wBACvDT;oBACF;gBACF;YACF;YAEAd,oBAAoBH,KAAK,CAACgB,MAAM,CAC7BW,GAAG,CAAC,mBACJzB,GAAG,CAACL,aAAakB;YAEpBZ,oBAAoBH,KAAK,CAACgB,MAAM,CAC7BW,GAAG,CAAC,kBACJzB,GAAG,CAACL,aAAakB;YAEpBZ,oBAAoBH,KAAK,CAACgB,MAAM,CAC7BW,GAAG,CAAC,sBACJzB,GAAG,CAACL,aAAakB;YAEpB,IAAI,CAACpB,sBAAsBiC,GAAG,CAAC3B,cAAc;gBAC3CN,sBAAsBkC,GAAG,CAAC5B,aAAa,EAAE;YAC3C;YAEA,MAAM6B,yBAAyBnC,sBAAsBoC,GAAG,CACtD9B;YAGFA,YAAYD,KAAK,CAACgC,IAAI,CAAC9B,GAAG,CAACL,aAAa;gBACtC,KAAK,MAAM,CAAC4B,MAAMQ,UAAU,IAAIhC,YAAYiC,OAAO,CAAE;oBACnD,KAAK,MAAMC,cAAcF,UAAUG,YAAY,CAAE;4BAE3C5B;wBADJ,MAAMA,UAASP,YAAYS,WAAW,CAAC2B,SAAS,CAACF;wBACjD,IAAI3B,4BAAAA,oBAAAA,QAAQY,SAAS,qBAAjBZ,kBAAmBa,aAAa,EAAE;4BACpCS,uBAAuBQ,IAAI,CAACb;4BAC5BxB,YAAYiC,OAAO,CAACK,MAAM,CAACd;wBAC7B;oBACF;gBACF;YACF;QACF;IAEJ;;aA1EAe,WAAW,IAAIjC;;AA2EjB&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>