<html>
<head>
<title>tsconfig-loader.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
tsconfig-loader.test.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { value: </span><span class="s2">true </span><span class="s1">});</span>
<span class="s2">var </span><span class="s1">tsconfig_loader_1 = require(</span><span class="s0">&quot;../tsconfig-loader&quot;</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">path_1 = require(</span><span class="s0">&quot;path&quot;</span><span class="s1">);</span>
<span class="s1">describe(</span><span class="s0">&quot;tsconfig-loader&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s1">it(</span><span class="s0">&quot;should find tsconfig in cwd&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.tsConfigLoader)({</span>
            <span class="s1">cwd: </span><span class="s0">&quot;/foo/bar&quot;</span><span class="s1">,</span>
            <span class="s1">getEnv: </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s1">undefined; },</span>
            <span class="s1">loadSync: </span><span class="s2">function </span><span class="s1">(cwd) {</span>
                <span class="s2">return </span><span class="s1">{</span>
                    <span class="s1">tsConfigPath: </span><span class="s0">&quot;&quot;</span><span class="s1">.concat(cwd, </span><span class="s0">&quot;/tsconfig.json&quot;</span><span class="s1">),</span>
                    <span class="s1">baseUrl: </span><span class="s0">&quot;./&quot;</span><span class="s1">,</span>
                    <span class="s1">paths: {},</span>
                <span class="s1">};</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
        <span class="s4">// assert.equal(result.tsConfigPath, &quot;/foo/bar/tsconfig.json&quot;);</span>
        <span class="s1">expect(result.tsConfigPath).toBe(</span><span class="s0">&quot;/foo/bar/tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should return loaderResult.tsConfigPath as undefined when not found&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.tsConfigLoader)({</span>
            <span class="s1">cwd: </span><span class="s0">&quot;/foo/bar&quot;</span><span class="s1">,</span>
            <span class="s1">getEnv: </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s1">undefined; },</span>
            <span class="s1">loadSync: </span><span class="s2">function </span><span class="s1">(_) {</span>
                <span class="s2">return </span><span class="s1">{</span>
                    <span class="s1">tsConfigPath: undefined,</span>
                    <span class="s1">baseUrl: </span><span class="s0">&quot;./&quot;</span><span class="s1">,</span>
                    <span class="s1">paths: {},</span>
                <span class="s1">};</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
        <span class="s4">// assert.isUndefined(result.tsConfigPath);</span>
        <span class="s1">expect(result.tsConfigPath).toBeUndefined();</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should use TS_NODE_PROJECT env if exists&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.tsConfigLoader)({</span>
            <span class="s1">cwd: </span><span class="s0">&quot;/foo/bar&quot;</span><span class="s1">,</span>
            <span class="s1">getEnv: </span><span class="s2">function </span><span class="s1">(key) {</span>
                <span class="s2">return </span><span class="s1">key === </span><span class="s0">&quot;TS_NODE_PROJECT&quot; </span><span class="s1">? </span><span class="s0">&quot;/foo/baz&quot; </span><span class="s1">: undefined;</span>
            <span class="s1">},</span>
            <span class="s1">loadSync: </span><span class="s2">function </span><span class="s1">(cwd, fileName) {</span>
                <span class="s2">if </span><span class="s1">(cwd === </span><span class="s0">&quot;/foo/bar&quot; </span><span class="s1">&amp;&amp; fileName === </span><span class="s0">&quot;/foo/baz&quot;</span><span class="s1">) {</span>
                    <span class="s2">return </span><span class="s1">{</span>
                        <span class="s1">tsConfigPath: </span><span class="s0">&quot;/foo/baz/tsconfig.json&quot;</span><span class="s1">,</span>
                        <span class="s1">baseUrl: </span><span class="s0">&quot;./&quot;</span><span class="s1">,</span>
                        <span class="s1">paths: {},</span>
                    <span class="s1">};</span>
                <span class="s1">}</span>
                <span class="s2">return </span><span class="s1">{</span>
                    <span class="s1">tsConfigPath: undefined,</span>
                    <span class="s1">baseUrl: </span><span class="s0">&quot;./&quot;</span><span class="s1">,</span>
                    <span class="s1">paths: {},</span>
                <span class="s1">};</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
        <span class="s4">// assert.equal(result.tsConfigPath, &quot;/foo/baz/tsconfig.json&quot;);</span>
        <span class="s1">expect(result.tsConfigPath).toBe(</span><span class="s0">&quot;/foo/baz/tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should use TS_NODE_BASEURL env if exists&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.tsConfigLoader)({</span>
            <span class="s1">cwd: </span><span class="s0">&quot;/foo/bar&quot;</span><span class="s1">,</span>
            <span class="s1">getEnv: </span><span class="s2">function </span><span class="s1">(key) {</span>
                <span class="s2">return </span><span class="s1">key === </span><span class="s0">&quot;TS_NODE_BASEURL&quot; </span><span class="s1">? </span><span class="s0">&quot;SOME_BASEURL&quot; </span><span class="s1">: undefined;</span>
            <span class="s1">},</span>
            <span class="s1">loadSync: </span><span class="s2">function </span><span class="s1">(_0, _1, baseUrl) {</span>
                <span class="s2">return </span><span class="s1">{</span>
                    <span class="s1">tsConfigPath: undefined,</span>
                    <span class="s1">baseUrl: baseUrl,</span>
                    <span class="s1">paths: {},</span>
                <span class="s1">};</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
        <span class="s4">// assert.equal(result.baseUrl, &quot;SOME_BASEURL&quot;);</span>
        <span class="s1">expect(result.baseUrl).toBe(</span><span class="s0">&quot;SOME_BASEURL&quot;</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should not use TS_NODE_BASEURL env if it does not exist&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.tsConfigLoader)({</span>
            <span class="s1">cwd: </span><span class="s0">&quot;/foo/bar&quot;</span><span class="s1">,</span>
            <span class="s1">getEnv: </span><span class="s2">function </span><span class="s1">(_) {</span>
                <span class="s2">return </span><span class="s1">undefined;</span>
            <span class="s1">},</span>
            <span class="s1">loadSync: </span><span class="s2">function </span><span class="s1">(_0, _1, baseUrl) {</span>
                <span class="s2">return </span><span class="s1">{</span>
                    <span class="s1">tsConfigPath: undefined,</span>
                    <span class="s1">baseUrl: baseUrl,</span>
                    <span class="s1">paths: {},</span>
                <span class="s1">};</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
        <span class="s4">// assert.equal(result.baseUrl, undefined);</span>
        <span class="s1">expect(result.baseUrl).toBeUndefined();</span>
    <span class="s1">});</span>
<span class="s1">});</span>
<span class="s1">describe(</span><span class="s0">&quot;walkForTsConfig&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s1">it(</span><span class="s0">&quot;should find tsconfig in starting directory&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">pathToTsconfig = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.walkForTsConfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === pathToTsconfig; });</span>
        <span class="s4">// assert.equal(res, pathToTsconfig);</span>
        <span class="s1">expect(res).toBe(pathToTsconfig);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should find tsconfig in parent directory&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">pathToTsconfig = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.walkForTsConfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === pathToTsconfig; });</span>
        <span class="s4">// assert.equal(res, pathToTsconfig);</span>
        <span class="s1">expect(res).toBe(pathToTsconfig);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should return undefined when reaching the top&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.walkForTsConfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;kalle&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">() { </span><span class="s2">return false</span><span class="s1">; });</span>
        <span class="s4">// assert.equal(res, undefined);</span>
        <span class="s1">expect(res).toBeUndefined();</span>
    <span class="s1">});</span>
<span class="s1">});</span>
<span class="s1">describe(</span><span class="s0">&quot;loadConfig&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s0">&quot;hej&quot; </span><span class="s1">} };</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)(</span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === </span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">; }, </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s1">JSON.stringify(config); });</span>
        <span class="s4">// assert.deepEqual(res, config);</span>
        <span class="s1">expect(res).toStrictEqual(config);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with comments&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s0">&quot;hej&quot; </span><span class="s1">} };</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)(</span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === </span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">; }, </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s0">&quot;{</span><span class="s5">\n          </span><span class="s0">// my comment</span><span class="s5">\n          \&quot;</span><span class="s0">compilerOptions</span><span class="s5">\&quot;</span><span class="s0">: { </span><span class="s5">\n            \&quot;</span><span class="s0">baseUrl</span><span class="s5">\&quot;</span><span class="s0">: </span><span class="s5">\&quot;</span><span class="s0">hej</span><span class="s5">\&quot;\n          </span><span class="s0">}</span><span class="s5">\n        </span><span class="s0">}&quot;</span><span class="s1">; });</span>
        <span class="s4">// assert.deepEqual(res, config);</span>
        <span class="s1">expect(res).toStrictEqual(config);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with trailing commas&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s0">&quot;hej&quot; </span><span class="s1">} };</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)(</span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === </span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">; }, </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s0">&quot;{</span><span class="s5">\n          \&quot;</span><span class="s0">compilerOptions</span><span class="s5">\&quot;</span><span class="s0">: { </span><span class="s5">\n            \&quot;</span><span class="s0">baseUrl</span><span class="s5">\&quot;</span><span class="s0">: </span><span class="s5">\&quot;</span><span class="s0">hej</span><span class="s5">\&quot;</span><span class="s0">,</span><span class="s5">\n          </span><span class="s0">},</span><span class="s5">\n        </span><span class="s0">}&quot;</span><span class="s1">; });</span>
        <span class="s4">// assert.deepEqual(res, config);</span>
        <span class="s1">expect(res).toStrictEqual(config);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should throw an error including the file path when encountering invalid JSON5&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s1">expect(</span><span class="s2">function </span><span class="s1">() {</span>
            <span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)(</span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === </span><span class="s0">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">; }, </span><span class="s2">function </span><span class="s1">(_) { </span><span class="s2">return </span><span class="s0">&quot;{</span><span class="s5">\n            \&quot;</span><span class="s0">compilerOptions</span><span class="s5">\&quot;</span><span class="s0">: {</span><span class="s5">\n          </span><span class="s0">}&quot;</span><span class="s1">; });</span>
        <span class="s1">}).toThrowError(</span><span class="s0">&quot;/root/dir1/tsconfig.json is malformed JSON5: invalid end of input at 3:12&quot;</span><span class="s1">);</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with string extends and overwrite all options&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">firstConfig = {</span>
            <span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;../base-config.json&quot;</span><span class="s1">,</span>
            <span class="s1">compilerOptions: { baseUrl: </span><span class="s0">&quot;kalle&quot;</span><span class="s1">, paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] } },</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">firstConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">baseConfig = {</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: </span><span class="s0">&quot;olle&quot;</span><span class="s1">,</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar1&quot;</span><span class="s1">] },</span>
                <span class="s1">strict: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">},</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">baseConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === firstConfigPath || path === baseConfigPath; }, </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">if </span><span class="s1">(path === firstConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(firstConfig);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === baseConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">});</span>
        <span class="s4">// assert.deepEqual(res, {</span>
        <span class="s4">//   extends: &quot;../base-config.json&quot;,</span>
        <span class="s4">//   compilerOptions: {</span>
        <span class="s4">//     baseUrl: &quot;kalle&quot;,</span>
        <span class="s4">//     paths: { foo: [&quot;bar2&quot;] },</span>
        <span class="s4">//     strict: true,</span>
        <span class="s4">//   },</span>
        <span class="s4">// });</span>
        <span class="s1">expect(res).toEqual({</span>
            <span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;../base-config.json&quot;</span><span class="s1">,</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: </span><span class="s0">&quot;kalle&quot;</span><span class="s1">,</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] },</span>
                <span class="s1">strict: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with string extends from node_modules and overwrite all options&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">firstConfig = {</span>
            <span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;my-package/base-config.json&quot;</span><span class="s1">,</span>
            <span class="s1">compilerOptions: { baseUrl: </span><span class="s0">&quot;kalle&quot;</span><span class="s1">, paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] } },</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">firstConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">baseConfig = {</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: </span><span class="s0">&quot;olle&quot;</span><span class="s1">,</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar1&quot;</span><span class="s1">] },</span>
                <span class="s1">strict: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">},</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">baseConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;node_modules&quot;</span><span class="s1">, </span><span class="s0">&quot;my-package&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">path === firstConfigPath || path === baseConfigPath; }, </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">if </span><span class="s1">(path === firstConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(firstConfig);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === baseConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">});</span>
        <span class="s4">// assert.deepEqual(res, {</span>
        <span class="s4">//   extends: &quot;my-package/base-config.json&quot;,</span>
        <span class="s4">//   compilerOptions: {</span>
        <span class="s4">//     baseUrl: &quot;kalle&quot;,</span>
        <span class="s4">//     paths: { foo: [&quot;bar2&quot;] },</span>
        <span class="s4">//     strict: true,</span>
        <span class="s4">//   },</span>
        <span class="s4">// });</span>
        <span class="s1">expect(res).toEqual({</span>
            <span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;my-package/base-config.json&quot;</span><span class="s1">,</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: </span><span class="s0">&quot;kalle&quot;</span><span class="s1">,</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] },</span>
                <span class="s1">strict: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should use baseUrl relative to location of extended tsconfig&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">firstConfig = { compilerOptions: { baseUrl: </span><span class="s0">&quot;.&quot; </span><span class="s1">} };</span>
        <span class="s2">var </span><span class="s1">firstConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;first-config.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">secondConfig = { </span><span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;../first-config.json&quot; </span><span class="s1">};</span>
        <span class="s2">var </span><span class="s1">secondConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;second-config.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">thirdConfig = { </span><span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;../second-config.json&quot; </span><span class="s1">};</span>
        <span class="s2">var </span><span class="s1">thirdConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;dir2&quot;</span><span class="s1">, </span><span class="s0">&quot;third-config.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;dir2&quot;</span><span class="s1">, </span><span class="s0">&quot;third-config.json&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">return </span><span class="s1">path === firstConfigPath ||</span>
                <span class="s1">path === secondConfigPath ||</span>
                <span class="s1">path === thirdConfigPath;</span>
        <span class="s1">}, </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">if </span><span class="s1">(path === firstConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(firstConfig);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === secondConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(secondConfig);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === thirdConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(thirdConfig);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">});</span>
        <span class="s4">// assert.deepEqual(res, {</span>
        <span class="s4">//   extends: &quot;../second-config.json&quot;,</span>
        <span class="s4">//   compilerOptions: { baseUrl: join(&quot;..&quot;, &quot;..&quot;) },</span>
        <span class="s4">// });</span>
        <span class="s1">expect(res).toEqual({</span>
            <span class="s2">extends</span><span class="s1">: </span><span class="s0">&quot;../second-config.json&quot;</span><span class="s1">,</span>
            <span class="s1">compilerOptions: { baseUrl: (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;..&quot;</span><span class="s1">, </span><span class="s0">&quot;..&quot;</span><span class="s1">) },</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with array extends and overwrite all options&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">baseConfig1 = {</span>
            <span class="s1">compilerOptions: { baseUrl: </span><span class="s0">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s0">&quot;bar&quot;</span><span class="s1">] } },</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">baseConfig1Path = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config-1.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">baseConfig2 = { compilerOptions: { baseUrl: </span><span class="s0">&quot;.&quot; </span><span class="s1">} };</span>
        <span class="s2">var </span><span class="s1">baseConfig2Path = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config-2.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">baseConfig3 = {</span>
            <span class="s1">compilerOptions: { baseUrl: </span><span class="s0">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] } },</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">baseConfig3Path = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;dir2&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config-3.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">actualConfig = {</span>
            <span class="s2">extends</span><span class="s1">: [</span>
                <span class="s0">&quot;./base-config-1.json&quot;</span><span class="s1">,</span>
                <span class="s0">&quot;./dir1/base-config-2.json&quot;</span><span class="s1">,</span>
                <span class="s0">&quot;./dir1/dir2/base-config-3.json&quot;</span><span class="s1">,</span>
            <span class="s1">],</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">actualConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">return </span><span class="s1">[</span>
                <span class="s1">baseConfig1Path,</span>
                <span class="s1">baseConfig2Path,</span>
                <span class="s1">baseConfig3Path,</span>
                <span class="s1">actualConfigPath,</span>
            <span class="s1">].indexOf(path) &gt;= </span><span class="s3">0</span><span class="s1">;</span>
        <span class="s1">}, </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">if </span><span class="s1">(path === baseConfig1Path) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig1);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === baseConfig2Path) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig2);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === baseConfig3Path) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig3);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === actualConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(actualConfig);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">});</span>
        <span class="s1">expect(res).toEqual({</span>
            <span class="s2">extends</span><span class="s1">: [</span>
                <span class="s0">&quot;./base-config-1.json&quot;</span><span class="s1">,</span>
                <span class="s0">&quot;./dir1/base-config-2.json&quot;</span><span class="s1">,</span>
                <span class="s0">&quot;./dir1/dir2/base-config-3.json&quot;</span><span class="s1">,</span>
            <span class="s1">],</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;dir1&quot;</span><span class="s1">, </span><span class="s0">&quot;dir2&quot;</span><span class="s1">),</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar2&quot;</span><span class="s1">] },</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
    <span class="s1">it(</span><span class="s0">&quot;should load a config with array extends without .json extension&quot;</span><span class="s1">, </span><span class="s2">function </span><span class="s1">() {</span>
        <span class="s2">var </span><span class="s1">baseConfig = {</span>
            <span class="s1">compilerOptions: { baseUrl: </span><span class="s0">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s0">&quot;bar&quot;</span><span class="s1">] } },</span>
        <span class="s1">};</span>
        <span class="s2">var </span><span class="s1">baseConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;base-config-1.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">actualConfig = { </span><span class="s2">extends</span><span class="s1">: [</span><span class="s0">&quot;./base-config-1&quot;</span><span class="s1">] };</span>
        <span class="s2">var </span><span class="s1">actualConfigPath = (</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">res = (</span><span class="s3">0</span><span class="s1">, tsconfig_loader_1.loadTsconfig)((</span><span class="s3">0</span><span class="s1">, path_1.join)(</span><span class="s0">&quot;/root&quot;</span><span class="s1">, </span><span class="s0">&quot;tsconfig.json&quot;</span><span class="s1">), </span><span class="s2">function </span><span class="s1">(path) { </span><span class="s2">return </span><span class="s1">[baseConfigPath, actualConfigPath].indexOf(path) &gt;= </span><span class="s3">0</span><span class="s1">; }, </span><span class="s2">function </span><span class="s1">(path) {</span>
            <span class="s2">if </span><span class="s1">(path === baseConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(baseConfig);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(path === actualConfigPath) {</span>
                <span class="s2">return </span><span class="s1">JSON.stringify(actualConfig);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
        <span class="s1">});</span>
        <span class="s1">expect(res).toEqual({</span>
            <span class="s2">extends</span><span class="s1">: [</span><span class="s0">&quot;./base-config-1&quot;</span><span class="s1">],</span>
            <span class="s1">compilerOptions: {</span>
                <span class="s1">baseUrl: </span><span class="s0">&quot;.&quot;</span><span class="s1">,</span>
                <span class="s1">paths: { foo: [</span><span class="s0">&quot;bar&quot;</span><span class="s1">] },</span>
            <span class="s1">},</span>
        <span class="s1">});</span>
    <span class="s1">});</span>
<span class="s1">});</span>
<span class="s4">//# sourceMappingURL=tsconfig-loader.test.js.map</span></pre>
</body>
</html>