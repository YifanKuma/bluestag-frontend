<html>
<head>
<title>promise-queue.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #0033b3;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
promise-queue.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
    This is a simple promise queue that allows you to limit the number of concurrent promises 
    that are running at any given time. It's used to limit the number of concurrent 
    prefetch requests that are being made to the server but could be used for other 
    things as well. 
*/ </span><span class="s2">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s2">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s3">true</span>
<span class="s1">});</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s2">&quot;PromiseQueue&quot;</span><span class="s1">, {</span>
    <span class="s1">enumerable: </span><span class="s3">true</span><span class="s1">,</span>
    <span class="s1">get: </span><span class="s3">function</span><span class="s1">() {</span>
        <span class="s3">return </span><span class="s1">PromiseQueue;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s3">const </span><span class="s1">_class_private_field_loose_base = require(</span><span class="s2">&quot;@swc/helpers/_/_class_private_field_loose_base&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_class_private_field_loose_key = require(</span><span class="s2">&quot;@swc/helpers/_/_class_private_field_loose_key&quot;</span><span class="s1">);</span>
<span class="s3">var </span><span class="s1">_maxConcurrency = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_class_private_field_loose_key._(</span><span class="s2">&quot;_maxConcurrency&quot;</span><span class="s1">), _runningCount = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_class_private_field_loose_key._(</span><span class="s2">&quot;_runningCount&quot;</span><span class="s1">), _queue = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_class_private_field_loose_key._(</span><span class="s2">&quot;_queue&quot;</span><span class="s1">), _processNext = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_class_private_field_loose_key._(</span><span class="s2">&quot;_processNext&quot;</span><span class="s1">);</span>
<span class="s3">class </span><span class="s1">PromiseQueue {</span>
    <span class="s1">enqueue(promiseFn) {</span>
        <span class="s3">let </span><span class="s1">taskResolve;</span>
        <span class="s3">let </span><span class="s1">taskReject;</span>
        <span class="s3">const </span><span class="s1">taskPromise = </span><span class="s3">new </span><span class="s1">Promise((resolve, reject)=&gt;{</span>
            <span class="s1">taskResolve = resolve;</span>
            <span class="s1">taskReject = reject;</span>
        <span class="s1">});</span>
        <span class="s3">const </span><span class="s1">task = async ()=&gt;{</span>
            <span class="s3">try </span><span class="s1">{</span>
                <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _runningCount)[_runningCount]++;</span>
                <span class="s3">const </span><span class="s1">result = </span><span class="s3">await </span><span class="s1">promiseFn();</span>
                <span class="s1">taskResolve(result);</span>
            <span class="s1">} </span><span class="s3">catch </span><span class="s1">(error) {</span>
                <span class="s1">taskReject(error);</span>
            <span class="s1">} </span><span class="s3">finally</span><span class="s1">{</span>
                <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _runningCount)[_runningCount]--;</span>
                <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _processNext)[_processNext]();</span>
            <span class="s1">}</span>
        <span class="s1">};</span>
        <span class="s3">const </span><span class="s1">enqueueResult = {</span>
            <span class="s1">promiseFn: taskPromise,</span>
            <span class="s1">task</span>
        <span class="s1">};</span>
        <span class="s0">// wonder if we should take a LIFO approach here</span>
        <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].push(enqueueResult);</span>
        <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _processNext)[_processNext]();</span>
        <span class="s3">return </span><span class="s1">taskPromise;</span>
    <span class="s1">}</span>
    <span class="s1">bump(promiseFn) {</span>
        <span class="s3">const </span><span class="s1">index = _class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].findIndex((item)=&gt;item.promiseFn === promiseFn);</span>
        <span class="s3">if </span><span class="s1">(index &gt; -</span><span class="s4">1</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s1">bumpedItem = _class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].splice(index, </span><span class="s4">1</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">];</span>
            <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].unshift(bumpedItem);</span>
            <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _processNext)[_processNext](</span><span class="s3">true</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s1">constructor(maxConcurrency = </span><span class="s4">5</span><span class="s1">){</span>
        <span class="s1">Object.defineProperty(</span><span class="s3">this</span><span class="s1">, _processNext, {</span>
            <span class="s1">value: processNext</span>
        <span class="s1">});</span>
        <span class="s1">Object.defineProperty(</span><span class="s3">this</span><span class="s1">, _maxConcurrency, {</span>
            <span class="s1">writable: </span><span class="s3">true</span><span class="s1">,</span>
            <span class="s1">value: </span><span class="s3">void </span><span class="s4">0</span>
        <span class="s1">});</span>
        <span class="s1">Object.defineProperty(</span><span class="s3">this</span><span class="s1">, _runningCount, {</span>
            <span class="s1">writable: </span><span class="s3">true</span><span class="s1">,</span>
            <span class="s1">value: </span><span class="s3">void </span><span class="s4">0</span>
        <span class="s1">});</span>
        <span class="s1">Object.defineProperty(</span><span class="s3">this</span><span class="s1">, _queue, {</span>
            <span class="s1">writable: </span><span class="s3">true</span><span class="s1">,</span>
            <span class="s1">value: </span><span class="s3">void </span><span class="s4">0</span>
        <span class="s1">});</span>
        <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _maxConcurrency)[_maxConcurrency] = maxConcurrency;</span>
        <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _runningCount)[_runningCount] = </span><span class="s4">0</span><span class="s1">;</span>
        <span class="s1">_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue] = [];</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s1">processNext(forced) {</span>
    <span class="s3">if </span><span class="s1">(forced === </span><span class="s3">void </span><span class="s4">0</span><span class="s1">) forced = </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">((_class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _runningCount)[_runningCount] &lt; _class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _maxConcurrency)[_maxConcurrency] || forced) &amp;&amp; _class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].length &gt; </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s3">var </span><span class="s1">_class_private_field_loose_base__queue_shift;</span>
        <span class="s1">(_class_private_field_loose_base__queue_shift = _class_private_field_loose_base._(</span><span class="s3">this</span><span class="s1">, _queue)[_queue].shift()) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _class_private_field_loose_base__queue_shift.task();</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">if </span><span class="s1">((</span><span class="s3">typeof </span><span class="s1">exports.default === </span><span class="s2">'function' </span><span class="s1">|| (</span><span class="s3">typeof </span><span class="s1">exports.default === </span><span class="s2">'object' </span><span class="s1">&amp;&amp; exports.default !== </span><span class="s3">null</span><span class="s1">)) &amp;&amp; </span><span class="s3">typeof </span><span class="s1">exports.default.__esModule === </span><span class="s2">'undefined'</span><span class="s1">) {</span>
  <span class="s1">Object.defineProperty(exports.default, </span><span class="s2">'__esModule'</span><span class="s1">, { value: </span><span class="s3">true </span><span class="s1">});</span>
  <span class="s1">Object.assign(exports.default, exports);</span>
  <span class="s1">module.exports = exports.default;</span>
<span class="s1">}</span>

<span class="s0">//# sourceMappingURL=promise-queue.js.map</span></pre>
</body>
</html>