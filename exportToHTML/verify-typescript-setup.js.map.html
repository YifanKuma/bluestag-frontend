<html>
<head>
<title>verify-typescript-setup.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
verify-typescript-setup.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/lib/verify-typescript-setup.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { bold, cyan, red, yellow } from './picocolors'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n\n</span><span class="s1">import { hasNecessaryDependencies } from './has-necessary-dependencies'</span><span class="s3">\n</span><span class="s1">import type { NecessaryDependencies } from './has-necessary-dependencies'</span><span class="s3">\n</span><span class="s1">import semver from 'next/dist/compiled/semver'</span><span class="s3">\n</span><span class="s1">import { CompileError } from './compile-error'</span><span class="s3">\n</span><span class="s1">import * as log from '../build/output/log'</span><span class="s3">\n\n</span><span class="s1">import { getTypeScriptIntent } from './typescript/getTypeScriptIntent'</span><span class="s3">\n</span><span class="s1">import type { TypeCheckResult } from './typescript/runTypeCheck'</span><span class="s3">\n</span><span class="s1">import { writeAppTypeDeclarations } from './typescript/writeAppTypeDeclarations'</span><span class="s3">\n</span><span class="s1">import { writeConfigurationDefaults } from './typescript/writeConfigurationDefaults'</span><span class="s3">\n</span><span class="s1">import { installDependencies } from './install-dependencies'</span><span class="s3">\n</span><span class="s1">import { isCI } from '../server/ci-info'</span><span class="s3">\n</span><span class="s1">import { missingDepsError } from './typescript/missingDependencyError'</span><span class="s3">\n\n</span><span class="s1">const requiredPackages = [</span><span class="s3">\n  </span><span class="s1">{</span><span class="s3">\n    </span><span class="s1">file: 'typescript/lib/typescript.js',</span><span class="s3">\n    </span><span class="s1">pkg: 'typescript',</span><span class="s3">\n    </span><span class="s1">exportsRestrict: true,</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">{</span><span class="s3">\n    </span><span class="s1">file: '@types/react/index.d.ts',</span><span class="s3">\n    </span><span class="s1">pkg: '@types/react',</span><span class="s3">\n    </span><span class="s1">exportsRestrict: true,</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">{</span><span class="s3">\n    </span><span class="s1">file: '@types/node/index.d.ts',</span><span class="s3">\n    </span><span class="s1">pkg: '@types/node',</span><span class="s3">\n    </span><span class="s1">exportsRestrict: true,</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n</span><span class="s1">]</span><span class="s3">\n\n</span><span class="s1">export async function verifyTypeScriptSetup({</span><span class="s3">\n  </span><span class="s1">dir,</span><span class="s3">\n  </span><span class="s1">distDir,</span><span class="s3">\n  </span><span class="s1">cacheDir,</span><span class="s3">\n  </span><span class="s1">intentDirs,</span><span class="s3">\n  </span><span class="s1">tsconfigPath,</span><span class="s3">\n  </span><span class="s1">typeCheckPreflight,</span><span class="s3">\n  </span><span class="s1">disableStaticImages,</span><span class="s3">\n  </span><span class="s1">hasAppDir,</span><span class="s3">\n  </span><span class="s1">hasPagesDir,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">dir: string</span><span class="s3">\n  </span><span class="s1">distDir: string</span><span class="s3">\n  </span><span class="s1">cacheDir?: string</span><span class="s3">\n  </span><span class="s1">tsconfigPath: string</span><span class="s3">\n  </span><span class="s1">intentDirs: string[]</span><span class="s3">\n  </span><span class="s1">typeCheckPreflight: boolean</span><span class="s3">\n  </span><span class="s1">disableStaticImages: boolean</span><span class="s3">\n  </span><span class="s1">hasAppDir: boolean</span><span class="s3">\n  </span><span class="s1">hasPagesDir: boolean</span><span class="s3">\n</span><span class="s1">}): Promise&lt;{ result?: TypeCheckResult; version: string | null }&gt; {</span><span class="s3">\n  </span><span class="s1">const resolvedTsConfigPath = path.join(dir, tsconfigPath)</span><span class="s3">\n\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">// Check if the project uses TypeScript:</span><span class="s3">\n    </span><span class="s1">const intent = await getTypeScriptIntent(dir, intentDirs, tsconfigPath)</span><span class="s3">\n    </span><span class="s1">if (!intent) {</span><span class="s3">\n      </span><span class="s1">return { version: null }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Ensure TypeScript and necessary `@types/*` are installed:</span><span class="s3">\n    </span><span class="s1">let deps: NecessaryDependencies = await hasNecessaryDependencies(</span><span class="s3">\n      </span><span class="s1">dir,</span><span class="s3">\n      </span><span class="s1">requiredPackages</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">if (deps.missing?.length &gt; 0) {</span><span class="s3">\n      </span><span class="s1">if (isCI) {</span><span class="s3">\n        </span><span class="s1">// we don't attempt auto install in CI to avoid side-effects</span><span class="s3">\n        </span><span class="s1">// and instead log the error for installing needed packages</span><span class="s3">\n        </span><span class="s1">missingDepsError(dir, deps.missing)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">console.log(</span><span class="s3">\n        </span><span class="s1">bold(</span><span class="s3">\n          </span><span class="s1">yellow(</span><span class="s3">\n            </span><span class="s1">`It looks like you're trying to use TypeScript but do not have the required package(s) installed.`</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">) +</span><span class="s3">\n          </span><span class="s1">'</span><span class="s3">\\</span><span class="s1">n' +</span><span class="s3">\n          </span><span class="s1">'Installing dependencies' +</span><span class="s3">\n          </span><span class="s1">'</span><span class="s3">\\</span><span class="s1">n</span><span class="s3">\\</span><span class="s1">n' +</span><span class="s3">\n          </span><span class="s1">bold(</span><span class="s3">\n            </span><span class="s1">'If you are not trying to use TypeScript, please remove the ' +</span><span class="s3">\n              </span><span class="s1">cyan('tsconfig.json') +</span><span class="s3">\n              </span><span class="s1">' file from your package root (and any TypeScript files in your app and pages directories).'</span><span class="s3">\n          </span><span class="s1">) +</span><span class="s3">\n          </span><span class="s1">'</span><span class="s3">\\</span><span class="s1">n'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">await installDependencies(dir, deps.missing, true).catch((err) =&gt; {</span><span class="s3">\n        </span><span class="s1">if (err &amp;&amp; typeof err === 'object' &amp;&amp; 'command' in err) {</span><span class="s3">\n          </span><span class="s1">console.error(</span><span class="s3">\n            </span><span class="s1">`Failed to install required TypeScript dependencies, please install them manually to continue:</span><span class="s3">\\</span><span class="s1">n` +</span><span class="s3">\n              </span><span class="s1">(err as any).command +</span><span class="s3">\n              </span><span class="s1">'</span><span class="s3">\\</span><span class="s1">n'</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">deps = await hasNecessaryDependencies(dir, requiredPackages)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Load TypeScript after we're sure it exists:</span><span class="s3">\n    </span><span class="s1">const tsPath = deps.resolved.get('typescript')!</span><span class="s3">\n    </span><span class="s1">const ts = (await Promise.resolve(</span><span class="s3">\n      </span><span class="s1">require(tsPath)</span><span class="s3">\n    </span><span class="s1">)) as typeof import('typescript')</span><span class="s3">\n\n    </span><span class="s1">if (semver.lt(ts.version, '4.5.2')) {</span><span class="s3">\n      </span><span class="s1">log.warn(</span><span class="s3">\n        </span><span class="s1">`Minimum recommended TypeScript version is v4.5.2, older versions can potentially be incompatible with Next.js. Detected: ${ts.version}`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Reconfigure (or create) the user's `tsconfig.json` for them:</span><span class="s3">\n    </span><span class="s1">await writeConfigurationDefaults(</span><span class="s3">\n      </span><span class="s1">ts,</span><span class="s3">\n      </span><span class="s1">resolvedTsConfigPath,</span><span class="s3">\n      </span><span class="s1">intent.firstTimeSetup,</span><span class="s3">\n      </span><span class="s1">hasAppDir,</span><span class="s3">\n      </span><span class="s1">distDir,</span><span class="s3">\n      </span><span class="s1">hasPagesDir</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">// Write out the necessary `next-env.d.ts` file to correctly register</span><span class="s3">\n    </span><span class="s1">// Next.js' types:</span><span class="s3">\n    </span><span class="s1">await writeAppTypeDeclarations({</span><span class="s3">\n      </span><span class="s1">baseDir: dir,</span><span class="s3">\n      </span><span class="s1">distDir,</span><span class="s3">\n      </span><span class="s1">imageImportsEnabled: !disableStaticImages,</span><span class="s3">\n      </span><span class="s1">hasPagesDir,</span><span class="s3">\n      </span><span class="s1">hasAppDir,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">let result</span><span class="s3">\n    </span><span class="s1">if (typeCheckPreflight) {</span><span class="s3">\n      </span><span class="s1">const { runTypeCheck } =</span><span class="s3">\n        </span><span class="s1">require('./typescript/runTypeCheck') as typeof import('./typescript/runTypeCheck')</span><span class="s3">\n\n      </span><span class="s1">// Verify the project passes type-checking before we go to webpack phase:</span><span class="s3">\n      </span><span class="s1">result = await runTypeCheck(</span><span class="s3">\n        </span><span class="s1">ts,</span><span class="s3">\n        </span><span class="s1">dir,</span><span class="s3">\n        </span><span class="s1">distDir,</span><span class="s3">\n        </span><span class="s1">resolvedTsConfigPath,</span><span class="s3">\n        </span><span class="s1">cacheDir,</span><span class="s3">\n        </span><span class="s1">hasAppDir</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return { result, version: ts.version }</span><span class="s3">\n  </span><span class="s1">} catch (err) {</span><span class="s3">\n    </span><span class="s1">// These are special errors that should not show a stack trace:</span><span class="s3">\n    </span><span class="s1">if (err instanceof CompileError) {</span><span class="s3">\n      </span><span class="s1">console.error(red('Failed to compile.</span><span class="s3">\\</span><span class="s1">n'))</span><span class="s3">\n      </span><span class="s1">console.error(err.message)</span><span class="s3">\n      </span><span class="s1">process.exit(1)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* verifyTypeScriptSetup can be either invoked directly in the main thread (during next dev / next lint)</span><span class="s3">\n     </span><span class="s1">* or run in a worker (during next build). In the latter case, we need to print the error message, as the</span><span class="s3">\n     </span><span class="s1">* parent process will only receive an `Jest worker encountered 1 child process exceptions, exceeding retry limit`.</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n\n    </span><span class="s1">// we are in a worker, print the error message and exit the process</span><span class="s3">\n    </span><span class="s1">if (process.env.IS_NEXT_WORKER) {</span><span class="s3">\n      </span><span class="s1">if (err instanceof Error) {</span><span class="s3">\n        </span><span class="s1">console.error(err.message)</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">console.error(err)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">process.exit(1)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// we are in the main thread, throw the error and it will be handled by the caller</span><span class="s3">\n    </span><span class="s1">throw err</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;verifyTypeScriptSetup&quot;</span><span class="s0">,</span><span class="s1">&quot;requiredPackages&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;pkg&quot;</span><span class="s0">,</span><span class="s1">&quot;exportsRestrict&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheDir&quot;</span><span class="s0">,</span><span class="s1">&quot;intentDirs&quot;</span><span class="s0">,</span><span class="s1">&quot;tsconfigPath&quot;</span><span class="s0">,</span><span class="s1">&quot;typeCheckPreflight&quot;</span><span class="s0">,</span><span class="s1">&quot;disableStaticImages&quot;</span><span class="s0">,</span><span class="s1">&quot;hasAppDir&quot;</span><span class="s0">,</span><span class="s1">&quot;hasPagesDir&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedTsConfigPath&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;deps&quot;</span><span class="s0">,</span><span class="s1">&quot;intent&quot;</span><span class="s0">,</span><span class="s1">&quot;getTypeScriptIntent&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;hasNecessaryDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;missing&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;isCI&quot;</span><span class="s0">,</span><span class="s1">&quot;missingDepsError&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;log&quot;</span><span class="s0">,</span><span class="s1">&quot;bold&quot;</span><span class="s0">,</span><span class="s1">&quot;yellow&quot;</span><span class="s0">,</span><span class="s1">&quot;cyan&quot;</span><span class="s0">,</span><span class="s1">&quot;installDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;catch&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;command&quot;</span><span class="s0">,</span><span class="s1">&quot;tsPath&quot;</span><span class="s0">,</span><span class="s1">&quot;resolved&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;ts&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;semver&quot;</span><span class="s0">,</span><span class="s1">&quot;lt&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;writeConfigurationDefaults&quot;</span><span class="s0">,</span><span class="s1">&quot;firstTimeSetup&quot;</span><span class="s0">,</span><span class="s1">&quot;writeAppTypeDeclarations&quot;</span><span class="s0">,</span><span class="s1">&quot;baseDir&quot;</span><span class="s0">,</span><span class="s1">&quot;imageImportsEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;runTypeCheck&quot;</span><span class="s0">,</span><span class="s1">&quot;CompileError&quot;</span><span class="s0">,</span><span class="s1">&quot;red&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;exit&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;IS_NEXT_WORKER&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>