<html>
<head>
<title>router-server.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
router-server.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/lib/router-server.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;// this must come first as it includes require hooks</span><span class="s3">\n</span><span class="s1">import type { WorkerRequestHandler, WorkerUpgradeHandler } from './types'</span><span class="s3">\n</span><span class="s1">import type { DevBundler, ServerFields } from './router-utils/setup-dev-bundler'</span><span class="s3">\n</span><span class="s1">import type { NextUrlWithParsedQuery, RequestMeta } from '../request-meta'</span><span class="s3">\n\n</span><span class="s1">// This is required before other imports to ensure the require hook is setup.</span><span class="s3">\n</span><span class="s1">import '../node-environment'</span><span class="s3">\n</span><span class="s1">import '../require-hook'</span><span class="s3">\n\n</span><span class="s1">import url from 'url'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import loadConfig from '../config'</span><span class="s3">\n</span><span class="s1">import { serveStatic } from '../serve-static'</span><span class="s3">\n</span><span class="s1">import setupDebug from 'next/dist/compiled/debug'</span><span class="s3">\n</span><span class="s1">import * as Log from '../../build/output/log'</span><span class="s3">\n</span><span class="s1">import { DecodeError } from '../../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import { findPagesDir } from '../../lib/find-pages-dir'</span><span class="s3">\n</span><span class="s1">import { setupFsCheck } from './router-utils/filesystem'</span><span class="s3">\n</span><span class="s1">import { proxyRequest } from './router-utils/proxy-request'</span><span class="s3">\n</span><span class="s1">import { isAbortError, pipeToNodeResponse } from '../pipe-readable'</span><span class="s3">\n</span><span class="s1">import { getResolveRoutes } from './router-utils/resolve-routes'</span><span class="s3">\n</span><span class="s1">import { addRequestMeta, getRequestMeta } from '../request-meta'</span><span class="s3">\n</span><span class="s1">import { pathHasPrefix } from '../../shared/lib/router/utils/path-has-prefix'</span><span class="s3">\n</span><span class="s1">import { removePathPrefix } from '../../shared/lib/router/utils/remove-path-prefix'</span><span class="s3">\n</span><span class="s1">import setupCompression from 'next/dist/compiled/compression'</span><span class="s3">\n</span><span class="s1">import { signalFromNodeResponse } from '../web/spec-extension/adapters/next-request'</span><span class="s3">\n</span><span class="s1">import { isPostpone } from './router-utils/is-postpone'</span><span class="s3">\n</span><span class="s1">import { parseUrl as parseUrlUtil } from '../../shared/lib/router/utils/parse-url'</span><span class="s3">\n\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">PHASE_PRODUCTION_SERVER,</span><span class="s3">\n  </span><span class="s1">PHASE_DEVELOPMENT_SERVER,</span><span class="s3">\n  </span><span class="s1">UNDERSCORE_NOT_FOUND_ROUTE,</span><span class="s3">\n</span><span class="s1">} from '../../shared/lib/constants'</span><span class="s3">\n</span><span class="s1">import { RedirectStatusCode } from '../../client/components/redirect-status-code'</span><span class="s3">\n</span><span class="s1">import { DevBundlerService } from './dev-bundler-service'</span><span class="s3">\n</span><span class="s1">import { type Span, trace } from '../../trace'</span><span class="s3">\n</span><span class="s1">import { ensureLeadingSlash } from '../../shared/lib/page-path/ensure-leading-slash'</span><span class="s3">\n</span><span class="s1">import { getNextPathnameInfo } from '../../shared/lib/router/utils/get-next-pathname-info'</span><span class="s3">\n</span><span class="s1">import { getHostname } from '../../shared/lib/get-hostname'</span><span class="s3">\n</span><span class="s1">import { detectDomainLocale } from '../../shared/lib/i18n/detect-domain-locale'</span><span class="s3">\n</span><span class="s1">import { MockedResponse } from './mock-request'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">HMR_ACTIONS_SENT_TO_BROWSER,</span><span class="s3">\n  </span><span class="s1">type AppIsrManifestAction,</span><span class="s3">\n</span><span class="s1">} from '../dev/hot-reloader-types'</span><span class="s3">\n</span><span class="s1">import { normalizedAssetPrefix } from '../../shared/lib/normalized-asset-prefix'</span><span class="s3">\n</span><span class="s1">import { NEXT_PATCH_SYMBOL } from './patch-fetch'</span><span class="s3">\n</span><span class="s1">import type { ServerInitResult } from './render-server'</span><span class="s3">\n</span><span class="s1">import { filterInternalHeaders } from './server-ipc/utils'</span><span class="s3">\n</span><span class="s1">import { blockCrossSite } from './router-utils/block-cross-site'</span><span class="s3">\n</span><span class="s1">import { traceGlobals } from '../../trace/shared'</span><span class="s3">\n</span><span class="s1">import { NoFallbackError } from '../../shared/lib/no-fallback-error.external'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">RouterServerContextSymbol,</span><span class="s3">\n  </span><span class="s1">routerServerGlobal,</span><span class="s3">\n</span><span class="s1">} from './router-utils/router-server-context'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">handleChromeDevtoolsWorkspaceRequest,</span><span class="s3">\n  </span><span class="s1">isChromeDevtoolsWorkspaceUrl,</span><span class="s3">\n</span><span class="s1">} from './chrome-devtools-workspace'</span><span class="s3">\n\n</span><span class="s1">const debug = setupDebug('next:router-server:main')</span><span class="s3">\n</span><span class="s1">const isNextFont = (pathname: string | null) =&gt;</span><span class="s3">\n  </span><span class="s1">pathname &amp;&amp; /</span><span class="s3">\\</span><span class="s1">/media</span><span class="s3">\\</span><span class="s1">/[^/]+</span><span class="s3">\\</span><span class="s1">.(woff|woff2|eot|ttf|otf)$/.test(pathname)</span><span class="s3">\n\n</span><span class="s1">export type RenderServer = Pick&lt;</span><span class="s3">\n  </span><span class="s1">typeof import('./render-server'),</span><span class="s3">\n  </span><span class="s1">| 'initialize'</span><span class="s3">\n  </span><span class="s1">| 'clearModuleContext'</span><span class="s3">\n  </span><span class="s1">| 'propagateServerField'</span><span class="s3">\n  </span><span class="s1">| 'getServerField'</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">export interface LazyRenderServerInstance {</span><span class="s3">\n  </span><span class="s1">instance?: RenderServer</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const requestHandlers: Record&lt;string, WorkerRequestHandler&gt; = {}</span><span class="s3">\n\n</span><span class="s1">export async function initialize(opts: {</span><span class="s3">\n  </span><span class="s1">dir: string</span><span class="s3">\n  </span><span class="s1">port: number</span><span class="s3">\n  </span><span class="s1">dev: boolean</span><span class="s3">\n  </span><span class="s1">onDevServerCleanup: ((listener: () =&gt; Promise&lt;void&gt;) =&gt; void) | undefined</span><span class="s3">\n  </span><span class="s1">server?: import('http').Server</span><span class="s3">\n  </span><span class="s1">minimalMode?: boolean</span><span class="s3">\n  </span><span class="s1">hostname?: string</span><span class="s3">\n  </span><span class="s1">keepAliveTimeout?: number</span><span class="s3">\n  </span><span class="s1">customServer?: boolean</span><span class="s3">\n  </span><span class="s1">experimentalHttpsServer?: boolean</span><span class="s3">\n  </span><span class="s1">startServerSpan?: Span</span><span class="s3">\n  </span><span class="s1">quiet?: boolean</span><span class="s3">\n</span><span class="s1">}): Promise&lt;ServerInitResult&gt; {</span><span class="s3">\n  </span><span class="s1">if (!process.env.NODE_ENV) {</span><span class="s3">\n    </span><span class="s1">// @ts-ignore not readonly</span><span class="s3">\n    </span><span class="s1">process.env.NODE_ENV = opts.dev ? 'development' : 'production'</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const config = await loadConfig(</span><span class="s3">\n    </span><span class="s1">opts.dev ? PHASE_DEVELOPMENT_SERVER : PHASE_PRODUCTION_SERVER,</span><span class="s3">\n    </span><span class="s1">opts.dir,</span><span class="s3">\n    </span><span class="s1">{ silent: false }</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">let compress: ReturnType&lt;typeof setupCompression&gt; | undefined</span><span class="s3">\n\n  </span><span class="s1">if (config?.compress !== false) {</span><span class="s3">\n    </span><span class="s1">compress = setupCompression()</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const fsChecker = await setupFsCheck({</span><span class="s3">\n    </span><span class="s1">dev: opts.dev,</span><span class="s3">\n    </span><span class="s1">dir: opts.dir,</span><span class="s3">\n    </span><span class="s1">config,</span><span class="s3">\n    </span><span class="s1">minimalMode: opts.minimalMode,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">const renderServer: LazyRenderServerInstance = {}</span><span class="s3">\n\n  </span><span class="s1">let developmentBundler: DevBundler | undefined</span><span class="s3">\n\n  </span><span class="s1">let devBundlerService: DevBundlerService | undefined</span><span class="s3">\n\n  </span><span class="s1">let originalFetch = globalThis.fetch</span><span class="s3">\n\n  </span><span class="s1">if (opts.dev) {</span><span class="s3">\n    </span><span class="s1">const { Telemetry } =</span><span class="s3">\n      </span><span class="s1">require('../../telemetry/storage') as typeof import('../../telemetry/storage')</span><span class="s3">\n\n    </span><span class="s1">const telemetry = new Telemetry({</span><span class="s3">\n      </span><span class="s1">distDir: path.join(opts.dir, config.distDir),</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">traceGlobals.set('telemetry', telemetry)</span><span class="s3">\n\n    </span><span class="s1">const { pagesDir, appDir } = findPagesDir(opts.dir)</span><span class="s3">\n\n    </span><span class="s1">const { setupDevBundler } =</span><span class="s3">\n      </span><span class="s1">require('./router-utils/setup-dev-bundler') as typeof import('./router-utils/setup-dev-bundler')</span><span class="s3">\n\n    </span><span class="s1">const resetFetch = () =&gt; {</span><span class="s3">\n      </span><span class="s1">globalThis.fetch = originalFetch</span><span class="s3">\n      </span><span class="s1">;(globalThis as Record&lt;symbol, unknown&gt;)[NEXT_PATCH_SYMBOL] = false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const setupDevBundlerSpan = opts.startServerSpan</span><span class="s3">\n      </span><span class="s1">? opts.startServerSpan.traceChild('setup-dev-bundler')</span><span class="s3">\n      </span><span class="s1">: trace('setup-dev-bundler')</span><span class="s3">\n    </span><span class="s1">developmentBundler = await setupDevBundlerSpan.traceAsyncFn(() =&gt;</span><span class="s3">\n      </span><span class="s1">setupDevBundler({</span><span class="s3">\n        </span><span class="s1">// Passed here but the initialization of this object happens below, doing the initialization before the setupDev call breaks.</span><span class="s3">\n        </span><span class="s1">renderServer,</span><span class="s3">\n        </span><span class="s1">appDir,</span><span class="s3">\n        </span><span class="s1">pagesDir,</span><span class="s3">\n        </span><span class="s1">telemetry,</span><span class="s3">\n        </span><span class="s1">fsChecker,</span><span class="s3">\n        </span><span class="s1">dir: opts.dir,</span><span class="s3">\n        </span><span class="s1">nextConfig: config,</span><span class="s3">\n        </span><span class="s1">isCustomServer: opts.customServer,</span><span class="s3">\n        </span><span class="s1">turbo: !!process.env.TURBOPACK,</span><span class="s3">\n        </span><span class="s1">port: opts.port,</span><span class="s3">\n        </span><span class="s1">onDevServerCleanup: opts.onDevServerCleanup,</span><span class="s3">\n        </span><span class="s1">resetFetch,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">devBundlerService = new DevBundlerService(</span><span class="s3">\n      </span><span class="s1">developmentBundler,</span><span class="s3">\n      </span><span class="s1">// The request handler is assigned below, this allows us to create a lazy</span><span class="s3">\n      </span><span class="s1">// reference to it.</span><span class="s3">\n      </span><span class="s1">(req, res) =&gt; {</span><span class="s3">\n        </span><span class="s1">return requestHandlers[opts.dir](req, res)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">renderServer.instance =</span><span class="s3">\n    </span><span class="s1">require('./render-server') as typeof import('./render-server')</span><span class="s3">\n\n  </span><span class="s1">const requestHandlerImpl: WorkerRequestHandler = async (req, res) =&gt; {</span><span class="s3">\n    </span><span class="s1">addRequestMeta(req, 'relativeProjectDir', relativeProjectDir)</span><span class="s3">\n\n    </span><span class="s1">// internal headers should not be honored by the request handler</span><span class="s3">\n    </span><span class="s1">if (!process.env.NEXT_PRIVATE_TEST_HEADERS) {</span><span class="s3">\n      </span><span class="s1">filterInternalHeaders(req.headers)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">!opts.minimalMode &amp;&amp;</span><span class="s3">\n      </span><span class="s1">config.i18n &amp;&amp;</span><span class="s3">\n      </span><span class="s1">config.i18n.localeDetection !== false</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">const urlParts = (req.url || '').split('?', 1)</span><span class="s3">\n      </span><span class="s1">let urlNoQuery = urlParts[0] || ''</span><span class="s3">\n\n      </span><span class="s1">if (config.basePath) {</span><span class="s3">\n        </span><span class="s1">urlNoQuery = removePathPrefix(urlNoQuery, config.basePath)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const pathnameInfo = getNextPathnameInfo(urlNoQuery, {</span><span class="s3">\n        </span><span class="s1">nextConfig: config,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">const domainLocale = detectDomainLocale(</span><span class="s3">\n        </span><span class="s1">config.i18n.domains,</span><span class="s3">\n        </span><span class="s1">getHostname({ hostname: urlNoQuery }, req.headers)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">const defaultLocale =</span><span class="s3">\n        </span><span class="s1">domainLocale?.defaultLocale || config.i18n.defaultLocale</span><span class="s3">\n\n      </span><span class="s1">const { getLocaleRedirect } =</span><span class="s3">\n        </span><span class="s1">require('../../shared/lib/i18n/get-locale-redirect') as typeof import('../../shared/lib/i18n/get-locale-redirect')</span><span class="s3">\n\n      </span><span class="s1">const parsedUrl = parseUrlUtil((req.url || '')?.replace(/^</span><span class="s3">\\</span><span class="s1">/+/, '/'))</span><span class="s3">\n\n      </span><span class="s1">const redirect = getLocaleRedirect({</span><span class="s3">\n        </span><span class="s1">defaultLocale,</span><span class="s3">\n        </span><span class="s1">domainLocale,</span><span class="s3">\n        </span><span class="s1">headers: req.headers,</span><span class="s3">\n        </span><span class="s1">nextConfig: config,</span><span class="s3">\n        </span><span class="s1">pathLocale: pathnameInfo.locale,</span><span class="s3">\n        </span><span class="s1">urlParsed: {</span><span class="s3">\n          </span><span class="s1">...parsedUrl,</span><span class="s3">\n          </span><span class="s1">pathname: pathnameInfo.locale</span><span class="s3">\n            </span><span class="s1">? `/${pathnameInfo.locale}${urlNoQuery}`</span><span class="s3">\n            </span><span class="s1">: urlNoQuery,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">if (redirect) {</span><span class="s3">\n        </span><span class="s1">res.setHeader('Location', redirect)</span><span class="s3">\n        </span><span class="s1">res.statusCode = RedirectStatusCode.TemporaryRedirect</span><span class="s3">\n        </span><span class="s1">res.end(redirect)</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (compress) {</span><span class="s3">\n      </span><span class="s1">// @ts-expect-error not express req/res</span><span class="s3">\n      </span><span class="s1">compress(req, res, () =&gt; {})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">req.on('error', (_err) =&gt; {</span><span class="s3">\n      </span><span class="s1">// TODO: log socket errors?</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">res.on('error', (_err) =&gt; {</span><span class="s3">\n      </span><span class="s1">// TODO: log socket errors?</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const invokedOutputs = new Set&lt;string&gt;()</span><span class="s3">\n\n    </span><span class="s1">async function invokeRender(</span><span class="s3">\n      </span><span class="s1">parsedUrl: NextUrlWithParsedQuery,</span><span class="s3">\n      </span><span class="s1">invokePath: string,</span><span class="s3">\n      </span><span class="s1">handleIndex: number,</span><span class="s3">\n      </span><span class="s1">additionalRequestMeta?: RequestMeta</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">// invokeRender expects /api routes to not be locale prefixed</span><span class="s3">\n      </span><span class="s1">// so normalize here before continuing</span><span class="s3">\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">config.i18n &amp;&amp;</span><span class="s3">\n        </span><span class="s1">removePathPrefix(invokePath, config.basePath).startsWith(</span><span class="s3">\n          </span><span class="s1">`/${getRequestMeta(req, 'locale')}/api`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">invokePath = fsChecker.handleLocale(</span><span class="s3">\n          </span><span class="s1">removePathPrefix(invokePath, config.basePath)</span><span class="s3">\n        </span><span class="s1">).pathname</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">req.headers['x-nextjs-data'] &amp;&amp;</span><span class="s3">\n        </span><span class="s1">fsChecker.getMiddlewareMatchers()?.length &amp;&amp;</span><span class="s3">\n        </span><span class="s1">removePathPrefix(invokePath, config.basePath) === '/404'</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">res.setHeader('x-nextjs-matched-path', parsedUrl.pathname || '')</span><span class="s3">\n        </span><span class="s1">res.statusCode = 404</span><span class="s3">\n        </span><span class="s1">res.setHeader('content-type', 'application/json')</span><span class="s3">\n        </span><span class="s1">res.end('{}')</span><span class="s3">\n        </span><span class="s1">return null</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (!handlers) {</span><span class="s3">\n        </span><span class="s1">throw new Error('Failed to initialize render server')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">addRequestMeta(req, 'invokePath', invokePath)</span><span class="s3">\n      </span><span class="s1">addRequestMeta(req, 'invokeQuery', parsedUrl.query)</span><span class="s3">\n      </span><span class="s1">addRequestMeta(req, 'middlewareInvoke', false)</span><span class="s3">\n\n      </span><span class="s1">for (const key in additionalRequestMeta || {}) {</span><span class="s3">\n        </span><span class="s1">addRequestMeta(</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">key as keyof RequestMeta,</span><span class="s3">\n          </span><span class="s1">additionalRequestMeta![key as keyof RequestMeta]</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">debug('invokeRender', req.url, req.headers)</span><span class="s3">\n\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const initResult =</span><span class="s3">\n          </span><span class="s1">await renderServer?.instance?.initialize(renderServerOpts)</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">await initResult?.requestHandler(req, res)</span><span class="s3">\n        </span><span class="s1">} catch (err) {</span><span class="s3">\n          </span><span class="s1">if (err instanceof NoFallbackError) {</span><span class="s3">\n            </span><span class="s1">// eslint-disable-next-line</span><span class="s3">\n            </span><span class="s1">await handleRequest(handleIndex + 1)</span><span class="s3">\n            </span><span class="s1">return</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">throw err</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">} catch (e) {</span><span class="s3">\n        </span><span class="s1">// If the client aborts before we can receive a response object (when</span><span class="s3">\n        </span><span class="s1">// the headers are flushed), then we can early exit without further</span><span class="s3">\n        </span><span class="s1">// processing.</span><span class="s3">\n        </span><span class="s1">if (isAbortError(e)) {</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">throw e</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const handleRequest = async (handleIndex: number) =&gt; {</span><span class="s3">\n      </span><span class="s1">if (handleIndex &gt; 5) {</span><span class="s3">\n        </span><span class="s1">throw new Error(`Attempted to handle request too many times ${req.url}`)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// handle hot-reloader first</span><span class="s3">\n      </span><span class="s1">if (developmentBundler) {</span><span class="s3">\n        </span><span class="s1">if (blockCrossSite(req, res, config.allowedDevOrigins, opts.hostname)) {</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const origUrl = req.url || '/'</span><span class="s3">\n\n        </span><span class="s1">// both the basePath and assetPrefix need to be stripped from the URL</span><span class="s3">\n        </span><span class="s1">// so that the development bundler can find the correct file</span><span class="s3">\n        </span><span class="s1">if (config.basePath &amp;&amp; pathHasPrefix(origUrl, config.basePath)) {</span><span class="s3">\n          </span><span class="s1">req.url = removePathPrefix(origUrl, config.basePath)</span><span class="s3">\n        </span><span class="s1">} else if (</span><span class="s3">\n          </span><span class="s1">config.assetPrefix &amp;&amp;</span><span class="s3">\n          </span><span class="s1">pathHasPrefix(origUrl, config.assetPrefix)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">req.url = removePathPrefix(origUrl, config.assetPrefix)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const parsedUrl = url.parse(req.url || '/')</span><span class="s3">\n\n        </span><span class="s1">const hotReloaderResult = await developmentBundler.hotReloader.run(</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">res,</span><span class="s3">\n          </span><span class="s1">parsedUrl</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">if (hotReloaderResult.finished) {</span><span class="s3">\n          </span><span class="s1">return hotReloaderResult</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">req.url = origUrl</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const {</span><span class="s3">\n        </span><span class="s1">finished,</span><span class="s3">\n        </span><span class="s1">parsedUrl,</span><span class="s3">\n        </span><span class="s1">statusCode,</span><span class="s3">\n        </span><span class="s1">resHeaders,</span><span class="s3">\n        </span><span class="s1">bodyStream,</span><span class="s3">\n        </span><span class="s1">matchedOutput,</span><span class="s3">\n      </span><span class="s1">} = await resolveRoutes({</span><span class="s3">\n        </span><span class="s1">req,</span><span class="s3">\n        </span><span class="s1">res,</span><span class="s3">\n        </span><span class="s1">isUpgradeReq: false,</span><span class="s3">\n        </span><span class="s1">signal: signalFromNodeResponse(res),</span><span class="s3">\n        </span><span class="s1">invokedOutputs,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">if (res.closed || res.finished) {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (developmentBundler &amp;&amp; matchedOutput?.type === 'devVirtualFsItem') {</span><span class="s3">\n        </span><span class="s1">const origUrl = req.url || '/'</span><span class="s3">\n\n        </span><span class="s1">if (config.basePath &amp;&amp; pathHasPrefix(origUrl, config.basePath)) {</span><span class="s3">\n          </span><span class="s1">req.url = removePathPrefix(origUrl, config.basePath)</span><span class="s3">\n        </span><span class="s1">} else if (</span><span class="s3">\n          </span><span class="s1">config.assetPrefix &amp;&amp;</span><span class="s3">\n          </span><span class="s1">pathHasPrefix(origUrl, config.assetPrefix)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">req.url = removePathPrefix(origUrl, config.assetPrefix)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (resHeaders) {</span><span class="s3">\n          </span><span class="s1">for (const key of Object.keys(resHeaders)) {</span><span class="s3">\n            </span><span class="s1">res.setHeader(key, resHeaders[key])</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const result = await developmentBundler.requestHandler(req, res)</span><span class="s3">\n\n        </span><span class="s1">if (result.finished) {</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">// TODO: throw invariant if we resolved to this but it wasn't handled?</span><span class="s3">\n        </span><span class="s1">req.url = origUrl</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">debug('requestHandler!', req.url, {</span><span class="s3">\n        </span><span class="s1">matchedOutput,</span><span class="s3">\n        </span><span class="s1">statusCode,</span><span class="s3">\n        </span><span class="s1">resHeaders,</span><span class="s3">\n        </span><span class="s1">bodyStream: !!bodyStream,</span><span class="s3">\n        </span><span class="s1">parsedUrl: {</span><span class="s3">\n          </span><span class="s1">pathname: parsedUrl.pathname,</span><span class="s3">\n          </span><span class="s1">query: parsedUrl.query,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">finished,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">// apply any response headers from routing</span><span class="s3">\n      </span><span class="s1">for (const key of Object.keys(resHeaders || {})) {</span><span class="s3">\n        </span><span class="s1">res.setHeader(key, resHeaders[key])</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// handle redirect</span><span class="s3">\n      </span><span class="s1">if (!bodyStream &amp;&amp; statusCode &amp;&amp; statusCode &gt; 300 &amp;&amp; statusCode &lt; 400) {</span><span class="s3">\n        </span><span class="s1">const destination = url.format(parsedUrl)</span><span class="s3">\n        </span><span class="s1">res.statusCode = statusCode</span><span class="s3">\n        </span><span class="s1">res.setHeader('location', destination)</span><span class="s3">\n\n        </span><span class="s1">if (statusCode === RedirectStatusCode.PermanentRedirect) {</span><span class="s3">\n          </span><span class="s1">res.setHeader('Refresh', `0;url=${destination}`)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return res.end(destination)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// handle middleware body response</span><span class="s3">\n      </span><span class="s1">if (bodyStream) {</span><span class="s3">\n        </span><span class="s1">res.statusCode = statusCode || 200</span><span class="s3">\n        </span><span class="s1">return await pipeToNodeResponse(bodyStream, res)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (finished &amp;&amp; parsedUrl.protocol) {</span><span class="s3">\n        </span><span class="s1">return await proxyRequest(</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">res,</span><span class="s3">\n          </span><span class="s1">parsedUrl,</span><span class="s3">\n          </span><span class="s1">undefined,</span><span class="s3">\n          </span><span class="s1">getRequestMeta(req, 'clonableBody')?.cloneBodyStream(),</span><span class="s3">\n          </span><span class="s1">config.experimental.proxyTimeout</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (matchedOutput?.fsPath &amp;&amp; matchedOutput.itemPath) {</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">opts.dev &amp;&amp;</span><span class="s3">\n          </span><span class="s1">(fsChecker.appFiles.has(matchedOutput.itemPath) ||</span><span class="s3">\n            </span><span class="s1">fsChecker.pageFiles.has(matchedOutput.itemPath))</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">res.statusCode = 500</span><span class="s3">\n          </span><span class="s1">const message = `A conflicting public file and page file was found for path ${matchedOutput.itemPath} https://nextjs.org/docs/messages/conflicting-public-file-page`</span><span class="s3">\n          </span><span class="s1">await invokeRender(parsedUrl, '/_error', handleIndex, {</span><span class="s3">\n            </span><span class="s1">invokeStatus: 500,</span><span class="s3">\n            </span><span class="s1">invokeError: new Error(message),</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n          </span><span class="s1">Log.error(message)</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">!res.getHeader('cache-control') &amp;&amp;</span><span class="s3">\n          </span><span class="s1">matchedOutput.type === 'nextStaticFolder'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">if (opts.dev &amp;&amp; !isNextFont(parsedUrl.pathname)) {</span><span class="s3">\n            </span><span class="s1">res.setHeader('Cache-Control', 'no-store, must-revalidate')</span><span class="s3">\n          </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">res.setHeader(</span><span class="s3">\n              </span><span class="s1">'Cache-Control',</span><span class="s3">\n              </span><span class="s1">'public, max-age=31536000, immutable'</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (!(req.method === 'GET' || req.method === 'HEAD')) {</span><span class="s3">\n          </span><span class="s1">res.setHeader('Allow', ['GET', 'HEAD'])</span><span class="s3">\n          </span><span class="s1">res.statusCode = 405</span><span class="s3">\n          </span><span class="s1">return await invokeRender(</span><span class="s3">\n            </span><span class="s1">url.parse('/405', true),</span><span class="s3">\n            </span><span class="s1">'/405',</span><span class="s3">\n            </span><span class="s1">handleIndex,</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n              </span><span class="s1">invokeStatus: 405,</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">return await serveStatic(req, res, matchedOutput.itemPath, {</span><span class="s3">\n            </span><span class="s1">root: matchedOutput.itemsRoot,</span><span class="s3">\n            </span><span class="s1">// Ensures that etags are not generated for static files when disabled.</span><span class="s3">\n            </span><span class="s1">etag: config.generateEtags,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">} catch (err: any) {</span><span class="s3">\n          </span><span class="s1">/**</span><span class="s3">\n           </span><span class="s1">* Hardcoded every possible error status code that could be thrown by </span><span class="s3">\&quot;</span><span class="s1">serveStatic</span><span class="s3">\&quot; </span><span class="s1">method</span><span class="s3">\n           </span><span class="s1">* This is done by searching </span><span class="s3">\&quot;</span><span class="s1">this.error</span><span class="s3">\&quot; </span><span class="s1">inside </span><span class="s3">\&quot;</span><span class="s1">send</span><span class="s3">\&quot; </span><span class="s1">module's source code:</span><span class="s3">\n           </span><span class="s1">* https://github.com/pillarjs/send/blob/master/index.js</span><span class="s3">\n           </span><span class="s1">* https://github.com/pillarjs/send/blob/develop/index.js</span><span class="s3">\n           </span><span class="s1">*/</span><span class="s3">\n          </span><span class="s1">const POSSIBLE_ERROR_CODE_FROM_SERVE_STATIC = new Set([</span><span class="s3">\n            </span><span class="s1">// send module will throw 500 when header is already sent or fs.stat error happens</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L392</span><span class="s3">\n            </span><span class="s1">// Note: we will use Next.js built-in 500 page to handle 500 errors</span><span class="s3">\n            </span><span class="s1">// 500,</span><span class="s3">\n\n            </span><span class="s1">// send module will throw 404 when file is missing</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L421</span><span class="s3">\n            </span><span class="s1">// Note: we will use Next.js built-in 404 page to handle 404 errors</span><span class="s3">\n            </span><span class="s1">// 404,</span><span class="s3">\n\n            </span><span class="s1">// send module will throw 403 when redirecting to a directory without enabling directory listing</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L484</span><span class="s3">\n            </span><span class="s1">// Note: Next.js throws a different error (without status code) for directory listing</span><span class="s3">\n            </span><span class="s1">// 403,</span><span class="s3">\n\n            </span><span class="s1">// send module will throw 400 when fails to normalize the path</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L520</span><span class="s3">\n            </span><span class="s1">400,</span><span class="s3">\n\n            </span><span class="s1">// send module will throw 412 with conditional GET request</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L632</span><span class="s3">\n            </span><span class="s1">412,</span><span class="s3">\n\n            </span><span class="s1">// send module will throw 416 when range is not satisfiable</span><span class="s3">\n            </span><span class="s1">// https://github.com/pillarjs/send/blob/53f0ab476145670a9bdd3dc722ab2fdc8d358fc6/index.js#L669</span><span class="s3">\n            </span><span class="s1">416,</span><span class="s3">\n          </span><span class="s1">])</span><span class="s3">\n\n          </span><span class="s1">let validErrorStatus = POSSIBLE_ERROR_CODE_FROM_SERVE_STATIC.has(</span><span class="s3">\n            </span><span class="s1">err.statusCode</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n\n          </span><span class="s1">// normalize non-allowed status codes</span><span class="s3">\n          </span><span class="s1">if (!validErrorStatus) {</span><span class="s3">\n            </span><span class="s1">;(err as any).statusCode = 400</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">if (typeof err.statusCode === 'number') {</span><span class="s3">\n            </span><span class="s1">const invokePath = `/${err.statusCode}`</span><span class="s3">\n            </span><span class="s1">const invokeStatus = err.statusCode</span><span class="s3">\n            </span><span class="s1">res.statusCode = err.statusCode</span><span class="s3">\n            </span><span class="s1">return await invokeRender(</span><span class="s3">\n              </span><span class="s1">url.parse(invokePath, true),</span><span class="s3">\n              </span><span class="s1">invokePath,</span><span class="s3">\n              </span><span class="s1">handleIndex,</span><span class="s3">\n              </span><span class="s1">{</span><span class="s3">\n                </span><span class="s1">invokeStatus,</span><span class="s3">\n              </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">throw err</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (matchedOutput) {</span><span class="s3">\n        </span><span class="s1">invokedOutputs.add(matchedOutput.itemPath)</span><span class="s3">\n\n        </span><span class="s1">return await invokeRender(</span><span class="s3">\n          </span><span class="s1">parsedUrl,</span><span class="s3">\n          </span><span class="s1">parsedUrl.pathname || '/',</span><span class="s3">\n          </span><span class="s1">handleIndex,</span><span class="s3">\n          </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">invokeOutput: matchedOutput.itemPath,</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (opts.dev &amp;&amp; isChromeDevtoolsWorkspaceUrl(parsedUrl)) {</span><span class="s3">\n        </span><span class="s1">await handleChromeDevtoolsWorkspaceRequest(res, opts, config)</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// 404 case</span><span class="s3">\n      </span><span class="s1">res.setHeader(</span><span class="s3">\n        </span><span class="s1">'Cache-Control',</span><span class="s3">\n        </span><span class="s1">'private, no-cache, no-store, max-age=0, must-revalidate'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">let realRequestPathname = parsedUrl.pathname ?? ''</span><span class="s3">\n      </span><span class="s1">if (realRequestPathname) {</span><span class="s3">\n        </span><span class="s1">if (config.basePath) {</span><span class="s3">\n          </span><span class="s1">realRequestPathname = removePathPrefix(</span><span class="s3">\n            </span><span class="s1">realRequestPathname,</span><span class="s3">\n            </span><span class="s1">config.basePath</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (config.assetPrefix) {</span><span class="s3">\n          </span><span class="s1">realRequestPathname = removePathPrefix(</span><span class="s3">\n            </span><span class="s1">realRequestPathname,</span><span class="s3">\n            </span><span class="s1">config.assetPrefix</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (config.i18n) {</span><span class="s3">\n          </span><span class="s1">realRequestPathname = removePathPrefix(</span><span class="s3">\n            </span><span class="s1">realRequestPathname,</span><span class="s3">\n            </span><span class="s1">'/' + (getRequestMeta(req, 'locale') ?? '')</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">// For not found static assets, return plain text 404 instead of</span><span class="s3">\n      </span><span class="s1">// full HTML 404 pages to save bandwidth.</span><span class="s3">\n      </span><span class="s1">if (realRequestPathname.startsWith('/_next/static/')) {</span><span class="s3">\n        </span><span class="s1">res.statusCode = 404</span><span class="s3">\n        </span><span class="s1">res.setHeader('Content-Type', 'text/plain; charset=utf-8')</span><span class="s3">\n        </span><span class="s1">res.end('Not Found')</span><span class="s3">\n        </span><span class="s1">return null</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Short-circuit favicon.ico serving so that the 404 page doesn't get built as favicon is requested by the browser when loading any route.</span><span class="s3">\n      </span><span class="s1">if (opts.dev &amp;&amp; !matchedOutput &amp;&amp; parsedUrl.pathname === '/favicon.ico') {</span><span class="s3">\n        </span><span class="s1">res.statusCode = 404</span><span class="s3">\n        </span><span class="s1">res.end('')</span><span class="s3">\n        </span><span class="s1">return null</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const appNotFound = opts.dev</span><span class="s3">\n        </span><span class="s1">? developmentBundler?.serverFields.hasAppNotFound</span><span class="s3">\n        </span><span class="s1">: await fsChecker.getItem(UNDERSCORE_NOT_FOUND_ROUTE)</span><span class="s3">\n\n      </span><span class="s1">res.statusCode = 404</span><span class="s3">\n\n      </span><span class="s1">if (appNotFound) {</span><span class="s3">\n        </span><span class="s1">return await invokeRender(</span><span class="s3">\n          </span><span class="s1">parsedUrl,</span><span class="s3">\n          </span><span class="s1">UNDERSCORE_NOT_FOUND_ROUTE,</span><span class="s3">\n          </span><span class="s1">handleIndex,</span><span class="s3">\n          </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">invokeStatus: 404,</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">await invokeRender(parsedUrl, '/404', handleIndex, {</span><span class="s3">\n        </span><span class="s1">invokeStatus: 404,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">await handleRequest(0)</span><span class="s3">\n    </span><span class="s1">} catch (err) {</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">let invokePath = '/500'</span><span class="s3">\n        </span><span class="s1">let invokeStatus = '500'</span><span class="s3">\n\n        </span><span class="s1">if (err instanceof DecodeError) {</span><span class="s3">\n          </span><span class="s1">invokePath = '/400'</span><span class="s3">\n          </span><span class="s1">invokeStatus = '400'</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">console.error(err)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">res.statusCode = Number(invokeStatus)</span><span class="s3">\n        </span><span class="s1">return await invokeRender(url.parse(invokePath, true), invokePath, 0, {</span><span class="s3">\n          </span><span class="s1">invokeStatus: res.statusCode,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">} catch (err2) {</span><span class="s3">\n        </span><span class="s1">console.error(err2)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">res.statusCode = 500</span><span class="s3">\n      </span><span class="s1">res.end('Internal Server Error')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">let requestHandler: WorkerRequestHandler = requestHandlerImpl</span><span class="s3">\n  </span><span class="s1">if (config.experimental.testProxy) {</span><span class="s3">\n    </span><span class="s1">// Intercept fetch and other testmode apis.</span><span class="s3">\n    </span><span class="s1">const { wrapRequestHandlerWorker, interceptTestApis } =</span><span class="s3">\n      </span><span class="s1">// eslint-disable-next-line @next/internal/typechecked-require -- experimental/testmode is not built ins next/dist/esm</span><span class="s3">\n      </span><span class="s1">require('next/dist/experimental/testmode/server') as typeof import('../../experimental/testmode/server')</span><span class="s3">\n    </span><span class="s1">requestHandler = wrapRequestHandlerWorker(requestHandler)</span><span class="s3">\n    </span><span class="s1">interceptTestApis()</span><span class="s3">\n    </span><span class="s1">// We treat the intercepted fetch as </span><span class="s3">\&quot;</span><span class="s1">original</span><span class="s3">\&quot; </span><span class="s1">fetch that should be reset to during HMR.</span><span class="s3">\n    </span><span class="s1">originalFetch = globalThis.fetch</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">requestHandlers[opts.dir] = requestHandler</span><span class="s3">\n\n  </span><span class="s1">const renderServerOpts: Parameters&lt;RenderServer['initialize']&gt;[0] = {</span><span class="s3">\n    </span><span class="s1">port: opts.port,</span><span class="s3">\n    </span><span class="s1">dir: opts.dir,</span><span class="s3">\n    </span><span class="s1">hostname: opts.hostname,</span><span class="s3">\n    </span><span class="s1">minimalMode: opts.minimalMode,</span><span class="s3">\n    </span><span class="s1">dev: !!opts.dev,</span><span class="s3">\n    </span><span class="s1">server: opts.server,</span><span class="s3">\n    </span><span class="s1">serverFields: {</span><span class="s3">\n      </span><span class="s1">...(developmentBundler?.serverFields || {}),</span><span class="s3">\n      </span><span class="s1">setIsrStatus: devBundlerService?.setIsrStatus.bind(devBundlerService),</span><span class="s3">\n    </span><span class="s1">} satisfies ServerFields,</span><span class="s3">\n    </span><span class="s1">experimentalTestProxy: !!config.experimental.testProxy,</span><span class="s3">\n    </span><span class="s1">experimentalHttpsServer: !!opts.experimentalHttpsServer,</span><span class="s3">\n    </span><span class="s1">bundlerService: devBundlerService,</span><span class="s3">\n    </span><span class="s1">startServerSpan: opts.startServerSpan,</span><span class="s3">\n    </span><span class="s1">quiet: opts.quiet,</span><span class="s3">\n    </span><span class="s1">onDevServerCleanup: opts.onDevServerCleanup,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">renderServerOpts.serverFields.routerServerHandler = requestHandlerImpl</span><span class="s3">\n\n  </span><span class="s1">// pre-initialize workers</span><span class="s3">\n  </span><span class="s1">const handlers = await renderServer.instance.initialize(renderServerOpts)</span><span class="s3">\n\n  </span><span class="s1">// this must come after initialize of render server since it's</span><span class="s3">\n  </span><span class="s1">// using initialized methods</span><span class="s3">\n  </span><span class="s1">if (!routerServerGlobal[RouterServerContextSymbol]) {</span><span class="s3">\n    </span><span class="s1">routerServerGlobal[RouterServerContextSymbol] = {}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const relativeProjectDir = path.relative(process.cwd(), opts.dir)</span><span class="s3">\n\n  </span><span class="s1">routerServerGlobal[RouterServerContextSymbol][relativeProjectDir] = {</span><span class="s3">\n    </span><span class="s1">nextConfig: config,</span><span class="s3">\n    </span><span class="s1">hostname: handlers.server.hostname,</span><span class="s3">\n    </span><span class="s1">revalidate: handlers.server.revalidate.bind(handlers.server),</span><span class="s3">\n    </span><span class="s1">render404: handlers.server.render404.bind(handlers.server),</span><span class="s3">\n    </span><span class="s1">experimentalTestProxy: renderServerOpts.experimentalTestProxy,</span><span class="s3">\n    </span><span class="s1">logErrorWithOriginalStack: opts.dev</span><span class="s3">\n      </span><span class="s1">? handlers.server.logErrorWithOriginalStack.bind(handlers.server)</span><span class="s3">\n      </span><span class="s1">: (err: unknown) =&gt; !opts.quiet &amp;&amp; Log.error(err),</span><span class="s3">\n    </span><span class="s1">setIsrStatus: devBundlerService?.setIsrStatus.bind(devBundlerService),</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const logError = async (</span><span class="s3">\n    </span><span class="s1">type: 'uncaughtException' | 'unhandledRejection',</span><span class="s3">\n    </span><span class="s1">err: Error | undefined</span><span class="s3">\n  </span><span class="s1">) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (isPostpone(err)) {</span><span class="s3">\n      </span><span class="s1">// React postpones that are unhandled might end up logged here but they're</span><span class="s3">\n      </span><span class="s1">// not really errors. They're just part of rendering.</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (type === 'unhandledRejection') {</span><span class="s3">\n      </span><span class="s1">Log.error('unhandledRejection: ', err)</span><span class="s3">\n    </span><span class="s1">} else if (type === 'uncaughtException') {</span><span class="s3">\n      </span><span class="s1">Log.error('uncaughtException: ', err)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">process.on('uncaughtException', logError.bind(null, 'uncaughtException'))</span><span class="s3">\n  </span><span class="s1">process.on('unhandledRejection', logError.bind(null, 'unhandledRejection'))</span><span class="s3">\n\n  </span><span class="s1">const resolveRoutes = getResolveRoutes(</span><span class="s3">\n    </span><span class="s1">fsChecker,</span><span class="s3">\n    </span><span class="s1">config,</span><span class="s3">\n    </span><span class="s1">opts,</span><span class="s3">\n    </span><span class="s1">renderServer.instance,</span><span class="s3">\n    </span><span class="s1">renderServerOpts,</span><span class="s3">\n    </span><span class="s1">developmentBundler?.ensureMiddleware</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const upgradeHandler: WorkerUpgradeHandler = async (req, socket, head) =&gt; {</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">req.on('error', (_err) =&gt; {</span><span class="s3">\n        </span><span class="s1">// TODO: log socket errors?</span><span class="s3">\n        </span><span class="s1">// console.error(_err);</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">socket.on('error', (_err) =&gt; {</span><span class="s3">\n        </span><span class="s1">// TODO: log socket errors?</span><span class="s3">\n        </span><span class="s1">// console.error(_err);</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">if (opts.dev &amp;&amp; developmentBundler &amp;&amp; req.url) {</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">blockCrossSite(req, socket, config.allowedDevOrigins, opts.hostname)</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const { basePath, assetPrefix } = config</span><span class="s3">\n\n        </span><span class="s1">let hmrPrefix = basePath</span><span class="s3">\n\n        </span><span class="s1">// assetPrefix overrides basePath for HMR path</span><span class="s3">\n        </span><span class="s1">if (assetPrefix) {</span><span class="s3">\n          </span><span class="s1">hmrPrefix = normalizedAssetPrefix(assetPrefix)</span><span class="s3">\n\n          </span><span class="s1">if (URL.canParse(hmrPrefix)) {</span><span class="s3">\n            </span><span class="s1">// remove trailing slash from pathname</span><span class="s3">\n            </span><span class="s1">// return empty string if pathname is '/'</span><span class="s3">\n            </span><span class="s1">// to avoid conflicts with '/_next' below</span><span class="s3">\n            </span><span class="s1">hmrPrefix = new URL(hmrPrefix).pathname.replace(/</span><span class="s3">\\</span><span class="s1">/$/, '')</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const isHMRRequest = req.url.startsWith(</span><span class="s3">\n          </span><span class="s1">ensureLeadingSlash(`${hmrPrefix}/_next/webpack-hmr`)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">// only handle HMR requests if the basePath in the request</span><span class="s3">\n        </span><span class="s1">// matches the basePath for the handler responding to the request</span><span class="s3">\n        </span><span class="s1">if (isHMRRequest) {</span><span class="s3">\n          </span><span class="s1">return developmentBundler.hotReloader.onHMR(</span><span class="s3">\n            </span><span class="s1">req,</span><span class="s3">\n            </span><span class="s1">socket,</span><span class="s3">\n            </span><span class="s1">head,</span><span class="s3">\n            </span><span class="s1">(client) =&gt; {</span><span class="s3">\n              </span><span class="s1">client.send(</span><span class="s3">\n                </span><span class="s1">JSON.stringify({</span><span class="s3">\n                  </span><span class="s1">action: HMR_ACTIONS_SENT_TO_BROWSER.ISR_MANIFEST,</span><span class="s3">\n                  </span><span class="s1">data: devBundlerService?.appIsrManifest || {},</span><span class="s3">\n                </span><span class="s1">} satisfies AppIsrManifestAction)</span><span class="s3">\n              </span><span class="s1">)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const res = new MockedResponse({</span><span class="s3">\n        </span><span class="s1">resWriter: () =&gt; {</span><span class="s3">\n          </span><span class="s1">throw new Error(</span><span class="s3">\n            </span><span class="s1">'Invariant: did not expect response writer to be written to for upgrade request'</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">const { matchedOutput, parsedUrl } = await resolveRoutes({</span><span class="s3">\n        </span><span class="s1">req,</span><span class="s3">\n        </span><span class="s1">res,</span><span class="s3">\n        </span><span class="s1">isUpgradeReq: true,</span><span class="s3">\n        </span><span class="s1">signal: signalFromNodeResponse(socket),</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">// TODO: allow upgrade requests to pages/app paths?</span><span class="s3">\n      </span><span class="s1">// this was not previously supported</span><span class="s3">\n      </span><span class="s1">if (matchedOutput) {</span><span class="s3">\n        </span><span class="s1">return socket.end()</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (parsedUrl.protocol) {</span><span class="s3">\n        </span><span class="s1">return await proxyRequest(req, socket, parsedUrl, head)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// If there's no matched output, we don't handle the request as user's</span><span class="s3">\n      </span><span class="s1">// custom WS server may be listening on the same path.</span><span class="s3">\n    </span><span class="s1">} catch (err) {</span><span class="s3">\n      </span><span class="s1">console.error('Error handling upgrade request', err)</span><span class="s3">\n      </span><span class="s1">socket.end()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return {</span><span class="s3">\n    </span><span class="s1">requestHandler,</span><span class="s3">\n    </span><span class="s1">upgradeHandler,</span><span class="s3">\n    </span><span class="s1">server: handlers.server,</span><span class="s3">\n    </span><span class="s1">closeUpgraded() {</span><span class="s3">\n      </span><span class="s1">developmentBundler?.hotReloader?.close()</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;initialize&quot;</span><span class="s0">,</span><span class="s1">&quot;debug&quot;</span><span class="s0">,</span><span class="s1">&quot;setupDebug&quot;</span><span class="s0">,</span><span class="s1">&quot;isNextFont&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;test&quot;</span><span class="s0">,</span><span class="s1">&quot;requestHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;opts&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ENV&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;loadConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;PHASE_DEVELOPMENT_SERVER&quot;</span><span class="s0">,</span><span class="s1">&quot;PHASE_PRODUCTION_SERVER&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;silent&quot;</span><span class="s0">,</span><span class="s1">&quot;compress&quot;</span><span class="s0">,</span><span class="s1">&quot;setupCompression&quot;</span><span class="s0">,</span><span class="s1">&quot;fsChecker&quot;</span><span class="s0">,</span><span class="s1">&quot;setupFsCheck&quot;</span><span class="s0">,</span><span class="s1">&quot;minimalMode&quot;</span><span class="s0">,</span><span class="s1">&quot;renderServer&quot;</span><span class="s0">,</span><span class="s1">&quot;developmentBundler&quot;</span><span class="s0">,</span><span class="s1">&quot;devBundlerService&quot;</span><span class="s0">,</span><span class="s1">&quot;originalFetch&quot;</span><span class="s0">,</span><span class="s1">&quot;globalThis&quot;</span><span class="s0">,</span><span class="s1">&quot;fetch&quot;</span><span class="s0">,</span><span class="s1">&quot;Telemetry&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;telemetry&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;traceGlobals&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;pagesDir&quot;</span><span class="s0">,</span><span class="s1">&quot;appDir&quot;</span><span class="s0">,</span><span class="s1">&quot;findPagesDir&quot;</span><span class="s0">,</span><span class="s1">&quot;setupDevBundler&quot;</span><span class="s0">,</span><span class="s1">&quot;resetFetch&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_PATCH_SYMBOL&quot;</span><span class="s0">,</span><span class="s1">&quot;setupDevBundlerSpan&quot;</span><span class="s0">,</span><span class="s1">&quot;startServerSpan&quot;</span><span class="s0">,</span><span class="s1">&quot;traceChild&quot;</span><span class="s0">,</span><span class="s1">&quot;trace&quot;</span><span class="s0">,</span><span class="s1">&quot;traceAsyncFn&quot;</span><span class="s0">,</span><span class="s1">&quot;nextConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;isCustomServer&quot;</span><span class="s0">,</span><span class="s1">&quot;customServer&quot;</span><span class="s0">,</span><span class="s1">&quot;turbo&quot;</span><span class="s0">,</span><span class="s1">&quot;TURBOPACK&quot;</span><span class="s0">,</span><span class="s1">&quot;port&quot;</span><span class="s0">,</span><span class="s1">&quot;onDevServerCleanup&quot;</span><span class="s0">,</span><span class="s1">&quot;DevBundlerService&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;instance&quot;</span><span class="s0">,</span><span class="s1">&quot;requestHandlerImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;addRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;relativeProjectDir&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_PRIVATE_TEST_HEADERS&quot;</span><span class="s0">,</span><span class="s1">&quot;filterInternalHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;i18n&quot;</span><span class="s0">,</span><span class="s1">&quot;localeDetection&quot;</span><span class="s0">,</span><span class="s1">&quot;urlParts&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;split&quot;</span><span class="s0">,</span><span class="s1">&quot;urlNoQuery&quot;</span><span class="s0">,</span><span class="s1">&quot;basePath&quot;</span><span class="s0">,</span><span class="s1">&quot;removePathPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;pathnameInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;getNextPathnameInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;domainLocale&quot;</span><span class="s0">,</span><span class="s1">&quot;detectDomainLocale&quot;</span><span class="s0">,</span><span class="s1">&quot;domains&quot;</span><span class="s0">,</span><span class="s1">&quot;getHostname&quot;</span><span class="s0">,</span><span class="s1">&quot;hostname&quot;</span><span class="s0">,</span><span class="s1">&quot;defaultLocale&quot;</span><span class="s0">,</span><span class="s1">&quot;getLocaleRedirect&quot;</span><span class="s0">,</span><span class="s1">&quot;parsedUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;parseUrlUtil&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;redirect&quot;</span><span class="s0">,</span><span class="s1">&quot;pathLocale&quot;</span><span class="s0">,</span><span class="s1">&quot;locale&quot;</span><span class="s0">,</span><span class="s1">&quot;urlParsed&quot;</span><span class="s0">,</span><span class="s1">&quot;setHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;statusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;RedirectStatusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;TemporaryRedirect&quot;</span><span class="s0">,</span><span class="s1">&quot;end&quot;</span><span class="s0">,</span><span class="s1">&quot;on&quot;</span><span class="s0">,</span><span class="s1">&quot;_err&quot;</span><span class="s0">,</span><span class="s1">&quot;invokedOutputs&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;invokeRender&quot;</span><span class="s0">,</span><span class="s1">&quot;invokePath&quot;</span><span class="s0">,</span><span class="s1">&quot;handleIndex&quot;</span><span class="s0">,</span><span class="s1">&quot;additionalRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;getRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;handleLocale&quot;</span><span class="s0">,</span><span class="s1">&quot;getMiddlewareMatchers&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;handlers&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;query&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;initResult&quot;</span><span class="s0">,</span><span class="s1">&quot;renderServerOpts&quot;</span><span class="s0">,</span><span class="s1">&quot;requestHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;NoFallbackError&quot;</span><span class="s0">,</span><span class="s1">&quot;handleRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbortError&quot;</span><span class="s0">,</span><span class="s1">&quot;blockCrossSite&quot;</span><span class="s0">,</span><span class="s1">&quot;allowedDevOrigins&quot;</span><span class="s0">,</span><span class="s1">&quot;origUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pathHasPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;assetPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;hotReloaderResult&quot;</span><span class="s0">,</span><span class="s1">&quot;hotReloader&quot;</span><span class="s0">,</span><span class="s1">&quot;run&quot;</span><span class="s0">,</span><span class="s1">&quot;finished&quot;</span><span class="s0">,</span><span class="s1">&quot;resHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;bodyStream&quot;</span><span class="s0">,</span><span class="s1">&quot;matchedOutput&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;isUpgradeReq&quot;</span><span class="s0">,</span><span class="s1">&quot;signal&quot;</span><span class="s0">,</span><span class="s1">&quot;signalFromNodeResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;closed&quot;</span><span class="s0">,</span><span class="s1">&quot;type&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;destination&quot;</span><span class="s0">,</span><span class="s1">&quot;format&quot;</span><span class="s0">,</span><span class="s1">&quot;PermanentRedirect&quot;</span><span class="s0">,</span><span class="s1">&quot;pipeToNodeResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;protocol&quot;</span><span class="s0">,</span><span class="s1">&quot;proxyRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;cloneBodyStream&quot;</span><span class="s0">,</span><span class="s1">&quot;experimental&quot;</span><span class="s0">,</span><span class="s1">&quot;proxyTimeout&quot;</span><span class="s0">,</span><span class="s1">&quot;fsPath&quot;</span><span class="s0">,</span><span class="s1">&quot;itemPath&quot;</span><span class="s0">,</span><span class="s1">&quot;appFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;pageFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;invokeStatus&quot;</span><span class="s0">,</span><span class="s1">&quot;invokeError&quot;</span><span class="s0">,</span><span class="s1">&quot;Log&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;getHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;serveStatic&quot;</span><span class="s0">,</span><span class="s1">&quot;root&quot;</span><span class="s0">,</span><span class="s1">&quot;itemsRoot&quot;</span><span class="s0">,</span><span class="s1">&quot;etag&quot;</span><span class="s0">,</span><span class="s1">&quot;generateEtags&quot;</span><span class="s0">,</span><span class="s1">&quot;POSSIBLE_ERROR_CODE_FROM_SERVE_STATIC&quot;</span><span class="s0">,</span><span class="s1">&quot;validErrorStatus&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;invokeOutput&quot;</span><span class="s0">,</span><span class="s1">&quot;isChromeDevtoolsWorkspaceUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;handleChromeDevtoolsWorkspaceRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;realRequestPathname&quot;</span><span class="s0">,</span><span class="s1">&quot;appNotFound&quot;</span><span class="s0">,</span><span class="s1">&quot;serverFields&quot;</span><span class="s0">,</span><span class="s1">&quot;hasAppNotFound&quot;</span><span class="s0">,</span><span class="s1">&quot;getItem&quot;</span><span class="s0">,</span><span class="s1">&quot;UNDERSCORE_NOT_FOUND_ROUTE&quot;</span><span class="s0">,</span><span class="s1">&quot;DecodeError&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;Number&quot;</span><span class="s0">,</span><span class="s1">&quot;err2&quot;</span><span class="s0">,</span><span class="s1">&quot;testProxy&quot;</span><span class="s0">,</span><span class="s1">&quot;wrapRequestHandlerWorker&quot;</span><span class="s0">,</span><span class="s1">&quot;interceptTestApis&quot;</span><span class="s0">,</span><span class="s1">&quot;server&quot;</span><span class="s0">,</span><span class="s1">&quot;setIsrStatus&quot;</span><span class="s0">,</span><span class="s1">&quot;bind&quot;</span><span class="s0">,</span><span class="s1">&quot;experimentalTestProxy&quot;</span><span class="s0">,</span><span class="s1">&quot;experimentalHttpsServer&quot;</span><span class="s0">,</span><span class="s1">&quot;bundlerService&quot;</span><span class="s0">,</span><span class="s1">&quot;quiet&quot;</span><span class="s0">,</span><span class="s1">&quot;routerServerHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;routerServerGlobal&quot;</span><span class="s0">,</span><span class="s1">&quot;RouterServerContextSymbol&quot;</span><span class="s0">,</span><span class="s1">&quot;relative&quot;</span><span class="s0">,</span><span class="s1">&quot;cwd&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;render404&quot;</span><span class="s0">,</span><span class="s1">&quot;logErrorWithOriginalStack&quot;</span><span class="s0">,</span><span class="s1">&quot;logError&quot;</span><span class="s0">,</span><span class="s1">&quot;isPostpone&quot;</span><span class="s0">,</span><span class="s1">&quot;getResolveRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;ensureMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;upgradeHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;socket&quot;</span><span class="s0">,</span><span class="s1">&quot;head&quot;</span><span class="s0">,</span><span class="s1">&quot;hmrPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizedAssetPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;URL&quot;</span><span class="s0">,</span><span class="s1">&quot;canParse&quot;</span><span class="s0">,</span><span class="s1">&quot;isHMRRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;ensureLeadingSlash&quot;</span><span class="s0">,</span><span class="s1">&quot;onHMR&quot;</span><span class="s0">,</span><span class="s1">&quot;client&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;action&quot;</span><span class="s0">,</span><span class="s1">&quot;HMR_ACTIONS_SENT_TO_BROWSER&quot;</span><span class="s0">,</span><span class="s1">&quot;ISR_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;appIsrManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;MockedResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;resWriter&quot;</span><span class="s0">,</span><span class="s1">&quot;closeUpgraded&quot;</span><span class="s0">,</span><span class="s1">&quot;close&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>