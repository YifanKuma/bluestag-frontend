<html>
<head>
<title>react-server-dom-webpack-plugin.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #8c8c8c; font-style: italic;}
.s2 { color: #080808;}
.s3 { color: #067d17;}
.s4 { color: #0033b3;}
.s5 { color: #1750eb;}
.s6 { color: #264eff;}
.s7 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
react-server-dom-webpack-plugin.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@license </span><span class="s0">React</span>
 <span class="s0">* react-server-dom-webpack-plugin.js</span>
 <span class="s0">*</span>
 <span class="s0">* Copyright (c) Meta Platforms, Inc. and affiliates.</span>
 <span class="s0">*</span>
 <span class="s0">* This source code is licensed under the MIT license found in the</span>
 <span class="s0">* LICENSE file in the root directory of this source tree.</span>
 <span class="s0">*/</span>

<span class="s3">&quot;use strict&quot;</span><span class="s2">;</span>
<span class="s4">var </span><span class="s2">path = require(</span><span class="s3">&quot;path&quot;</span><span class="s2">),</span>
  <span class="s2">url = require(</span><span class="s3">&quot;url&quot;</span><span class="s2">),</span>
  <span class="s2">asyncLib = require(</span><span class="s3">&quot;neo-async&quot;</span><span class="s2">),</span>
  <span class="s2">acorn = require(</span><span class="s3">&quot;acorn-loose&quot;</span><span class="s2">),</span>
  <span class="s2">ModuleDependency = require(</span><span class="s3">&quot;webpack/lib/dependencies/ModuleDependency&quot;</span><span class="s2">),</span>
  <span class="s2">NullDependency = require(</span><span class="s3">&quot;webpack/lib/dependencies/NullDependency&quot;</span><span class="s2">),</span>
  <span class="s2">Template = require(</span><span class="s3">&quot;webpack/lib/Template&quot;</span><span class="s2">),</span>
  <span class="s2">webpack = require(</span><span class="s3">&quot;webpack&quot;</span><span class="s2">);</span>
<span class="s4">function </span><span class="s2">_unsupportedIterableToArray(o, minLen) {</span>
  <span class="s4">if </span><span class="s2">(o) {</span>
    <span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;string&quot; </span><span class="s2">=== </span><span class="s4">typeof </span><span class="s2">o) </span><span class="s4">return </span><span class="s2">_arrayLikeToArray(o, minLen);</span>
    <span class="s4">var </span><span class="s2">n = Object.prototype.toString.call(o).slice(</span><span class="s5">8</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">&quot;Object&quot; </span><span class="s2">=== n &amp;&amp; o.constructor &amp;&amp; (n = o.constructor.name);</span>
    <span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;Map&quot; </span><span class="s2">=== n || </span><span class="s3">&quot;Set&quot; </span><span class="s2">=== n) </span><span class="s4">return </span><span class="s2">Array.from(o);</span>
    <span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;Arguments&quot; </span><span class="s2">=== n || </span><span class="s6">/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/</span><span class="s2">.test(n))</span>
      <span class="s4">return </span><span class="s2">_arrayLikeToArray(o, minLen);</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s4">function </span><span class="s2">_arrayLikeToArray(arr, len) {</span>
  <span class="s4">if </span><span class="s2">(</span><span class="s4">null </span><span class="s2">== len || len &gt; arr.length) len = arr.length;</span>
  <span class="s4">for </span><span class="s2">(</span><span class="s4">var </span><span class="s2">i = </span><span class="s5">0</span><span class="s2">, arr2 = Array(len); i &lt; len; i++) arr2[i] = arr[i];</span>
  <span class="s4">return </span><span class="s2">arr2;</span>
<span class="s2">}</span>
<span class="s4">function </span><span class="s2">_createForOfIteratorHelper(o, allowArrayLike) {</span>
  <span class="s4">var </span><span class="s2">it =</span>
    <span class="s2">(</span><span class="s3">&quot;undefined&quot; </span><span class="s2">!== </span><span class="s4">typeof </span><span class="s2">Symbol &amp;&amp; o[Symbol.iterator]) || o[</span><span class="s3">&quot;@@iterator&quot;</span><span class="s2">];</span>
  <span class="s4">if </span><span class="s2">(!it) {</span>
    <span class="s4">if </span><span class="s2">(</span>
      <span class="s2">Array.isArray(o) ||</span>
      <span class="s2">(it = _unsupportedIterableToArray(o)) ||</span>
      <span class="s2">(allowArrayLike &amp;&amp; o &amp;&amp; </span><span class="s3">&quot;number&quot; </span><span class="s2">=== </span><span class="s4">typeof </span><span class="s2">o.length)</span>
    <span class="s2">) {</span>
      <span class="s2">it &amp;&amp; (o = it);</span>
      <span class="s4">var </span><span class="s2">i = </span><span class="s5">0</span><span class="s2">;</span>
      <span class="s2">allowArrayLike = </span><span class="s4">function </span><span class="s2">() {};</span>
      <span class="s4">return </span><span class="s2">{</span>
        <span class="s2">s: allowArrayLike,</span>
        <span class="s2">n: </span><span class="s4">function </span><span class="s2">() {</span>
          <span class="s4">return </span><span class="s2">i &gt;= o.length ? { done: !</span><span class="s5">0 </span><span class="s2">} : { done: !</span><span class="s5">1</span><span class="s2">, value: o[i++] };</span>
        <span class="s2">},</span>
        <span class="s2">e: </span><span class="s4">function </span><span class="s2">(e) {</span>
          <span class="s4">throw </span><span class="s2">e;</span>
        <span class="s2">},</span>
        <span class="s2">f: allowArrayLike</span>
      <span class="s2">};</span>
    <span class="s2">}</span>
    <span class="s4">throw new </span><span class="s2">TypeError(</span>
      <span class="s3">&quot;Invalid attempt to iterate non-iterable instance.</span><span class="s7">\n</span><span class="s3">In order to be iterable, non-array objects must have a [Symbol.iterator]() method.&quot;</span>
    <span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s4">var </span><span class="s2">normalCompletion = !</span><span class="s5">0</span><span class="s2">,</span>
    <span class="s2">didErr = !</span><span class="s5">1</span><span class="s2">,</span>
    <span class="s2">err;</span>
  <span class="s4">return </span><span class="s2">{</span>
    <span class="s2">s: </span><span class="s4">function </span><span class="s2">() {</span>
      <span class="s2">it = it.call(o);</span>
    <span class="s2">},</span>
    <span class="s2">n: </span><span class="s4">function </span><span class="s2">() {</span>
      <span class="s4">var </span><span class="s2">step = it.next();</span>
      <span class="s2">normalCompletion = step.done;</span>
      <span class="s4">return </span><span class="s2">step;</span>
    <span class="s2">},</span>
    <span class="s2">e: </span><span class="s4">function </span><span class="s2">(e) {</span>
      <span class="s2">didErr = !</span><span class="s5">0</span><span class="s2">;</span>
      <span class="s2">err = e;</span>
    <span class="s2">},</span>
    <span class="s2">f: </span><span class="s4">function </span><span class="s2">() {</span>
      <span class="s4">try </span><span class="s2">{</span>
        <span class="s2">normalCompletion || </span><span class="s4">null </span><span class="s2">== it.return || it.return();</span>
      <span class="s2">} </span><span class="s4">finally </span><span class="s2">{</span>
        <span class="s4">if </span><span class="s2">(didErr) </span><span class="s4">throw </span><span class="s2">err;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
<span class="s2">}</span>
<span class="s4">const </span><span class="s2">isArrayImpl = Array.isArray;</span>
<span class="s4">class </span><span class="s2">ClientReferenceDependency </span><span class="s4">extends </span><span class="s2">ModuleDependency {</span>
  <span class="s2">constructor(request) {</span>
    <span class="s4">super</span><span class="s2">(request);</span>
  <span class="s2">}</span>
  <span class="s2">get type() {</span>
    <span class="s4">return </span><span class="s3">&quot;client-reference&quot;</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s4">const </span><span class="s2">clientFileName = require.resolve(</span><span class="s3">&quot;../client.browser.js&quot;</span><span class="s2">);</span>
<span class="s4">class </span><span class="s2">ReactFlightWebpackPlugin {</span>
  <span class="s2">constructor(options) {</span>
    <span class="s4">this</span><span class="s2">.serverConsumerManifestFilename =</span>
      <span class="s4">this</span><span class="s2">.clientManifestFilename =</span>
      <span class="s4">this</span><span class="s2">.chunkName =</span>
      <span class="s4">this</span><span class="s2">.clientReferences =</span>
        <span class="s4">void </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s4">if </span><span class="s2">(!options || </span><span class="s3">&quot;boolean&quot; </span><span class="s2">!== </span><span class="s4">typeof </span><span class="s2">options.isServer)</span>
      <span class="s4">throw </span><span class="s2">Error(</span>
        <span class="s3">&quot;React Server Plugin: You must specify the isServer option as a boolean.&quot;</span>
      <span class="s2">);</span>
    <span class="s4">if </span><span class="s2">(options.isServer) </span><span class="s4">throw </span><span class="s2">Error(</span><span class="s3">&quot;TODO: Implement the server compiler.&quot;</span><span class="s2">);</span>
    <span class="s2">options.clientReferences</span>
      <span class="s2">? </span><span class="s3">&quot;string&quot; </span><span class="s2">!== </span><span class="s4">typeof </span><span class="s2">options.clientReferences &amp;&amp;</span>
        <span class="s2">isArrayImpl(options.clientReferences)</span>
        <span class="s2">? (</span><span class="s4">this</span><span class="s2">.clientReferences = options.clientReferences)</span>
        <span class="s2">: (</span><span class="s4">this</span><span class="s2">.clientReferences = [options.clientReferences])</span>
      <span class="s2">: (</span><span class="s4">this</span><span class="s2">.clientReferences = [</span>
          <span class="s2">{ directory: </span><span class="s3">&quot;.&quot;</span><span class="s2">, recursive: !</span><span class="s5">0</span><span class="s2">, include: </span><span class="s6">/\.(js|ts|jsx|tsx)$/ </span><span class="s2">}</span>
        <span class="s2">]);</span>
    <span class="s3">&quot;string&quot; </span><span class="s2">=== </span><span class="s4">typeof </span><span class="s2">options.chunkName</span>
      <span class="s2">? ((</span><span class="s4">this</span><span class="s2">.chunkName = options.chunkName),</span>
        <span class="s6">/\[(index|request)\]/</span><span class="s2">.test(</span><span class="s4">this</span><span class="s2">.chunkName) ||</span>
          <span class="s2">(</span><span class="s4">this</span><span class="s2">.chunkName += </span><span class="s3">&quot;[index]&quot;</span><span class="s2">))</span>
      <span class="s2">: (</span><span class="s4">this</span><span class="s2">.chunkName = </span><span class="s3">&quot;client[index]&quot;</span><span class="s2">);</span>
    <span class="s4">this</span><span class="s2">.clientManifestFilename =</span>
      <span class="s2">options.clientManifestFilename || </span><span class="s3">&quot;react-client-manifest.json&quot;</span><span class="s2">;</span>
    <span class="s4">this</span><span class="s2">.serverConsumerManifestFilename =</span>
      <span class="s2">options.serverConsumerManifestFilename || </span><span class="s3">&quot;react-ssr-manifest.json&quot;</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s2">apply(compiler) {</span>
    <span class="s4">const </span><span class="s2">_this = </span><span class="s4">this</span><span class="s2">;</span>
    <span class="s4">let </span><span class="s2">resolvedClientReferences,</span>
      <span class="s2">clientFileNameFound = !</span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">compiler.hooks.beforeCompile.tapAsync(</span>
      <span class="s3">&quot;React Server Plugin&quot;</span><span class="s2">,</span>
      <span class="s2">(_ref, callback) =&gt; {</span>
        <span class="s2">_ref = _ref.contextModuleFactory;</span>
        <span class="s4">const </span><span class="s2">contextResolver = compiler.resolverFactory.get(</span><span class="s3">&quot;context&quot;</span><span class="s2">, {}),</span>
          <span class="s2">normalResolver = compiler.resolverFactory.get(</span><span class="s3">&quot;normal&quot;</span><span class="s2">);</span>
        <span class="s2">_this.resolveAllClientFiles(</span>
          <span class="s2">compiler.context,</span>
          <span class="s2">contextResolver,</span>
          <span class="s2">normalResolver,</span>
          <span class="s2">compiler.inputFileSystem,</span>
          <span class="s2">_ref,</span>
          <span class="s4">function </span><span class="s2">(err, resolvedClientRefs) {</span>
            <span class="s2">err</span>
              <span class="s2">? callback(err)</span>
              <span class="s2">: ((resolvedClientReferences = resolvedClientRefs), callback());</span>
          <span class="s2">}</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
    <span class="s2">compiler.hooks.thisCompilation.tap(</span>
      <span class="s3">&quot;React Server Plugin&quot;</span><span class="s2">,</span>
      <span class="s2">(compilation, _ref2) =&gt; {</span>
        <span class="s2">_ref2 = _ref2.normalModuleFactory;</span>
        <span class="s2">compilation.dependencyFactories.set(ClientReferenceDependency, _ref2);</span>
        <span class="s2">compilation.dependencyTemplates.set(</span>
          <span class="s2">ClientReferenceDependency,</span>
          <span class="s4">new </span><span class="s2">NullDependency.Template()</span>
        <span class="s2">);</span>
        <span class="s2">compilation = (parser) =&gt; {</span>
          <span class="s2">parser.hooks.program.tap(</span><span class="s3">&quot;React Server Plugin&quot;</span><span class="s2">, () =&gt; {</span>
            <span class="s4">const </span><span class="s2">module = parser.state.module;</span>
            <span class="s4">if </span><span class="s2">(</span>
              <span class="s2">module.resource === clientFileName &amp;&amp;</span>
              <span class="s2">((clientFileNameFound = !</span><span class="s5">0</span><span class="s2">), resolvedClientReferences)</span>
            <span class="s2">)</span>
              <span class="s4">for </span><span class="s2">(</span><span class="s4">let </span><span class="s2">i = </span><span class="s5">0</span><span class="s2">; i &lt; resolvedClientReferences.length; i++) {</span>
                <span class="s4">const </span><span class="s2">dep = resolvedClientReferences[i];</span>
                <span class="s4">var </span><span class="s2">chunkName = _this.chunkName</span>
                  <span class="s2">.replace(</span><span class="s6">/\[index\]/g</span><span class="s2">, </span><span class="s3">&quot;&quot; </span><span class="s2">+ i)</span>
                  <span class="s2">.replace(</span><span class="s6">/\[request\]/g</span><span class="s2">, Template.toPath(dep.userRequest));</span>
                <span class="s2">chunkName = </span><span class="s4">new </span><span class="s2">webpack.AsyncDependenciesBlock(</span>
                  <span class="s2">{ name: chunkName },</span>
                  <span class="s4">null</span><span class="s2">,</span>
                  <span class="s2">dep.request</span>
                <span class="s2">);</span>
                <span class="s2">chunkName.addDependency(dep);</span>
                <span class="s2">module.addBlock(chunkName);</span>
              <span class="s2">}</span>
          <span class="s2">});</span>
        <span class="s2">};</span>
        <span class="s2">_ref2.hooks.parser</span>
          <span class="s2">.for(</span><span class="s3">&quot;javascript/auto&quot;</span><span class="s2">)</span>
          <span class="s2">.tap(</span><span class="s3">&quot;HarmonyModulesPlugin&quot;</span><span class="s2">, compilation);</span>
        <span class="s2">_ref2.hooks.parser</span>
          <span class="s2">.for(</span><span class="s3">&quot;javascript/esm&quot;</span><span class="s2">)</span>
          <span class="s2">.tap(</span><span class="s3">&quot;HarmonyModulesPlugin&quot;</span><span class="s2">, compilation);</span>
        <span class="s2">_ref2.hooks.parser</span>
          <span class="s2">.for(</span><span class="s3">&quot;javascript/dynamic&quot;</span><span class="s2">)</span>
          <span class="s2">.tap(</span><span class="s3">&quot;HarmonyModulesPlugin&quot;</span><span class="s2">, compilation);</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
    <span class="s2">compiler.hooks.make.tap(</span><span class="s3">&quot;React Server Plugin&quot;</span><span class="s2">, (compilation) =&gt; {</span>
      <span class="s2">compilation.hooks.processAssets.tap(</span>
        <span class="s2">{</span>
          <span class="s2">name: </span><span class="s3">&quot;React Server Plugin&quot;</span><span class="s2">,</span>
          <span class="s2">stage: webpack.Compilation.PROCESS_ASSETS_STAGE_REPORT</span>
        <span class="s2">},</span>
        <span class="s4">function </span><span class="s2">() {</span>
          <span class="s4">if </span><span class="s2">(!</span><span class="s5">1 </span><span class="s2">=== clientFileNameFound)</span>
            <span class="s2">compilation.warnings.push(</span>
              <span class="s4">new </span><span class="s2">webpack.WebpackError(</span>
                <span class="s3">&quot;Client runtime at react-server-dom-webpack/client was not found. React Server Components module map file &quot; </span><span class="s2">+</span>
                  <span class="s2">_this.clientManifestFilename +</span>
                  <span class="s3">&quot; was not created.&quot;</span>
              <span class="s2">)</span>
            <span class="s2">);</span>
          <span class="s4">else </span><span class="s2">{</span>
            <span class="s4">var </span><span class="s2">configuredCrossOriginLoading =</span>
              <span class="s2">compilation.outputOptions.crossOriginLoading;</span>
            <span class="s2">configuredCrossOriginLoading =</span>
              <span class="s3">&quot;string&quot; </span><span class="s2">=== </span><span class="s4">typeof </span><span class="s2">configuredCrossOriginLoading</span>
                <span class="s2">? </span><span class="s3">&quot;use-credentials&quot; </span><span class="s2">=== configuredCrossOriginLoading</span>
                  <span class="s2">? configuredCrossOriginLoading</span>
                  <span class="s2">: </span><span class="s3">&quot;anonymous&quot;</span>
                <span class="s2">: </span><span class="s4">null</span><span class="s2">;</span>
            <span class="s4">var </span><span class="s2">resolvedClientFiles = </span><span class="s4">new </span><span class="s2">Set(</span>
                <span class="s2">(resolvedClientReferences || []).map((ref) =&gt; ref.request)</span>
              <span class="s2">),</span>
              <span class="s2">clientManifest = {},</span>
              <span class="s2">moduleMap = {};</span>
            <span class="s2">configuredCrossOriginLoading = {</span>
              <span class="s2">moduleLoading: {</span>
                <span class="s2">prefix: compilation.outputOptions.publicPath || </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
                <span class="s2">crossOrigin: configuredCrossOriginLoading</span>
              <span class="s2">},</span>
              <span class="s2">moduleMap</span>
            <span class="s2">};</span>
            <span class="s4">var </span><span class="s2">runtimeChunkFiles = </span><span class="s4">new </span><span class="s2">Set();</span>
            <span class="s2">compilation.entrypoints.forEach((entrypoint) =&gt; {</span>
              <span class="s2">(entrypoint = entrypoint.getRuntimeChunk()) &amp;&amp;</span>
                <span class="s2">entrypoint.files.forEach((runtimeFile) =&gt; {</span>
                  <span class="s2">runtimeChunkFiles.add(runtimeFile);</span>
                <span class="s2">});</span>
            <span class="s2">});</span>
            <span class="s2">compilation.chunkGroups.forEach(</span><span class="s4">function </span><span class="s2">(chunkGroup) {</span>
              <span class="s4">function </span><span class="s2">recordModule(id, module) {</span>
                <span class="s4">if </span><span class="s2">(</span>
                  <span class="s2">resolvedClientFiles.has(module.resource) &amp;&amp;</span>
                  <span class="s2">((module = url.pathToFileURL(module.resource).href),</span>
                  <span class="s4">void </span><span class="s5">0 </span><span class="s2">!== module)</span>
                <span class="s2">) {</span>
                  <span class="s4">const </span><span class="s2">ssrExports = {};</span>
                  <span class="s2">clientManifest[module] = { id, chunks, name: </span><span class="s3">&quot;*&quot; </span><span class="s2">};</span>
                  <span class="s2">ssrExports[</span><span class="s3">&quot;*&quot;</span><span class="s2">] = { specifier: module, name: </span><span class="s3">&quot;*&quot; </span><span class="s2">};</span>
                  <span class="s2">moduleMap[id] = ssrExports;</span>
                <span class="s2">}</span>
              <span class="s2">}</span>
              <span class="s4">const </span><span class="s2">chunks = [];</span>
              <span class="s2">chunkGroup.chunks.forEach(</span><span class="s4">function </span><span class="s2">(c) {</span>
                <span class="s4">var </span><span class="s2">_iterator = _createForOfIteratorHelper(c.files),</span>
                  <span class="s2">_step;</span>
                <span class="s4">try </span><span class="s2">{</span>
                  <span class="s4">for </span><span class="s2">(_iterator.s(); !(_step = _iterator.n()).done; ) {</span>
                    <span class="s4">const </span><span class="s2">file = _step.value;</span>
                    <span class="s4">if </span><span class="s2">(!file.endsWith(</span><span class="s3">&quot;.js&quot;</span><span class="s2">) &amp;&amp; !file.endsWith(</span><span class="s3">&quot;.mjs&quot;</span><span class="s2">)) </span><span class="s4">break</span><span class="s2">;</span>
                    <span class="s4">if </span><span class="s2">(</span>
                      <span class="s2">file.endsWith(</span><span class="s3">&quot;.hot-update.js&quot;</span><span class="s2">) ||</span>
                      <span class="s2">file.endsWith(</span><span class="s3">&quot;.hot-update.mjs&quot;</span><span class="s2">)</span>
                    <span class="s2">)</span>
                      <span class="s4">break</span><span class="s2">;</span>
                    <span class="s2">chunks.push(c.id, file);</span>
                    <span class="s4">break</span><span class="s2">;</span>
                  <span class="s2">}</span>
                <span class="s2">} </span><span class="s4">catch </span><span class="s2">(err) {</span>
                  <span class="s2">_iterator.e(err);</span>
                <span class="s2">} </span><span class="s4">finally </span><span class="s2">{</span>
                  <span class="s2">_iterator.f();</span>
                <span class="s2">}</span>
              <span class="s2">});</span>
              <span class="s2">chunkGroup.chunks.forEach(</span><span class="s4">function </span><span class="s2">(chunk) {</span>
                <span class="s2">chunk = compilation.chunkGraph.getChunkModulesIterable(chunk);</span>
                <span class="s2">Array.from(chunk).forEach(</span><span class="s4">function </span><span class="s2">(module) {</span>
                  <span class="s4">const </span><span class="s2">moduleId = compilation.chunkGraph.getModuleId(module);</span>
                  <span class="s2">recordModule(moduleId, module);</span>
                  <span class="s2">module.modules &amp;&amp;</span>
                    <span class="s2">module.modules.forEach((concatenatedMod) =&gt; {</span>
                      <span class="s2">recordModule(moduleId, concatenatedMod);</span>
                    <span class="s2">});</span>
                <span class="s2">});</span>
              <span class="s2">});</span>
            <span class="s2">});</span>
            <span class="s4">var </span><span class="s2">clientOutput = JSON.stringify(clientManifest, </span><span class="s4">null</span><span class="s2">, </span><span class="s5">2</span><span class="s2">);</span>
            <span class="s2">compilation.emitAsset(</span>
              <span class="s2">_this.clientManifestFilename,</span>
              <span class="s4">new </span><span class="s2">webpack.sources.RawSource(clientOutput, !</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s2">);</span>
            <span class="s2">configuredCrossOriginLoading = JSON.stringify(</span>
              <span class="s2">configuredCrossOriginLoading,</span>
              <span class="s4">null</span><span class="s2">,</span>
              <span class="s5">2</span>
            <span class="s2">);</span>
            <span class="s2">compilation.emitAsset(</span>
              <span class="s2">_this.serverConsumerManifestFilename,</span>
              <span class="s4">new </span><span class="s2">webpack.sources.RawSource(configuredCrossOriginLoading, !</span><span class="s5">1</span><span class="s2">)</span>
            <span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">}</span>
  <span class="s2">resolveAllClientFiles(</span>
    <span class="s2">context,</span>
    <span class="s2">contextResolver,</span>
    <span class="s2">normalResolver,</span>
    <span class="s2">fs,</span>
    <span class="s2">contextModuleFactory,</span>
    <span class="s2">callback</span>
  <span class="s2">) {</span>
    <span class="s4">function </span><span class="s2">hasUseClientDirective(source) {</span>
      <span class="s4">if </span><span class="s2">(-</span><span class="s5">1 </span><span class="s2">=== source.indexOf(</span><span class="s3">&quot;use client&quot;</span><span class="s2">)) </span><span class="s4">return </span><span class="s2">!</span><span class="s5">1</span><span class="s2">;</span>
      <span class="s4">let </span><span class="s2">body;</span>
      <span class="s4">try </span><span class="s2">{</span>
        <span class="s2">body = acorn.parse(source, {</span>
          <span class="s2">ecmaVersion: </span><span class="s3">&quot;2024&quot;</span><span class="s2">,</span>
          <span class="s2">sourceType: </span><span class="s3">&quot;module&quot;</span>
        <span class="s2">}).body;</span>
      <span class="s2">} </span><span class="s4">catch </span><span class="s2">(x) {</span>
        <span class="s4">return </span><span class="s2">!</span><span class="s5">1</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s4">for </span><span class="s2">(source = </span><span class="s5">0</span><span class="s2">; source &lt; body.length; source++) {</span>
        <span class="s4">const </span><span class="s2">node = body[source];</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;ExpressionStatement&quot; </span><span class="s2">!== node.type || !node.directive) </span><span class="s4">break</span><span class="s2">;</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;use client&quot; </span><span class="s2">=== node.directive) </span><span class="s4">return </span><span class="s2">!</span><span class="s5">0</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s4">return </span><span class="s2">!</span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s2">asyncLib.map(</span>
      <span class="s4">this</span><span class="s2">.clientReferences,</span>
      <span class="s2">(clientReferencePath, cb) =&gt; {</span>
        <span class="s3">&quot;string&quot; </span><span class="s2">=== </span><span class="s4">typeof </span><span class="s2">clientReferencePath</span>
          <span class="s2">? cb(</span><span class="s4">null</span><span class="s2">, [</span><span class="s4">new </span><span class="s2">ClientReferenceDependency(clientReferencePath)])</span>
          <span class="s2">: contextResolver.resolve(</span>
              <span class="s2">{},</span>
              <span class="s2">context,</span>
              <span class="s2">clientReferencePath.directory,</span>
              <span class="s2">{},</span>
              <span class="s2">(err, resolvedDirectory) =&gt; {</span>
                <span class="s4">if </span><span class="s2">(err) </span><span class="s4">return </span><span class="s2">cb(err);</span>
                <span class="s2">contextModuleFactory.resolveDependencies(</span>
                  <span class="s2">fs,</span>
                  <span class="s2">{</span>
                    <span class="s2">resource: resolvedDirectory,</span>
                    <span class="s2">resourceQuery: </span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
                    <span class="s2">recursive:</span>
                      <span class="s4">void </span><span class="s5">0 </span><span class="s2">=== clientReferencePath.recursive</span>
                        <span class="s2">? !</span><span class="s5">0</span>
                        <span class="s2">: clientReferencePath.recursive,</span>
                    <span class="s2">regExp: clientReferencePath.include,</span>
                    <span class="s2">include: </span><span class="s4">void </span><span class="s5">0</span><span class="s2">,</span>
                    <span class="s2">exclude: clientReferencePath.exclude</span>
                  <span class="s2">},</span>
                  <span class="s2">(err2, deps) =&gt; {</span>
                    <span class="s4">if </span><span class="s2">(err2) </span><span class="s4">return </span><span class="s2">cb(err2);</span>
                    <span class="s2">err2 = deps.map((dep) =&gt; {</span>
                      <span class="s4">var </span><span class="s2">request = path.join(</span>
                        <span class="s2">resolvedDirectory,</span>
                        <span class="s2">dep.userRequest</span>
                      <span class="s2">);</span>
                      <span class="s2">request = </span><span class="s4">new </span><span class="s2">ClientReferenceDependency(request);</span>
                      <span class="s2">request.userRequest = dep.userRequest;</span>
                      <span class="s4">return </span><span class="s2">request;</span>
                    <span class="s2">});</span>
                    <span class="s2">asyncLib.filter(</span>
                      <span class="s2">err2,</span>
                      <span class="s2">(clientRefDep, filterCb) =&gt; {</span>
                        <span class="s2">normalResolver.resolve(</span>
                          <span class="s2">{},</span>
                          <span class="s2">context,</span>
                          <span class="s2">clientRefDep.request,</span>
                          <span class="s2">{},</span>
                          <span class="s2">(err3, resolvedPath) =&gt; {</span>
                            <span class="s4">if </span><span class="s2">(err3 || </span><span class="s3">&quot;string&quot; </span><span class="s2">!== </span><span class="s4">typeof </span><span class="s2">resolvedPath)</span>
                              <span class="s4">return </span><span class="s2">filterCb(</span><span class="s4">null</span><span class="s2">, !</span><span class="s5">1</span><span class="s2">);</span>
                            <span class="s2">fs.readFile(</span>
                              <span class="s2">resolvedPath,</span>
                              <span class="s3">&quot;utf-8&quot;</span><span class="s2">,</span>
                              <span class="s2">(err4, content) =&gt; {</span>
                                <span class="s4">if </span><span class="s2">(err4 || </span><span class="s3">&quot;string&quot; </span><span class="s2">!== </span><span class="s4">typeof </span><span class="s2">content)</span>
                                  <span class="s4">return </span><span class="s2">filterCb(</span><span class="s4">null</span><span class="s2">, !</span><span class="s5">1</span><span class="s2">);</span>
                                <span class="s2">err4 = hasUseClientDirective(content);</span>
                                <span class="s2">filterCb(</span><span class="s4">null</span><span class="s2">, err4);</span>
                              <span class="s2">}</span>
                            <span class="s2">);</span>
                          <span class="s2">}</span>
                        <span class="s2">);</span>
                      <span class="s2">},</span>
                      <span class="s2">cb</span>
                    <span class="s2">);</span>
                  <span class="s2">}</span>
                <span class="s2">);</span>
              <span class="s2">}</span>
            <span class="s2">);</span>
      <span class="s2">},</span>
      <span class="s2">(err, result) =&gt; {</span>
        <span class="s4">if </span><span class="s2">(err) </span><span class="s4">return </span><span class="s2">callback(err);</span>
        <span class="s2">err = [];</span>
        <span class="s4">for </span><span class="s2">(</span><span class="s4">let </span><span class="s2">i = </span><span class="s5">0</span><span class="s2">; i &lt; result.length; i++) err.push.apply(err, result[i]);</span>
        <span class="s2">callback(</span><span class="s4">null</span><span class="s2">, err);</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span>
<span class="s2">module.exports = ReactFlightWebpackPlugin;</span>
</pre>
</body>
</html>