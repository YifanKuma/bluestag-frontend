<html>
<head>
<title>restart-dev-server-middleware.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
restart-dev-server-middleware.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/next-devtools/server/restart-dev-server-middleware.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { ServerResponse, IncomingMessage } from 'http'</span><span class="s3">\n</span><span class="s1">import type { Telemetry } from '../../telemetry/storage'</span><span class="s3">\n</span><span class="s1">import { RESTART_EXIT_CODE } from '../../server/lib/utils'</span><span class="s3">\n</span><span class="s1">import { middlewareResponse } from './middleware-response'</span><span class="s3">\n</span><span class="s1">import type { Project } from '../../build/swc/types'</span><span class="s3">\n</span><span class="s1">import { invalidatePersistentCache as invalidateWebpackPersistentCache } from '../../build/webpack/cache-invalidation'</span><span class="s3">\n\n</span><span class="s1">const EVENT_DEV_OVERLAY_RESTART_SERVER = 'DEV_OVERLAY_RESTART_SERVER'</span><span class="s3">\n\n</span><span class="s1">interface RestartDevServerMiddlewareConfig {</span><span class="s3">\n  </span><span class="s1">telemetry: Telemetry</span><span class="s3">\n  </span><span class="s1">turbopackProject?: Project</span><span class="s3">\n  </span><span class="s1">webpackCacheDirectories?: Set&lt;string&gt;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function getRestartDevServerMiddleware({</span><span class="s3">\n  </span><span class="s1">telemetry,</span><span class="s3">\n  </span><span class="s1">turbopackProject,</span><span class="s3">\n  </span><span class="s1">webpackCacheDirectories,</span><span class="s3">\n</span><span class="s1">}: RestartDevServerMiddlewareConfig) {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Some random value between 1 and Number.MAX_SAFE_INTEGER (inclusive). The same value is returned</span><span class="s3">\n   </span><span class="s1">* on every call to `__nextjs_server_status` until the server is restarted.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* Can be used to determine if two server status responses are from the same process or a</span><span class="s3">\n   </span><span class="s1">* different (restarted) process.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">const executionId: number =</span><span class="s3">\n    </span><span class="s1">Math.floor(Math.random() * Number.MAX_SAFE_INTEGER) + 1</span><span class="s3">\n\n  </span><span class="s1">async function handleRestartRequest(</span><span class="s3">\n    </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: ServerResponse,</span><span class="s3">\n    </span><span class="s1">searchParams: URLSearchParams</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">if (req.method !== 'POST') {</span><span class="s3">\n      </span><span class="s1">return middlewareResponse.methodNotAllowed(res)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const shouldInvalidatePersistentCache = searchParams.has(</span><span class="s3">\n      </span><span class="s1">'invalidatePersistentCache'</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">if (shouldInvalidatePersistentCache) {</span><span class="s3">\n      </span><span class="s1">if (webpackCacheDirectories != null) {</span><span class="s3">\n        </span><span class="s1">await Promise.all(</span><span class="s3">\n          </span><span class="s1">Array.from(webpackCacheDirectories).map(</span><span class="s3">\n            </span><span class="s1">invalidateWebpackPersistentCache</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">if (turbopackProject != null) {</span><span class="s3">\n        </span><span class="s1">await turbopackProject.invalidatePersistentCache()</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">telemetry.record({</span><span class="s3">\n      </span><span class="s1">eventName: EVENT_DEV_OVERLAY_RESTART_SERVER,</span><span class="s3">\n      </span><span class="s1">payload: { invalidatePersistentCache: shouldInvalidatePersistentCache },</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">// TODO: Use flushDetached</span><span class="s3">\n    </span><span class="s1">await telemetry.flush()</span><span class="s3">\n\n    </span><span class="s1">// do this async to try to give the response a chance to send</span><span class="s3">\n    </span><span class="s1">// it's not really important if it doesn't though</span><span class="s3">\n    </span><span class="s1">setTimeout(() =&gt; {</span><span class="s3">\n      </span><span class="s1">process.exit(RESTART_EXIT_CODE)</span><span class="s3">\n    </span><span class="s1">}, 0)</span><span class="s3">\n\n    </span><span class="s1">return middlewareResponse.noContent(res)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">async function handleServerStatus(req: IncomingMessage, res: ServerResponse) {</span><span class="s3">\n    </span><span class="s1">if (req.method !== 'GET') {</span><span class="s3">\n      </span><span class="s1">return middlewareResponse.methodNotAllowed(res)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return middlewareResponse.json(res, {</span><span class="s3">\n      </span><span class="s1">executionId,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return async function (</span><span class="s3">\n    </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: ServerResponse,</span><span class="s3">\n    </span><span class="s1">next: () =&gt; void</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">const { pathname, searchParams } = new URL(`http://n${req.url}`)</span><span class="s3">\n\n    </span><span class="s1">switch (pathname) {</span><span class="s3">\n      </span><span class="s1">case '/__nextjs_restart_dev':</span><span class="s3">\n        </span><span class="s1">return await handleRestartRequest(req, res, searchParams)</span><span class="s3">\n      </span><span class="s1">case '/__nextjs_server_status':</span><span class="s3">\n        </span><span class="s1">return await handleServerStatus(req, res)</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">return next()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;getRestartDevServerMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;EVENT_DEV_OVERLAY_RESTART_SERVER&quot;</span><span class="s0">,</span><span class="s1">&quot;telemetry&quot;</span><span class="s0">,</span><span class="s1">&quot;turbopackProject&quot;</span><span class="s0">,</span><span class="s1">&quot;webpackCacheDirectories&quot;</span><span class="s0">,</span><span class="s1">&quot;executionId&quot;</span><span class="s0">,</span><span class="s1">&quot;Math&quot;</span><span class="s0">,</span><span class="s1">&quot;floor&quot;</span><span class="s0">,</span><span class="s1">&quot;random&quot;</span><span class="s0">,</span><span class="s1">&quot;Number&quot;</span><span class="s0">,</span><span class="s1">&quot;MAX_SAFE_INTEGER&quot;</span><span class="s0">,</span><span class="s1">&quot;handleRestartRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;searchParams&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;middlewareResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;methodNotAllowed&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldInvalidatePersistentCache&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;invalidateWebpackPersistentCache&quot;</span><span class="s0">,</span><span class="s1">&quot;invalidatePersistentCache&quot;</span><span class="s0">,</span><span class="s1">&quot;record&quot;</span><span class="s0">,</span><span class="s1">&quot;eventName&quot;</span><span class="s0">,</span><span class="s1">&quot;payload&quot;</span><span class="s0">,</span><span class="s1">&quot;flush&quot;</span><span class="s0">,</span><span class="s1">&quot;setTimeout&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;exit&quot;</span><span class="s0">,</span><span class="s1">&quot;RESTART_EXIT_CODE&quot;</span><span class="s0">,</span><span class="s1">&quot;noContent&quot;</span><span class="s0">,</span><span class="s1">&quot;handleServerStatus&quot;</span><span class="s0">,</span><span class="s1">&quot;json&quot;</span><span class="s0">,</span><span class="s1">&quot;next&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;URL&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAegBA;;;eAAAA;;;uBAbkB;oCACC;mCAE2C;AAE9E,MAAMC,mCAAmC;AAQlC,SAASD,8BAA8B,KAIX;IAJW,IAAA,EAC5CE,SAAS,EACTC,gBAAgB,EAChBC,uBAAuB,EACU,GAJW;IAK5C;;;;;;GAMC,GACD,MAAMC,cACJC,KAAKC,KAAK,CAACD,KAAKE,MAAM,KAAKC,OAAOC,gBAAgB,IAAI;IAExD,eAAeC,qBACbC,GAAoB,EACpBC,GAAmB,EACnBC,YAA6B;QAE7B,IAAIF,IAAIG,MAAM,KAAK,QAAQ;YACzB,OAAOC,sCAAkB,CAACC,gBAAgB,CAACJ;QAC7C;QAEA,MAAMK,kCAAkCJ,aAAaK,GAAG,CACtD;QAEF,IAAID,iCAAiC;YACnC,IAAId,2BAA2B,MAAM;gBACnC,MAAMgB,QAAQC,GAAG,CACfC,MAAMC,IAAI,CAACnB,yBAAyBoB,GAAG,CACrCC,4CAAgC;YAGtC;YACA,IAAItB,oBAAoB,MAAM;gBAC5B,MAAMA,iBAAiBuB,yBAAyB;YAClD;QACF;QAEAxB,UAAUyB,MAAM,CAAC;YACfC,WAAW3B;YACX4B,SAAS;gBAAEH,2BAA2BR;YAAgC;QACxE;QAEA,0BAA0B;QAC1B,MAAMhB,UAAU4B,KAAK;QAErB,6DAA6D;QAC7D,iDAAiD;QACjDC,WAAW;YACTC,QAAQC,IAAI,CAACC,wBAAiB;QAChC,GAAG;QAEH,OAAOlB,sCAAkB,CAACmB,SAAS,CAACtB;IACtC;IAEA,eAAeuB,mBAAmBxB,GAAoB,EAAEC,GAAmB;QACzE,IAAID,IAAIG,MAAM,KAAK,OAAO;YACxB,OAAOC,sCAAkB,CAACC,gBAAgB,CAACJ;QAC7C;QAEA,OAAOG,sCAAkB,CAACqB,IAAI,CAACxB,KAAK;YAClCR;QACF;IACF;IAEA,OAAO,eACLO,GAAoB,EACpBC,GAAmB,EACnByB,IAAgB;QAEhB,MAAM,EAAEC,QAAQ,EAAEzB,YAAY,EAAE,GAAG,IAAI0B,IAAI,AAAC,aAAU5B,IAAI6B,GAAG;QAE7D,OAAQF;YACN,KAAK;gBACH,OAAO,MAAM5B,qBAAqBC,KAAKC,KAAKC;YAC9C,KAAK;gBACH,OAAO,MAAMsB,mBAAmBxB,KAAKC;YACvC;gBACE,OAAOyB;QACX;IACF;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>