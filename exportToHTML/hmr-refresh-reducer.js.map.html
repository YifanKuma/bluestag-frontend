<html>
<head>
<title>hmr-refresh-reducer.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
hmr-refresh-reducer.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../../src/client/components/router-reducer/reducers/hmr-refresh-reducer.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { fetchServerResponse } from '../fetch-server-response'</span><span class="s3">\n</span><span class="s1">import { createHrefFromUrl } from '../create-href-from-url'</span><span class="s3">\n</span><span class="s1">import { applyRouterStatePatchToTree } from '../apply-router-state-patch-to-tree'</span><span class="s3">\n</span><span class="s1">import { isNavigatingToNewRootLayout } from '../is-navigating-to-new-root-layout'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">ReducerState,</span><span class="s3">\n  </span><span class="s1">HmrRefreshAction,</span><span class="s3">\n  </span><span class="s1">Mutable,</span><span class="s3">\n</span><span class="s1">} from '../router-reducer-types'</span><span class="s3">\n</span><span class="s1">import { handleExternalUrl } from './navigate-reducer'</span><span class="s3">\n</span><span class="s1">import { handleMutable } from '../handle-mutable'</span><span class="s3">\n</span><span class="s1">import { applyFlightData } from '../apply-flight-data'</span><span class="s3">\n</span><span class="s1">import type { CacheNode } from '../../../../shared/lib/app-router-context.shared-runtime'</span><span class="s3">\n</span><span class="s1">import { createEmptyCacheNode } from '../../app-router'</span><span class="s3">\n</span><span class="s1">import { handleSegmentMismatch } from '../handle-segment-mismatch'</span><span class="s3">\n</span><span class="s1">import { hasInterceptionRouteInCurrentTree } from './has-interception-route-in-current-tree'</span><span class="s3">\n\n</span><span class="s1">// A version of refresh reducer that keeps the cache around instead of wiping all of it.</span><span class="s3">\n</span><span class="s1">function hmrRefreshReducerImpl(</span><span class="s3">\n  </span><span class="s1">state: ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">action: HmrRefreshAction</span><span class="s3">\n</span><span class="s1">): ReducerState {</span><span class="s3">\n  </span><span class="s1">const { origin } = action</span><span class="s3">\n  </span><span class="s1">const mutable: Mutable = {}</span><span class="s3">\n  </span><span class="s1">const href = state.canonicalUrl</span><span class="s3">\n\n  </span><span class="s1">mutable.preserveCustomHistoryState = false</span><span class="s3">\n\n  </span><span class="s1">const cache: CacheNode = createEmptyCacheNode()</span><span class="s3">\n  </span><span class="s1">// If the current tree was intercepted, the nextUrl should be included in the request.</span><span class="s3">\n  </span><span class="s1">// This is to ensure that the refresh request doesn't get intercepted, accidentally triggering the interception route.</span><span class="s3">\n  </span><span class="s1">const includeNextUrl = hasInterceptionRouteInCurrentTree(state.tree)</span><span class="s3">\n\n  </span><span class="s1">// TODO-APP: verify that `href` is not an external url.</span><span class="s3">\n  </span><span class="s1">// Fetch data from the root of the tree.</span><span class="s3">\n  </span><span class="s1">const navigatedAt = Date.now()</span><span class="s3">\n  </span><span class="s1">cache.lazyData = fetchServerResponse(new URL(href, origin), {</span><span class="s3">\n    </span><span class="s1">flightRouterState: [state.tree[0], state.tree[1], state.tree[2], 'refetch'],</span><span class="s3">\n    </span><span class="s1">nextUrl: includeNextUrl ? state.nextUrl : null,</span><span class="s3">\n    </span><span class="s1">isHmrRefresh: true,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">return cache.lazyData.then(</span><span class="s3">\n    </span><span class="s1">({ flightData, canonicalUrl: canonicalUrlOverride }) =&gt; {</span><span class="s3">\n      </span><span class="s1">// Handle case when navigating to page in `pages` from `app`</span><span class="s3">\n      </span><span class="s1">if (typeof flightData === 'string') {</span><span class="s3">\n        </span><span class="s1">return handleExternalUrl(</span><span class="s3">\n          </span><span class="s1">state,</span><span class="s3">\n          </span><span class="s1">mutable,</span><span class="s3">\n          </span><span class="s1">flightData,</span><span class="s3">\n          </span><span class="s1">state.pushRef.pendingPush</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Remove cache.lazyData as it has been resolved at this point.</span><span class="s3">\n      </span><span class="s1">cache.lazyData = null</span><span class="s3">\n\n      </span><span class="s1">let currentTree = state.tree</span><span class="s3">\n      </span><span class="s1">let currentCache = state.cache</span><span class="s3">\n\n      </span><span class="s1">for (const normalizedFlightData of flightData) {</span><span class="s3">\n        </span><span class="s1">const { tree: treePatch, isRootRender } = normalizedFlightData</span><span class="s3">\n        </span><span class="s1">if (!isRootRender) {</span><span class="s3">\n          </span><span class="s1">// TODO-APP: handle this case better</span><span class="s3">\n          </span><span class="s1">console.log('REFRESH FAILED')</span><span class="s3">\n          </span><span class="s1">return state</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const newTree = applyRouterStatePatchToTree(</span><span class="s3">\n          </span><span class="s1">// TODO-APP: remove ''</span><span class="s3">\n          </span><span class="s1">[''],</span><span class="s3">\n          </span><span class="s1">currentTree,</span><span class="s3">\n          </span><span class="s1">treePatch,</span><span class="s3">\n          </span><span class="s1">state.canonicalUrl</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">if (newTree === null) {</span><span class="s3">\n          </span><span class="s1">return handleSegmentMismatch(state, action, treePatch)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (isNavigatingToNewRootLayout(currentTree, newTree)) {</span><span class="s3">\n          </span><span class="s1">return handleExternalUrl(</span><span class="s3">\n            </span><span class="s1">state,</span><span class="s3">\n            </span><span class="s1">mutable,</span><span class="s3">\n            </span><span class="s1">href,</span><span class="s3">\n            </span><span class="s1">state.pushRef.pendingPush</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const canonicalUrlOverrideHref = canonicalUrlOverride</span><span class="s3">\n          </span><span class="s1">? createHrefFromUrl(canonicalUrlOverride)</span><span class="s3">\n          </span><span class="s1">: undefined</span><span class="s3">\n\n        </span><span class="s1">if (canonicalUrlOverride) {</span><span class="s3">\n          </span><span class="s1">mutable.canonicalUrl = canonicalUrlOverrideHref</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">const applied = applyFlightData(</span><span class="s3">\n          </span><span class="s1">navigatedAt,</span><span class="s3">\n          </span><span class="s1">currentCache,</span><span class="s3">\n          </span><span class="s1">cache,</span><span class="s3">\n          </span><span class="s1">normalizedFlightData</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">if (applied) {</span><span class="s3">\n          </span><span class="s1">mutable.cache = cache</span><span class="s3">\n          </span><span class="s1">currentCache = cache</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">mutable.patchedTree = newTree</span><span class="s3">\n        </span><span class="s1">mutable.canonicalUrl = href</span><span class="s3">\n\n        </span><span class="s1">currentTree = newTree</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">return handleMutable(state, mutable)</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">() =&gt; state</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function hmrRefreshReducerNoop(</span><span class="s3">\n  </span><span class="s1">state: ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">_action: HmrRefreshAction</span><span class="s3">\n</span><span class="s1">): ReducerState {</span><span class="s3">\n  </span><span class="s1">return state</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export const hmrRefreshReducer =</span><span class="s3">\n  </span><span class="s1">process.env.NODE_ENV === 'production'</span><span class="s3">\n    </span><span class="s1">? hmrRefreshReducerNoop</span><span class="s3">\n    </span><span class="s1">: hmrRefreshReducerImpl</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;hmrRefreshReducer&quot;</span><span class="s0">,</span><span class="s1">&quot;hmrRefreshReducerImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;state&quot;</span><span class="s0">,</span><span class="s1">&quot;action&quot;</span><span class="s0">,</span><span class="s1">&quot;origin&quot;</span><span class="s0">,</span><span class="s1">&quot;mutable&quot;</span><span class="s0">,</span><span class="s1">&quot;href&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;preserveCustomHistoryState&quot;</span><span class="s0">,</span><span class="s1">&quot;cache&quot;</span><span class="s0">,</span><span class="s1">&quot;createEmptyCacheNode&quot;</span><span class="s0">,</span><span class="s1">&quot;includeNextUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;hasInterceptionRouteInCurrentTree&quot;</span><span class="s0">,</span><span class="s1">&quot;tree&quot;</span><span class="s0">,</span><span class="s1">&quot;navigatedAt&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;lazyData&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchServerResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;URL&quot;</span><span class="s0">,</span><span class="s1">&quot;flightRouterState&quot;</span><span class="s0">,</span><span class="s1">&quot;nextUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;isHmrRefresh&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">,</span><span class="s1">&quot;flightData&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrlOverride&quot;</span><span class="s0">,</span><span class="s1">&quot;handleExternalUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pushRef&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingPush&quot;</span><span class="s0">,</span><span class="s1">&quot;currentTree&quot;</span><span class="s0">,</span><span class="s1">&quot;currentCache&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizedFlightData&quot;</span><span class="s0">,</span><span class="s1">&quot;treePatch&quot;</span><span class="s0">,</span><span class="s1">&quot;isRootRender&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;log&quot;</span><span class="s0">,</span><span class="s1">&quot;newTree&quot;</span><span class="s0">,</span><span class="s1">&quot;applyRouterStatePatchToTree&quot;</span><span class="s0">,</span><span class="s1">&quot;handleSegmentMismatch&quot;</span><span class="s0">,</span><span class="s1">&quot;isNavigatingToNewRootLayout&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrlOverrideHref&quot;</span><span class="s0">,</span><span class="s1">&quot;createHrefFromUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;applied&quot;</span><span class="s0">,</span><span class="s1">&quot;applyFlightData&quot;</span><span class="s0">,</span><span class="s1">&quot;patchedTree&quot;</span><span class="s0">,</span><span class="s1">&quot;handleMutable&quot;</span><span class="s0">,</span><span class="s1">&quot;hmrRefreshReducerNoop&quot;</span><span class="s0">,</span><span class="s1">&quot;_action&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ENV&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BA+HaA;;;eAAAA;;;qCA/HuB;mCACF;6CACU;6CACA;iCAOV;+BACJ;iCACE;2BAEK;uCACC;mDACY;AAElD,wFAAwF;AACxF,SAASC,sBACPC,KAA2B,EAC3BC,MAAwB;IAExB,MAAM,EAAEC,MAAM,EAAE,GAAGD;IACnB,MAAME,UAAmB,CAAC;IAC1B,MAAMC,OAAOJ,MAAMK,YAAY;IAE/BF,QAAQG,0BAA0B,GAAG;IAErC,MAAMC,QAAmBC,IAAAA,+BAAoB;IAC7C,sFAAsF;IACtF,sHAAsH;IACtH,MAAMC,iBAAiBC,IAAAA,oEAAiC,EAACV,MAAMW,IAAI;IAEnE,uDAAuD;IACvD,wCAAwC;IACxC,MAAMC,cAAcC,KAAKC,GAAG;IAC5BP,MAAMQ,QAAQ,GAAGC,IAAAA,wCAAmB,EAAC,IAAIC,IAAIb,MAAMF,SAAS;QAC1DgB,mBAAmB;YAAClB,MAAMW,IAAI,CAAC,EAAE;YAAEX,MAAMW,IAAI,CAAC,EAAE;YAAEX,MAAMW,IAAI,CAAC,EAAE;YAAE;SAAU;QAC3EQ,SAASV,iBAAiBT,MAAMmB,OAAO,GAAG;QAC1CC,cAAc;IAChB;IAEA,OAAOb,MAAMQ,QAAQ,CAACM,IAAI,CACxB;YAAC,EAAEC,UAAU,EAAEjB,cAAckB,oBAAoB,EAAE;QACjD,4DAA4D;QAC5D,IAAI,OAAOD,eAAe,UAAU;YAClC,OAAOE,IAAAA,kCAAiB,EACtBxB,OACAG,SACAmB,YACAtB,MAAMyB,OAAO,CAACC,WAAW;QAE7B;QAEA,+DAA+D;QAC/DnB,MAAMQ,QAAQ,GAAG;QAEjB,IAAIY,cAAc3B,MAAMW,IAAI;QAC5B,IAAIiB,eAAe5B,MAAMO,KAAK;QAE9B,KAAK,MAAMsB,wBAAwBP,WAAY;YAC7C,MAAM,EAAEX,MAAMmB,SAAS,EAAEC,YAAY,EAAE,GAAGF;YAC1C,IAAI,CAACE,cAAc;gBACjB,oCAAoC;gBACpCC,QAAQC,GAAG,CAAC;gBACZ,OAAOjC;YACT;YAEA,MAAMkC,UAAUC,IAAAA,wDAA2B,EACzC,sBAAsB;YACtB;gBAAC;aAAG,EACJR,aACAG,WACA9B,MAAMK,YAAY;YAGpB,IAAI6B,YAAY,MAAM;gBACpB,OAAOE,IAAAA,4CAAqB,EAACpC,OAAOC,QAAQ6B;YAC9C;YAEA,IAAIO,IAAAA,wDAA2B,EAACV,aAAaO,UAAU;gBACrD,OAAOV,IAAAA,kCAAiB,EACtBxB,OACAG,SACAC,MACAJ,MAAMyB,OAAO,CAACC,WAAW;YAE7B;YAEA,MAAMY,2BAA2Bf,uBAC7BgB,IAAAA,oCAAiB,EAAChB,wBAClBiB;YAEJ,IAAIjB,sBAAsB;gBACxBpB,QAAQE,YAAY,GAAGiC;YACzB;YACA,MAAMG,UAAUC,IAAAA,gCAAe,EAC7B9B,aACAgB,cACArB,OACAsB;YAGF,IAAIY,SAAS;gBACXtC,QAAQI,KAAK,GAAGA;gBAChBqB,eAAerB;YACjB;YAEAJ,QAAQwC,WAAW,GAAGT;YACtB/B,QAAQE,YAAY,GAAGD;YAEvBuB,cAAcO;QAChB;QACA,OAAOU,IAAAA,4BAAa,EAAC5C,OAAOG;IAC9B,GACA,IAAMH;AAEV;AAEA,SAAS6C,sBACP7C,KAA2B,EAC3B8C,OAAyB;IAEzB,OAAO9C;AACT;AAEO,MAAMF,oBACXiD,QAAQC,GAAG,CAACC,QAAQ,KAAK,eACrBJ,wBACA9C&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>