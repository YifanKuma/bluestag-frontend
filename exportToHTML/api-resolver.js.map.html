<html>
<head>
<title>api-resolver.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
api-resolver.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/server/api-utils/node/api-resolver.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { IncomingMessage, ServerResponse } from 'http'</span><span class="s3">\n</span><span class="s1">import type { NextApiRequest, NextApiResponse } from '../../../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import type { PageConfig, ResponseLimit } from '../../../types'</span><span class="s3">\n</span><span class="s1">import type { __ApiPreviewProps } from '../.'</span><span class="s3">\n</span><span class="s1">import type { CookieSerializeOptions } from 'next/dist/compiled/cookie'</span><span class="s3">\n\n</span><span class="s1">import bytes from 'next/dist/compiled/bytes'</span><span class="s3">\n</span><span class="s1">import { generateETag } from '../../lib/etag'</span><span class="s3">\n</span><span class="s1">import { sendEtagResponse } from '../../send-payload'</span><span class="s3">\n</span><span class="s1">import { Stream } from 'stream'</span><span class="s3">\n</span><span class="s1">import isError from '../../../lib/is-error'</span><span class="s3">\n</span><span class="s1">import { isResSent } from '../../../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import { interopDefault } from '../../../lib/interop-default'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">setLazyProp,</span><span class="s3">\n  </span><span class="s1">sendStatusCode,</span><span class="s3">\n  </span><span class="s1">redirect,</span><span class="s3">\n  </span><span class="s1">clearPreviewData,</span><span class="s3">\n  </span><span class="s1">sendError,</span><span class="s3">\n  </span><span class="s1">ApiError,</span><span class="s3">\n  </span><span class="s1">COOKIE_NAME_PRERENDER_BYPASS,</span><span class="s3">\n  </span><span class="s1">COOKIE_NAME_PRERENDER_DATA,</span><span class="s3">\n  </span><span class="s1">RESPONSE_LIMIT_DEFAULT,</span><span class="s3">\n</span><span class="s1">} from './../index'</span><span class="s3">\n</span><span class="s1">import { getCookieParser } from './../get-cookie-parser'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">JSON_CONTENT_TYPE_HEADER,</span><span class="s3">\n  </span><span class="s1">PRERENDER_REVALIDATE_HEADER,</span><span class="s3">\n  </span><span class="s1">PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER,</span><span class="s3">\n</span><span class="s1">} from '../../../lib/constants'</span><span class="s3">\n</span><span class="s1">import { tryGetPreviewData } from './try-get-preview-data'</span><span class="s3">\n</span><span class="s1">import { parseBody } from './parse-body'</span><span class="s3">\n</span><span class="s1">import type { RevalidateFn } from '../../lib/router-utils/router-server-context'</span><span class="s3">\n</span><span class="s1">import type { InstrumentationOnRequestError } from '../../instrumentation/types'</span><span class="s3">\n\n</span><span class="s1">type ApiContext = __ApiPreviewProps &amp; {</span><span class="s3">\n  </span><span class="s1">trustHostHeader?: boolean</span><span class="s3">\n  </span><span class="s1">allowedRevalidateHeaderKeys?: string[]</span><span class="s3">\n  </span><span class="s1">hostname?: string</span><span class="s3">\n  </span><span class="s1">multiZoneDraftMode?: boolean</span><span class="s3">\n  </span><span class="s1">dev: boolean</span><span class="s3">\n  </span><span class="s1">internalRevalidate?: RevalidateFn</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function getMaxContentLength(responseLimit?: ResponseLimit) {</span><span class="s3">\n  </span><span class="s1">if (responseLimit &amp;&amp; typeof responseLimit !== 'boolean') {</span><span class="s3">\n    </span><span class="s1">return bytes.parse(responseLimit)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return RESPONSE_LIMIT_DEFAULT</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Send `any` body to response</span><span class="s3">\n </span><span class="s1">* @param req request object</span><span class="s3">\n </span><span class="s1">* @param res response object</span><span class="s3">\n </span><span class="s1">* @param body of response</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function sendData(req: NextApiRequest, res: NextApiResponse, body: any): void {</span><span class="s3">\n  </span><span class="s1">if (body === null || body === undefined) {</span><span class="s3">\n    </span><span class="s1">res.end()</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// strip irrelevant headers/body</span><span class="s3">\n  </span><span class="s1">if (res.statusCode === 204 || res.statusCode === 304) {</span><span class="s3">\n    </span><span class="s1">res.removeHeader('Content-Type')</span><span class="s3">\n    </span><span class="s1">res.removeHeader('Content-Length')</span><span class="s3">\n    </span><span class="s1">res.removeHeader('Transfer-Encoding')</span><span class="s3">\n\n    </span><span class="s1">if (process.env.NODE_ENV === 'development' &amp;&amp; body) {</span><span class="s3">\n      </span><span class="s1">console.warn(</span><span class="s3">\n        </span><span class="s1">`A body was attempted to be set with a 204 statusCode for ${req.url}, this is invalid and the body was ignored.</span><span class="s3">\\</span><span class="s1">n` +</span><span class="s3">\n          </span><span class="s1">`See more info here https://nextjs.org/docs/messages/invalid-api-status-body`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">res.end()</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const contentType = res.getHeader('Content-Type')</span><span class="s3">\n\n  </span><span class="s1">if (body instanceof Stream) {</span><span class="s3">\n    </span><span class="s1">if (!contentType) {</span><span class="s3">\n      </span><span class="s1">res.setHeader('Content-Type', 'application/octet-stream')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">body.pipe(res)</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const isJSONLike = ['object', 'number', 'boolean'].includes(typeof body)</span><span class="s3">\n  </span><span class="s1">const stringifiedBody = isJSONLike ? JSON.stringify(body) : body</span><span class="s3">\n  </span><span class="s1">const etag = generateETag(stringifiedBody)</span><span class="s3">\n  </span><span class="s1">if (sendEtagResponse(req, res, etag)) {</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (Buffer.isBuffer(body)) {</span><span class="s3">\n    </span><span class="s1">if (!contentType) {</span><span class="s3">\n      </span><span class="s1">res.setHeader('Content-Type', 'application/octet-stream')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">res.setHeader('Content-Length', body.length)</span><span class="s3">\n    </span><span class="s1">res.end(body)</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (isJSONLike) {</span><span class="s3">\n    </span><span class="s1">res.setHeader('Content-Type', JSON_CONTENT_TYPE_HEADER)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">res.setHeader('Content-Length', Buffer.byteLength(stringifiedBody))</span><span class="s3">\n  </span><span class="s1">res.end(stringifiedBody)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Send `JSON` object</span><span class="s3">\n </span><span class="s1">* @param res response object</span><span class="s3">\n </span><span class="s1">* @param jsonBody of data</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function sendJson(res: NextApiResponse, jsonBody: any): void {</span><span class="s3">\n  </span><span class="s1">// Set header to application/json</span><span class="s3">\n  </span><span class="s1">res.setHeader('Content-Type', JSON_CONTENT_TYPE_HEADER)</span><span class="s3">\n\n  </span><span class="s1">// Use send to handle request</span><span class="s3">\n  </span><span class="s1">res.send(JSON.stringify(jsonBody))</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isValidData(str: any): str is string {</span><span class="s3">\n  </span><span class="s1">return typeof str === 'string' &amp;&amp; str.length &gt;= 16</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function setDraftMode&lt;T&gt;(</span><span class="s3">\n  </span><span class="s1">res: NextApiResponse&lt;T&gt;,</span><span class="s3">\n  </span><span class="s1">options: {</span><span class="s3">\n    </span><span class="s1">enable: boolean</span><span class="s3">\n    </span><span class="s1">previewModeId?: string</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">): NextApiResponse&lt;T&gt; {</span><span class="s3">\n  </span><span class="s1">if (!isValidData(options.previewModeId)) {</span><span class="s3">\n    </span><span class="s1">throw new Error('invariant: invalid previewModeId')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const expires = options.enable ? undefined : new Date(0)</span><span class="s3">\n  </span><span class="s1">// To delete a cookie, set `expires` to a date in the past:</span><span class="s3">\n  </span><span class="s1">// https://tools.ietf.org/html/rfc6265#section-4.1.1</span><span class="s3">\n  </span><span class="s1">// `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.</span><span class="s3">\n  </span><span class="s1">const { serialize } =</span><span class="s3">\n    </span><span class="s1">require('next/dist/compiled/cookie') as typeof import('next/dist/compiled/cookie')</span><span class="s3">\n  </span><span class="s1">const previous = res.getHeader('Set-Cookie')</span><span class="s3">\n  </span><span class="s1">res.setHeader(`Set-Cookie`, [</span><span class="s3">\n    </span><span class="s1">...(typeof previous === 'string'</span><span class="s3">\n      </span><span class="s1">? [previous]</span><span class="s3">\n      </span><span class="s1">: Array.isArray(previous)</span><span class="s3">\n        </span><span class="s1">? previous</span><span class="s3">\n        </span><span class="s1">: []),</span><span class="s3">\n    </span><span class="s1">serialize(COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {</span><span class="s3">\n      </span><span class="s1">httpOnly: true,</span><span class="s3">\n      </span><span class="s1">sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',</span><span class="s3">\n      </span><span class="s1">secure: process.env.NODE_ENV !== 'development',</span><span class="s3">\n      </span><span class="s1">path: '/',</span><span class="s3">\n      </span><span class="s1">expires,</span><span class="s3">\n    </span><span class="s1">}),</span><span class="s3">\n  </span><span class="s1">])</span><span class="s3">\n  </span><span class="s1">return res</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function setPreviewData&lt;T&gt;(</span><span class="s3">\n  </span><span class="s1">res: NextApiResponse&lt;T&gt;,</span><span class="s3">\n  </span><span class="s1">data: object | string, // TODO: strict runtime type checking</span><span class="s3">\n  </span><span class="s1">options: {</span><span class="s3">\n    </span><span class="s1">maxAge?: number</span><span class="s3">\n    </span><span class="s1">path?: string</span><span class="s3">\n  </span><span class="s1">} &amp; __ApiPreviewProps</span><span class="s3">\n</span><span class="s1">): NextApiResponse&lt;T&gt; {</span><span class="s3">\n  </span><span class="s1">if (!isValidData(options.previewModeId)) {</span><span class="s3">\n    </span><span class="s1">throw new Error('invariant: invalid previewModeId')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (!isValidData(options.previewModeEncryptionKey)) {</span><span class="s3">\n    </span><span class="s1">throw new Error('invariant: invalid previewModeEncryptionKey')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (!isValidData(options.previewModeSigningKey)) {</span><span class="s3">\n    </span><span class="s1">throw new Error('invariant: invalid previewModeSigningKey')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const jsonwebtoken =</span><span class="s3">\n    </span><span class="s1">require('next/dist/compiled/jsonwebtoken') as typeof import('next/dist/compiled/jsonwebtoken')</span><span class="s3">\n  </span><span class="s1">const { encryptWithSecret } =</span><span class="s3">\n    </span><span class="s1">require('../../crypto-utils') as typeof import('../../crypto-utils')</span><span class="s3">\n  </span><span class="s1">const payload = jsonwebtoken.sign(</span><span class="s3">\n    </span><span class="s1">{</span><span class="s3">\n      </span><span class="s1">data: encryptWithSecret(</span><span class="s3">\n        </span><span class="s1">Buffer.from(options.previewModeEncryptionKey),</span><span class="s3">\n        </span><span class="s1">JSON.stringify(data)</span><span class="s3">\n      </span><span class="s1">),</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">options.previewModeSigningKey,</span><span class="s3">\n    </span><span class="s1">{</span><span class="s3">\n      </span><span class="s1">algorithm: 'HS256',</span><span class="s3">\n      </span><span class="s1">...(options.maxAge !== undefined</span><span class="s3">\n        </span><span class="s1">? { expiresIn: options.maxAge }</span><span class="s3">\n        </span><span class="s1">: undefined),</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">// limit preview mode cookie to 2KB since we shouldn't store too much</span><span class="s3">\n  </span><span class="s1">// data here and browsers drop cookies over 4KB</span><span class="s3">\n  </span><span class="s1">if (payload.length &gt; 2048) {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">`Preview data is limited to 2KB currently, reduce how much data you are storing as preview data to continue`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const { serialize } =</span><span class="s3">\n    </span><span class="s1">require('next/dist/compiled/cookie') as typeof import('next/dist/compiled/cookie')</span><span class="s3">\n  </span><span class="s1">const previous = res.getHeader('Set-Cookie')</span><span class="s3">\n  </span><span class="s1">res.setHeader(`Set-Cookie`, [</span><span class="s3">\n    </span><span class="s1">...(typeof previous === 'string'</span><span class="s3">\n      </span><span class="s1">? [previous]</span><span class="s3">\n      </span><span class="s1">: Array.isArray(previous)</span><span class="s3">\n        </span><span class="s1">? previous</span><span class="s3">\n        </span><span class="s1">: []),</span><span class="s3">\n    </span><span class="s1">serialize(COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {</span><span class="s3">\n      </span><span class="s1">httpOnly: true,</span><span class="s3">\n      </span><span class="s1">sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',</span><span class="s3">\n      </span><span class="s1">secure: process.env.NODE_ENV !== 'development',</span><span class="s3">\n      </span><span class="s1">path: '/',</span><span class="s3">\n      </span><span class="s1">...(options.maxAge !== undefined</span><span class="s3">\n        </span><span class="s1">? ({ maxAge: options.maxAge } as CookieSerializeOptions)</span><span class="s3">\n        </span><span class="s1">: undefined),</span><span class="s3">\n      </span><span class="s1">...(options.path !== undefined</span><span class="s3">\n        </span><span class="s1">? ({ path: options.path } as CookieSerializeOptions)</span><span class="s3">\n        </span><span class="s1">: undefined),</span><span class="s3">\n    </span><span class="s1">}),</span><span class="s3">\n    </span><span class="s1">serialize(COOKIE_NAME_PRERENDER_DATA, payload, {</span><span class="s3">\n      </span><span class="s1">httpOnly: true,</span><span class="s3">\n      </span><span class="s1">sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',</span><span class="s3">\n      </span><span class="s1">secure: process.env.NODE_ENV !== 'development',</span><span class="s3">\n      </span><span class="s1">path: '/',</span><span class="s3">\n      </span><span class="s1">...(options.maxAge !== undefined</span><span class="s3">\n        </span><span class="s1">? ({ maxAge: options.maxAge } as CookieSerializeOptions)</span><span class="s3">\n        </span><span class="s1">: undefined),</span><span class="s3">\n      </span><span class="s1">...(options.path !== undefined</span><span class="s3">\n        </span><span class="s1">? ({ path: options.path } as CookieSerializeOptions)</span><span class="s3">\n        </span><span class="s1">: undefined),</span><span class="s3">\n    </span><span class="s1">}),</span><span class="s3">\n  </span><span class="s1">])</span><span class="s3">\n  </span><span class="s1">return res</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">async function revalidate(</span><span class="s3">\n  </span><span class="s1">urlPath: string,</span><span class="s3">\n  </span><span class="s1">opts: {</span><span class="s3">\n    </span><span class="s1">unstable_onlyGenerated?: boolean</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n  </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n  </span><span class="s1">context: ApiContext</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">if (typeof urlPath !== 'string' || !urlPath.startsWith('/')) {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">`Invalid urlPath provided to revalidate(), must be a path e.g. /blog/post-1, received ${urlPath}`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const revalidateHeaders: HeadersInit = {</span><span class="s3">\n    </span><span class="s1">[PRERENDER_REVALIDATE_HEADER]: context.previewModeId,</span><span class="s3">\n    </span><span class="s1">...(opts.unstable_onlyGenerated</span><span class="s3">\n      </span><span class="s1">? {</span><span class="s3">\n          </span><span class="s1">[PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER]: '1',</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">: {}),</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const allowedRevalidateHeaderKeys = [</span><span class="s3">\n    </span><span class="s1">...(context.allowedRevalidateHeaderKeys || []),</span><span class="s3">\n  </span><span class="s1">]</span><span class="s3">\n\n  </span><span class="s1">if (context.trustHostHeader || context.dev) {</span><span class="s3">\n    </span><span class="s1">allowedRevalidateHeaderKeys.push('cookie')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (context.trustHostHeader) {</span><span class="s3">\n    </span><span class="s1">allowedRevalidateHeaderKeys.push('x-vercel-protection-bypass')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">for (const key of Object.keys(req.headers)) {</span><span class="s3">\n    </span><span class="s1">if (allowedRevalidateHeaderKeys.includes(key)) {</span><span class="s3">\n      </span><span class="s1">revalidateHeaders[key] = req.headers[key] as string</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const internalRevalidate = context.internalRevalidate</span><span class="s3">\n\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">// We use the revalidate in router-server if available.</span><span class="s3">\n    </span><span class="s1">// If we are operating without router-server (serverless)</span><span class="s3">\n    </span><span class="s1">// we must go through network layer with fetch request</span><span class="s3">\n    </span><span class="s1">if (internalRevalidate) {</span><span class="s3">\n      </span><span class="s1">return await internalRevalidate({</span><span class="s3">\n        </span><span class="s1">urlPath,</span><span class="s3">\n        </span><span class="s1">revalidateHeaders,</span><span class="s3">\n        </span><span class="s1">opts,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (context.trustHostHeader) {</span><span class="s3">\n      </span><span class="s1">const res = await fetch(`https://${req.headers.host}${urlPath}`, {</span><span class="s3">\n        </span><span class="s1">method: 'HEAD',</span><span class="s3">\n        </span><span class="s1">headers: revalidateHeaders,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">// we use the cache header to determine successful revalidate as</span><span class="s3">\n      </span><span class="s1">// a non-200 status code can be returned from a successful revalidate</span><span class="s3">\n      </span><span class="s1">// e.g. notFound: true returns 404 status code but is successful</span><span class="s3">\n      </span><span class="s1">const cacheHeader =</span><span class="s3">\n        </span><span class="s1">res.headers.get('x-vercel-cache') || res.headers.get('x-nextjs-cache')</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">cacheHeader?.toUpperCase() !== 'REVALIDATED' &amp;&amp;</span><span class="s3">\n        </span><span class="s1">res.status !== 200 &amp;&amp;</span><span class="s3">\n        </span><span class="s1">!(res.status === 404 &amp;&amp; opts.unstable_onlyGenerated)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">throw new Error(`Invalid response ${res.status}`)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">`Invariant: missing internal router-server-methods this is an internal bug`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (err: unknown) {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">`Failed to revalidate ${urlPath}: ${isError(err) ? err.message : err}`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function apiResolver(</span><span class="s3">\n  </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n  </span><span class="s1">res: ServerResponse,</span><span class="s3">\n  </span><span class="s1">query: any,</span><span class="s3">\n  </span><span class="s1">resolverModule: any,</span><span class="s3">\n  </span><span class="s1">apiContext: ApiContext,</span><span class="s3">\n  </span><span class="s1">propagateError: boolean,</span><span class="s3">\n  </span><span class="s1">dev?: boolean,</span><span class="s3">\n  </span><span class="s1">page?: string,</span><span class="s3">\n  </span><span class="s1">onError?: InstrumentationOnRequestError</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">const apiReq = req as NextApiRequest</span><span class="s3">\n  </span><span class="s1">const apiRes = res as NextApiResponse</span><span class="s3">\n\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">if (!resolverModule) {</span><span class="s3">\n      </span><span class="s1">res.statusCode = 404</span><span class="s3">\n      </span><span class="s1">res.end('Not Found')</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">const config: PageConfig = resolverModule.config || {}</span><span class="s3">\n    </span><span class="s1">const bodyParser = config.api?.bodyParser !== false</span><span class="s3">\n    </span><span class="s1">const responseLimit = config.api?.responseLimit ?? true</span><span class="s3">\n    </span><span class="s1">const externalResolver = config.api?.externalResolver || false</span><span class="s3">\n\n    </span><span class="s1">// Parsing of cookies</span><span class="s3">\n    </span><span class="s1">setLazyProp({ req: apiReq }, 'cookies', getCookieParser(req.headers))</span><span class="s3">\n    </span><span class="s1">// Parsing query string</span><span class="s3">\n    </span><span class="s1">apiReq.query = query</span><span class="s3">\n    </span><span class="s1">// Parsing preview data</span><span class="s3">\n    </span><span class="s1">setLazyProp({ req: apiReq }, 'previewData', () =&gt;</span><span class="s3">\n      </span><span class="s1">tryGetPreviewData(req, res, apiContext, !!apiContext.multiZoneDraftMode)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">// Checking if preview mode is enabled</span><span class="s3">\n    </span><span class="s1">setLazyProp({ req: apiReq }, 'preview', () =&gt;</span><span class="s3">\n      </span><span class="s1">apiReq.previewData !== false ? true : undefined</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">// Set draftMode to the same value as preview</span><span class="s3">\n    </span><span class="s1">setLazyProp({ req: apiReq }, 'draftMode', () =&gt; apiReq.preview)</span><span class="s3">\n\n    </span><span class="s1">// Parsing of body</span><span class="s3">\n    </span><span class="s1">if (bodyParser &amp;&amp; !apiReq.body) {</span><span class="s3">\n      </span><span class="s1">apiReq.body = await parseBody(</span><span class="s3">\n        </span><span class="s1">apiReq,</span><span class="s3">\n        </span><span class="s1">config.api &amp;&amp; config.api.bodyParser &amp;&amp; config.api.bodyParser.sizeLimit</span><span class="s3">\n          </span><span class="s1">? config.api.bodyParser.sizeLimit</span><span class="s3">\n          </span><span class="s1">: '1mb'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let contentLength = 0</span><span class="s3">\n    </span><span class="s1">const maxContentLength = getMaxContentLength(responseLimit)</span><span class="s3">\n    </span><span class="s1">const writeData = apiRes.write</span><span class="s3">\n    </span><span class="s1">const endResponse = apiRes.end</span><span class="s3">\n    </span><span class="s1">apiRes.write = (...args: any[2]) =&gt; {</span><span class="s3">\n      </span><span class="s1">contentLength += Buffer.byteLength(args[0] || '')</span><span class="s3">\n      </span><span class="s1">return writeData.apply(apiRes, args)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">apiRes.end = (...args: any[2]) =&gt; {</span><span class="s3">\n      </span><span class="s1">if (args.length &amp;&amp; typeof args[0] !== 'function') {</span><span class="s3">\n        </span><span class="s1">contentLength += Buffer.byteLength(args[0] || '')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (responseLimit &amp;&amp; contentLength &gt;= maxContentLength) {</span><span class="s3">\n        </span><span class="s1">console.warn(</span><span class="s3">\n          </span><span class="s1">`API response for ${req.url} exceeds ${bytes.format(</span><span class="s3">\n            </span><span class="s1">maxContentLength</span><span class="s3">\n          </span><span class="s1">)}. API Routes are meant to respond quickly. https://nextjs.org/docs/messages/api-routes-response-size-limit`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">return endResponse.apply(apiRes, args)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">apiRes.status = (statusCode) =&gt; sendStatusCode(apiRes, statusCode)</span><span class="s3">\n    </span><span class="s1">apiRes.send = (data) =&gt; sendData(apiReq, apiRes, data)</span><span class="s3">\n    </span><span class="s1">apiRes.json = (data) =&gt; sendJson(apiRes, data)</span><span class="s3">\n    </span><span class="s1">apiRes.redirect = (statusOrUrl: number | string, url?: string) =&gt;</span><span class="s3">\n      </span><span class="s1">redirect(apiRes, statusOrUrl, url)</span><span class="s3">\n    </span><span class="s1">apiRes.setDraftMode = (options = { enable: true }) =&gt;</span><span class="s3">\n      </span><span class="s1">setDraftMode(apiRes, Object.assign({}, apiContext, options))</span><span class="s3">\n    </span><span class="s1">apiRes.setPreviewData = (data, options = {}) =&gt;</span><span class="s3">\n      </span><span class="s1">setPreviewData(apiRes, data, Object.assign({}, apiContext, options))</span><span class="s3">\n    </span><span class="s1">apiRes.clearPreviewData = (options = {}) =&gt;</span><span class="s3">\n      </span><span class="s1">clearPreviewData(apiRes, options)</span><span class="s3">\n    </span><span class="s1">apiRes.revalidate = (</span><span class="s3">\n      </span><span class="s1">urlPath: string,</span><span class="s3">\n      </span><span class="s1">opts?: {</span><span class="s3">\n        </span><span class="s1">unstable_onlyGenerated?: boolean</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">) =&gt; revalidate(urlPath, opts || {}, req, apiContext)</span><span class="s3">\n\n    </span><span class="s1">const resolver = interopDefault(resolverModule)</span><span class="s3">\n    </span><span class="s1">let wasPiped = false</span><span class="s3">\n\n    </span><span class="s1">if (process.env.NODE_ENV !== 'production') {</span><span class="s3">\n      </span><span class="s1">// listen for pipe event and don't show resolve warning</span><span class="s3">\n      </span><span class="s1">res.once('pipe', () =&gt; (wasPiped = true))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const apiRouteResult = await resolver(req, res)</span><span class="s3">\n\n    </span><span class="s1">if (process.env.NODE_ENV !== 'production') {</span><span class="s3">\n      </span><span class="s1">if (typeof apiRouteResult !== 'undefined') {</span><span class="s3">\n        </span><span class="s1">if (apiRouteResult instanceof Response) {</span><span class="s3">\n          </span><span class="s1">throw new Error(</span><span class="s3">\n            </span><span class="s1">'API route returned a Response object in the Node.js runtime, this is not supported. Please use `runtime: </span><span class="s3">\&quot;</span><span class="s1">edge</span><span class="s3">\&quot;</span><span class="s1">` instead: https://nextjs.org/docs/api-routes/edge-api-routes'</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">console.warn(</span><span class="s3">\n          </span><span class="s1">`API handler should not return a value, received ${typeof apiRouteResult}.`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (!externalResolver &amp;&amp; !isResSent(res) &amp;&amp; !wasPiped) {</span><span class="s3">\n        </span><span class="s1">console.warn(</span><span class="s3">\n          </span><span class="s1">`API resolved without sending a response for ${req.url}, this may result in stalled requests.`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (err) {</span><span class="s3">\n    </span><span class="s1">await onError?.(</span><span class="s3">\n      </span><span class="s1">err,</span><span class="s3">\n      </span><span class="s1">{</span><span class="s3">\n        </span><span class="s1">method: req.method || 'GET',</span><span class="s3">\n        </span><span class="s1">headers: req.headers,</span><span class="s3">\n        </span><span class="s1">path: req.url || '/',</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">{</span><span class="s3">\n        </span><span class="s1">routerKind: 'Pages Router',</span><span class="s3">\n        </span><span class="s1">routePath: page || '',</span><span class="s3">\n        </span><span class="s1">routeType: 'route',</span><span class="s3">\n        </span><span class="s1">revalidateReason: undefined,</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">if (err instanceof ApiError) {</span><span class="s3">\n      </span><span class="s1">sendError(apiRes, err.statusCode, err.message)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">if (dev) {</span><span class="s3">\n        </span><span class="s1">if (isError(err)) {</span><span class="s3">\n          </span><span class="s1">err.page = page</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">console.error(err)</span><span class="s3">\n      </span><span class="s1">if (propagateError) {</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">sendError(apiRes, 500, 'Internal Server Error')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;apiResolver&quot;</span><span class="s0">,</span><span class="s1">&quot;getMaxContentLength&quot;</span><span class="s0">,</span><span class="s1">&quot;responseLimit&quot;</span><span class="s0">,</span><span class="s1">&quot;bytes&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;RESPONSE_LIMIT_DEFAULT&quot;</span><span class="s0">,</span><span class="s1">&quot;sendData&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;end&quot;</span><span class="s0">,</span><span class="s1">&quot;statusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;removeHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ENV&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;contentType&quot;</span><span class="s0">,</span><span class="s1">&quot;getHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;Stream&quot;</span><span class="s0">,</span><span class="s1">&quot;setHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;pipe&quot;</span><span class="s0">,</span><span class="s1">&quot;isJSONLike&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;stringifiedBody&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;etag&quot;</span><span class="s0">,</span><span class="s1">&quot;generateETag&quot;</span><span class="s0">,</span><span class="s1">&quot;sendEtagResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;Buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;isBuffer&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON_CONTENT_TYPE_HEADER&quot;</span><span class="s0">,</span><span class="s1">&quot;byteLength&quot;</span><span class="s0">,</span><span class="s1">&quot;sendJson&quot;</span><span class="s0">,</span><span class="s1">&quot;jsonBody&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;isValidData&quot;</span><span class="s0">,</span><span class="s1">&quot;str&quot;</span><span class="s0">,</span><span class="s1">&quot;setDraftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;options&quot;</span><span class="s0">,</span><span class="s1">&quot;previewModeId&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;expires&quot;</span><span class="s0">,</span><span class="s1">&quot;enable&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;serialize&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;previous&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;isArray&quot;</span><span class="s0">,</span><span class="s1">&quot;COOKIE_NAME_PRERENDER_BYPASS&quot;</span><span class="s0">,</span><span class="s1">&quot;httpOnly&quot;</span><span class="s0">,</span><span class="s1">&quot;sameSite&quot;</span><span class="s0">,</span><span class="s1">&quot;secure&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;setPreviewData&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;previewModeEncryptionKey&quot;</span><span class="s0">,</span><span class="s1">&quot;previewModeSigningKey&quot;</span><span class="s0">,</span><span class="s1">&quot;jsonwebtoken&quot;</span><span class="s0">,</span><span class="s1">&quot;encryptWithSecret&quot;</span><span class="s0">,</span><span class="s1">&quot;payload&quot;</span><span class="s0">,</span><span class="s1">&quot;sign&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;algorithm&quot;</span><span class="s0">,</span><span class="s1">&quot;maxAge&quot;</span><span class="s0">,</span><span class="s1">&quot;expiresIn&quot;</span><span class="s0">,</span><span class="s1">&quot;COOKIE_NAME_PRERENDER_DATA&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;urlPath&quot;</span><span class="s0">,</span><span class="s1">&quot;opts&quot;</span><span class="s0">,</span><span class="s1">&quot;context&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidateHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;PRERENDER_REVALIDATE_HEADER&quot;</span><span class="s0">,</span><span class="s1">&quot;unstable_onlyGenerated&quot;</span><span class="s0">,</span><span class="s1">&quot;PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER&quot;</span><span class="s0">,</span><span class="s1">&quot;allowedRevalidateHeaderKeys&quot;</span><span class="s0">,</span><span class="s1">&quot;trustHostHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;internalRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;fetch&quot;</span><span class="s0">,</span><span class="s1">&quot;host&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;toUpperCase&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;isError&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;query&quot;</span><span class="s0">,</span><span class="s1">&quot;resolverModule&quot;</span><span class="s0">,</span><span class="s1">&quot;apiContext&quot;</span><span class="s0">,</span><span class="s1">&quot;propagateError&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;onError&quot;</span><span class="s0">,</span><span class="s1">&quot;apiReq&quot;</span><span class="s0">,</span><span class="s1">&quot;apiRes&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;bodyParser&quot;</span><span class="s0">,</span><span class="s1">&quot;api&quot;</span><span class="s0">,</span><span class="s1">&quot;externalResolver&quot;</span><span class="s0">,</span><span class="s1">&quot;setLazyProp&quot;</span><span class="s0">,</span><span class="s1">&quot;getCookieParser&quot;</span><span class="s0">,</span><span class="s1">&quot;tryGetPreviewData&quot;</span><span class="s0">,</span><span class="s1">&quot;multiZoneDraftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;previewData&quot;</span><span class="s0">,</span><span class="s1">&quot;preview&quot;</span><span class="s0">,</span><span class="s1">&quot;parseBody&quot;</span><span class="s0">,</span><span class="s1">&quot;sizeLimit&quot;</span><span class="s0">,</span><span class="s1">&quot;contentLength&quot;</span><span class="s0">,</span><span class="s1">&quot;maxContentLength&quot;</span><span class="s0">,</span><span class="s1">&quot;writeData&quot;</span><span class="s0">,</span><span class="s1">&quot;write&quot;</span><span class="s0">,</span><span class="s1">&quot;endResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;args&quot;</span><span class="s0">,</span><span class="s1">&quot;apply&quot;</span><span class="s0">,</span><span class="s1">&quot;format&quot;</span><span class="s0">,</span><span class="s1">&quot;sendStatusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;json&quot;</span><span class="s0">,</span><span class="s1">&quot;redirect&quot;</span><span class="s0">,</span><span class="s1">&quot;statusOrUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;assign&quot;</span><span class="s0">,</span><span class="s1">&quot;clearPreviewData&quot;</span><span class="s0">,</span><span class="s1">&quot;resolver&quot;</span><span class="s0">,</span><span class="s1">&quot;interopDefault&quot;</span><span class="s0">,</span><span class="s1">&quot;wasPiped&quot;</span><span class="s0">,</span><span class="s1">&quot;once&quot;</span><span class="s0">,</span><span class="s1">&quot;apiRouteResult&quot;</span><span class="s0">,</span><span class="s1">&quot;Response&quot;</span><span class="s0">,</span><span class="s1">&quot;isResSent&quot;</span><span class="s0">,</span><span class="s1">&quot;routerKind&quot;</span><span class="s0">,</span><span class="s1">&quot;routePath&quot;</span><span class="s0">,</span><span class="s1">&quot;routeType&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidateReason&quot;</span><span class="s0">,</span><span class="s1">&quot;ApiError&quot;</span><span class="s0">,</span><span class="s1">&quot;sendError&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>