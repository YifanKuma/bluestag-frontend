<html>
<head>
<title>get-source-map-from-file.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
get-source-map-from-file.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/dev/get-source-map-from-file.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import fs from 'fs/promises'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import url from 'url'</span><span class="s3">\n</span><span class="s1">import type { RawSourceMap } from 'next/dist/compiled/source-map08'</span><span class="s3">\n</span><span class="s1">import dataUriToBuffer from 'next/dist/compiled/data-uri-to-buffer'</span><span class="s3">\n\n</span><span class="s1">function getSourceMapUrl(fileContents: string): string | null {</span><span class="s3">\n  </span><span class="s1">const regex = /</span><span class="s3">\\</span><span class="s1">/</span><span class="s3">\\</span><span class="s1">/[#@] ?sourceMappingURL=([^</span><span class="s3">\\</span><span class="s1">s'</span><span class="s3">\&quot;</span><span class="s1">]+)</span><span class="s3">\\</span><span class="s1">s*$/gm</span><span class="s3">\n  </span><span class="s1">let match = null</span><span class="s3">\n  </span><span class="s1">for (;;) {</span><span class="s3">\n    </span><span class="s1">let next = regex.exec(fileContents)</span><span class="s3">\n    </span><span class="s1">if (next == null) {</span><span class="s3">\n      </span><span class="s1">break</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">match = next</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (!(match &amp;&amp; match[1])) {</span><span class="s3">\n    </span><span class="s1">return null</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return match[1].toString()</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function getSourceMapFromFile(</span><span class="s3">\n  </span><span class="s1">filename: string</span><span class="s3">\n</span><span class="s1">): Promise&lt;RawSourceMap | undefined&gt; {</span><span class="s3">\n  </span><span class="s1">filename = filename.startsWith('file://')</span><span class="s3">\n    </span><span class="s1">? url.fileURLToPath(filename)</span><span class="s3">\n    </span><span class="s1">: filename</span><span class="s3">\n\n  </span><span class="s1">let fileContents: string</span><span class="s3">\n\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">fileContents = await fs.readFile(filename, 'utf-8')</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">throw new Error(`Failed to read file contents of ${filename}.`, {</span><span class="s3">\n      </span><span class="s1">cause: error,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const sourceUrl = getSourceMapUrl(fileContents)</span><span class="s3">\n\n  </span><span class="s1">if (!sourceUrl) {</span><span class="s3">\n    </span><span class="s1">return undefined</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (sourceUrl.startsWith('data:')) {</span><span class="s3">\n    </span><span class="s1">let buffer: dataUriToBuffer.MimeBuffer</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">buffer = dataUriToBuffer(sourceUrl)</span><span class="s3">\n    </span><span class="s1">} catch (error) {</span><span class="s3">\n      </span><span class="s1">throw new Error(`Failed to parse source map URL for ${filename}.`, {</span><span class="s3">\n        </span><span class="s1">cause: error,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (buffer.type !== 'application/json') {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">`Unknown source map type for ${filename}: ${buffer.typeFull}.`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">return JSON.parse(buffer.toString())</span><span class="s3">\n    </span><span class="s1">} catch (error) {</span><span class="s3">\n      </span><span class="s1">throw new Error(`Failed to parse source map for ${filename}.`, {</span><span class="s3">\n        </span><span class="s1">cause: error,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const sourceMapFilename = path.resolve(</span><span class="s3">\n    </span><span class="s1">path.dirname(filename),</span><span class="s3">\n    </span><span class="s1">decodeURIComponent(sourceUrl)</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">const sourceMapContents = await fs.readFile(sourceMapFilename, 'utf-8')</span><span class="s3">\n\n    </span><span class="s1">return JSON.parse(sourceMapContents.toString())</span><span class="s3">\n  </span><span class="s1">} catch (error) {</span><span class="s3">\n    </span><span class="s1">throw new Error(`Failed to parse source map ${sourceMapFilename}.`, {</span><span class="s3">\n      </span><span class="s1">cause: error,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;getSourceMapFromFile&quot;</span><span class="s0">,</span><span class="s1">&quot;getSourceMapUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;fileContents&quot;</span><span class="s0">,</span><span class="s1">&quot;regex&quot;</span><span class="s0">,</span><span class="s1">&quot;match&quot;</span><span class="s0">,</span><span class="s1">&quot;next&quot;</span><span class="s0">,</span><span class="s1">&quot;exec&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;filename&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;fileURLToPath&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;readFile&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;cause&quot;</span><span class="s0">,</span><span class="s1">&quot;sourceUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;dataUriToBuffer&quot;</span><span class="s0">,</span><span class="s1">&quot;type&quot;</span><span class="s0">,</span><span class="s1">&quot;typeFull&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;sourceMapFilename&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;dirname&quot;</span><span class="s0">,</span><span class="s1">&quot;decodeURIComponent&quot;</span><span class="s0">,</span><span class="s1">&quot;sourceMapContents&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAsBsBA;;;eAAAA;;;iEAtBP;6DACE;4DACD;wEAEY;;;;;;AAE5B,SAASC,gBAAgBC,YAAoB;IAC3C,MAAMC,QAAQ;IACd,IAAIC,QAAQ;IACZ,OAAS;QACP,IAAIC,OAAOF,MAAMG,IAAI,CAACJ;QACtB,IAAIG,QAAQ,MAAM;YAChB;QACF;QACAD,QAAQC;IACV;IACA,IAAI,CAAED,CAAAA,SAASA,KAAK,CAAC,EAAE,AAAD,GAAI;QACxB,OAAO;IACT;IACA,OAAOA,KAAK,CAAC,EAAE,CAACG,QAAQ;AAC1B;AAEO,eAAeP,qBACpBQ,QAAgB;IAEhBA,WAAWA,SAASC,UAAU,CAAC,aAC3BC,YAAG,CAACC,aAAa,CAACH,YAClBA;IAEJ,IAAIN;IAEJ,IAAI;QACFA,eAAe,MAAMU,iBAAE,CAACC,QAAQ,CAACL,UAAU;IAC7C,EAAE,OAAOM,OAAO;QACd,MAAM,qBAEJ,CAFI,IAAIC,MAAM,CAAC,gCAAgC,EAAEP,SAAS,CAAC,CAAC,EAAE;YAC9DQ,OAAOF;QACT,IAFM,qBAAA;mBAAA;wBAAA;0BAAA;QAEL;IACH;IAEA,MAAMG,YAAYhB,gBAAgBC;IAElC,IAAI,CAACe,WAAW;QACd,OAAOC;IACT;IAEA,IAAID,UAAUR,UAAU,CAAC,UAAU;QACjC,IAAIU;QAEJ,IAAI;YACFA,SAASC,IAAAA,wBAAe,EAACH;QAC3B,EAAE,OAAOH,OAAO;YACd,MAAM,qBAEJ,CAFI,IAAIC,MAAM,CAAC,mCAAmC,EAAEP,SAAS,CAAC,CAAC,EAAE;gBACjEQ,OAAOF;YACT,IAFM,qBAAA;uBAAA;4BAAA;8BAAA;YAEL;QACH;QAEA,IAAIK,OAAOE,IAAI,KAAK,oBAAoB;YACtC,MAAM,qBAEL,CAFK,IAAIN,MACR,CAAC,4BAA4B,EAAEP,SAAS,EAAE,EAAEW,OAAOG,QAAQ,CAAC,CAAC,CAAC,GAD1D,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;QAEA,IAAI;YACF,OAAOC,KAAKC,KAAK,CAACL,OAAOZ,QAAQ;QACnC,EAAE,OAAOO,OAAO;YACd,MAAM,qBAEJ,CAFI,IAAIC,MAAM,CAAC,+BAA+B,EAAEP,SAAS,CAAC,CAAC,EAAE;gBAC7DQ,OAAOF;YACT,IAFM,qBAAA;uBAAA;4BAAA;8BAAA;YAEL;QACH;IACF;IAEA,MAAMW,oBAAoBC,aAAI,CAACC,OAAO,CACpCD,aAAI,CAACE,OAAO,CAACpB,WACbqB,mBAAmBZ;IAGrB,IAAI;QACF,MAAMa,oBAAoB,MAAMlB,iBAAE,CAACC,QAAQ,CAACY,mBAAmB;QAE/D,OAAOF,KAAKC,KAAK,CAACM,kBAAkBvB,QAAQ;IAC9C,EAAE,OAAOO,OAAO;QACd,MAAM,qBAEJ,CAFI,IAAIC,MAAM,CAAC,2BAA2B,EAAEU,kBAAkB,CAAC,CAAC,EAAE;YAClET,OAAOF;QACT,IAFM,qBAAA;mBAAA;wBAAA;0BAAA;QAEL;IACH;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>