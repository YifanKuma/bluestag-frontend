<html>
<head>
<title>subresource-integrity-plugin.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
subresource-integrity-plugin.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/build/webpack/plugins/subresource-integrity-plugin.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { webpack, sources } from 'next/dist/compiled/webpack/webpack'</span><span class="s3">\n</span><span class="s1">import crypto from 'crypto'</span><span class="s3">\n</span><span class="s1">import { SUBRESOURCE_INTEGRITY_MANIFEST } from '../../../shared/lib/constants'</span><span class="s3">\n\n</span><span class="s1">const PLUGIN_NAME = 'SubresourceIntegrityPlugin'</span><span class="s3">\n\n</span><span class="s1">export type SubresourceIntegrityAlgorithm = 'sha256' | 'sha384' | 'sha512'</span><span class="s3">\n\n</span><span class="s1">export class SubresourceIntegrityPlugin {</span><span class="s3">\n  </span><span class="s1">constructor(private readonly algorithm: SubresourceIntegrityAlgorithm) {}</span><span class="s3">\n\n  </span><span class="s1">public apply(compiler: webpack.Compiler) {</span><span class="s3">\n    </span><span class="s1">compiler.hooks.make.tap(PLUGIN_NAME, (compilation) =&gt; {</span><span class="s3">\n      </span><span class="s1">compilation.hooks.afterProcessAssets.tap(</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">name: PLUGIN_NAME,</span><span class="s3">\n          </span><span class="s1">stage: webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">() =&gt; {</span><span class="s3">\n          </span><span class="s1">// Collect all the assets.</span><span class="s3">\n          </span><span class="s1">let files = new Set&lt;string&gt;()</span><span class="s3">\n          </span><span class="s1">for (const asset of compilation.getAssets()) {</span><span class="s3">\n            </span><span class="s1">files.add(asset.name)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">// For each file, deduped, calculate the file hash.</span><span class="s3">\n          </span><span class="s1">const hashes: Record&lt;string, string&gt; = {}</span><span class="s3">\n          </span><span class="s1">for (const file of files.values()) {</span><span class="s3">\n            </span><span class="s1">// Get the buffer for the asset.</span><span class="s3">\n            </span><span class="s1">const asset = compilation.getAsset(file)</span><span class="s3">\n            </span><span class="s1">if (!asset) {</span><span class="s3">\n              </span><span class="s1">throw new Error(`could not get asset: ${file}`)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">// Get the buffer for the asset.</span><span class="s3">\n            </span><span class="s1">const buffer = asset.source.buffer()</span><span class="s3">\n\n            </span><span class="s1">// Create the hash for the content.</span><span class="s3">\n            </span><span class="s1">const hash = crypto</span><span class="s3">\n              </span><span class="s1">.createHash(this.algorithm)</span><span class="s3">\n              </span><span class="s1">.update(buffer)</span><span class="s3">\n              </span><span class="s1">.digest()</span><span class="s3">\n              </span><span class="s1">.toString('base64')</span><span class="s3">\n\n            </span><span class="s1">hashes[file] = `${this.algorithm}-${hash}`</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">const json = JSON.stringify(hashes, null, 2)</span><span class="s3">\n          </span><span class="s1">const file = 'server/' + SUBRESOURCE_INTEGRITY_MANIFEST</span><span class="s3">\n          </span><span class="s1">compilation.emitAsset(</span><span class="s3">\n            </span><span class="s1">file + '.js',</span><span class="s3">\n            </span><span class="s1">new sources.RawSource(</span><span class="s3">\n              </span><span class="s1">`self.__SUBRESOURCE_INTEGRITY_MANIFEST=${JSON.stringify(json)}`</span><span class="s3">\n              </span><span class="s1">// Work around webpack 4 type of RawSource being used</span><span class="s3">\n              </span><span class="s1">// TODO: use webpack 5 type by default</span><span class="s3">\n            </span><span class="s1">) as unknown as webpack.sources.RawSource</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">compilation.emitAsset(</span><span class="s3">\n            </span><span class="s1">file + '.json',</span><span class="s3">\n            </span><span class="s1">new sources.RawSource(</span><span class="s3">\n              </span><span class="s1">json</span><span class="s3">\n              </span><span class="s1">// Work around webpack 4 type of RawSource being used</span><span class="s3">\n              </span><span class="s1">// TODO: use webpack 5 type by default</span><span class="s3">\n            </span><span class="s1">) as unknown as webpack.sources.RawSource</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;SubresourceIntegrityPlugin&quot;</span><span class="s0">,</span><span class="s1">&quot;PLUGIN_NAME&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;algorithm&quot;</span><span class="s0">,</span><span class="s1">&quot;apply&quot;</span><span class="s0">,</span><span class="s1">&quot;compiler&quot;</span><span class="s0">,</span><span class="s1">&quot;hooks&quot;</span><span class="s0">,</span><span class="s1">&quot;make&quot;</span><span class="s0">,</span><span class="s1">&quot;tap&quot;</span><span class="s0">,</span><span class="s1">&quot;compilation&quot;</span><span class="s0">,</span><span class="s1">&quot;afterProcessAssets&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;stage&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack&quot;</span><span class="s0">,</span><span class="s1">&quot;Compilation&quot;</span><span class="s0">,</span><span class="s1">&quot;PROCESS_ASSETS_STAGE_ADDITIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;files&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;asset&quot;</span><span class="s0">,</span><span class="s1">&quot;getAssets&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;hashes&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;values&quot;</span><span class="s0">,</span><span class="s1">&quot;getAsset&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;source&quot;</span><span class="s0">,</span><span class="s1">&quot;hash&quot;</span><span class="s0">,</span><span class="s1">&quot;crypto&quot;</span><span class="s0">,</span><span class="s1">&quot;createHash&quot;</span><span class="s0">,</span><span class="s1">&quot;update&quot;</span><span class="s0">,</span><span class="s1">&quot;digest&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;json&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;SUBRESOURCE_INTEGRITY_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;emitAsset&quot;</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">,</span><span class="s1">&quot;RawSource&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAQaA;;;eAAAA;;;yBARoB;+DACd;2BAC4B;;;;;;AAE/C,MAAMC,cAAc;AAIb,MAAMD;IACXE,YAAY,AAAiBC,SAAwC,CAAE;aAA1CA,YAAAA;IAA2C;IAEjEC,MAAMC,QAA0B,EAAE;QACvCA,SAASC,KAAK,CAACC,IAAI,CAACC,GAAG,CAACP,aAAa,CAACQ;YACpCA,YAAYH,KAAK,CAACI,kBAAkB,CAACF,GAAG,CACtC;gBACEG,MAAMV;gBACNW,OAAOC,gBAAO,CAACC,WAAW,CAACC,8BAA8B;YAC3D,GACA;gBACE,0BAA0B;gBAC1B,IAAIC,QAAQ,IAAIC;gBAChB,KAAK,MAAMC,SAAST,YAAYU,SAAS,GAAI;oBAC3CH,MAAMI,GAAG,CAACF,MAAMP,IAAI;gBACtB;gBAEA,mDAAmD;gBACnD,MAAMU,SAAiC,CAAC;gBACxC,KAAK,MAAMC,QAAQN,MAAMO,MAAM,GAAI;oBACjC,gCAAgC;oBAChC,MAAML,QAAQT,YAAYe,QAAQ,CAACF;oBACnC,IAAI,CAACJ,OAAO;wBACV,MAAM,qBAAyC,CAAzC,IAAIO,MAAM,CAAC,qBAAqB,EAAEH,MAAM,GAAxC,qBAAA;mCAAA;wCAAA;0CAAA;wBAAwC;oBAChD;oBAEA,gCAAgC;oBAChC,MAAMI,SAASR,MAAMS,MAAM,CAACD,MAAM;oBAElC,mCAAmC;oBACnC,MAAME,OAAOC,eAAM,CAChBC,UAAU,CAAC,IAAI,CAAC3B,SAAS,EACzB4B,MAAM,CAACL,QACPM,MAAM,GACNC,QAAQ,CAAC;oBAEZZ,MAAM,CAACC,KAAK,GAAG,GAAG,IAAI,CAACnB,SAAS,CAAC,CAAC,EAAEyB,MAAM;gBAC5C;gBAEA,MAAMM,OAAOC,KAAKC,SAAS,CAACf,QAAQ,MAAM;gBAC1C,MAAMC,OAAO,YAAYe,yCAA8B;gBACvD5B,YAAY6B,SAAS,CACnBhB,OAAO,OACP,IAAIiB,gBAAO,CAACC,SAAS,CACnB,CAAC,sCAAsC,EAAEL,KAAKC,SAAS,CAACF,OAAO;gBAKnEzB,YAAY6B,SAAS,CACnBhB,OAAO,SACP,IAAIiB,gBAAO,CAACC,SAAS,CACnBN;YAKN;QAEJ;IACF;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>