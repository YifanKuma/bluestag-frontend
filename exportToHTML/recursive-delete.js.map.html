<html>
<head>
<title>recursive-delete.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
recursive-delete.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/lib/recursive-delete.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { Dirent } from 'fs'</span><span class="s3">\n</span><span class="s1">import { promises } from 'fs'</span><span class="s3">\n</span><span class="s1">import { join, isAbsolute, dirname } from 'path'</span><span class="s3">\n</span><span class="s1">import isError from './is-error'</span><span class="s3">\n</span><span class="s1">import { wait } from './wait'</span><span class="s3">\n\n</span><span class="s1">const unlinkPath = async (p: string, isDir = false, t = 1): Promise&lt;void&gt; =&gt; {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">if (isDir) {</span><span class="s3">\n      </span><span class="s1">await promises.rmdir(p)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">await promises.unlink(p)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">const code = isError(e) &amp;&amp; e.code</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">(code === 'EBUSY' ||</span><span class="s3">\n        </span><span class="s1">code === 'ENOTEMPTY' ||</span><span class="s3">\n        </span><span class="s1">code === 'EPERM' ||</span><span class="s3">\n        </span><span class="s1">code === 'EMFILE') &amp;&amp;</span><span class="s3">\n      </span><span class="s1">t &lt; 3</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">await wait(t * 100)</span><span class="s3">\n      </span><span class="s1">return unlinkPath(p, isDir, t++)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (code === 'ENOENT') {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">throw e</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Recursively delete directory contents</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export async function recursiveDelete(</span><span class="s3">\n  </span><span class="s1">/** Directory to delete the contents of */</span><span class="s3">\n  </span><span class="s1">dir: string,</span><span class="s3">\n  </span><span class="s1">/** Exclude based on relative file path */</span><span class="s3">\n  </span><span class="s1">exclude?: RegExp,</span><span class="s3">\n  </span><span class="s1">/** Ensures that parameter dir exists, this is not passed recursively */</span><span class="s3">\n  </span><span class="s1">previousPath: string = ''</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">let result</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">result = await promises.readdir(dir, { withFileTypes: true })</span><span class="s3">\n  </span><span class="s1">} catch (e) {</span><span class="s3">\n    </span><span class="s1">if (isError(e) &amp;&amp; e.code === 'ENOENT') {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">throw e</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">await Promise.all(</span><span class="s3">\n    </span><span class="s1">result.map(async (part: Dirent) =&gt; {</span><span class="s3">\n      </span><span class="s1">const absolutePath = join(dir, part.name)</span><span class="s3">\n\n      </span><span class="s1">// readdir does not follow symbolic links</span><span class="s3">\n      </span><span class="s1">// if part is a symbolic link, follow it using stat</span><span class="s3">\n      </span><span class="s1">let isDirectory = part.isDirectory()</span><span class="s3">\n      </span><span class="s1">const isSymlink = part.isSymbolicLink()</span><span class="s3">\n\n      </span><span class="s1">if (isSymlink) {</span><span class="s3">\n        </span><span class="s1">const linkPath = await promises.readlink(absolutePath)</span><span class="s3">\n\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">const stats = await promises.stat(</span><span class="s3">\n            </span><span class="s1">isAbsolute(linkPath)</span><span class="s3">\n              </span><span class="s1">? linkPath</span><span class="s3">\n              </span><span class="s1">: join(dirname(absolutePath), linkPath)</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">isDirectory = stats.isDirectory()</span><span class="s3">\n        </span><span class="s1">} catch {}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const pp = join(previousPath, part.name)</span><span class="s3">\n      </span><span class="s1">const isNotExcluded = !exclude || !exclude.test(pp)</span><span class="s3">\n\n      </span><span class="s1">if (isNotExcluded) {</span><span class="s3">\n        </span><span class="s1">if (!isSymlink &amp;&amp; isDirectory) {</span><span class="s3">\n          </span><span class="s1">await recursiveDelete(absolutePath, exclude, pp)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return unlinkPath(absolutePath, !isSymlink &amp;&amp; isDirectory)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;recursiveDelete&quot;</span><span class="s0">,</span><span class="s1">&quot;unlinkPath&quot;</span><span class="s0">,</span><span class="s1">&quot;p&quot;</span><span class="s0">,</span><span class="s1">&quot;isDir&quot;</span><span class="s0">,</span><span class="s1">&quot;t&quot;</span><span class="s0">,</span><span class="s1">&quot;promises&quot;</span><span class="s0">,</span><span class="s1">&quot;rmdir&quot;</span><span class="s0">,</span><span class="s1">&quot;unlink&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;code&quot;</span><span class="s0">,</span><span class="s1">&quot;isError&quot;</span><span class="s0">,</span><span class="s1">&quot;wait&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;exclude&quot;</span><span class="s0">,</span><span class="s1">&quot;previousPath&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;readdir&quot;</span><span class="s0">,</span><span class="s1">&quot;withFileTypes&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;part&quot;</span><span class="s0">,</span><span class="s1">&quot;absolutePath&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;isDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;isSymlink&quot;</span><span class="s0">,</span><span class="s1">&quot;isSymbolicLink&quot;</span><span class="s0">,</span><span class="s1">&quot;linkPath&quot;</span><span class="s0">,</span><span class="s1">&quot;readlink&quot;</span><span class="s0">,</span><span class="s1">&quot;stats&quot;</span><span class="s0">,</span><span class="s1">&quot;stat&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbsolute&quot;</span><span class="s0">,</span><span class="s1">&quot;dirname&quot;</span><span class="s0">,</span><span class="s1">&quot;pp&quot;</span><span class="s0">,</span><span class="s1">&quot;isNotExcluded&quot;</span><span class="s0">,</span><span class="s1">&quot;test&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAqCsBA;;;eAAAA;;;oBApCG;sBACiB;gEACtB;sBACC;;;;;;AAErB,MAAMC,aAAa,OAAOC,GAAWC,QAAQ,KAAK,EAAEC,IAAI,CAAC;IACvD,IAAI;QACF,IAAID,OAAO;YACT,MAAME,YAAQ,CAACC,KAAK,CAACJ;QACvB,OAAO;YACL,MAAMG,YAAQ,CAACE,MAAM,CAACL;QACxB;IACF,EAAE,OAAOM,GAAG;QACV,MAAMC,OAAOC,IAAAA,gBAAO,EAACF,MAAMA,EAAEC,IAAI;QACjC,IACE,AAACA,CAAAA,SAAS,WACRA,SAAS,eACTA,SAAS,WACTA,SAAS,QAAO,KAClBL,IAAI,GACJ;YACA,MAAMO,IAAAA,UAAI,EAACP,IAAI;YACf,OAAOH,WAAWC,GAAGC,OAAOC;QAC9B;QAEA,IAAIK,SAAS,UAAU;YACrB;QACF;QAEA,MAAMD;IACR;AACF;AAKO,eAAeR,gBACpB,wCAAwC,GACxCY,GAAW,EACX,wCAAwC,GACxCC,OAAgB,EAChB,sEAAsE,GACtEC,eAAuB,EAAE;IAEzB,IAAIC;IACJ,IAAI;QACFA,SAAS,MAAMV,YAAQ,CAACW,OAAO,CAACJ,KAAK;YAAEK,eAAe;QAAK;IAC7D,EAAE,OAAOT,GAAG;QACV,IAAIE,IAAAA,gBAAO,EAACF,MAAMA,EAAEC,IAAI,KAAK,UAAU;YACrC;QACF;QACA,MAAMD;IACR;IAEA,MAAMU,QAAQC,GAAG,CACfJ,OAAOK,GAAG,CAAC,OAAOC;QAChB,MAAMC,eAAeC,IAAAA,UAAI,EAACX,KAAKS,KAAKG,IAAI;QAExC,yCAAyC;QACzC,mDAAmD;QACnD,IAAIC,cAAcJ,KAAKI,WAAW;QAClC,MAAMC,YAAYL,KAAKM,cAAc;QAErC,IAAID,WAAW;YACb,MAAME,WAAW,MAAMvB,YAAQ,CAACwB,QAAQ,CAACP;YAEzC,IAAI;gBACF,MAAMQ,QAAQ,MAAMzB,YAAQ,CAAC0B,IAAI,CAC/BC,IAAAA,gBAAU,EAACJ,YACPA,WACAL,IAAAA,UAAI,EAACU,IAAAA,aAAO,EAACX,eAAeM;gBAElCH,cAAcK,MAAML,WAAW;YACjC,EAAE,OAAM,CAAC;QACX;QAEA,MAAMS,KAAKX,IAAAA,UAAI,EAACT,cAAcO,KAAKG,IAAI;QACvC,MAAMW,gBAAgB,CAACtB,WAAW,CAACA,QAAQuB,IAAI,CAACF;QAEhD,IAAIC,eAAe;YACjB,IAAI,CAACT,aAAaD,aAAa;gBAC7B,MAAMzB,gBAAgBsB,cAAcT,SAASqB;YAC/C;YACA,OAAOjC,WAAWqB,cAAc,CAACI,aAAaD;QAChD;IACF;AAEJ&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>