<html>
<head>
<title>flight-client-entry-plugin.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
flight-client-entry-plugin.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/build/webpack/plugins/flight-client-entry-plugin.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type {</span><span class="s3">\n  </span><span class="s1">CssImports,</span><span class="s3">\n  </span><span class="s1">ClientComponentImports,</span><span class="s3">\n</span><span class="s1">} from '../loaders/next-flight-client-entry-loader'</span><span class="s3">\n\n</span><span class="s1">import { webpack } from 'next/dist/compiled/webpack/webpack'</span><span class="s3">\n</span><span class="s1">import { parse, stringify } from 'querystring'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import { sources } from 'next/dist/compiled/webpack/webpack'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">getInvalidator,</span><span class="s3">\n  </span><span class="s1">getEntries,</span><span class="s3">\n  </span><span class="s1">EntryTypes,</span><span class="s3">\n  </span><span class="s1">getEntryKey,</span><span class="s3">\n</span><span class="s1">} from '../../../server/dev/on-demand-entry-handler'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">WEBPACK_LAYERS,</span><span class="s3">\n  </span><span class="s1">WEBPACK_RESOURCE_QUERIES,</span><span class="s3">\n</span><span class="s1">} from '../../../lib/constants'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">APP_CLIENT_INTERNALS,</span><span class="s3">\n  </span><span class="s1">BARREL_OPTIMIZATION_PREFIX,</span><span class="s3">\n  </span><span class="s1">COMPILER_NAMES,</span><span class="s3">\n  </span><span class="s1">DEFAULT_RUNTIME_WEBPACK,</span><span class="s3">\n  </span><span class="s1">EDGE_RUNTIME_WEBPACK,</span><span class="s3">\n  </span><span class="s1">SERVER_REFERENCE_MANIFEST,</span><span class="s3">\n  </span><span class="s1">UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,</span><span class="s3">\n</span><span class="s1">} from '../../../shared/lib/constants'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">isClientComponentEntryModule,</span><span class="s3">\n  </span><span class="s1">isCSSMod,</span><span class="s3">\n  </span><span class="s1">regexCSS,</span><span class="s3">\n</span><span class="s1">} from '../loaders/utils'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">traverseModules,</span><span class="s3">\n  </span><span class="s1">forEachEntryModule,</span><span class="s3">\n  </span><span class="s1">formatBarrelOptimizedResource,</span><span class="s3">\n  </span><span class="s1">getModuleReferencesInOrder,</span><span class="s3">\n</span><span class="s1">} from '../utils'</span><span class="s3">\n</span><span class="s1">import { normalizePathSep } from '../../../shared/lib/page-path/normalize-path-sep'</span><span class="s3">\n</span><span class="s1">import { getProxiedPluginState } from '../../build-context'</span><span class="s3">\n</span><span class="s1">import { PAGE_TYPES } from '../../../lib/page-types'</span><span class="s3">\n</span><span class="s1">import { getModuleBuildInfo } from '../loaders/get-module-build-info'</span><span class="s3">\n</span><span class="s1">import { getAssumedSourceType } from '../loaders/next-flight-loader'</span><span class="s3">\n</span><span class="s1">import { isAppRouteRoute } from '../../../lib/is-app-route-route'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">DEFAULT_METADATA_ROUTE_EXTENSIONS,</span><span class="s3">\n  </span><span class="s1">isMetadataRouteFile,</span><span class="s3">\n</span><span class="s1">} from '../../../lib/metadata/is-metadata-route'</span><span class="s3">\n</span><span class="s1">import type { MetadataRouteLoaderOptions } from '../loaders/next-metadata-route-loader'</span><span class="s3">\n</span><span class="s1">import type { FlightActionEntryLoaderActions } from '../loaders/next-flight-action-entry-loader'</span><span class="s3">\n</span><span class="s1">import getWebpackBundler from '../../../shared/lib/get-webpack-bundler'</span><span class="s3">\n\n</span><span class="s1">interface Options {</span><span class="s3">\n  </span><span class="s1">dev: boolean</span><span class="s3">\n  </span><span class="s1">appDir: string</span><span class="s3">\n  </span><span class="s1">isEdgeServer: boolean</span><span class="s3">\n  </span><span class="s1">encryptionKey: string</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const PLUGIN_NAME = 'FlightClientEntryPlugin'</span><span class="s3">\n\n</span><span class="s1">type Actions = {</span><span class="s3">\n  </span><span class="s1">[actionId: string]: {</span><span class="s3">\n    </span><span class="s1">exportedName?: string</span><span class="s3">\n    </span><span class="s1">filename?: string</span><span class="s3">\n    </span><span class="s1">workers: {</span><span class="s3">\n      </span><span class="s1">[name: string]: {</span><span class="s3">\n        </span><span class="s1">moduleId: string | number</span><span class="s3">\n        </span><span class="s1">async: boolean</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// Record which layer the action is in (rsc or sc_action), in the specific entry.</span><span class="s3">\n    </span><span class="s1">layer: {</span><span class="s3">\n      </span><span class="s1">[name: string]: string</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type ActionIdNamePair = { id: string; exportedName?: string; filename?: string }</span><span class="s3">\n\n</span><span class="s1">export type ActionManifest = {</span><span class="s3">\n  </span><span class="s1">// Assign a unique encryption key during production build.</span><span class="s3">\n  </span><span class="s1">encryptionKey: string</span><span class="s3">\n  </span><span class="s1">node: Actions</span><span class="s3">\n  </span><span class="s1">edge: Actions</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export interface ModuleInfo {</span><span class="s3">\n  </span><span class="s1">moduleId: string | number</span><span class="s3">\n  </span><span class="s1">async: boolean</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const pluginState = getProxiedPluginState({</span><span class="s3">\n  </span><span class="s1">// A map to track </span><span class="s3">\&quot;</span><span class="s1">action</span><span class="s3">\&quot; </span><span class="s1">-&gt; </span><span class="s3">\&quot;</span><span class="s1">list of bundles</span><span class="s3">\&quot;</span><span class="s1">.</span><span class="s3">\n  </span><span class="s1">serverActions: {} as ActionManifest['node'],</span><span class="s3">\n  </span><span class="s1">edgeServerActions: {} as ActionManifest['edge'],</span><span class="s3">\n\n  </span><span class="s1">serverActionModules: {} as {</span><span class="s3">\n    </span><span class="s1">[workerName: string]: {</span><span class="s3">\n      </span><span class="s1">server?: ModuleInfo</span><span class="s3">\n      </span><span class="s1">client?: ModuleInfo</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n\n  </span><span class="s1">edgeServerActionModules: {} as {</span><span class="s3">\n    </span><span class="s1">[workerName: string]: {</span><span class="s3">\n      </span><span class="s1">server?: ModuleInfo</span><span class="s3">\n      </span><span class="s1">client?: ModuleInfo</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">},</span><span class="s3">\n\n  </span><span class="s1">ssrModules: {} as { [ssrModuleId: string]: ModuleInfo },</span><span class="s3">\n  </span><span class="s1">edgeSsrModules: {} as { [ssrModuleId: string]: ModuleInfo },</span><span class="s3">\n\n  </span><span class="s1">rscModules: {} as { [rscModuleId: string]: ModuleInfo },</span><span class="s3">\n  </span><span class="s1">edgeRscModules: {} as { [rscModuleId: string]: ModuleInfo },</span><span class="s3">\n\n  </span><span class="s1">injectedClientEntries: {} as Record&lt;string, string&gt;,</span><span class="s3">\n</span><span class="s1">})</span><span class="s3">\n\n</span><span class="s1">const POSSIBLE_SHARED_CONVENTIONS = ['template', 'layout']</span><span class="s3">\n</span><span class="s1">const STANDALONE_BUNDLE_CONVENTION = 'global-not-found'</span><span class="s3">\n\n</span><span class="s1">function deduplicateCSSImportsForEntry(mergedCSSimports: CssImports) {</span><span class="s3">\n  </span><span class="s1">// If multiple entry module connections are having the same CSS import,</span><span class="s3">\n  </span><span class="s1">// we only need to have one module to keep track of that CSS import.</span><span class="s3">\n  </span><span class="s1">// It is based on the fact that if a page or a layout is rendered in the</span><span class="s3">\n  </span><span class="s1">// given entry, all its parent layouts are always rendered too.</span><span class="s3">\n  </span><span class="s1">// This can avoid duplicate CSS imports in the generated CSS manifest,</span><span class="s3">\n  </span><span class="s1">// for example, if a page and its parent layout are both using the same</span><span class="s3">\n  </span><span class="s1">// CSS import, we only need to have the layout to keep track of that CSS</span><span class="s3">\n  </span><span class="s1">// import.</span><span class="s3">\n  </span><span class="s1">// To achieve this, we need to first collect all the CSS imports from</span><span class="s3">\n  </span><span class="s1">// every connection, and deduplicate them in the order of layers from</span><span class="s3">\n  </span><span class="s1">// top to bottom. The implementation can be generally described as:</span><span class="s3">\n  </span><span class="s1">// - Sort by number of `/` in the request path (the more `/`, the deeper)</span><span class="s3">\n  </span><span class="s1">// - When in the same depth, sort by the filename (template &lt; layout &lt; page and others)</span><span class="s3">\n\n  </span><span class="s1">// Sort the connections as described above.</span><span class="s3">\n  </span><span class="s1">const sortedCSSImports = Object.entries(mergedCSSimports).sort((a, b) =&gt; {</span><span class="s3">\n    </span><span class="s1">const [aPath] = a</span><span class="s3">\n    </span><span class="s1">const [bPath] = b</span><span class="s3">\n\n    </span><span class="s1">const aDepth = aPath.split('/').length</span><span class="s3">\n    </span><span class="s1">const bDepth = bPath.split('/').length</span><span class="s3">\n\n    </span><span class="s1">if (aDepth !== bDepth) {</span><span class="s3">\n      </span><span class="s1">return aDepth - bDepth</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const aName = path.parse(aPath).name</span><span class="s3">\n    </span><span class="s1">const bName = path.parse(bPath).name</span><span class="s3">\n\n    </span><span class="s1">const indexA = POSSIBLE_SHARED_CONVENTIONS.indexOf(aName)</span><span class="s3">\n    </span><span class="s1">const indexB = POSSIBLE_SHARED_CONVENTIONS.indexOf(bName)</span><span class="s3">\n\n    </span><span class="s1">if (indexA === -1) return 1</span><span class="s3">\n    </span><span class="s1">if (indexB === -1) return -1</span><span class="s3">\n    </span><span class="s1">return indexA - indexB</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">const dedupedCSSImports: CssImports = {}</span><span class="s3">\n  </span><span class="s1">const trackedCSSImports = new Set&lt;string&gt;()</span><span class="s3">\n\n  </span><span class="s1">for (const [entryFilePath, cssImports] of sortedCSSImports) {</span><span class="s3">\n    </span><span class="s1">const entryConventionName = path.parse(entryFilePath).name</span><span class="s3">\n\n    </span><span class="s1">for (const cssImport of cssImports) {</span><span class="s3">\n      </span><span class="s1">// If the CSS import is already tracked, we can skip it.</span><span class="s3">\n      </span><span class="s1">// Or if it's any standalone entry such as `global-not-found`, it won't share any resources with other entry, skip it.</span><span class="s3">\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">trackedCSSImports.has(cssImport) &amp;&amp;</span><span class="s3">\n        </span><span class="s1">STANDALONE_BUNDLE_CONVENTION !== entryConventionName</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">continue</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Only track CSS imports that are in files that can inherit CSS.</span><span class="s3">\n      </span><span class="s1">if (POSSIBLE_SHARED_CONVENTIONS.includes(entryConventionName)) {</span><span class="s3">\n        </span><span class="s1">trackedCSSImports.add(cssImport)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (!dedupedCSSImports[entryFilePath]) {</span><span class="s3">\n        </span><span class="s1">dedupedCSSImports[entryFilePath] = []</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">dedupedCSSImports[entryFilePath].push(cssImport)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return dedupedCSSImports</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export class FlightClientEntryPlugin {</span><span class="s3">\n  </span><span class="s1">dev: boolean</span><span class="s3">\n  </span><span class="s1">appDir: string</span><span class="s3">\n  </span><span class="s1">projectDir: string</span><span class="s3">\n  </span><span class="s1">encryptionKey: string</span><span class="s3">\n  </span><span class="s1">isEdgeServer: boolean</span><span class="s3">\n  </span><span class="s1">assetPrefix: string</span><span class="s3">\n  </span><span class="s1">webpackRuntime: string</span><span class="s3">\n\n  </span><span class="s1">constructor(options: Options) {</span><span class="s3">\n    </span><span class="s1">this.dev = options.dev</span><span class="s3">\n    </span><span class="s1">this.appDir = options.appDir</span><span class="s3">\n    </span><span class="s1">this.projectDir = path.join(options.appDir, '..')</span><span class="s3">\n    </span><span class="s1">this.isEdgeServer = options.isEdgeServer</span><span class="s3">\n    </span><span class="s1">this.assetPrefix = !this.dev &amp;&amp; !this.isEdgeServer ? '../' : ''</span><span class="s3">\n    </span><span class="s1">this.encryptionKey = options.encryptionKey</span><span class="s3">\n    </span><span class="s1">this.webpackRuntime = this.isEdgeServer</span><span class="s3">\n      </span><span class="s1">? EDGE_RUNTIME_WEBPACK</span><span class="s3">\n      </span><span class="s1">: DEFAULT_RUNTIME_WEBPACK</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">apply(compiler: webpack.Compiler) {</span><span class="s3">\n    </span><span class="s1">compiler.hooks.finishMake.tapPromise(PLUGIN_NAME, (compilation) =&gt;</span><span class="s3">\n      </span><span class="s1">this.createClientEntries(compiler, compilation)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">compiler.hooks.afterCompile.tap(PLUGIN_NAME, (compilation) =&gt; {</span><span class="s3">\n      </span><span class="s1">const recordModule = (modId: string, mod: any) =&gt; {</span><span class="s3">\n        </span><span class="s1">// Match Resource is undefined unless an import is using the inline match resource syntax</span><span class="s3">\n        </span><span class="s1">// https://webpack.js.org/api/loaders/#inline-matchresource</span><span class="s3">\n        </span><span class="s1">const modPath = mod.matchResource || mod.resourceResolveData?.path</span><span class="s3">\n        </span><span class="s1">const modQuery = mod.resourceResolveData?.query || ''</span><span class="s3">\n        </span><span class="s1">// query is already part of mod.resource</span><span class="s3">\n        </span><span class="s1">// so it's only necessary to add it for matchResource or mod.resourceResolveData</span><span class="s3">\n        </span><span class="s1">const modResource = modPath</span><span class="s3">\n          </span><span class="s1">? modPath.startsWith(BARREL_OPTIMIZATION_PREFIX)</span><span class="s3">\n            </span><span class="s1">? formatBarrelOptimizedResource(mod.resource, modPath)</span><span class="s3">\n            </span><span class="s1">: modPath + modQuery</span><span class="s3">\n          </span><span class="s1">: mod.resource</span><span class="s3">\n\n        </span><span class="s1">if (typeof modId !== 'undefined' &amp;&amp; modResource) {</span><span class="s3">\n          </span><span class="s1">if (mod.layer === WEBPACK_LAYERS.reactServerComponents) {</span><span class="s3">\n            </span><span class="s1">const key = path</span><span class="s3">\n              </span><span class="s1">.relative(compiler.context, modResource)</span><span class="s3">\n              </span><span class="s1">.replace(/</span><span class="s3">\\</span><span class="s1">/next</span><span class="s3">\\</span><span class="s1">/dist</span><span class="s3">\\</span><span class="s1">/esm</span><span class="s3">\\</span><span class="s1">//, '/next/dist/')</span><span class="s3">\n\n            </span><span class="s1">const moduleInfo: ModuleInfo = {</span><span class="s3">\n              </span><span class="s1">moduleId: modId,</span><span class="s3">\n              </span><span class="s1">async: compilation.moduleGraph.isAsync(mod),</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">if (this.isEdgeServer) {</span><span class="s3">\n              </span><span class="s1">pluginState.edgeRscModules[key] = moduleInfo</span><span class="s3">\n            </span><span class="s1">} else {</span><span class="s3">\n              </span><span class="s1">pluginState.rscModules[key] = moduleInfo</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (mod.layer !== WEBPACK_LAYERS.serverSideRendering) {</span><span class="s3">\n          </span><span class="s1">return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// Check mod resource to exclude the empty resource module like virtual module created by next-flight-client-entry-loader</span><span class="s3">\n        </span><span class="s1">if (typeof modId !== 'undefined' &amp;&amp; modResource) {</span><span class="s3">\n          </span><span class="s1">// Note that this isn't that reliable as webpack is still possible to assign</span><span class="s3">\n          </span><span class="s1">// additional queries to make sure there's no conflict even using the `named`</span><span class="s3">\n          </span><span class="s1">// module ID strategy.</span><span class="s3">\n          </span><span class="s1">let ssrNamedModuleId = path.relative(compiler.context, modResource)</span><span class="s3">\n\n          </span><span class="s1">if (!ssrNamedModuleId.startsWith('.')) {</span><span class="s3">\n            </span><span class="s1">// TODO use getModuleId instead</span><span class="s3">\n            </span><span class="s1">ssrNamedModuleId = `./${normalizePathSep(ssrNamedModuleId)}`</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">const moduleInfo: ModuleInfo = {</span><span class="s3">\n            </span><span class="s1">moduleId: modId,</span><span class="s3">\n            </span><span class="s1">async: compilation.moduleGraph.isAsync(mod),</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">if (this.isEdgeServer) {</span><span class="s3">\n            </span><span class="s1">pluginState.edgeSsrModules[</span><span class="s3">\n              </span><span class="s1">ssrNamedModuleId.replace(/</span><span class="s3">\\</span><span class="s1">/next</span><span class="s3">\\</span><span class="s1">/dist</span><span class="s3">\\</span><span class="s1">/esm</span><span class="s3">\\</span><span class="s1">//, '/next/dist/')</span><span class="s3">\n            </span><span class="s1">] = moduleInfo</span><span class="s3">\n          </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">pluginState.ssrModules[ssrNamedModuleId] = moduleInfo</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">traverseModules(compilation, (mod, _chunk, _chunkGroup, modId) =&gt; {</span><span class="s3">\n        </span><span class="s1">if (modId) recordModule(modId, mod)</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">compiler.hooks.make.tap(PLUGIN_NAME, (compilation) =&gt; {</span><span class="s3">\n      </span><span class="s1">compilation.hooks.processAssets.tapPromise(</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">name: PLUGIN_NAME,</span><span class="s3">\n          </span><span class="s1">stage: webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_HASH,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">() =&gt; this.createActionAssets(compilation)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">async createClientEntries(</span><span class="s3">\n    </span><span class="s1">compiler: webpack.Compiler,</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">const addClientEntryAndSSRModulesList: Array&lt;</span><span class="s3">\n      </span><span class="s1">ReturnType&lt;typeof this.injectClientEntryAndSSRModules&gt;</span><span class="s3">\n    </span><span class="s1">&gt; = []</span><span class="s3">\n    </span><span class="s1">const createdSSRDependenciesForEntry: Record&lt;</span><span class="s3">\n      </span><span class="s1">string,</span><span class="s3">\n      </span><span class="s1">ReturnType&lt;typeof this.injectClientEntryAndSSRModules&gt;[3][]</span><span class="s3">\n    </span><span class="s1">&gt; = {}</span><span class="s3">\n\n    </span><span class="s1">const addActionEntryList: Array&lt;ReturnType&lt;typeof this.injectActionEntry&gt;&gt; =</span><span class="s3">\n      </span><span class="s1">[]</span><span class="s3">\n    </span><span class="s1">const actionMapsPerEntry: Record&lt;</span><span class="s3">\n      </span><span class="s1">string,</span><span class="s3">\n      </span><span class="s1">Map&lt;string, ActionIdNamePair[]&gt;</span><span class="s3">\n    </span><span class="s1">&gt; = {}</span><span class="s3">\n    </span><span class="s1">const createdActionIds = new Set&lt;string&gt;()</span><span class="s3">\n\n    </span><span class="s1">// For each SC server compilation entry, we need to create its corresponding</span><span class="s3">\n    </span><span class="s1">// client component entry.</span><span class="s3">\n    </span><span class="s1">forEachEntryModule(compilation, ({ name, entryModule }) =&gt; {</span><span class="s3">\n      </span><span class="s1">const internalClientComponentEntryImports: ClientComponentImports = {}</span><span class="s3">\n      </span><span class="s1">const actionEntryImports = new Map&lt;string, ActionIdNamePair[]&gt;()</span><span class="s3">\n      </span><span class="s1">const clientEntriesToInject = []</span><span class="s3">\n      </span><span class="s1">const mergedCSSimports: CssImports = {}</span><span class="s3">\n\n      </span><span class="s1">for (const connection of getModuleReferencesInOrder(</span><span class="s3">\n        </span><span class="s1">entryModule,</span><span class="s3">\n        </span><span class="s1">compilation.moduleGraph</span><span class="s3">\n      </span><span class="s1">)) {</span><span class="s3">\n        </span><span class="s1">// Entry can be any user defined entry files such as layout, page, error, loading, etc.</span><span class="s3">\n        </span><span class="s1">let entryRequest = (</span><span class="s3">\n          </span><span class="s1">connection.dependency as unknown as webpack.NormalModule</span><span class="s3">\n        </span><span class="s1">).request</span><span class="s3">\n\n        </span><span class="s1">if (entryRequest.endsWith(WEBPACK_RESOURCE_QUERIES.metadataRoute)) {</span><span class="s3">\n          </span><span class="s1">const { filePath, isDynamicRouteExtension } =</span><span class="s3">\n            </span><span class="s1">getMetadataRouteResource(entryRequest)</span><span class="s3">\n\n          </span><span class="s1">if (isDynamicRouteExtension === '1') {</span><span class="s3">\n            </span><span class="s1">entryRequest = filePath</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const { clientComponentImports, actionImports, cssImports } =</span><span class="s3">\n          </span><span class="s1">this.collectComponentInfoFromServerEntryDependency({</span><span class="s3">\n            </span><span class="s1">entryRequest,</span><span class="s3">\n            </span><span class="s1">compilation,</span><span class="s3">\n            </span><span class="s1">resolvedModule: connection.resolvedModule,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">actionImports.forEach(([dep, actions]) =&gt;</span><span class="s3">\n          </span><span class="s1">actionEntryImports.set(dep, actions)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">const isAbsoluteRequest = path.isAbsolute(entryRequest)</span><span class="s3">\n\n        </span><span class="s1">// Next.js internals are put into a separate entry.</span><span class="s3">\n        </span><span class="s1">if (!isAbsoluteRequest) {</span><span class="s3">\n          </span><span class="s1">Object.keys(clientComponentImports).forEach(</span><span class="s3">\n            </span><span class="s1">(value) =&gt; (internalClientComponentEntryImports[value] = new Set())</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">continue</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// TODO-APP: Enable these lines. This ensures no entrypoint is created for layout/page when there are no client components.</span><span class="s3">\n        </span><span class="s1">// Currently disabled because it causes test failures in CI.</span><span class="s3">\n        </span><span class="s1">// if (clientImports.length === 0 &amp;&amp; actionImports.length === 0) {</span><span class="s3">\n        </span><span class="s1">//   continue</span><span class="s3">\n        </span><span class="s1">// }</span><span class="s3">\n\n        </span><span class="s1">const relativeRequest = isAbsoluteRequest</span><span class="s3">\n          </span><span class="s1">? path.relative(compilation.options.context!, entryRequest)</span><span class="s3">\n          </span><span class="s1">: entryRequest</span><span class="s3">\n\n        </span><span class="s1">// Replace file suffix as `.js` will be added.</span><span class="s3">\n        </span><span class="s1">// bundlePath will have app/ prefix but not src/.</span><span class="s3">\n        </span><span class="s1">// e.g. src/app/foo/page.js -&gt; app/foo/page</span><span class="s3">\n        </span><span class="s1">let bundlePath = normalizePathSep(</span><span class="s3">\n          </span><span class="s1">relativeRequest.replace(/</span><span class="s3">\\</span><span class="s1">.[^.</span><span class="s3">\\\\</span><span class="s1">/]+$/, '').replace(/^src[</span><span class="s3">\\\\</span><span class="s1">/]/, '')</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">// For metadata routes, the entry name can be used as the bundle path,</span><span class="s3">\n        </span><span class="s1">// as it has been normalized already.</span><span class="s3">\n        </span><span class="s1">// e.g.</span><span class="s3">\n        </span><span class="s1">// When `relativeRequest` is 'src/app/sitemap.js',</span><span class="s3">\n        </span><span class="s1">// `appDirRelativeRequest` will be '/sitemap.js'</span><span class="s3">\n        </span><span class="s1">// then `isMetadataEntryFile` will be `true`</span><span class="s3">\n        </span><span class="s1">const appDirRelativeRequest = relativeRequest</span><span class="s3">\n          </span><span class="s1">.replace(/^src[</span><span class="s3">\\\\</span><span class="s1">/]/, '')</span><span class="s3">\n          </span><span class="s1">.replace(/^app[</span><span class="s3">\\\\</span><span class="s1">/]/, '/')</span><span class="s3">\n        </span><span class="s1">const isMetadataEntryFile = isMetadataRouteFile(</span><span class="s3">\n          </span><span class="s1">appDirRelativeRequest,</span><span class="s3">\n          </span><span class="s1">DEFAULT_METADATA_ROUTE_EXTENSIONS,</span><span class="s3">\n          </span><span class="s1">true</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">if (isMetadataEntryFile) {</span><span class="s3">\n          </span><span class="s1">bundlePath = name</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">Object.assign(mergedCSSimports, cssImports)</span><span class="s3">\n        </span><span class="s1">clientEntriesToInject.push({</span><span class="s3">\n          </span><span class="s1">compiler,</span><span class="s3">\n          </span><span class="s1">compilation,</span><span class="s3">\n          </span><span class="s1">entryName: name,</span><span class="s3">\n          </span><span class="s1">clientComponentImports,</span><span class="s3">\n          </span><span class="s1">bundlePath,</span><span class="s3">\n          </span><span class="s1">absolutePagePath: entryRequest,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// The webpack implementation of writing the client reference manifest relies on all entrypoints writing a page.js even when there is no client components in the page.</span><span class="s3">\n        </span><span class="s1">// It needs the file in order to write the reference manifest for the path in the `.next/server` folder.</span><span class="s3">\n        </span><span class="s1">// TODO-APP: This could be better handled, however Turbopack does not have the same problem as we resolve client components in a single graph.</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">name === `app${UNDERSCORE_NOT_FOUND_ROUTE_ENTRY}` &amp;&amp;</span><span class="s3">\n          </span><span class="s1">bundlePath === 'app/not-found'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">clientEntriesToInject.push({</span><span class="s3">\n            </span><span class="s1">compiler,</span><span class="s3">\n            </span><span class="s1">compilation,</span><span class="s3">\n            </span><span class="s1">entryName: name,</span><span class="s3">\n            </span><span class="s1">clientComponentImports: {},</span><span class="s3">\n            </span><span class="s1">bundlePath: `app${UNDERSCORE_NOT_FOUND_ROUTE_ENTRY}`,</span><span class="s3">\n            </span><span class="s1">absolutePagePath: entryRequest,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">name === `app${UNDERSCORE_NOT_FOUND_ROUTE_ENTRY}` &amp;&amp;</span><span class="s3">\n          </span><span class="s1">bundlePath === 'app/global-not-found'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">clientEntriesToInject.push({</span><span class="s3">\n            </span><span class="s1">compiler,</span><span class="s3">\n            </span><span class="s1">compilation,</span><span class="s3">\n            </span><span class="s1">entryName: name,</span><span class="s3">\n            </span><span class="s1">clientComponentImports,</span><span class="s3">\n            </span><span class="s1">bundlePath: `app${UNDERSCORE_NOT_FOUND_ROUTE_ENTRY}`,</span><span class="s3">\n            </span><span class="s1">absolutePagePath: entryRequest,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Make sure CSS imports are deduplicated before injecting the client entry</span><span class="s3">\n      </span><span class="s1">// and SSR modules.</span><span class="s3">\n      </span><span class="s1">const dedupedCSSImports = deduplicateCSSImportsForEntry(mergedCSSimports)</span><span class="s3">\n      </span><span class="s1">for (const clientEntryToInject of clientEntriesToInject) {</span><span class="s3">\n        </span><span class="s1">const injected = this.injectClientEntryAndSSRModules({</span><span class="s3">\n          </span><span class="s1">...clientEntryToInject,</span><span class="s3">\n          </span><span class="s1">clientImports: {</span><span class="s3">\n            </span><span class="s1">...clientEntryToInject.clientComponentImports,</span><span class="s3">\n            </span><span class="s1">...(</span><span class="s3">\n              </span><span class="s1">dedupedCSSImports[clientEntryToInject.absolutePagePath] || []</span><span class="s3">\n            </span><span class="s1">).reduce&lt;ClientComponentImports&gt;((res, curr) =&gt; {</span><span class="s3">\n              </span><span class="s1">res[curr] = new Set()</span><span class="s3">\n              </span><span class="s1">return res</span><span class="s3">\n            </span><span class="s1">}, {}),</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">// Track all created SSR dependencies for each entry from the server layer.</span><span class="s3">\n        </span><span class="s1">if (!createdSSRDependenciesForEntry[clientEntryToInject.entryName]) {</span><span class="s3">\n          </span><span class="s1">createdSSRDependenciesForEntry[clientEntryToInject.entryName] = []</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">createdSSRDependenciesForEntry[clientEntryToInject.entryName].push(</span><span class="s3">\n          </span><span class="s1">injected[3]</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">addClientEntryAndSSRModulesList.push(injected)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (!isAppRouteRoute(name)) {</span><span class="s3">\n        </span><span class="s1">// Create internal app</span><span class="s3">\n        </span><span class="s1">addClientEntryAndSSRModulesList.push(</span><span class="s3">\n          </span><span class="s1">this.injectClientEntryAndSSRModules({</span><span class="s3">\n            </span><span class="s1">compiler,</span><span class="s3">\n            </span><span class="s1">compilation,</span><span class="s3">\n            </span><span class="s1">entryName: name,</span><span class="s3">\n            </span><span class="s1">clientImports: { ...internalClientComponentEntryImports },</span><span class="s3">\n            </span><span class="s1">bundlePath: APP_CLIENT_INTERNALS,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (actionEntryImports.size &gt; 0) {</span><span class="s3">\n        </span><span class="s1">if (!actionMapsPerEntry[name]) {</span><span class="s3">\n          </span><span class="s1">actionMapsPerEntry[name] = new Map()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">actionMapsPerEntry[name] = new Map([</span><span class="s3">\n          </span><span class="s1">...actionMapsPerEntry[name],</span><span class="s3">\n          </span><span class="s1">...actionEntryImports,</span><span class="s3">\n        </span><span class="s1">])</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">for (const [name, actionEntryImports] of Object.entries(</span><span class="s3">\n      </span><span class="s1">actionMapsPerEntry</span><span class="s3">\n    </span><span class="s1">)) {</span><span class="s3">\n      </span><span class="s1">addActionEntryList.push(</span><span class="s3">\n        </span><span class="s1">this.injectActionEntry({</span><span class="s3">\n          </span><span class="s1">compiler,</span><span class="s3">\n          </span><span class="s1">compilation,</span><span class="s3">\n          </span><span class="s1">actions: actionEntryImports,</span><span class="s3">\n          </span><span class="s1">entryName: name,</span><span class="s3">\n          </span><span class="s1">bundlePath: name,</span><span class="s3">\n          </span><span class="s1">createdActionIds,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Invalidate in development to trigger recompilation</span><span class="s3">\n    </span><span class="s1">const invalidator = getInvalidator(compiler.outputPath)</span><span class="s3">\n    </span><span class="s1">// Check if any of the entry injections need an invalidation</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">invalidator &amp;&amp;</span><span class="s3">\n      </span><span class="s1">addClientEntryAndSSRModulesList.some(</span><span class="s3">\n        </span><span class="s1">([shouldInvalidate]) =&gt; shouldInvalidate === true</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">invalidator.invalidate([COMPILER_NAMES.client])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Client compiler is invalidated before awaiting the compilation of the SSR</span><span class="s3">\n    </span><span class="s1">// and RSC client component entries so that the client compiler is running</span><span class="s3">\n    </span><span class="s1">// in parallel to the server compiler.</span><span class="s3">\n    </span><span class="s1">await Promise.all(</span><span class="s3">\n      </span><span class="s1">addClientEntryAndSSRModulesList.flatMap((addClientEntryAndSSRModules) =&gt; [</span><span class="s3">\n        </span><span class="s1">addClientEntryAndSSRModules[1],</span><span class="s3">\n        </span><span class="s1">addClientEntryAndSSRModules[2],</span><span class="s3">\n      </span><span class="s1">])</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">// Wait for action entries to be added.</span><span class="s3">\n    </span><span class="s1">await Promise.all(addActionEntryList)</span><span class="s3">\n\n    </span><span class="s1">const addedClientActionEntryList: Promise&lt;any&gt;[] = []</span><span class="s3">\n    </span><span class="s1">const actionMapsPerClientEntry: Record&lt;</span><span class="s3">\n      </span><span class="s1">string,</span><span class="s3">\n      </span><span class="s1">Map&lt;string, ActionIdNamePair[]&gt;</span><span class="s3">\n    </span><span class="s1">&gt; = {}</span><span class="s3">\n\n    </span><span class="s1">// We need to create extra action entries that are created from the</span><span class="s3">\n    </span><span class="s1">// client layer.</span><span class="s3">\n    </span><span class="s1">// Start from each entry's created SSR dependency from our previous step.</span><span class="s3">\n    </span><span class="s1">for (const [name, ssrEntryDependencies] of Object.entries(</span><span class="s3">\n      </span><span class="s1">createdSSRDependenciesForEntry</span><span class="s3">\n    </span><span class="s1">)) {</span><span class="s3">\n      </span><span class="s1">// Collect from all entries, e.g. layout.js, page.js, loading.js, ...</span><span class="s3">\n      </span><span class="s1">// add aggregate them.</span><span class="s3">\n      </span><span class="s1">const actionEntryImports = this.collectClientActionsFromDependencies({</span><span class="s3">\n        </span><span class="s1">compilation,</span><span class="s3">\n        </span><span class="s1">dependencies: ssrEntryDependencies,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">if (actionEntryImports.size &gt; 0) {</span><span class="s3">\n        </span><span class="s1">if (!actionMapsPerClientEntry[name]) {</span><span class="s3">\n          </span><span class="s1">actionMapsPerClientEntry[name] = new Map()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">actionMapsPerClientEntry[name] = new Map([</span><span class="s3">\n          </span><span class="s1">...actionMapsPerClientEntry[name],</span><span class="s3">\n          </span><span class="s1">...actionEntryImports,</span><span class="s3">\n        </span><span class="s1">])</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (const [entryName, actionEntryImports] of Object.entries(</span><span class="s3">\n      </span><span class="s1">actionMapsPerClientEntry</span><span class="s3">\n    </span><span class="s1">)) {</span><span class="s3">\n      </span><span class="s1">// If an action method is already created in the server layer, we don't</span><span class="s3">\n      </span><span class="s1">// need to create it again in the action layer.</span><span class="s3">\n      </span><span class="s1">// This is to avoid duplicate action instances and make sure the module</span><span class="s3">\n      </span><span class="s1">// state is shared.</span><span class="s3">\n      </span><span class="s1">let remainingClientImportedActions = false</span><span class="s3">\n      </span><span class="s1">const remainingActionEntryImports = new Map&lt;string, ActionIdNamePair[]&gt;()</span><span class="s3">\n      </span><span class="s1">for (const [dep, actions] of actionEntryImports) {</span><span class="s3">\n        </span><span class="s1">const remainingActionNames = []</span><span class="s3">\n        </span><span class="s1">for (const action of actions) {</span><span class="s3">\n          </span><span class="s1">if (!createdActionIds.has(entryName + '@' + action.id)) {</span><span class="s3">\n            </span><span class="s1">remainingActionNames.push(action)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (remainingActionNames.length &gt; 0) {</span><span class="s3">\n          </span><span class="s1">remainingActionEntryImports.set(dep, remainingActionNames)</span><span class="s3">\n          </span><span class="s1">remainingClientImportedActions = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (remainingClientImportedActions) {</span><span class="s3">\n        </span><span class="s1">addedClientActionEntryList.push(</span><span class="s3">\n          </span><span class="s1">this.injectActionEntry({</span><span class="s3">\n            </span><span class="s1">compiler,</span><span class="s3">\n            </span><span class="s1">compilation,</span><span class="s3">\n            </span><span class="s1">actions: remainingActionEntryImports,</span><span class="s3">\n            </span><span class="s1">entryName,</span><span class="s3">\n            </span><span class="s1">bundlePath: entryName,</span><span class="s3">\n            </span><span class="s1">fromClient: true,</span><span class="s3">\n            </span><span class="s1">createdActionIds,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">await Promise.all(addedClientActionEntryList)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">collectClientActionsFromDependencies({</span><span class="s3">\n    </span><span class="s1">compilation,</span><span class="s3">\n    </span><span class="s1">dependencies,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation</span><span class="s3">\n    </span><span class="s1">dependencies: ReturnType&lt;typeof webpack.EntryPlugin.createDependency&gt;[]</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">// action file path -&gt; action names</span><span class="s3">\n    </span><span class="s1">const collectedActions = new Map&lt;string, ActionIdNamePair[]&gt;()</span><span class="s3">\n\n    </span><span class="s1">// Keep track of checked modules to avoid infinite loops with recursive imports.</span><span class="s3">\n    </span><span class="s1">const visitedModule = new Set&lt;string&gt;()</span><span class="s3">\n    </span><span class="s1">const visitedEntry = new Set&lt;string&gt;()</span><span class="s3">\n\n    </span><span class="s1">const collectActions = ({</span><span class="s3">\n      </span><span class="s1">entryRequest,</span><span class="s3">\n      </span><span class="s1">resolvedModule,</span><span class="s3">\n    </span><span class="s1">}: {</span><span class="s3">\n      </span><span class="s1">entryRequest: string</span><span class="s3">\n      </span><span class="s1">resolvedModule: any</span><span class="s3">\n    </span><span class="s1">}) =&gt; {</span><span class="s3">\n      </span><span class="s1">const collectActionsInDep = (mod: webpack.NormalModule): void =&gt; {</span><span class="s3">\n        </span><span class="s1">if (!mod) return</span><span class="s3">\n\n        </span><span class="s1">const modResource = getModuleResource(mod)</span><span class="s3">\n\n        </span><span class="s1">if (!modResource) return</span><span class="s3">\n\n        </span><span class="s1">if (visitedModule.has(modResource)) return</span><span class="s3">\n        </span><span class="s1">visitedModule.add(modResource)</span><span class="s3">\n\n        </span><span class="s1">const actionIds = getModuleBuildInfo(mod).rsc?.actionIds</span><span class="s3">\n        </span><span class="s1">if (actionIds) {</span><span class="s3">\n          </span><span class="s1">collectedActions.set(</span><span class="s3">\n            </span><span class="s1">modResource,</span><span class="s3">\n            </span><span class="s1">Object.entries(actionIds).map(([id, exportedName]) =&gt; ({</span><span class="s3">\n              </span><span class="s1">id,</span><span class="s3">\n              </span><span class="s1">exportedName,</span><span class="s3">\n              </span><span class="s1">filename: path.posix.relative(this.projectDir, modResource),</span><span class="s3">\n            </span><span class="s1">}))</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">// Collect used exported actions transversely.</span><span class="s3">\n        </span><span class="s1">getModuleReferencesInOrder(mod, compilation.moduleGraph).forEach(</span><span class="s3">\n          </span><span class="s1">(connection: any) =&gt; {</span><span class="s3">\n            </span><span class="s1">collectActionsInDep(</span><span class="s3">\n              </span><span class="s1">connection.resolvedModule as webpack.NormalModule</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Don't traverse the module graph anymore once hitting the action layer.</span><span class="s3">\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">entryRequest &amp;&amp;</span><span class="s3">\n        </span><span class="s1">!entryRequest.includes('next-flight-action-entry-loader')</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">// Traverse the module graph to find all client components.</span><span class="s3">\n        </span><span class="s1">collectActionsInDep(resolvedModule)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (const entryDependency of dependencies) {</span><span class="s3">\n      </span><span class="s1">const ssrEntryModule =</span><span class="s3">\n        </span><span class="s1">compilation.moduleGraph.getResolvedModule(entryDependency)!</span><span class="s3">\n      </span><span class="s1">for (const connection of getModuleReferencesInOrder(</span><span class="s3">\n        </span><span class="s1">ssrEntryModule,</span><span class="s3">\n        </span><span class="s1">compilation.moduleGraph</span><span class="s3">\n      </span><span class="s1">)) {</span><span class="s3">\n        </span><span class="s1">const depModule = connection.dependency</span><span class="s3">\n        </span><span class="s1">const request = (depModule as unknown as webpack.NormalModule).request</span><span class="s3">\n\n        </span><span class="s1">// It is possible that the same entry is added multiple times in the</span><span class="s3">\n        </span><span class="s1">// connection graph. We can just skip these to speed up the process.</span><span class="s3">\n        </span><span class="s1">if (visitedEntry.has(request)) continue</span><span class="s3">\n        </span><span class="s1">visitedEntry.add(request)</span><span class="s3">\n\n        </span><span class="s1">collectActions({</span><span class="s3">\n          </span><span class="s1">entryRequest: request,</span><span class="s3">\n          </span><span class="s1">resolvedModule: connection.resolvedModule,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return collectedActions</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">collectComponentInfoFromServerEntryDependency({</span><span class="s3">\n    </span><span class="s1">entryRequest,</span><span class="s3">\n    </span><span class="s1">compilation,</span><span class="s3">\n    </span><span class="s1">resolvedModule,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">entryRequest: string</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation</span><span class="s3">\n    </span><span class="s1">resolvedModule: any /* Dependency */</span><span class="s3">\n  </span><span class="s1">}): {</span><span class="s3">\n    </span><span class="s1">cssImports: CssImports</span><span class="s3">\n    </span><span class="s1">clientComponentImports: ClientComponentImports</span><span class="s3">\n    </span><span class="s1">actionImports: [string, ActionIdNamePair[]][]</span><span class="s3">\n  </span><span class="s1">} {</span><span class="s3">\n    </span><span class="s1">// Keep track of checked modules to avoid infinite loops with recursive imports.</span><span class="s3">\n    </span><span class="s1">const visitedOfClientComponentsTraverse = new Set()</span><span class="s3">\n\n    </span><span class="s1">// Info to collect.</span><span class="s3">\n    </span><span class="s1">const clientComponentImports: ClientComponentImports = {}</span><span class="s3">\n    </span><span class="s1">const actionImports: [string, ActionIdNamePair[]][] = []</span><span class="s3">\n    </span><span class="s1">const CSSImports = new Set&lt;string&gt;()</span><span class="s3">\n\n    </span><span class="s1">const filterClientComponents = (</span><span class="s3">\n      </span><span class="s1">mod: webpack.NormalModule,</span><span class="s3">\n      </span><span class="s1">importedIdentifiers: string[]</span><span class="s3">\n    </span><span class="s1">): void =&gt; {</span><span class="s3">\n      </span><span class="s1">if (!mod) return</span><span class="s3">\n\n      </span><span class="s1">const modResource = getModuleResource(mod)</span><span class="s3">\n\n      </span><span class="s1">if (!modResource) return</span><span class="s3">\n      </span><span class="s1">if (visitedOfClientComponentsTraverse.has(modResource)) {</span><span class="s3">\n        </span><span class="s1">if (clientComponentImports[modResource]) {</span><span class="s3">\n          </span><span class="s1">addClientImport(</span><span class="s3">\n            </span><span class="s1">mod,</span><span class="s3">\n            </span><span class="s1">modResource,</span><span class="s3">\n            </span><span class="s1">clientComponentImports,</span><span class="s3">\n            </span><span class="s1">importedIdentifiers,</span><span class="s3">\n            </span><span class="s1">false</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">visitedOfClientComponentsTraverse.add(modResource)</span><span class="s3">\n\n      </span><span class="s1">const actionIds = getModuleBuildInfo(mod).rsc?.actionIds</span><span class="s3">\n      </span><span class="s1">if (actionIds) {</span><span class="s3">\n        </span><span class="s1">actionImports.push([</span><span class="s3">\n          </span><span class="s1">modResource,</span><span class="s3">\n          </span><span class="s1">Object.entries(actionIds).map(([id, exportedName]) =&gt; ({</span><span class="s3">\n            </span><span class="s1">id,</span><span class="s3">\n            </span><span class="s1">exportedName,</span><span class="s3">\n            </span><span class="s1">filename: path.posix.relative(this.projectDir, modResource),</span><span class="s3">\n          </span><span class="s1">})),</span><span class="s3">\n        </span><span class="s1">])</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (isCSSMod(mod)) {</span><span class="s3">\n        </span><span class="s1">const sideEffectFree =</span><span class="s3">\n          </span><span class="s1">mod.factoryMeta &amp;&amp; (mod.factoryMeta as any).sideEffectFree</span><span class="s3">\n\n        </span><span class="s1">if (sideEffectFree) {</span><span class="s3">\n          </span><span class="s1">const unused = !compilation.moduleGraph</span><span class="s3">\n            </span><span class="s1">.getExportsInfo(mod)</span><span class="s3">\n            </span><span class="s1">.isModuleUsed(this.webpackRuntime)</span><span class="s3">\n\n          </span><span class="s1">if (unused) return</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">CSSImports.add(modResource)</span><span class="s3">\n      </span><span class="s1">} else if (isClientComponentEntryModule(mod)) {</span><span class="s3">\n        </span><span class="s1">if (!clientComponentImports[modResource]) {</span><span class="s3">\n          </span><span class="s1">clientComponentImports[modResource] = new Set()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">addClientImport(</span><span class="s3">\n          </span><span class="s1">mod,</span><span class="s3">\n          </span><span class="s1">modResource,</span><span class="s3">\n          </span><span class="s1">clientComponentImports,</span><span class="s3">\n          </span><span class="s1">importedIdentifiers,</span><span class="s3">\n          </span><span class="s1">true</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">getModuleReferencesInOrder(mod, compilation.moduleGraph).forEach(</span><span class="s3">\n        </span><span class="s1">(connection: any) =&gt; {</span><span class="s3">\n          </span><span class="s1">let dependencyIds: string[] = []</span><span class="s3">\n\n          </span><span class="s1">// `ids` are the identifiers that are imported from the dependency,</span><span class="s3">\n          </span><span class="s1">// if it's present, it's an array of strings.</span><span class="s3">\n          </span><span class="s1">if (connection.dependency?.ids) {</span><span class="s3">\n            </span><span class="s1">dependencyIds.push(...connection.dependency.ids)</span><span class="s3">\n          </span><span class="s1">} else {</span><span class="s3">\n            </span><span class="s1">dependencyIds = ['*']</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">filterClientComponents(connection.resolvedModule, dependencyIds)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Traverse the module graph to find all client components.</span><span class="s3">\n    </span><span class="s1">filterClientComponents(resolvedModule, [])</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n      </span><span class="s1">clientComponentImports,</span><span class="s3">\n      </span><span class="s1">cssImports: CSSImports.size</span><span class="s3">\n        </span><span class="s1">? {</span><span class="s3">\n            </span><span class="s1">[entryRequest]: Array.from(CSSImports),</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">: {},</span><span class="s3">\n      </span><span class="s1">actionImports,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">injectClientEntryAndSSRModules({</span><span class="s3">\n    </span><span class="s1">compiler,</span><span class="s3">\n    </span><span class="s1">compilation,</span><span class="s3">\n    </span><span class="s1">entryName,</span><span class="s3">\n    </span><span class="s1">clientImports,</span><span class="s3">\n    </span><span class="s1">bundlePath,</span><span class="s3">\n    </span><span class="s1">absolutePagePath,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">compiler: webpack.Compiler</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation</span><span class="s3">\n    </span><span class="s1">entryName: string</span><span class="s3">\n    </span><span class="s1">clientImports: ClientComponentImports</span><span class="s3">\n    </span><span class="s1">bundlePath: string</span><span class="s3">\n    </span><span class="s1">absolutePagePath?: string</span><span class="s3">\n  </span><span class="s1">}): [</span><span class="s3">\n    </span><span class="s1">shouldInvalidate: boolean,</span><span class="s3">\n    </span><span class="s1">addSSREntryPromise: Promise&lt;void&gt;,</span><span class="s3">\n    </span><span class="s1">addRSCEntryPromise: Promise&lt;void&gt;,</span><span class="s3">\n    </span><span class="s1">ssrDep: ReturnType&lt;typeof webpack.EntryPlugin.createDependency&gt;,</span><span class="s3">\n  </span><span class="s1">] {</span><span class="s3">\n    </span><span class="s1">const bundler = getWebpackBundler()</span><span class="s3">\n    </span><span class="s1">let shouldInvalidate = false</span><span class="s3">\n\n    </span><span class="s1">const modules = Object.keys(clientImports)</span><span class="s3">\n      </span><span class="s1">.sort((a, b) =&gt; (regexCSS.test(b) ? 1 : a.localeCompare(b)))</span><span class="s3">\n      </span><span class="s1">.map((clientImportPath) =&gt; ({</span><span class="s3">\n        </span><span class="s1">request: clientImportPath,</span><span class="s3">\n        </span><span class="s1">ids: [...clientImports[clientImportPath]],</span><span class="s3">\n      </span><span class="s1">}))</span><span class="s3">\n\n    </span><span class="s1">// For the client entry, we always use the CJS build of Next.js. If the</span><span class="s3">\n    </span><span class="s1">// server is using the ESM build (when using the Edge runtime), we need to</span><span class="s3">\n    </span><span class="s1">// replace them.</span><span class="s3">\n    </span><span class="s1">const clientBrowserLoader = `next-flight-client-entry-loader?${stringify({</span><span class="s3">\n      </span><span class="s1">modules: (this.isEdgeServer</span><span class="s3">\n        </span><span class="s1">? modules.map(({ request, ids }) =&gt; ({</span><span class="s3">\n            </span><span class="s1">request: request.replace(</span><span class="s3">\n              </span><span class="s1">/[</span><span class="s3">\\\\</span><span class="s1">/]next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]esm[</span><span class="s3">\\\\</span><span class="s1">/]/,</span><span class="s3">\n              </span><span class="s1">'/next/dist/'.replace(/</span><span class="s3">\\</span><span class="s1">//g, path.sep)</span><span class="s3">\n            </span><span class="s1">),</span><span class="s3">\n            </span><span class="s1">ids,</span><span class="s3">\n          </span><span class="s1">}))</span><span class="s3">\n        </span><span class="s1">: modules</span><span class="s3">\n      </span><span class="s1">).map((x) =&gt; JSON.stringify(x)),</span><span class="s3">\n      </span><span class="s1">server: false,</span><span class="s3">\n    </span><span class="s1">})}!`</span><span class="s3">\n\n    </span><span class="s1">const clientServerLoader = `next-flight-client-entry-loader?${stringify({</span><span class="s3">\n      </span><span class="s1">modules: modules.map((x) =&gt; JSON.stringify(x)),</span><span class="s3">\n      </span><span class="s1">server: true,</span><span class="s3">\n    </span><span class="s1">})}!`</span><span class="s3">\n\n    </span><span class="s1">// Add for the client compilation</span><span class="s3">\n    </span><span class="s1">// Inject the entry to the client compiler.</span><span class="s3">\n    </span><span class="s1">if (this.dev) {</span><span class="s3">\n      </span><span class="s1">const entries = getEntries(compiler.outputPath)</span><span class="s3">\n      </span><span class="s1">const pageKey = getEntryKey(</span><span class="s3">\n        </span><span class="s1">COMPILER_NAMES.client,</span><span class="s3">\n        </span><span class="s1">PAGE_TYPES.APP,</span><span class="s3">\n        </span><span class="s1">bundlePath</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">if (!entries[pageKey]) {</span><span class="s3">\n        </span><span class="s1">entries[pageKey] = {</span><span class="s3">\n          </span><span class="s1">type: EntryTypes.CHILD_ENTRY,</span><span class="s3">\n          </span><span class="s1">parentEntries: new Set([entryName]),</span><span class="s3">\n          </span><span class="s1">absoluteEntryFilePath: absolutePagePath,</span><span class="s3">\n          </span><span class="s1">bundlePath,</span><span class="s3">\n          </span><span class="s1">request: clientBrowserLoader,</span><span class="s3">\n          </span><span class="s1">dispose: false,</span><span class="s3">\n          </span><span class="s1">lastActiveTime: Date.now(),</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">shouldInvalidate = true</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">const entryData = entries[pageKey]</span><span class="s3">\n        </span><span class="s1">// New version of the client loader</span><span class="s3">\n        </span><span class="s1">if (entryData.request !== clientBrowserLoader) {</span><span class="s3">\n          </span><span class="s1">entryData.request = clientBrowserLoader</span><span class="s3">\n          </span><span class="s1">shouldInvalidate = true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">if (entryData.type === EntryTypes.CHILD_ENTRY) {</span><span class="s3">\n          </span><span class="s1">entryData.parentEntries.add(entryName)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">entryData.dispose = false</span><span class="s3">\n        </span><span class="s1">entryData.lastActiveTime = Date.now()</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">pluginState.injectedClientEntries[bundlePath] = clientBrowserLoader</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const clientComponentSSREntryDep = bundler.EntryPlugin.createDependency(</span><span class="s3">\n      </span><span class="s1">clientServerLoader,</span><span class="s3">\n      </span><span class="s1">{ name: bundlePath }</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">const clientComponentRSCEntryDep = bundler.EntryPlugin.createDependency(</span><span class="s3">\n      </span><span class="s1">clientServerLoader,</span><span class="s3">\n      </span><span class="s1">{ name: bundlePath }</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">return [</span><span class="s3">\n      </span><span class="s1">shouldInvalidate,</span><span class="s3">\n      </span><span class="s1">// Add the entries to the server compiler for the SSR and RSC layers. The</span><span class="s3">\n      </span><span class="s1">// promises are awaited later using `Promise.all` in order to parallelize</span><span class="s3">\n      </span><span class="s1">// adding the entries.</span><span class="s3">\n      </span><span class="s1">this.addEntry(compilation, compiler.context, clientComponentSSREntryDep, {</span><span class="s3">\n        </span><span class="s1">name: entryName,</span><span class="s3">\n        </span><span class="s1">layer: WEBPACK_LAYERS.serverSideRendering,</span><span class="s3">\n      </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">this.addEntry(compilation, compiler.context, clientComponentRSCEntryDep, {</span><span class="s3">\n        </span><span class="s1">name: entryName,</span><span class="s3">\n        </span><span class="s1">layer: WEBPACK_LAYERS.reactServerComponents,</span><span class="s3">\n      </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">clientComponentSSREntryDep,</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">injectActionEntry({</span><span class="s3">\n    </span><span class="s1">compiler,</span><span class="s3">\n    </span><span class="s1">compilation,</span><span class="s3">\n    </span><span class="s1">actions,</span><span class="s3">\n    </span><span class="s1">entryName,</span><span class="s3">\n    </span><span class="s1">bundlePath,</span><span class="s3">\n    </span><span class="s1">fromClient,</span><span class="s3">\n    </span><span class="s1">createdActionIds,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">compiler: webpack.Compiler</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation</span><span class="s3">\n    </span><span class="s1">actions: Map&lt;string, ActionIdNamePair[]&gt;</span><span class="s3">\n    </span><span class="s1">entryName: string</span><span class="s3">\n    </span><span class="s1">bundlePath: string</span><span class="s3">\n    </span><span class="s1">createdActionIds: Set&lt;string&gt;</span><span class="s3">\n    </span><span class="s1">fromClient?: boolean</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">const bundler = getWebpackBundler()</span><span class="s3">\n    </span><span class="s1">const actionsArray = Array.from(actions.entries())</span><span class="s3">\n    </span><span class="s1">for (const [, actionsFromModule] of actions) {</span><span class="s3">\n      </span><span class="s1">for (const { id } of actionsFromModule) {</span><span class="s3">\n        </span><span class="s1">createdActionIds.add(entryName + '@' + id)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (actionsArray.length === 0) {</span><span class="s3">\n      </span><span class="s1">return Promise.resolve()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const actionLoader = `next-flight-action-entry-loader?${stringify({</span><span class="s3">\n      </span><span class="s1">actions: JSON.stringify(</span><span class="s3">\n        </span><span class="s1">actionsArray satisfies FlightActionEntryLoaderActions</span><span class="s3">\n      </span><span class="s1">),</span><span class="s3">\n      </span><span class="s1">__client_imported__: fromClient,</span><span class="s3">\n    </span><span class="s1">})}!`</span><span class="s3">\n\n    </span><span class="s1">const currentCompilerServerActions = this.isEdgeServer</span><span class="s3">\n      </span><span class="s1">? pluginState.edgeServerActions</span><span class="s3">\n      </span><span class="s1">: pluginState.serverActions</span><span class="s3">\n\n    </span><span class="s1">for (const [, actionsFromModule] of actionsArray) {</span><span class="s3">\n      </span><span class="s1">for (const { id, exportedName, filename } of actionsFromModule) {</span><span class="s3">\n        </span><span class="s1">if (typeof currentCompilerServerActions[id] === 'undefined') {</span><span class="s3">\n          </span><span class="s1">currentCompilerServerActions[id] = {</span><span class="s3">\n            </span><span class="s1">workers: {},</span><span class="s3">\n            </span><span class="s1">layer: {},</span><span class="s3">\n            </span><span class="s1">filename,</span><span class="s3">\n            </span><span class="s1">exportedName,</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">currentCompilerServerActions[id].workers[bundlePath] = {</span><span class="s3">\n          </span><span class="s1">moduleId: '', // TODO: What's the meaning of this?</span><span class="s3">\n          </span><span class="s1">async: false,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">currentCompilerServerActions[id].layer[bundlePath] = fromClient</span><span class="s3">\n          </span><span class="s1">? WEBPACK_LAYERS.actionBrowser</span><span class="s3">\n          </span><span class="s1">: WEBPACK_LAYERS.reactServerComponents</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Inject the entry to the server compiler</span><span class="s3">\n    </span><span class="s1">const actionEntryDep = bundler.EntryPlugin.createDependency(actionLoader, {</span><span class="s3">\n      </span><span class="s1">name: bundlePath,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">return this.addEntry(</span><span class="s3">\n      </span><span class="s1">compilation,</span><span class="s3">\n      </span><span class="s1">// Reuse compilation context.</span><span class="s3">\n      </span><span class="s1">compiler.context,</span><span class="s3">\n      </span><span class="s1">actionEntryDep,</span><span class="s3">\n      </span><span class="s1">{</span><span class="s3">\n        </span><span class="s1">name: entryName,</span><span class="s3">\n        </span><span class="s1">layer: fromClient</span><span class="s3">\n          </span><span class="s1">? WEBPACK_LAYERS.actionBrowser</span><span class="s3">\n          </span><span class="s1">: WEBPACK_LAYERS.reactServerComponents,</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">addEntry(</span><span class="s3">\n    </span><span class="s1">compilation: webpack.Compilation,</span><span class="s3">\n    </span><span class="s1">context: string,</span><span class="s3">\n    </span><span class="s1">dependency: webpack.Dependency,</span><span class="s3">\n    </span><span class="s1">options: webpack.EntryOptions</span><span class="s3">\n  </span><span class="s1">): Promise&lt;any&gt; /* Promise&lt;module&gt; */ {</span><span class="s3">\n    </span><span class="s1">return new Promise((resolve, reject) =&gt; {</span><span class="s3">\n      </span><span class="s1">if ('rspack' in compilation.compiler) {</span><span class="s3">\n        </span><span class="s1">compilation.addInclude(context, dependency, options, (err, module) =&gt; {</span><span class="s3">\n          </span><span class="s1">if (err) {</span><span class="s3">\n            </span><span class="s1">return reject(err)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">compilation.moduleGraph</span><span class="s3">\n            </span><span class="s1">.getExportsInfo(module!)</span><span class="s3">\n            </span><span class="s1">.setUsedInUnknownWay(</span><span class="s3">\n              </span><span class="s1">this.isEdgeServer ? EDGE_RUNTIME_WEBPACK : DEFAULT_RUNTIME_WEBPACK</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">return resolve(module)</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">const entry = compilation.entries.get(options.name!)!</span><span class="s3">\n        </span><span class="s1">entry.includeDependencies.push(dependency)</span><span class="s3">\n        </span><span class="s1">compilation.hooks.addEntry.call(entry as any, options)</span><span class="s3">\n        </span><span class="s1">compilation.addModuleTree(</span><span class="s3">\n          </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">context,</span><span class="s3">\n            </span><span class="s1">dependency,</span><span class="s3">\n            </span><span class="s1">contextInfo: { issuerLayer: options.layer },</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n          </span><span class="s1">(err: any, module: any) =&gt; {</span><span class="s3">\n            </span><span class="s1">if (err) {</span><span class="s3">\n              </span><span class="s1">compilation.hooks.failedEntry.call(dependency, options, err)</span><span class="s3">\n              </span><span class="s1">return reject(err)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n\n            </span><span class="s1">compilation.hooks.succeedEntry.call(dependency, options, module)</span><span class="s3">\n\n            </span><span class="s1">compilation.moduleGraph</span><span class="s3">\n              </span><span class="s1">.getExportsInfo(module)</span><span class="s3">\n              </span><span class="s1">.setUsedInUnknownWay(</span><span class="s3">\n                </span><span class="s1">this.isEdgeServer</span><span class="s3">\n                  </span><span class="s1">? EDGE_RUNTIME_WEBPACK</span><span class="s3">\n                  </span><span class="s1">: DEFAULT_RUNTIME_WEBPACK</span><span class="s3">\n              </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">return resolve(module)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">async createActionAssets(compilation: webpack.Compilation) {</span><span class="s3">\n    </span><span class="s1">const serverActions: ActionManifest['node'] = {}</span><span class="s3">\n    </span><span class="s1">const edgeServerActions: ActionManifest['edge'] = {}</span><span class="s3">\n\n    </span><span class="s1">traverseModules(compilation, (mod, _chunk, chunkGroup, modId) =&gt; {</span><span class="s3">\n      </span><span class="s1">// Go through all action entries and record the module ID for each entry.</span><span class="s3">\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">chunkGroup.name &amp;&amp;</span><span class="s3">\n        </span><span class="s1">mod.request &amp;&amp;</span><span class="s3">\n        </span><span class="s1">modId &amp;&amp;</span><span class="s3">\n        </span><span class="s1">/next-flight-action-entry-loader/.test(mod.request)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">const fromClient = /&amp;__client_imported__=true/.test(mod.request)</span><span class="s3">\n\n        </span><span class="s1">const mapping = this.isEdgeServer</span><span class="s3">\n          </span><span class="s1">? pluginState.edgeServerActionModules</span><span class="s3">\n          </span><span class="s1">: pluginState.serverActionModules</span><span class="s3">\n\n        </span><span class="s1">if (!mapping[chunkGroup.name]) {</span><span class="s3">\n          </span><span class="s1">mapping[chunkGroup.name] = {}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">mapping[chunkGroup.name][fromClient ? 'client' : 'server'] = {</span><span class="s3">\n          </span><span class="s1">moduleId: modId,</span><span class="s3">\n          </span><span class="s1">async: compilation.moduleGraph.isAsync(mod),</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">for (let id in pluginState.serverActions) {</span><span class="s3">\n      </span><span class="s1">const action = pluginState.serverActions[id]</span><span class="s3">\n      </span><span class="s1">for (let name in action.workers) {</span><span class="s3">\n        </span><span class="s1">const modId =</span><span class="s3">\n          </span><span class="s1">pluginState.serverActionModules[name][</span><span class="s3">\n            </span><span class="s1">action.layer[name] === WEBPACK_LAYERS.actionBrowser</span><span class="s3">\n              </span><span class="s1">? 'client'</span><span class="s3">\n              </span><span class="s1">: 'server'</span><span class="s3">\n          </span><span class="s1">]</span><span class="s3">\n        </span><span class="s1">action.workers[name] = modId!</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">serverActions[id] = action</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (let id in pluginState.edgeServerActions) {</span><span class="s3">\n      </span><span class="s1">const action = pluginState.edgeServerActions[id]</span><span class="s3">\n      </span><span class="s1">for (let name in action.workers) {</span><span class="s3">\n        </span><span class="s1">const modId =</span><span class="s3">\n          </span><span class="s1">pluginState.edgeServerActionModules[name][</span><span class="s3">\n            </span><span class="s1">action.layer[name] === WEBPACK_LAYERS.actionBrowser</span><span class="s3">\n              </span><span class="s1">? 'client'</span><span class="s3">\n              </span><span class="s1">: 'server'</span><span class="s3">\n          </span><span class="s1">]</span><span class="s3">\n        </span><span class="s1">action.workers[name] = modId!</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">edgeServerActions[id] = action</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const serverManifest = {</span><span class="s3">\n      </span><span class="s1">node: serverActions,</span><span class="s3">\n      </span><span class="s1">edge: edgeServerActions,</span><span class="s3">\n      </span><span class="s1">encryptionKey: this.encryptionKey,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">const edgeServerManifest = {</span><span class="s3">\n      </span><span class="s1">...serverManifest,</span><span class="s3">\n      </span><span class="s1">encryptionKey: 'process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY',</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const json = JSON.stringify(serverManifest, null, this.dev ? 2 : undefined)</span><span class="s3">\n    </span><span class="s1">const edgeJson = JSON.stringify(</span><span class="s3">\n      </span><span class="s1">edgeServerManifest,</span><span class="s3">\n      </span><span class="s1">null,</span><span class="s3">\n      </span><span class="s1">this.dev ? 2 : undefined</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">compilation.emitAsset(</span><span class="s3">\n      </span><span class="s1">`${this.assetPrefix}${SERVER_REFERENCE_MANIFEST}.js`,</span><span class="s3">\n      </span><span class="s1">new sources.RawSource(</span><span class="s3">\n        </span><span class="s1">`self.__RSC_SERVER_MANIFEST=${JSON.stringify(edgeJson)}`</span><span class="s3">\n      </span><span class="s1">) as unknown as webpack.sources.RawSource</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">compilation.emitAsset(</span><span class="s3">\n      </span><span class="s1">`${this.assetPrefix}${SERVER_REFERENCE_MANIFEST}.json`,</span><span class="s3">\n      </span><span class="s1">new sources.RawSource(json) as unknown as webpack.sources.RawSource</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function addClientImport(</span><span class="s3">\n  </span><span class="s1">mod: webpack.NormalModule,</span><span class="s3">\n  </span><span class="s1">modRequest: string,</span><span class="s3">\n  </span><span class="s1">clientComponentImports: ClientComponentImports,</span><span class="s3">\n  </span><span class="s1">importedIdentifiers: string[],</span><span class="s3">\n  </span><span class="s1">isFirstVisitModule: boolean</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const clientEntryType = getModuleBuildInfo(mod).rsc?.clientEntryType</span><span class="s3">\n  </span><span class="s1">const isCjsModule = clientEntryType === 'cjs'</span><span class="s3">\n  </span><span class="s1">const assumedSourceType = getAssumedSourceType(</span><span class="s3">\n    </span><span class="s1">mod,</span><span class="s3">\n    </span><span class="s1">isCjsModule ? 'commonjs' : 'auto'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const clientImportsSet = clientComponentImports[modRequest]</span><span class="s3">\n\n  </span><span class="s1">if (importedIdentifiers[0] === '*') {</span><span class="s3">\n    </span><span class="s1">// If there's collected import path with named import identifiers,</span><span class="s3">\n    </span><span class="s1">// or there's nothing in collected imports are empty.</span><span class="s3">\n    </span><span class="s1">// we should include the whole module.</span><span class="s3">\n    </span><span class="s1">if (!isFirstVisitModule &amp;&amp; [...clientImportsSet][0] !== '*') {</span><span class="s3">\n      </span><span class="s1">clientComponentImports[modRequest] = new Set(['*'])</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">const isAutoModuleSourceType = assumedSourceType === 'auto'</span><span class="s3">\n    </span><span class="s1">if (isAutoModuleSourceType) {</span><span class="s3">\n      </span><span class="s1">clientComponentImports[modRequest] = new Set(['*'])</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">// If it's not analyzed as named ESM exports, e.g. if it's mixing `export *` with named exports,</span><span class="s3">\n      </span><span class="s1">// We'll include all modules since it's not able to do tree-shaking.</span><span class="s3">\n      </span><span class="s1">for (const name of importedIdentifiers) {</span><span class="s3">\n        </span><span class="s1">// For cjs module default import, we include the whole module since</span><span class="s3">\n        </span><span class="s1">const isCjsDefaultImport = isCjsModule &amp;&amp; name === 'default'</span><span class="s3">\n\n        </span><span class="s1">// Always include __esModule along with cjs module default export,</span><span class="s3">\n        </span><span class="s1">// to make sure it work with client module proxy from React.</span><span class="s3">\n        </span><span class="s1">if (isCjsDefaultImport) {</span><span class="s3">\n          </span><span class="s1">clientComponentImports[modRequest].add('__esModule')</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">clientComponentImports[modRequest].add(name)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function getModuleResource(mod: webpack.NormalModule): string {</span><span class="s3">\n  </span><span class="s1">const modPath: string = mod.resourceResolveData?.path || ''</span><span class="s3">\n  </span><span class="s1">const modQuery = mod.resourceResolveData?.query || ''</span><span class="s3">\n  </span><span class="s1">// We have to always use the resolved request here to make sure the</span><span class="s3">\n  </span><span class="s1">// server and client are using the same module path (required by RSC), as</span><span class="s3">\n  </span><span class="s1">// the server compiler and client compiler have different resolve configs.</span><span class="s3">\n  </span><span class="s1">let modResource: string = modPath + modQuery</span><span class="s3">\n\n  </span><span class="s1">// Context modules don't have a resource path, we use the identifier instead.</span><span class="s3">\n  </span><span class="s1">if (mod.constructor.name === 'ContextModule') {</span><span class="s3">\n    </span><span class="s1">modResource = mod.identifier()</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// For the barrel optimization, we need to use the match resource instead</span><span class="s3">\n  </span><span class="s1">// because there will be 2 modules for the same file (same resource path)</span><span class="s3">\n  </span><span class="s1">// but they're different modules and can't be deduped via `visitedModule`.</span><span class="s3">\n  </span><span class="s1">// The first module is a virtual re-export module created by the loader.</span><span class="s3">\n  </span><span class="s1">if (mod.matchResource?.startsWith(BARREL_OPTIMIZATION_PREFIX)) {</span><span class="s3">\n    </span><span class="s1">modResource = mod.matchResource + ':' + modResource</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (mod.resource === `?${WEBPACK_RESOURCE_QUERIES.metadataRoute}`) {</span><span class="s3">\n    </span><span class="s1">return getMetadataRouteResource(mod.rawRequest).filePath</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return modResource</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function getMetadataRouteResource(request: string): MetadataRouteLoaderOptions {</span><span class="s3">\n  </span><span class="s1">// e.g. next-metadata-route-loader?filePath=&lt;some-url-encoded-path&gt;&amp;isDynamicRouteExtension=1!?__next_metadata_route__</span><span class="s3">\n  </span><span class="s1">const query = request.split('!')[0].split('next-metadata-route-loader?')[1]</span><span class="s3">\n\n  </span><span class="s1">return parse(query) as MetadataRouteLoaderOptions</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;FlightClientEntryPlugin&quot;</span><span class="s0">,</span><span class="s1">&quot;PLUGIN_NAME&quot;</span><span class="s0">,</span><span class="s1">&quot;pluginState&quot;</span><span class="s0">,</span><span class="s1">&quot;getProxiedPluginState&quot;</span><span class="s0">,</span><span class="s1">&quot;serverActions&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeServerActions&quot;</span><span class="s0">,</span><span class="s1">&quot;serverActionModules&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeServerActionModules&quot;</span><span class="s0">,</span><span class="s1">&quot;ssrModules&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeSsrModules&quot;</span><span class="s0">,</span><span class="s1">&quot;rscModules&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeRscModules&quot;</span><span class="s0">,</span><span class="s1">&quot;injectedClientEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;POSSIBLE_SHARED_CONVENTIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;STANDALONE_BUNDLE_CONVENTION&quot;</span><span class="s0">,</span><span class="s1">&quot;deduplicateCSSImportsForEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;mergedCSSimports&quot;</span><span class="s0">,</span><span class="s1">&quot;sortedCSSImports&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;entries&quot;</span><span class="s0">,</span><span class="s1">&quot;sort&quot;</span><span class="s0">,</span><span class="s1">&quot;a&quot;</span><span class="s0">,</span><span class="s1">&quot;b&quot;</span><span class="s0">,</span><span class="s1">&quot;aPath&quot;</span><span class="s0">,</span><span class="s1">&quot;bPath&quot;</span><span class="s0">,</span><span class="s1">&quot;aDepth&quot;</span><span class="s0">,</span><span class="s1">&quot;split&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;bDepth&quot;</span><span class="s0">,</span><span class="s1">&quot;aName&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;bName&quot;</span><span class="s0">,</span><span class="s1">&quot;indexA&quot;</span><span class="s0">,</span><span class="s1">&quot;indexOf&quot;</span><span class="s0">,</span><span class="s1">&quot;indexB&quot;</span><span class="s0">,</span><span class="s1">&quot;dedupedCSSImports&quot;</span><span class="s0">,</span><span class="s1">&quot;trackedCSSImports&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;entryFilePath&quot;</span><span class="s0">,</span><span class="s1">&quot;cssImports&quot;</span><span class="s0">,</span><span class="s1">&quot;entryConventionName&quot;</span><span class="s0">,</span><span class="s1">&quot;cssImport&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;options&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;appDir&quot;</span><span class="s0">,</span><span class="s1">&quot;projectDir&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;isEdgeServer&quot;</span><span class="s0">,</span><span class="s1">&quot;assetPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;encryptionKey&quot;</span><span class="s0">,</span><span class="s1">&quot;webpackRuntime&quot;</span><span class="s0">,</span><span class="s1">&quot;EDGE_RUNTIME_WEBPACK&quot;</span><span class="s0">,</span><span class="s1">&quot;DEFAULT_RUNTIME_WEBPACK&quot;</span><span class="s0">,</span><span class="s1">&quot;apply&quot;</span><span class="s0">,</span><span class="s1">&quot;compiler&quot;</span><span class="s0">,</span><span class="s1">&quot;hooks&quot;</span><span class="s0">,</span><span class="s1">&quot;finishMake&quot;</span><span class="s0">,</span><span class="s1">&quot;tapPromise&quot;</span><span class="s0">,</span><span class="s1">&quot;compilation&quot;</span><span class="s0">,</span><span class="s1">&quot;createClientEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;afterCompile&quot;</span><span class="s0">,</span><span class="s1">&quot;tap&quot;</span><span class="s0">,</span><span class="s1">&quot;recordModule&quot;</span><span class="s0">,</span><span class="s1">&quot;modId&quot;</span><span class="s0">,</span><span class="s1">&quot;mod&quot;</span><span class="s0">,</span><span class="s1">&quot;modPath&quot;</span><span class="s0">,</span><span class="s1">&quot;matchResource&quot;</span><span class="s0">,</span><span class="s1">&quot;resourceResolveData&quot;</span><span class="s0">,</span><span class="s1">&quot;modQuery&quot;</span><span class="s0">,</span><span class="s1">&quot;query&quot;</span><span class="s0">,</span><span class="s1">&quot;modResource&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;BARREL_OPTIMIZATION_PREFIX&quot;</span><span class="s0">,</span><span class="s1">&quot;formatBarrelOptimizedResource&quot;</span><span class="s0">,</span><span class="s1">&quot;resource&quot;</span><span class="s0">,</span><span class="s1">&quot;layer&quot;</span><span class="s0">,</span><span class="s1">&quot;WEBPACK_LAYERS&quot;</span><span class="s0">,</span><span class="s1">&quot;reactServerComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;relative&quot;</span><span class="s0">,</span><span class="s1">&quot;context&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;moduleInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;moduleId&quot;</span><span class="s0">,</span><span class="s1">&quot;async&quot;</span><span class="s0">,</span><span class="s1">&quot;moduleGraph&quot;</span><span class="s0">,</span><span class="s1">&quot;isAsync&quot;</span><span class="s0">,</span><span class="s1">&quot;serverSideRendering&quot;</span><span class="s0">,</span><span class="s1">&quot;ssrNamedModuleId&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizePathSep&quot;</span><span class="s0">,</span><span class="s1">&quot;traverseModules&quot;</span><span class="s0">,</span><span class="s1">&quot;_chunk&quot;</span><span class="s0">,</span><span class="s1">&quot;_chunkGroup&quot;</span><span class="s0">,</span><span class="s1">&quot;make&quot;</span><span class="s0">,</span><span class="s1">&quot;processAssets&quot;</span><span class="s0">,</span><span class="s1">&quot;stage&quot;</span><span class="s0">,</span><span class="s1">&quot;webpack&quot;</span><span class="s0">,</span><span class="s1">&quot;Compilation&quot;</span><span class="s0">,</span><span class="s1">&quot;PROCESS_ASSETS_STAGE_OPTIMIZE_HASH&quot;</span><span class="s0">,</span><span class="s1">&quot;createActionAssets&quot;</span><span class="s0">,</span><span class="s1">&quot;addClientEntryAndSSRModulesList&quot;</span><span class="s0">,</span><span class="s1">&quot;createdSSRDependenciesForEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;addActionEntryList&quot;</span><span class="s0">,</span><span class="s1">&quot;actionMapsPerEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;createdActionIds&quot;</span><span class="s0">,</span><span class="s1">&quot;forEachEntryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;entryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;internalClientComponentEntryImports&quot;</span><span class="s0">,</span><span class="s1">&quot;actionEntryImports&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;clientEntriesToInject&quot;</span><span class="s0">,</span><span class="s1">&quot;connection&quot;</span><span class="s0">,</span><span class="s1">&quot;getModuleReferencesInOrder&quot;</span><span class="s0">,</span><span class="s1">&quot;entryRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;dependency&quot;</span><span class="s0">,</span><span class="s1">&quot;request&quot;</span><span class="s0">,</span><span class="s1">&quot;endsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;WEBPACK_RESOURCE_QUERIES&quot;</span><span class="s0">,</span><span class="s1">&quot;metadataRoute&quot;</span><span class="s0">,</span><span class="s1">&quot;filePath&quot;</span><span class="s0">,</span><span class="s1">&quot;isDynamicRouteExtension&quot;</span><span class="s0">,</span><span class="s1">&quot;getMetadataRouteResource&quot;</span><span class="s0">,</span><span class="s1">&quot;clientComponentImports&quot;</span><span class="s0">,</span><span class="s1">&quot;actionImports&quot;</span><span class="s0">,</span><span class="s1">&quot;collectComponentInfoFromServerEntryDependency&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedModule&quot;</span><span class="s0">,</span><span class="s1">&quot;forEach&quot;</span><span class="s0">,</span><span class="s1">&quot;dep&quot;</span><span class="s0">,</span><span class="s1">&quot;actions&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbsoluteRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbsolute&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;relativeRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;bundlePath&quot;</span><span class="s0">,</span><span class="s1">&quot;appDirRelativeRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;isMetadataEntryFile&quot;</span><span class="s0">,</span><span class="s1">&quot;isMetadataRouteFile&quot;</span><span class="s0">,</span><span class="s1">&quot;DEFAULT_METADATA_ROUTE_EXTENSIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;assign&quot;</span><span class="s0">,</span><span class="s1">&quot;entryName&quot;</span><span class="s0">,</span><span class="s1">&quot;absolutePagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;UNDERSCORE_NOT_FOUND_ROUTE_ENTRY&quot;</span><span class="s0">,</span><span class="s1">&quot;clientEntryToInject&quot;</span><span class="s0">,</span><span class="s1">&quot;injected&quot;</span><span class="s0">,</span><span class="s1">&quot;injectClientEntryAndSSRModules&quot;</span><span class="s0">,</span><span class="s1">&quot;clientImports&quot;</span><span class="s0">,</span><span class="s1">&quot;reduce&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;curr&quot;</span><span class="s0">,</span><span class="s1">&quot;isAppRouteRoute&quot;</span><span class="s0">,</span><span class="s1">&quot;APP_CLIENT_INTERNALS&quot;</span><span class="s0">,</span><span class="s1">&quot;size&quot;</span><span class="s0">,</span><span class="s1">&quot;injectActionEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;invalidator&quot;</span><span class="s0">,</span><span class="s1">&quot;getInvalidator&quot;</span><span class="s0">,</span><span class="s1">&quot;outputPath&quot;</span><span class="s0">,</span><span class="s1">&quot;some&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldInvalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;invalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;COMPILER_NAMES&quot;</span><span class="s0">,</span><span class="s1">&quot;client&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;flatMap&quot;</span><span class="s0">,</span><span class="s1">&quot;addClientEntryAndSSRModules&quot;</span><span class="s0">,</span><span class="s1">&quot;addedClientActionEntryList&quot;</span><span class="s0">,</span><span class="s1">&quot;actionMapsPerClientEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;ssrEntryDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;collectClientActionsFromDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;dependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;remainingClientImportedActions&quot;</span><span class="s0">,</span><span class="s1">&quot;remainingActionEntryImports&quot;</span><span class="s0">,</span><span class="s1">&quot;remainingActionNames&quot;</span><span class="s0">,</span><span class="s1">&quot;action&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;fromClient&quot;</span><span class="s0">,</span><span class="s1">&quot;collectedActions&quot;</span><span class="s0">,</span><span class="s1">&quot;visitedModule&quot;</span><span class="s0">,</span><span class="s1">&quot;visitedEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;collectActions&quot;</span><span class="s0">,</span><span class="s1">&quot;collectActionsInDep&quot;</span><span class="s0">,</span><span class="s1">&quot;getModuleBuildInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;getModuleResource&quot;</span><span class="s0">,</span><span class="s1">&quot;actionIds&quot;</span><span class="s0">,</span><span class="s1">&quot;rsc&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;exportedName&quot;</span><span class="s0">,</span><span class="s1">&quot;filename&quot;</span><span class="s0">,</span><span class="s1">&quot;posix&quot;</span><span class="s0">,</span><span class="s1">&quot;entryDependency&quot;</span><span class="s0">,</span><span class="s1">&quot;ssrEntryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;getResolvedModule&quot;</span><span class="s0">,</span><span class="s1">&quot;depModule&quot;</span><span class="s0">,</span><span class="s1">&quot;visitedOfClientComponentsTraverse&quot;</span><span class="s0">,</span><span class="s1">&quot;CSSImports&quot;</span><span class="s0">,</span><span class="s1">&quot;filterClientComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;importedIdentifiers&quot;</span><span class="s0">,</span><span class="s1">&quot;addClientImport&quot;</span><span class="s0">,</span><span class="s1">&quot;isCSSMod&quot;</span><span class="s0">,</span><span class="s1">&quot;sideEffectFree&quot;</span><span class="s0">,</span><span class="s1">&quot;factoryMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;unused&quot;</span><span class="s0">,</span><span class="s1">&quot;getExportsInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;isModuleUsed&quot;</span><span class="s0">,</span><span class="s1">&quot;isClientComponentEntryModule&quot;</span><span class="s0">,</span><span class="s1">&quot;dependencyIds&quot;</span><span class="s0">,</span><span class="s1">&quot;ids&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;bundler&quot;</span><span class="s0">,</span><span class="s1">&quot;getWebpackBundler&quot;</span><span class="s0">,</span><span class="s1">&quot;modules&quot;</span><span class="s0">,</span><span class="s1">&quot;regexCSS&quot;</span><span class="s0">,</span><span class="s1">&quot;test&quot;</span><span class="s0">,</span><span class="s1">&quot;localeCompare&quot;</span><span class="s0">,</span><span class="s1">&quot;clientImportPath&quot;</span><span class="s0">,</span><span class="s1">&quot;clientBrowserLoader&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;sep&quot;</span><span class="s0">,</span><span class="s1">&quot;x&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;server&quot;</span><span class="s0">,</span><span class="s1">&quot;clientServerLoader&quot;</span><span class="s0">,</span><span class="s1">&quot;getEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;pageKey&quot;</span><span class="s0">,</span><span class="s1">&quot;getEntryKey&quot;</span><span class="s0">,</span><span class="s1">&quot;PAGE_TYPES&quot;</span><span class="s0">,</span><span class="s1">&quot;APP&quot;</span><span class="s0">,</span><span class="s1">&quot;type&quot;</span><span class="s0">,</span><span class="s1">&quot;EntryTypes&quot;</span><span class="s0">,</span><span class="s1">&quot;CHILD_ENTRY&quot;</span><span class="s0">,</span><span class="s1">&quot;parentEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;absoluteEntryFilePath&quot;</span><span class="s0">,</span><span class="s1">&quot;dispose&quot;</span><span class="s0">,</span><span class="s1">&quot;lastActiveTime&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;entryData&quot;</span><span class="s0">,</span><span class="s1">&quot;clientComponentSSREntryDep&quot;</span><span class="s0">,</span><span class="s1">&quot;EntryPlugin&quot;</span><span class="s0">,</span><span class="s1">&quot;createDependency&quot;</span><span class="s0">,</span><span class="s1">&quot;clientComponentRSCEntryDep&quot;</span><span class="s0">,</span><span class="s1">&quot;addEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;actionsArray&quot;</span><span class="s0">,</span><span class="s1">&quot;actionsFromModule&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;actionLoader&quot;</span><span class="s0">,</span><span class="s1">&quot;__client_imported__&quot;</span><span class="s0">,</span><span class="s1">&quot;currentCompilerServerActions&quot;</span><span class="s0">,</span><span class="s1">&quot;workers&quot;</span><span class="s0">,</span><span class="s1">&quot;actionBrowser&quot;</span><span class="s0">,</span><span class="s1">&quot;actionEntryDep&quot;</span><span class="s0">,</span><span class="s1">&quot;reject&quot;</span><span class="s0">,</span><span class="s1">&quot;addInclude&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;module&quot;</span><span class="s0">,</span><span class="s1">&quot;setUsedInUnknownWay&quot;</span><span class="s0">,</span><span class="s1">&quot;entry&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;includeDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;call&quot;</span><span class="s0">,</span><span class="s1">&quot;addModuleTree&quot;</span><span class="s0">,</span><span class="s1">&quot;contextInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;issuerLayer&quot;</span><span class="s0">,</span><span class="s1">&quot;failedEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;succeedEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;chunkGroup&quot;</span><span class="s0">,</span><span class="s1">&quot;mapping&quot;</span><span class="s0">,</span><span class="s1">&quot;serverManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;node&quot;</span><span class="s0">,</span><span class="s1">&quot;edge&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeServerManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;json&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeJson&quot;</span><span class="s0">,</span><span class="s1">&quot;emitAsset&quot;</span><span class="s0">,</span><span class="s1">&quot;SERVER_REFERENCE_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">,</span><span class="s1">&quot;RawSource&quot;</span><span class="s0">,</span><span class="s1">&quot;modRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;isFirstVisitModule&quot;</span><span class="s0">,</span><span class="s1">&quot;clientEntryType&quot;</span><span class="s0">,</span><span class="s1">&quot;isCjsModule&quot;</span><span class="s0">,</span><span class="s1">&quot;assumedSourceType&quot;</span><span class="s0">,</span><span class="s1">&quot;getAssumedSourceType&quot;</span><span class="s0">,</span><span class="s1">&quot;clientImportsSet&quot;</span><span class="s0">,</span><span class="s1">&quot;isAutoModuleSourceType&quot;</span><span class="s0">,</span><span class="s1">&quot;isCjsDefaultImport&quot;</span><span class="s0">,</span><span class="s1">&quot;identifier&quot;</span><span class="s0">,</span><span class="s1">&quot;rawRequest&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>