<html>
<head>
<title>index.test.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
index.test.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/trace/report/index.test.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { mkdtemp, readFile } from 'fs/promises'</span><span class="s3">\n</span><span class="s1">import { reporter } from '.'</span><span class="s3">\n</span><span class="s1">import { setGlobal } from '../shared'</span><span class="s3">\n</span><span class="s1">import { join } from 'path'</span><span class="s3">\n</span><span class="s1">import { tmpdir } from 'os'</span><span class="s3">\n\n</span><span class="s1">const TRACE_EVENT = {</span><span class="s3">\n  </span><span class="s1">name: 'test-span',</span><span class="s3">\n  </span><span class="s1">duration: 321,</span><span class="s3">\n  </span><span class="s1">timestamp: Date.now(),</span><span class="s3">\n  </span><span class="s1">id: 127,</span><span class="s3">\n  </span><span class="s1">startTime: Date.now(),</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">const WEBPACK_INVALIDATED_EVENT = {</span><span class="s3">\n  </span><span class="s1">name: 'webpack-invalidated',</span><span class="s3">\n  </span><span class="s1">duration: 100,</span><span class="s3">\n  </span><span class="s1">timestamp: Date.now(),</span><span class="s3">\n  </span><span class="s1">id: 112,</span><span class="s3">\n  </span><span class="s1">startTime: Date.now(),</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">describe('Trace Reporter', () =&gt; {</span><span class="s3">\n  </span><span class="s1">describe('JSON reporter', () =&gt; {</span><span class="s3">\n    </span><span class="s1">it('should write the trace events to JSON file', async () =&gt; {</span><span class="s3">\n      </span><span class="s1">const tmpDir = await mkdtemp(join(tmpdir(), 'json-reporter'))</span><span class="s3">\n      </span><span class="s1">setGlobal('distDir', tmpDir)</span><span class="s3">\n      </span><span class="s1">setGlobal('phase', 'anything')</span><span class="s3">\n      </span><span class="s1">reporter.report(TRACE_EVENT)</span><span class="s3">\n      </span><span class="s1">await reporter.flushAll()</span><span class="s3">\n      </span><span class="s1">const traceFilename = join(tmpDir, 'trace')</span><span class="s3">\n      </span><span class="s1">const traces = JSON.parse(await readFile(traceFilename, 'utf-8'))</span><span class="s3">\n      </span><span class="s1">expect(traces.length).toEqual(1)</span><span class="s3">\n      </span><span class="s1">expect(traces[0].name).toEqual('test-span')</span><span class="s3">\n      </span><span class="s1">expect(traces[0].id).toEqual(127)</span><span class="s3">\n      </span><span class="s1">expect(traces[0].duration).toEqual(321)</span><span class="s3">\n      </span><span class="s1">expect(traces[0].traceId).toBeDefined()</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">describe('Telemetry reporter', () =&gt; {</span><span class="s3">\n    </span><span class="s1">it('should record telemetry event', async () =&gt; {</span><span class="s3">\n      </span><span class="s1">const recordMock = jest.fn()</span><span class="s3">\n      </span><span class="s1">const telemetryMock = {</span><span class="s3">\n        </span><span class="s1">record: recordMock,</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">setGlobal('telemetry', telemetryMock)</span><span class="s3">\n      </span><span class="s1">// This should be ignored.</span><span class="s3">\n      </span><span class="s1">reporter.report(TRACE_EVENT)</span><span class="s3">\n      </span><span class="s1">expect(recordMock).toHaveBeenCalledTimes(0)</span><span class="s3">\n      </span><span class="s1">reporter.report(WEBPACK_INVALIDATED_EVENT)</span><span class="s3">\n      </span><span class="s1">expect(recordMock).toHaveBeenCalledTimes(1)</span><span class="s3">\n      </span><span class="s1">expect(recordMock).toHaveBeenCalledWith({</span><span class="s3">\n        </span><span class="s1">eventName: 'WEBPACK_INVALIDATED',</span><span class="s3">\n        </span><span class="s1">payload: {</span><span class="s3">\n          </span><span class="s1">durationInMicroseconds: 100,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">})</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;TRACE_EVENT&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;duration&quot;</span><span class="s0">,</span><span class="s1">&quot;timestamp&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;startTime&quot;</span><span class="s0">,</span><span class="s1">&quot;WEBPACK_INVALIDATED_EVENT&quot;</span><span class="s0">,</span><span class="s1">&quot;describe&quot;</span><span class="s0">,</span><span class="s1">&quot;it&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpDir&quot;</span><span class="s0">,</span><span class="s1">&quot;mkdtemp&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpdir&quot;</span><span class="s0">,</span><span class="s1">&quot;setGlobal&quot;</span><span class="s0">,</span><span class="s1">&quot;reporter&quot;</span><span class="s0">,</span><span class="s1">&quot;report&quot;</span><span class="s0">,</span><span class="s1">&quot;flushAll&quot;</span><span class="s0">,</span><span class="s1">&quot;traceFilename&quot;</span><span class="s0">,</span><span class="s1">&quot;traces&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;readFile&quot;</span><span class="s0">,</span><span class="s1">&quot;expect&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;toEqual&quot;</span><span class="s0">,</span><span class="s1">&quot;traceId&quot;</span><span class="s0">,</span><span class="s1">&quot;toBeDefined&quot;</span><span class="s0">,</span><span class="s1">&quot;recordMock&quot;</span><span class="s0">,</span><span class="s1">&quot;jest&quot;</span><span class="s0">,</span><span class="s1">&quot;fn&quot;</span><span class="s0">,</span><span class="s1">&quot;telemetryMock&quot;</span><span class="s0">,</span><span class="s1">&quot;record&quot;</span><span class="s0">,</span><span class="s1">&quot;toHaveBeenCalledTimes&quot;</span><span class="s0">,</span><span class="s1">&quot;toHaveBeenCalledWith&quot;</span><span class="s0">,</span><span class="s1">&quot;eventName&quot;</span><span class="s0">,</span><span class="s1">&quot;payload&quot;</span><span class="s0">,</span><span class="s1">&quot;durationInMicroseconds&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;0BAAkC;kBACT;wBACC;sBACL;oBACE;AAEvB,MAAMA,cAAc;IAClBC,MAAM;IACNC,UAAU;IACVC,WAAWC,KAAKC,GAAG;IACnBC,IAAI;IACJC,WAAWH,KAAKC,GAAG;AACrB;AACA,MAAMG,4BAA4B;IAChCP,MAAM;IACNC,UAAU;IACVC,WAAWC,KAAKC,GAAG;IACnBC,IAAI;IACJC,WAAWH,KAAKC,GAAG;AACrB;AAEAI,SAAS,kBAAkB;IACzBA,SAAS,iBAAiB;QACxBC,GAAG,8CAA8C;YAC/C,MAAMC,SAAS,MAAMC,IAAAA,iBAAO,EAACC,IAAAA,UAAI,EAACC,IAAAA,UAAM,KAAI;YAC5CC,IAAAA,iBAAS,EAAC,WAAWJ;YACrBI,IAAAA,iBAAS,EAAC,SAAS;YACnBC,UAAQ,CAACC,MAAM,CAACjB;YAChB,MAAMgB,UAAQ,CAACE,QAAQ;YACvB,MAAMC,gBAAgBN,IAAAA,UAAI,EAACF,QAAQ;YACnC,MAAMS,SAASC,KAAKC,KAAK,CAAC,MAAMC,IAAAA,kBAAQ,EAACJ,eAAe;YACxDK,OAAOJ,OAAOK,MAAM,EAAEC,OAAO,CAAC;YAC9BF,OAAOJ,MAAM,CAAC,EAAE,CAACnB,IAAI,EAAEyB,OAAO,CAAC;YAC/BF,OAAOJ,MAAM,CAAC,EAAE,CAACd,EAAE,EAAEoB,OAAO,CAAC;YAC7BF,OAAOJ,MAAM,CAAC,EAAE,CAAClB,QAAQ,EAAEwB,OAAO,CAAC;YACnCF,OAAOJ,MAAM,CAAC,EAAE,CAACO,OAAO,EAAEC,WAAW;QACvC;IACF;IAEAnB,SAAS,sBAAsB;QAC7BC,GAAG,iCAAiC;YAClC,MAAMmB,aAAaC,KAAKC,EAAE;YAC1B,MAAMC,gBAAgB;gBACpBC,QAAQJ;YACV;YACAd,IAAAA,iBAAS,EAAC,aAAaiB;YACvB,0BAA0B;YAC1BhB,UAAQ,CAACC,MAAM,CAACjB;YAChBwB,OAAOK,YAAYK,qBAAqB,CAAC;YACzClB,UAAQ,CAACC,MAAM,CAACT;YAChBgB,OAAOK,YAAYK,qBAAqB,CAAC;YACzCV,OAAOK,YAAYM,oBAAoB,CAAC;gBACtCC,WAAW;gBACXC,SAAS;oBACPC,wBAAwB;gBAC1B;YACF;QACF;IACF;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>