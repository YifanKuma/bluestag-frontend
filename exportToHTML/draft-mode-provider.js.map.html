<html>
<head>
<title>draft-mode-provider.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
draft-mode-provider.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/async-storage/draft-mode-provider.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { IncomingMessage } from 'http'</span><span class="s3">\n</span><span class="s1">import type { ReadonlyRequestCookies } from '../web/spec-extension/adapters/request-cookies'</span><span class="s3">\n</span><span class="s1">import type { ResponseCookies } from '../web/spec-extension/cookies'</span><span class="s3">\n</span><span class="s1">import type { BaseNextRequest } from '../base-http'</span><span class="s3">\n</span><span class="s1">import type { NextRequest } from '../web/spec-extension/request'</span><span class="s3">\n\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">COOKIE_NAME_PRERENDER_BYPASS,</span><span class="s3">\n  </span><span class="s1">checkIsOnDemandRevalidate,</span><span class="s3">\n</span><span class="s1">} from '../api-utils'</span><span class="s3">\n</span><span class="s1">import type { __ApiPreviewProps } from '../api-utils'</span><span class="s3">\n\n</span><span class="s1">export class DraftModeProvider {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* @internal - this declaration is stripped via `tsc --stripInternal`</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">private _isEnabled: boolean</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* @internal - this declaration is stripped via `tsc --stripInternal`</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">private readonly _previewModeId: string | undefined</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* @internal - this declaration is stripped via `tsc --stripInternal`</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">private readonly _mutableCookies: ResponseCookies</span><span class="s3">\n\n  </span><span class="s1">constructor(</span><span class="s3">\n    </span><span class="s1">previewProps: __ApiPreviewProps | undefined,</span><span class="s3">\n    </span><span class="s1">req: IncomingMessage | BaseNextRequest&lt;unknown&gt; | NextRequest,</span><span class="s3">\n    </span><span class="s1">cookies: ReadonlyRequestCookies,</span><span class="s3">\n    </span><span class="s1">mutableCookies: ResponseCookies</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// The logic for draftMode() is very similar to tryGetPreviewData()</span><span class="s3">\n    </span><span class="s1">// but Draft Mode does not have any data associated with it.</span><span class="s3">\n    </span><span class="s1">const isOnDemandRevalidate =</span><span class="s3">\n      </span><span class="s1">previewProps &amp;&amp;</span><span class="s3">\n      </span><span class="s1">checkIsOnDemandRevalidate(req, previewProps).isOnDemandRevalidate</span><span class="s3">\n\n    </span><span class="s1">const cookieValue = cookies.get(COOKIE_NAME_PRERENDER_BYPASS)?.value</span><span class="s3">\n\n    </span><span class="s1">this._isEnabled = Boolean(</span><span class="s3">\n      </span><span class="s1">!isOnDemandRevalidate &amp;&amp;</span><span class="s3">\n        </span><span class="s1">cookieValue &amp;&amp;</span><span class="s3">\n        </span><span class="s1">previewProps &amp;&amp;</span><span class="s3">\n        </span><span class="s1">(cookieValue === previewProps.previewModeId ||</span><span class="s3">\n          </span><span class="s1">// In dev mode, the cookie can be actual hash value preview id but the preview props can still be `development-id`.</span><span class="s3">\n          </span><span class="s1">(process.env.NODE_ENV !== 'production' &amp;&amp;</span><span class="s3">\n            </span><span class="s1">previewProps.previewModeId === 'development-id'))</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">this._previewModeId = previewProps?.previewModeId</span><span class="s3">\n    </span><span class="s1">this._mutableCookies = mutableCookies</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">get isEnabled() {</span><span class="s3">\n    </span><span class="s1">return this._isEnabled</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">enable() {</span><span class="s3">\n    </span><span class="s1">if (!this._previewModeId) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'Invariant: previewProps missing previewModeId this should never happen'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">this._mutableCookies.set({</span><span class="s3">\n      </span><span class="s1">name: COOKIE_NAME_PRERENDER_BYPASS,</span><span class="s3">\n      </span><span class="s1">value: this._previewModeId,</span><span class="s3">\n      </span><span class="s1">httpOnly: true,</span><span class="s3">\n      </span><span class="s1">sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',</span><span class="s3">\n      </span><span class="s1">secure: process.env.NODE_ENV !== 'development',</span><span class="s3">\n      </span><span class="s1">path: '/',</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">this._isEnabled = true</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">disable() {</span><span class="s3">\n    </span><span class="s1">// To delete a cookie, set `expires` to a date in the past:</span><span class="s3">\n    </span><span class="s1">// https://tools.ietf.org/html/rfc6265#section-4.1.1</span><span class="s3">\n    </span><span class="s1">// `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.</span><span class="s3">\n    </span><span class="s1">this._mutableCookies.set({</span><span class="s3">\n      </span><span class="s1">name: COOKIE_NAME_PRERENDER_BYPASS,</span><span class="s3">\n      </span><span class="s1">value: '',</span><span class="s3">\n      </span><span class="s1">httpOnly: true,</span><span class="s3">\n      </span><span class="s1">sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',</span><span class="s3">\n      </span><span class="s1">secure: process.env.NODE_ENV !== 'development',</span><span class="s3">\n      </span><span class="s1">path: '/',</span><span class="s3">\n      </span><span class="s1">expires: new Date(0),</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">this._isEnabled = false</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;DraftModeProvider&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;previewProps&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;cookies&quot;</span><span class="s0">,</span><span class="s1">&quot;mutableCookies&quot;</span><span class="s0">,</span><span class="s1">&quot;isOnDemandRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;checkIsOnDemandRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;cookieValue&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;COOKIE_NAME_PRERENDER_BYPASS&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;_isEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;Boolean&quot;</span><span class="s0">,</span><span class="s1">&quot;previewModeId&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ENV&quot;</span><span class="s0">,</span><span class="s1">&quot;_previewModeId&quot;</span><span class="s0">,</span><span class="s1">&quot;_mutableCookies&quot;</span><span class="s0">,</span><span class="s1">&quot;isEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;enable&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;httpOnly&quot;</span><span class="s0">,</span><span class="s1">&quot;sameSite&quot;</span><span class="s0">,</span><span class="s1">&quot;secure&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;disable&quot;</span><span class="s0">,</span><span class="s1">&quot;expires&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAYaA;;;eAAAA;;;0BAHN;AAGA,MAAMA;IAgBXC,YACEC,YAA2C,EAC3CC,GAA6D,EAC7DC,OAA+B,EAC/BC,cAA+B,CAC/B;YAOoBD;QANpB,mEAAmE;QACnE,4DAA4D;QAC5D,MAAME,uBACJJ,gBACAK,IAAAA,mCAAyB,EAACJ,KAAKD,cAAcI,oBAAoB;QAEnE,MAAME,eAAcJ,eAAAA,QAAQK,GAAG,CAACC,sCAA4B,sBAAxCN,aAA2CO,KAAK;QAEpE,IAAI,CAACC,UAAU,GAAGC,QAChB,CAACP,wBACCE,eACAN,gBACCM,CAAAA,gBAAgBN,aAAaY,aAAa,IACzC,mHAAmH;QAClHC,QAAQC,GAAG,CAACC,QAAQ,KAAK,gBACxBf,aAAaY,aAAa,KAAK,gBAAgB;QAGvD,IAAI,CAACI,cAAc,GAAGhB,gCAAAA,aAAcY,aAAa;QACjD,IAAI,CAACK,eAAe,GAAGd;IACzB;IAEA,IAAIe,YAAY;QACd,OAAO,IAAI,CAACR,UAAU;IACxB;IAEAS,SAAS;QACP,IAAI,CAAC,IAAI,CAACH,cAAc,EAAE;YACxB,MAAM,qBAEL,CAFK,IAAII,MACR,2EADI,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;QAEA,IAAI,CAACH,eAAe,CAACI,GAAG,CAAC;YACvBC,MAAMd,sCAA4B;YAClCC,OAAO,IAAI,CAACO,cAAc;YAC1BO,UAAU;YACVC,UAAUX,QAAQC,GAAG,CAACC,QAAQ,KAAK,gBAAgB,SAAS;YAC5DU,QAAQZ,QAAQC,GAAG,CAACC,QAAQ,KAAK;YACjCW,MAAM;QACR;QAEA,IAAI,CAAChB,UAAU,GAAG;IACpB;IAEAiB,UAAU;QACR,2DAA2D;QAC3D,oDAAoD;QACpD,wEAAwE;QACxE,IAAI,CAACV,eAAe,CAACI,GAAG,CAAC;YACvBC,MAAMd,sCAA4B;YAClCC,OAAO;YACPc,UAAU;YACVC,UAAUX,QAAQC,GAAG,CAACC,QAAQ,KAAK,gBAAgB,SAAS;YAC5DU,QAAQZ,QAAQC,GAAG,CAACC,QAAQ,KAAK;YACjCW,MAAM;YACNE,SAAS,IAAIC,KAAK;QACpB;QAEA,IAAI,CAACnB,UAAU,GAAG;IACpB;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>