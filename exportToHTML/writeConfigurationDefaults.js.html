<html>
<head>
<title>writeConfigurationDefaults.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
writeConfigurationDefaults.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s3">0 </span><span class="s1">&amp;&amp; (module.exports = {</span>
    <span class="s1">getRequiredConfiguration: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s1">writeConfigurationDefaults: </span><span class="s2">null</span>
<span class="s1">});</span>
<span class="s2">function </span><span class="s1">_export(target, all) {</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">name </span><span class="s2">in </span><span class="s1">all)Object.defineProperty(target, name, {</span>
        <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
        <span class="s1">get: all[name]</span>
    <span class="s1">});</span>
<span class="s1">}</span>
<span class="s1">_export(exports, {</span>
    <span class="s1">getRequiredConfiguration: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">getRequiredConfiguration;</span>
    <span class="s1">},</span>
    <span class="s1">writeConfigurationDefaults: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">writeConfigurationDefaults;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_fs = require(</span><span class="s0">&quot;fs&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_picocolors = require(</span><span class="s0">&quot;../picocolors&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_commentjson = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_wildcard(require(</span><span class="s0">&quot;next/dist/compiled/comment-json&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_semver = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;next/dist/compiled/semver&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_os = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;os&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_getTypeScriptConfiguration = require(</span><span class="s0">&quot;./getTypeScriptConfiguration&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_log = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_wildcard(require(</span><span class="s0">&quot;../../build/output/log&quot;</span><span class="s1">));</span>
<span class="s2">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s2">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_getRequireWildcardCache(nodeInterop) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">WeakMap !== </span><span class="s0">&quot;function&quot;</span><span class="s1">) </span><span class="s2">return null</span><span class="s1">;</span>
    <span class="s2">var </span><span class="s1">cacheBabelInterop = </span><span class="s2">new </span><span class="s1">WeakMap();</span>
    <span class="s2">var </span><span class="s1">cacheNodeInterop = </span><span class="s2">new </span><span class="s1">WeakMap();</span>
    <span class="s2">return </span><span class="s1">(_getRequireWildcardCache = </span><span class="s2">function</span><span class="s1">(nodeInterop) {</span>
        <span class="s2">return </span><span class="s1">nodeInterop ? cacheNodeInterop : cacheBabelInterop;</span>
    <span class="s1">})(nodeInterop);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_interop_require_wildcard(obj, nodeInterop) {</span>
    <span class="s2">if </span><span class="s1">(!nodeInterop &amp;&amp; obj &amp;&amp; obj.__esModule) {</span>
        <span class="s2">return </span><span class="s1">obj;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(obj === </span><span class="s2">null </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s1">obj !== </span><span class="s0">&quot;object&quot; </span><span class="s1">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">obj !== </span><span class="s0">&quot;function&quot;</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">{</span>
            <span class="s2">default</span><span class="s1">: obj</span>
        <span class="s1">};</span>
    <span class="s1">}</span>
    <span class="s2">var </span><span class="s1">cache = _getRequireWildcardCache(nodeInterop);</span>
    <span class="s2">if </span><span class="s1">(cache &amp;&amp; cache.has(obj)) {</span>
        <span class="s2">return </span><span class="s1">cache.get(obj);</span>
    <span class="s1">}</span>
    <span class="s2">var </span><span class="s1">newObj = {</span>
        <span class="s1">__proto__: </span><span class="s2">null</span>
    <span class="s1">};</span>
    <span class="s2">var </span><span class="s1">hasPropertyDescriptor = Object.defineProperty &amp;&amp; Object.getOwnPropertyDescriptor;</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">key </span><span class="s2">in </span><span class="s1">obj){</span>
        <span class="s2">if </span><span class="s1">(key !== </span><span class="s0">&quot;default&quot; </span><span class="s1">&amp;&amp; Object.prototype.hasOwnProperty.call(obj, key)) {</span>
            <span class="s2">var </span><span class="s1">desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : </span><span class="s2">null</span><span class="s1">;</span>
            <span class="s2">if </span><span class="s1">(desc &amp;&amp; (desc.get || desc.set)) {</span>
                <span class="s1">Object.defineProperty(newObj, key, desc);</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                <span class="s1">newObj[key] = obj[key];</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s1">newObj.default = obj;</span>
    <span class="s2">if </span><span class="s1">(cache) {</span>
        <span class="s1">cache.set(obj, newObj);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">newObj;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">getDesiredCompilerOptions(ts, tsOptions) {</span>
    <span class="s2">const </span><span class="s1">o = {</span>
        <span class="s1">target: {</span>
            <span class="s1">suggested: </span><span class="s0">'ES2017'</span><span class="s1">,</span>
            <span class="s1">reason: </span><span class="s0">'For top-level `await`. Note: Next.js only polyfills for the esmodules target.'</span>
        <span class="s1">},</span>
        <span class="s4">// These are suggested values and will be set when not present in the</span>
        <span class="s4">// tsconfig.json</span>
        <span class="s1">lib: {</span>
            <span class="s1">suggested: [</span>
                <span class="s0">'dom'</span><span class="s1">,</span>
                <span class="s0">'dom.iterable'</span><span class="s1">,</span>
                <span class="s0">'esnext'</span>
            <span class="s1">]</span>
        <span class="s1">},</span>
        <span class="s1">allowJs: {</span>
            <span class="s1">suggested: </span><span class="s2">true</span>
        <span class="s1">},</span>
        <span class="s1">skipLibCheck: {</span>
            <span class="s1">suggested: </span><span class="s2">true</span>
        <span class="s1">},</span>
        <span class="s1">strict: {</span>
            <span class="s1">suggested: </span><span class="s2">false</span>
        <span class="s1">},</span>
        <span class="s1">..._semver.default.lt(ts.version, </span><span class="s0">'5.0.0'</span><span class="s1">) ? {</span>
            <span class="s1">forceConsistentCasingInFileNames: {</span>
                <span class="s1">suggested: </span><span class="s2">true</span>
            <span class="s1">}</span>
        <span class="s1">} : undefined,</span>
        <span class="s1">noEmit: {</span>
            <span class="s1">suggested: </span><span class="s2">true</span>
        <span class="s1">},</span>
        <span class="s1">..._semver.default.gte(ts.version, </span><span class="s0">'4.4.2'</span><span class="s1">) ? {</span>
            <span class="s1">incremental: {</span>
                <span class="s1">suggested: </span><span class="s2">true</span>
            <span class="s1">}</span>
        <span class="s1">} : undefined,</span>
        <span class="s4">// These values are required and cannot be changed by the user</span>
        <span class="s4">// Keep this in sync with the webpack config</span>
        <span class="s4">// 'parsedValue' matches the output value from ts.parseJsonConfigFileContent()</span>
        <span class="s1">module: {</span>
            <span class="s1">parsedValue: ts.ModuleKind.ESNext,</span>
            <span class="s4">// All of these values work:</span>
            <span class="s1">parsedValues: [</span>
                <span class="s1">_semver.default.gte(ts.version, </span><span class="s0">'5.4.0'</span><span class="s1">) &amp;&amp; ts.ModuleKind.Preserve,</span>
                <span class="s1">ts.ModuleKind.ES2020,</span>
                <span class="s1">ts.ModuleKind.ESNext,</span>
                <span class="s1">ts.ModuleKind.CommonJS,</span>
                <span class="s1">ts.ModuleKind.AMD,</span>
                <span class="s1">ts.ModuleKind.NodeNext,</span>
                <span class="s1">ts.ModuleKind.Node16</span>
            <span class="s1">],</span>
            <span class="s1">value: </span><span class="s0">'esnext'</span><span class="s1">,</span>
            <span class="s1">reason: </span><span class="s0">'for dynamic import() support'</span>
        <span class="s1">},</span>
        <span class="s4">// TODO: Semver check not needed once Next.js repo uses 5.4.</span>
        <span class="s1">..._semver.default.gte(ts.version, </span><span class="s0">'5.4.0'</span><span class="s1">) &amp;&amp; (tsOptions == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: tsOptions.module) === ts.ModuleKind.Preserve ? {</span>
        <span class="s1">} : {</span>
            <span class="s1">esModuleInterop: {</span>
                <span class="s1">value: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">reason: </span><span class="s0">'requirement for SWC / babel'</span>
            <span class="s1">},</span>
            <span class="s1">moduleResolution: {</span>
                <span class="s4">// In TypeScript 5.0, `NodeJs` has renamed to `Node10`</span>
                <span class="s1">parsedValue: ts.ModuleResolutionKind.Bundler ?? ts.ModuleResolutionKind.NodeNext ?? ts.ModuleResolutionKind.Node10 ?? ts.ModuleResolutionKind.NodeJs,</span>
                <span class="s4">// All of these values work:</span>
                <span class="s1">parsedValues: [</span>
                    <span class="s1">ts.ModuleResolutionKind.Node10 ?? ts.ModuleResolutionKind.NodeJs,</span>
                    <span class="s4">// only newer TypeScript versions have this field, it</span>
                    <span class="s4">// will be filtered for new versions of TypeScript</span>
                    <span class="s1">ts.ModuleResolutionKind.Node12,</span>
                    <span class="s1">ts.ModuleResolutionKind.Node16,</span>
                    <span class="s1">ts.ModuleResolutionKind.NodeNext,</span>
                    <span class="s1">ts.ModuleResolutionKind.Bundler</span>
                <span class="s1">].filter((val)=&gt;</span><span class="s2">typeof </span><span class="s1">val !== </span><span class="s0">'undefined'</span><span class="s1">),</span>
                <span class="s1">value: </span><span class="s0">'node'</span><span class="s1">,</span>
                <span class="s1">reason: </span><span class="s0">'to match webpack resolution'</span>
            <span class="s1">},</span>
            <span class="s1">resolveJsonModule: {</span>
                <span class="s1">value: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">reason: </span><span class="s0">'to match webpack resolution'</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">...(tsOptions == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: tsOptions.verbatimModuleSyntax) === </span><span class="s2">true </span><span class="s1">? undefined : {</span>
            <span class="s1">isolatedModules: {</span>
                <span class="s1">value: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">reason: </span><span class="s0">'requirement for SWC / Babel'</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">jsx: {</span>
            <span class="s1">parsedValue: ts.JsxEmit.Preserve,</span>
            <span class="s1">value: </span><span class="s0">'preserve'</span><span class="s1">,</span>
            <span class="s1">reason: </span><span class="s0">'next.js implements its own optimized jsx transform'</span>
        <span class="s1">}</span>
    <span class="s1">};</span>
    <span class="s2">return </span><span class="s1">o;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">getRequiredConfiguration(ts) {</span>
    <span class="s2">const </span><span class="s1">res = {};</span>
    <span class="s2">const </span><span class="s1">desiredCompilerOptions = getDesiredCompilerOptions(ts);</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">optionKey of Object.keys(desiredCompilerOptions)){</span>
        <span class="s2">const </span><span class="s1">ev = desiredCompilerOptions[optionKey];</span>
        <span class="s2">if </span><span class="s1">(!(</span><span class="s0">'value' </span><span class="s2">in </span><span class="s1">ev)) {</span>
            <span class="s2">continue</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s1">res[optionKey] = ev.parsedValue ?? ev.value;</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">res;</span>
<span class="s1">}</span>
<span class="s2">const </span><span class="s1">localDevTestFilesExcludeAction = </span><span class="s0">'NEXT_PRIVATE_LOCAL_DEV_TEST_FILES_EXCLUDE'</span><span class="s1">;</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">writeConfigurationDefaults(ts, tsConfigPath, isFirstTimeSetup, hasAppDir, distDir, hasPagesDir) {</span>
    <span class="s2">var </span><span class="s1">_userTsConfig_compilerOptions;</span>
    <span class="s2">if </span><span class="s1">(isFirstTimeSetup) {</span>
        <span class="s2">await </span><span class="s1">_fs.promises.writeFile(tsConfigPath, </span><span class="s0">'{}' </span><span class="s1">+ _os.default.EOL);</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">{ options: tsOptions, raw: rawConfig } = </span><span class="s2">await </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _getTypeScriptConfiguration.getTypeScriptConfiguration)(ts, tsConfigPath, </span><span class="s2">true</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">userTsConfigContent = </span><span class="s2">await </span><span class="s1">_fs.promises.readFile(tsConfigPath, {</span>
        <span class="s1">encoding: </span><span class="s0">'utf8'</span>
    <span class="s1">});</span>
    <span class="s2">const </span><span class="s1">userTsConfig = _commentjson.parse(userTsConfigContent);</span>
    <span class="s2">if </span><span class="s1">(userTsConfig.compilerOptions == </span><span class="s2">null </span><span class="s1">&amp;&amp; !(</span><span class="s0">'extends' </span><span class="s2">in </span><span class="s1">rawConfig)) {</span>
        <span class="s1">userTsConfig.compilerOptions = {};</span>
        <span class="s1">isFirstTimeSetup = </span><span class="s2">true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">desiredCompilerOptions = getDesiredCompilerOptions(ts, tsOptions);</span>
    <span class="s2">const </span><span class="s1">suggestedActions = [];</span>
    <span class="s2">const </span><span class="s1">requiredActions = [];</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">optionKey of Object.keys(desiredCompilerOptions)){</span>
        <span class="s2">const </span><span class="s1">check = desiredCompilerOptions[optionKey];</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">'suggested' </span><span class="s2">in </span><span class="s1">check) {</span>
            <span class="s2">if </span><span class="s1">(!(optionKey </span><span class="s2">in </span><span class="s1">tsOptions)) {</span>
                <span class="s2">if </span><span class="s1">(!userTsConfig.compilerOptions) {</span>
                    <span class="s1">userTsConfig.compilerOptions = {};</span>
                <span class="s1">}</span>
                <span class="s1">userTsConfig.compilerOptions[optionKey] = check.suggested;</span>
                <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(optionKey) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(check.suggested) + (check.reason ? </span><span class="s0">` (</span><span class="s1">${check.reason}</span><span class="s0">)` </span><span class="s1">: </span><span class="s0">''</span><span class="s1">));</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s0">'value' </span><span class="s2">in </span><span class="s1">check) {</span>
            <span class="s2">var </span><span class="s1">_check_parsedValues;</span>
            <span class="s2">const </span><span class="s1">ev = tsOptions[optionKey];</span>
            <span class="s2">if </span><span class="s1">(!(</span><span class="s0">'parsedValues' </span><span class="s2">in </span><span class="s1">check ? (_check_parsedValues = check.parsedValues) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _check_parsedValues.includes(ev) : </span><span class="s0">'parsedValue' </span><span class="s2">in </span><span class="s1">check ? check.parsedValue === ev : check.value === ev)) {</span>
                <span class="s2">if </span><span class="s1">(!userTsConfig.compilerOptions) {</span>
                    <span class="s1">userTsConfig.compilerOptions = {};</span>
                <span class="s1">}</span>
                <span class="s1">userTsConfig.compilerOptions[optionKey] = check.value;</span>
                <span class="s1">requiredActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(optionKey) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(check.value) + </span><span class="s0">` (</span><span class="s1">${check.reason}</span><span class="s0">)`</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s4">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span>
            <span class="s2">const </span><span class="s1">_ = check;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">nextAppTypes = </span><span class="s0">`</span><span class="s1">${distDir}</span><span class="s0">/types/**/*.ts`</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(!(</span><span class="s0">'include' </span><span class="s2">in </span><span class="s1">rawConfig)) {</span>
        <span class="s1">userTsConfig.include = hasAppDir ? [</span>
            <span class="s0">'next-env.d.ts'</span><span class="s1">,</span>
            <span class="s1">nextAppTypes,</span>
            <span class="s0">'**/*.ts'</span><span class="s1">,</span>
            <span class="s0">'**/*.tsx'</span>
        <span class="s1">] : [</span>
            <span class="s0">'next-env.d.ts'</span><span class="s1">,</span>
            <span class="s0">'**/*.ts'</span><span class="s1">,</span>
            <span class="s0">'**/*.tsx'</span>
        <span class="s1">];</span>
        <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'include'</span><span class="s1">) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(hasAppDir ? </span><span class="s0">`['next-env.d.ts', '</span><span class="s1">${nextAppTypes}</span><span class="s0">', '**/*.ts', '**/*.tsx']` </span><span class="s1">: </span><span class="s0">`['next-env.d.ts', '**/*.ts', '**/*.tsx']`</span><span class="s1">));</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(hasAppDir &amp;&amp; !rawConfig.include.includes(nextAppTypes)) {</span>
        <span class="s2">if </span><span class="s1">(!Array.isArray(userTsConfig.include)) {</span>
            <span class="s1">userTsConfig.include = [];</span>
        <span class="s1">}</span>
        <span class="s4">// rawConfig will resolve all extends and include paths (ex: tsconfig.json, tsconfig.base.json, etc.)</span>
        <span class="s4">// if it doesn't match userTsConfig then update the userTsConfig to add the</span>
        <span class="s4">// rawConfig's includes in addition to nextAppTypes</span>
        <span class="s2">if </span><span class="s1">(rawConfig.include.length !== userTsConfig.include.length || JSON.stringify(rawConfig.include.sort()) !== JSON.stringify(userTsConfig.include.sort())) {</span>
            <span class="s1">userTsConfig.include.push(...rawConfig.include, nextAppTypes);</span>
            <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'include'</span><span class="s1">) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">`[</span><span class="s1">${[</span>
                <span class="s1">...rawConfig.include,</span>
                <span class="s1">nextAppTypes</span>
            <span class="s1">].map((i)=&gt;</span><span class="s0">`'</span><span class="s1">${i}</span><span class="s0">'`</span><span class="s1">).join(</span><span class="s0">', '</span><span class="s1">)}</span><span class="s0">]`</span><span class="s1">));</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">userTsConfig.include.push(nextAppTypes);</span>
            <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'include'</span><span class="s1">) + </span><span class="s0">' was updated to add ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">`'</span><span class="s1">${nextAppTypes}</span><span class="s0">'`</span><span class="s1">));</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s4">// Enable the Next.js typescript plugin.</span>
    <span class="s2">if </span><span class="s1">(hasAppDir) {</span>
        <span class="s4">// Check if the config or the resolved config has the plugin already.</span>
        <span class="s2">const </span><span class="s1">plugins = [</span>
            <span class="s1">...Array.isArray(tsOptions.plugins) ? tsOptions.plugins : [],</span>
            <span class="s1">...userTsConfig.compilerOptions &amp;&amp; Array.isArray(userTsConfig.compilerOptions.plugins) ? userTsConfig.compilerOptions.plugins : []</span>
        <span class="s1">];</span>
        <span class="s2">const </span><span class="s1">hasNextPlugin = plugins.some(({ name })=&gt;name === </span><span class="s0">'next'</span><span class="s1">);</span>
        <span class="s4">// If the TS config extends on another config, we can't add the `plugin` field</span>
        <span class="s4">// because that will override the parent config's plugins.</span>
        <span class="s4">// Instead we have to show a message to the user to add the plugin manually.</span>
        <span class="s2">if </span><span class="s1">(!userTsConfig.compilerOptions || plugins.length &amp;&amp; !hasNextPlugin &amp;&amp; </span><span class="s0">'extends' </span><span class="s2">in </span><span class="s1">rawConfig &amp;&amp; (!rawConfig.compilerOptions || !rawConfig.compilerOptions.plugins)) {</span>
            <span class="s1">_log.info(</span><span class="s0">`</span><span class="s5">\n</span><span class="s0">Your </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">'tsconfig.json'</span><span class="s1">)} </span><span class="s0">extends another configuration, which means we cannot add the Next.js TypeScript plugin automatically. To improve your development experience, we recommend adding the Next.js plugin (</span><span class="s5">\`</span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'&quot;plugins&quot;: [{ &quot;name&quot;: &quot;next&quot; }]'</span><span class="s1">)}</span><span class="s5">\`</span><span class="s0">) manually to your TypeScript configuration. Learn more: https://nextjs.org/docs/app/api-reference/config/typescript#the-typescript-plugin</span><span class="s5">\n</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(!hasNextPlugin) {</span>
            <span class="s2">if </span><span class="s1">(!(</span><span class="s0">'plugins' </span><span class="s2">in </span><span class="s1">userTsConfig.compilerOptions)) {</span>
                <span class="s1">userTsConfig.compilerOptions.plugins = [];</span>
            <span class="s1">}</span>
            <span class="s1">userTsConfig.compilerOptions.plugins.push({</span>
                <span class="s1">name: </span><span class="s0">'next'</span>
            <span class="s1">});</span>
            <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'plugins'</span><span class="s1">) + </span><span class="s0">' was updated to add ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">`{ name: 'next' }`</span><span class="s1">));</span>
        <span class="s1">}</span>
        <span class="s4">// If `strict` is set to `false` and `strictNullChecks` is set to `false`,</span>
        <span class="s4">// then set `strictNullChecks` to `true`.</span>
        <span class="s2">if </span><span class="s1">(hasPagesDir &amp;&amp; hasAppDir &amp;&amp; !tsOptions.strict &amp;&amp; !(</span><span class="s0">'strictNullChecks' </span><span class="s2">in </span><span class="s1">tsOptions)) {</span>
            <span class="s1">userTsConfig.compilerOptions.strictNullChecks = </span><span class="s2">true</span><span class="s1">;</span>
            <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'strictNullChecks'</span><span class="s1">) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">`true`</span><span class="s1">));</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(!(</span><span class="s0">'exclude' </span><span class="s2">in </span><span class="s1">rawConfig)) {</span>
        <span class="s1">userTsConfig.exclude = [</span>
            <span class="s0">'node_modules'</span>
        <span class="s1">];</span>
        <span class="s1">suggestedActions.push((</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'exclude'</span><span class="s1">) + </span><span class="s0">' was set to ' </span><span class="s1">+ (</span><span class="s3">0</span><span class="s1">, _picocolors.bold)(</span><span class="s0">`['node_modules']`</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s4">// During local development inside Next.js repo, exclude the test files coverage by the local tsconfig</span>
    <span class="s2">if </span><span class="s1">(process.env.NEXT_PRIVATE_LOCAL_DEV &amp;&amp; userTsConfig.exclude) {</span>
        <span class="s2">const </span><span class="s1">tsGlob = </span><span class="s0">'**/*.test.ts'</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">tsxGlob = </span><span class="s0">'**/*.test.tsx'</span><span class="s1">;</span>
        <span class="s2">let </span><span class="s1">hasUpdates = </span><span class="s2">false</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(!userTsConfig.exclude.includes(tsGlob)) {</span>
            <span class="s1">userTsConfig.exclude.push(tsGlob);</span>
            <span class="s1">hasUpdates = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(!userTsConfig.exclude.includes(tsxGlob)) {</span>
            <span class="s1">userTsConfig.exclude.push(tsxGlob);</span>
            <span class="s1">hasUpdates = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(hasUpdates) {</span>
            <span class="s1">requiredActions.push(localDevTestFilesExcludeAction);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(suggestedActions.length &lt; </span><span class="s3">1 </span><span class="s1">&amp;&amp; requiredActions.length &lt; </span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">await </span><span class="s1">_fs.promises.writeFile(tsConfigPath, _commentjson.stringify(userTsConfig, </span><span class="s2">null</span><span class="s1">, </span><span class="s3">2</span><span class="s1">) + _os.default.EOL);</span>
    <span class="s1">_log.info(</span><span class="s0">''</span><span class="s1">);</span>
    <span class="s2">if </span><span class="s1">(isFirstTimeSetup) {</span>
        <span class="s1">_log.info(</span><span class="s0">`We detected TypeScript in your project and created a </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'tsconfig.json'</span><span class="s1">)} </span><span class="s0">file for you.`</span><span class="s1">);</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s1">_log.info(</span><span class="s0">`We detected TypeScript in your project and reconfigured your </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'tsconfig.json'</span><span class="s1">)} </span><span class="s0">file for you.</span><span class="s1">${((_userTsConfig_compilerOptions = userTsConfig.compilerOptions) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _userTsConfig_compilerOptions.strict) ? </span><span class="s0">'' </span><span class="s1">: </span><span class="s0">` Strict-mode is set to </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'false'</span><span class="s1">)} </span><span class="s0">by default.`</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s2">if </span><span class="s1">(suggestedActions.length) {</span>
        <span class="s1">_log.info(</span><span class="s0">`The following suggested values were added to your </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'tsconfig.json'</span><span class="s1">)}</span><span class="s0">. These values </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'can be changed'</span><span class="s1">)} </span><span class="s0">to fit your project's needs:</span><span class="s5">\n</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">suggestedActions.forEach((action)=&gt;_log.info(</span><span class="s0">`</span><span class="s5">\t</span><span class="s0">- </span><span class="s1">${action}</span><span class="s0">`</span><span class="s1">));</span>
        <span class="s1">_log.info(</span><span class="s0">''</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">requiredActionsToBeLogged = process.env.NEXT_PRIVATE_LOCAL_DEV ? requiredActions.filter((action)=&gt;action !== localDevTestFilesExcludeAction) : requiredActions;</span>
    <span class="s2">if </span><span class="s1">(requiredActionsToBeLogged.length) {</span>
        <span class="s1">_log.info(</span><span class="s0">`The following </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.white)(</span><span class="s0">'mandatory changes'</span><span class="s1">)} </span><span class="s0">were made to your </span><span class="s1">${(</span><span class="s3">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s0">'tsconfig.json'</span><span class="s1">)}</span><span class="s0">:</span><span class="s5">\n</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">requiredActionsToBeLogged.forEach((action)=&gt;_log.info(</span><span class="s0">`</span><span class="s5">\t</span><span class="s0">- </span><span class="s1">${action}</span><span class="s0">`</span><span class="s1">));</span>
        <span class="s1">_log.info(</span><span class="s0">''</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s4">//# sourceMappingURL=writeConfigurationDefaults.js.map</span></pre>
</body>
</html>