<html>
<head>
<title>size-rollup-motion-value.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #1750eb;}
.s3 { color: #067d17;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
size-rollup-motion-value.js</font>
</center></td></tr></table>
<pre><span class="s0">const </span><span class="s1">t={};</span><span class="s0">class </span><span class="s1">e{constructor(){</span><span class="s0">this</span><span class="s1">.subscriptions=[]}add(t){</span><span class="s0">var </span><span class="s1">e,s;</span><span class="s0">return </span><span class="s1">e=</span><span class="s0">this</span><span class="s1">.subscriptions,s=t,-</span><span class="s2">1</span><span class="s1">===e.indexOf(s)&amp;&amp;e.push(s),()=&gt;</span><span class="s0">function</span><span class="s1">(t,e){</span><span class="s0">const </span><span class="s1">s=t.indexOf(e);s&gt;-</span><span class="s2">1</span><span class="s1">&amp;&amp;t.splice(s,</span><span class="s2">1</span><span class="s1">)}(</span><span class="s0">this</span><span class="s1">.subscriptions,t)}notify(t,e,s){</span><span class="s0">const </span><span class="s1">i=</span><span class="s0">this</span><span class="s1">.subscriptions.length;</span><span class="s0">if</span><span class="s1">(i)</span><span class="s0">if</span><span class="s1">(</span><span class="s2">1</span><span class="s1">===i)</span><span class="s0">this</span><span class="s1">.subscriptions[</span><span class="s2">0</span><span class="s1">](t,e,s);</span><span class="s0">else for</span><span class="s1">(</span><span class="s0">let </span><span class="s1">n=</span><span class="s2">0</span><span class="s1">;n&lt;i;n++){</span><span class="s0">const </span><span class="s1">i=</span><span class="s0">this</span><span class="s1">.subscriptions[n];i&amp;&amp;i(t,e,s)}}getSize(){</span><span class="s0">return this</span><span class="s1">.subscriptions.length}clear(){</span><span class="s0">this</span><span class="s1">.subscriptions.length=</span><span class="s2">0</span><span class="s1">}}</span><span class="s0">const </span><span class="s1">s=[</span><span class="s3">&quot;setup&quot;</span><span class="s1">,</span><span class="s3">&quot;read&quot;</span><span class="s1">,</span><span class="s3">&quot;resolveKeyframes&quot;</span><span class="s1">,</span><span class="s3">&quot;preUpdate&quot;</span><span class="s1">,</span><span class="s3">&quot;update&quot;</span><span class="s1">,</span><span class="s3">&quot;preRender&quot;</span><span class="s1">,</span><span class="s3">&quot;render&quot;</span><span class="s1">,</span><span class="s3">&quot;postRender&quot;</span><span class="s1">],i={value:</span><span class="s0">null</span><span class="s1">,addProjectionMetrics:</span><span class="s0">null</span><span class="s1">};</span><span class="s0">function </span><span class="s1">n(e,n){</span><span class="s0">let </span><span class="s1">r=!</span><span class="s2">1</span><span class="s1">,a=!</span><span class="s2">0</span><span class="s1">;</span><span class="s0">const </span><span class="s1">o={delta:</span><span class="s2">0</span><span class="s1">,timestamp:</span><span class="s2">0</span><span class="s1">,isProcessing:!</span><span class="s2">1</span><span class="s1">},c=()=&gt;r=!</span><span class="s2">0</span><span class="s1">,h=s.reduce((t,e)=&gt;(t[e]=</span><span class="s0">function</span><span class="s1">(t,e){</span><span class="s0">let </span><span class="s1">s=</span><span class="s0">new </span><span class="s1">Set,n=</span><span class="s0">new </span><span class="s1">Set,r=!</span><span class="s2">1</span><span class="s1">,a=!</span><span class="s2">1</span><span class="s1">;</span><span class="s0">const </span><span class="s1">o=</span><span class="s0">new </span><span class="s1">WeakSet;</span><span class="s0">let </span><span class="s1">c={delta:</span><span class="s2">0</span><span class="s1">,timestamp:</span><span class="s2">0</span><span class="s1">,isProcessing:!</span><span class="s2">1</span><span class="s1">},h=</span><span class="s2">0</span><span class="s1">;</span><span class="s0">function </span><span class="s1">p(e){o.has(e)&amp;&amp;(d.schedule(e),t()),h++,e(c)}</span><span class="s0">const </span><span class="s1">d={schedule:(t,e=!</span><span class="s2">1</span><span class="s1">,i=!</span><span class="s2">1</span><span class="s1">)=&gt;{</span><span class="s0">const </span><span class="s1">a=i&amp;&amp;r?s:n;</span><span class="s0">return </span><span class="s1">e&amp;&amp;o.add(t),a.has(t)||a.add(t),t},cancel:t=&gt;{n.delete(t),o.delete(t)},process:t=&gt;{c=t,r?a=!</span><span class="s2">0</span><span class="s1">:(r=!</span><span class="s2">0</span><span class="s1">,[s,n]=[n,s],s.forEach(p),e&amp;&amp;i.value&amp;&amp;i.value.frameloop[e].push(h),h=</span><span class="s2">0</span><span class="s1">,s.clear(),r=!</span><span class="s2">1</span><span class="s1">,a&amp;&amp;(a=!</span><span class="s2">1</span><span class="s1">,d.process(t)))}};</span><span class="s0">return </span><span class="s1">d}(c,e),t),{}),{setup:p,read:d,resolveKeyframes:u,preUpdate:l,update:v,preRender:m,render:f,postRender:g}=h,y=()=&gt;{</span><span class="s0">const </span><span class="s1">s=t.useManualTiming?o.timestamp:performance.now();r=!</span><span class="s2">1</span><span class="s1">,t.useManualTiming||(o.delta=a?</span><span class="s2">1e3</span><span class="s1">/</span><span class="s2">60</span><span class="s1">:Math.max(Math.min(s-o.timestamp,</span><span class="s2">40</span><span class="s1">),</span><span class="s2">1</span><span class="s1">)),o.timestamp=s,o.isProcessing=!</span><span class="s2">0</span><span class="s1">,p.process(o),d.process(o),u.process(o),l.process(o),v.process(o),m.process(o),f.process(o),g.process(o),o.isProcessing=!</span><span class="s2">1</span><span class="s1">,r&amp;&amp;n&amp;&amp;(a=!</span><span class="s2">1</span><span class="s1">,e(y))};</span><span class="s0">return</span><span class="s1">{schedule:s.reduce((t,s)=&gt;{</span><span class="s0">const </span><span class="s1">i=h[s];</span><span class="s0">return </span><span class="s1">t[s]=(t,s=!</span><span class="s2">1</span><span class="s1">,n=!</span><span class="s2">1</span><span class="s1">)=&gt;(r||(r=!</span><span class="s2">0</span><span class="s1">,a=!</span><span class="s2">0</span><span class="s1">,o.isProcessing||e(y)),i.schedule(t,s,n)),t},{}),cancel:t=&gt;{</span><span class="s0">for</span><span class="s1">(</span><span class="s0">let </span><span class="s1">e=</span><span class="s2">0</span><span class="s1">;e&lt;s.length;e++)h[s[e]].cancel(t)},state:o,steps:h}}</span><span class="s0">const</span><span class="s1">{schedule:r,cancel:a,state:o,steps:c}=n(</span><span class="s3">&quot;undefined&quot;</span><span class="s1">!=</span><span class="s0">typeof </span><span class="s1">requestAnimationFrame?requestAnimationFrame:t=&gt;t,!</span><span class="s2">0</span><span class="s1">);</span><span class="s0">let </span><span class="s1">h;</span><span class="s0">function </span><span class="s1">p(){h=</span><span class="s0">void </span><span class="s2">0</span><span class="s1">}</span><span class="s0">const </span><span class="s1">d={now:()=&gt;(</span><span class="s0">void </span><span class="s2">0</span><span class="s1">===h&amp;&amp;d.set(o.isProcessing||t.useManualTiming?o.timestamp:performance.now()),h),set:t=&gt;{h=t,queueMicrotask(p)}},u={current:</span><span class="s0">void </span><span class="s2">0</span><span class="s1">};</span><span class="s0">class </span><span class="s1">l{constructor(t,e={}){</span><span class="s0">this</span><span class="s1">.canTrackVelocity=</span><span class="s0">null</span><span class="s1">,</span><span class="s0">this</span><span class="s1">.events={},</span><span class="s0">this</span><span class="s1">.updateAndNotify=t=&gt;{</span><span class="s0">const </span><span class="s1">e=d.now();</span><span class="s0">if</span><span class="s1">(</span><span class="s0">this</span><span class="s1">.updatedAt!==e&amp;&amp;</span><span class="s0">this</span><span class="s1">.setPrevFrameValue(),</span><span class="s0">this</span><span class="s1">.prev=</span><span class="s0">this</span><span class="s1">.current,</span><span class="s0">this</span><span class="s1">.setCurrent(t),</span><span class="s0">this</span><span class="s1">.current!==</span><span class="s0">this</span><span class="s1">.prev&amp;&amp;(</span><span class="s0">this</span><span class="s1">.events.change?.notify(</span><span class="s0">this</span><span class="s1">.current),</span><span class="s0">this</span><span class="s1">.dependents))</span><span class="s0">for</span><span class="s1">(</span><span class="s0">const </span><span class="s1">t of </span><span class="s0">this</span><span class="s1">.dependents)t.dirty()},</span><span class="s0">this</span><span class="s1">.hasAnimated=!</span><span class="s2">1</span><span class="s1">,</span><span class="s0">this</span><span class="s1">.setCurrent(t),</span><span class="s0">this</span><span class="s1">.owner=e.owner}setCurrent(t){</span><span class="s0">var </span><span class="s1">e;</span><span class="s0">this</span><span class="s1">.current=t,</span><span class="s0">this</span><span class="s1">.updatedAt=d.now(),</span><span class="s0">null</span><span class="s1">===</span><span class="s0">this</span><span class="s1">.canTrackVelocity&amp;&amp;</span><span class="s0">void </span><span class="s2">0</span><span class="s1">!==t&amp;&amp;(</span><span class="s0">this</span><span class="s1">.canTrackVelocity=(e=</span><span class="s0">this</span><span class="s1">.current,!isNaN(parseFloat(e))))}setPrevFrameValue(t=</span><span class="s0">this</span><span class="s1">.current){</span><span class="s0">this</span><span class="s1">.prevFrameValue=t,</span><span class="s0">this</span><span class="s1">.prevUpdatedAt=</span><span class="s0">this</span><span class="s1">.updatedAt}onChange(t){</span><span class="s0">return this</span><span class="s1">.on(</span><span class="s3">&quot;change&quot;</span><span class="s1">,t)}on(t,s){</span><span class="s0">this</span><span class="s1">.events[t]||(</span><span class="s0">this</span><span class="s1">.events[t]=</span><span class="s0">new </span><span class="s1">e);</span><span class="s0">const </span><span class="s1">i=</span><span class="s0">this</span><span class="s1">.events[t].add(s);</span><span class="s0">return</span><span class="s3">&quot;change&quot;</span><span class="s1">===t?()=&gt;{i(),r.read(()=&gt;{</span><span class="s0">this</span><span class="s1">.events.change.getSize()||</span><span class="s0">this</span><span class="s1">.stop()})}:i}clearListeners(){</span><span class="s0">for</span><span class="s1">(</span><span class="s0">const </span><span class="s1">t </span><span class="s0">in this</span><span class="s1">.events)</span><span class="s0">this</span><span class="s1">.events[t].clear()}attach(t,e){</span><span class="s0">this</span><span class="s1">.passiveEffect=t,</span><span class="s0">this</span><span class="s1">.stopPassiveEffect=e}set(t){</span><span class="s0">this</span><span class="s1">.passiveEffect?</span><span class="s0">this</span><span class="s1">.passiveEffect(t,</span><span class="s0">this</span><span class="s1">.updateAndNotify):</span><span class="s0">this</span><span class="s1">.updateAndNotify(t)}setWithVelocity(t,e,s){</span><span class="s0">this</span><span class="s1">.set(e),</span><span class="s0">this</span><span class="s1">.prev=</span><span class="s0">void </span><span class="s2">0</span><span class="s1">,</span><span class="s0">this</span><span class="s1">.prevFrameValue=t,</span><span class="s0">this</span><span class="s1">.prevUpdatedAt=</span><span class="s0">this</span><span class="s1">.updatedAt-s}jump(t,e=!</span><span class="s2">0</span><span class="s1">){</span><span class="s0">this</span><span class="s1">.updateAndNotify(t),</span><span class="s0">this</span><span class="s1">.prev=t,</span><span class="s0">this</span><span class="s1">.prevUpdatedAt=</span><span class="s0">this</span><span class="s1">.prevFrameValue=</span><span class="s0">void </span><span class="s2">0</span><span class="s1">,e&amp;&amp;</span><span class="s0">this</span><span class="s1">.stop(),</span><span class="s0">this</span><span class="s1">.stopPassiveEffect&amp;&amp;</span><span class="s0">this</span><span class="s1">.stopPassiveEffect()}dirty(){</span><span class="s0">this</span><span class="s1">.events.change?.notify(</span><span class="s0">this</span><span class="s1">.current)}addDependent(t){</span><span class="s0">this</span><span class="s1">.dependents||(</span><span class="s0">this</span><span class="s1">.dependents=</span><span class="s0">new </span><span class="s1">Set),</span><span class="s0">this</span><span class="s1">.dependents.add(t)}removeDependent(t){</span><span class="s0">this</span><span class="s1">.dependents&amp;&amp;</span><span class="s0">this</span><span class="s1">.dependents.delete(t)}get(){</span><span class="s0">return </span><span class="s1">u.current&amp;&amp;u.current.push(</span><span class="s0">this</span><span class="s1">),</span><span class="s0">this</span><span class="s1">.current}getPrevious(){</span><span class="s0">return this</span><span class="s1">.prev}getVelocity(){</span><span class="s0">const </span><span class="s1">t=d.now();</span><span class="s0">if</span><span class="s1">(!</span><span class="s0">this</span><span class="s1">.canTrackVelocity||</span><span class="s0">void </span><span class="s2">0</span><span class="s1">===</span><span class="s0">this</span><span class="s1">.prevFrameValue||t-</span><span class="s0">this</span><span class="s1">.updatedAt&gt;</span><span class="s2">30</span><span class="s1">)</span><span class="s0">return </span><span class="s2">0</span><span class="s1">;</span><span class="s0">const </span><span class="s1">e=Math.min(</span><span class="s0">this</span><span class="s1">.updatedAt-</span><span class="s0">this</span><span class="s1">.prevUpdatedAt,</span><span class="s2">30</span><span class="s1">);</span><span class="s0">return </span><span class="s1">s=parseFloat(</span><span class="s0">this</span><span class="s1">.current)-parseFloat(</span><span class="s0">this</span><span class="s1">.prevFrameValue),(i=e)?s*(</span><span class="s2">1e3</span><span class="s1">/i):</span><span class="s2">0</span><span class="s1">;</span><span class="s0">var </span><span class="s1">s,i}start(t){</span><span class="s0">return this</span><span class="s1">.stop(),</span><span class="s0">new </span><span class="s1">Promise(e=&gt;{</span><span class="s0">this</span><span class="s1">.hasAnimated=!</span><span class="s2">0</span><span class="s1">,</span><span class="s0">this</span><span class="s1">.animation=t(e),</span><span class="s0">this</span><span class="s1">.events.animationStart&amp;&amp;</span><span class="s0">this</span><span class="s1">.events.animationStart.notify()}).then(()=&gt;{</span><span class="s0">this</span><span class="s1">.events.animationComplete&amp;&amp;</span><span class="s0">this</span><span class="s1">.events.animationComplete.notify(),</span><span class="s0">this</span><span class="s1">.clearAnimation()})}stop(){</span><span class="s0">this</span><span class="s1">.animation&amp;&amp;(</span><span class="s0">this</span><span class="s1">.animation.stop(),</span><span class="s0">this</span><span class="s1">.events.animationCancel&amp;&amp;</span><span class="s0">this</span><span class="s1">.events.animationCancel.notify()),</span><span class="s0">this</span><span class="s1">.clearAnimation()}isAnimating(){</span><span class="s0">return</span><span class="s1">!!</span><span class="s0">this</span><span class="s1">.animation}clearAnimation(){</span><span class="s0">delete this</span><span class="s1">.animation}destroy(){</span><span class="s0">this</span><span class="s1">.dependents?.clear(),</span><span class="s0">this</span><span class="s1">.events.destroy?.notify(),</span><span class="s0">this</span><span class="s1">.clearListeners(),</span><span class="s0">this</span><span class="s1">.stop(),</span><span class="s0">this</span><span class="s1">.stopPassiveEffect&amp;&amp;</span><span class="s0">this</span><span class="s1">.stopPassiveEffect()}}</span><span class="s0">function </span><span class="s1">v(t,e){</span><span class="s0">return new </span><span class="s1">l(t,e)}</span><span class="s0">export</span><span class="s1">{l as MotionValue,u as collectMotionValues,v as motionValue};</span>
</pre>
</body>
</html>