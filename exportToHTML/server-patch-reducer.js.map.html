<html>
<head>
<title>server-patch-reducer.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
server-patch-reducer.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../../src/client/components/router-reducer/reducers/server-patch-reducer.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { createHrefFromUrl } from '../create-href-from-url'</span><span class="s3">\n</span><span class="s1">import { applyRouterStatePatchToTree } from '../apply-router-state-patch-to-tree'</span><span class="s3">\n</span><span class="s1">import { isNavigatingToNewRootLayout } from '../is-navigating-to-new-root-layout'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">ServerPatchAction,</span><span class="s3">\n  </span><span class="s1">ReducerState,</span><span class="s3">\n  </span><span class="s1">ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">Mutable,</span><span class="s3">\n</span><span class="s1">} from '../router-reducer-types'</span><span class="s3">\n</span><span class="s1">import { handleExternalUrl } from './navigate-reducer'</span><span class="s3">\n</span><span class="s1">import { applyFlightData } from '../apply-flight-data'</span><span class="s3">\n</span><span class="s1">import { handleMutable } from '../handle-mutable'</span><span class="s3">\n</span><span class="s1">import type { CacheNode } from '../../../../shared/lib/app-router-context.shared-runtime'</span><span class="s3">\n</span><span class="s1">import { createEmptyCacheNode } from '../../app-router'</span><span class="s3">\n\n</span><span class="s1">export function serverPatchReducer(</span><span class="s3">\n  </span><span class="s1">state: ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">action: ServerPatchAction</span><span class="s3">\n</span><span class="s1">): ReducerState {</span><span class="s3">\n  </span><span class="s1">const {</span><span class="s3">\n    </span><span class="s1">serverResponse: { flightData, canonicalUrl: canonicalUrlOverride },</span><span class="s3">\n    </span><span class="s1">navigatedAt,</span><span class="s3">\n  </span><span class="s1">} = action</span><span class="s3">\n\n  </span><span class="s1">const mutable: Mutable = {}</span><span class="s3">\n\n  </span><span class="s1">mutable.preserveCustomHistoryState = false</span><span class="s3">\n\n  </span><span class="s1">// Handle case when navigating to page in `pages` from `app`</span><span class="s3">\n  </span><span class="s1">if (typeof flightData === 'string') {</span><span class="s3">\n    </span><span class="s1">return handleExternalUrl(</span><span class="s3">\n      </span><span class="s1">state,</span><span class="s3">\n      </span><span class="s1">mutable,</span><span class="s3">\n      </span><span class="s1">flightData,</span><span class="s3">\n      </span><span class="s1">state.pushRef.pendingPush</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">let currentTree = state.tree</span><span class="s3">\n  </span><span class="s1">let currentCache = state.cache</span><span class="s3">\n\n  </span><span class="s1">for (const normalizedFlightData of flightData) {</span><span class="s3">\n    </span><span class="s1">const { segmentPath: flightSegmentPath, tree: treePatch } =</span><span class="s3">\n      </span><span class="s1">normalizedFlightData</span><span class="s3">\n\n    </span><span class="s1">const newTree = applyRouterStatePatchToTree(</span><span class="s3">\n      </span><span class="s1">// TODO-APP: remove ''</span><span class="s3">\n      </span><span class="s1">['', ...flightSegmentPath],</span><span class="s3">\n      </span><span class="s1">currentTree,</span><span class="s3">\n      </span><span class="s1">treePatch,</span><span class="s3">\n      </span><span class="s1">state.canonicalUrl</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">// `applyRouterStatePatchToTree` returns `null` when it determined that the server response is not applicable to the current tree.</span><span class="s3">\n    </span><span class="s1">// In other words, the server responded with a tree that doesn't match what the client is currently rendering.</span><span class="s3">\n    </span><span class="s1">// This can happen if the server patch action took longer to resolve than a subsequent navigation which would have changed the tree.</span><span class="s3">\n    </span><span class="s1">// Previously this case triggered an MPA navigation but it should be safe to simply discard the server response rather than forcing</span><span class="s3">\n    </span><span class="s1">// the entire page to reload.</span><span class="s3">\n    </span><span class="s1">if (newTree === null) {</span><span class="s3">\n      </span><span class="s1">return state</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (isNavigatingToNewRootLayout(currentTree, newTree)) {</span><span class="s3">\n      </span><span class="s1">return handleExternalUrl(</span><span class="s3">\n        </span><span class="s1">state,</span><span class="s3">\n        </span><span class="s1">mutable,</span><span class="s3">\n        </span><span class="s1">state.canonicalUrl,</span><span class="s3">\n        </span><span class="s1">state.pushRef.pendingPush</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const canonicalUrlOverrideHref = canonicalUrlOverride</span><span class="s3">\n      </span><span class="s1">? createHrefFromUrl(canonicalUrlOverride)</span><span class="s3">\n      </span><span class="s1">: undefined</span><span class="s3">\n\n    </span><span class="s1">if (canonicalUrlOverrideHref) {</span><span class="s3">\n      </span><span class="s1">mutable.canonicalUrl = canonicalUrlOverrideHref</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const cache: CacheNode = createEmptyCacheNode()</span><span class="s3">\n    </span><span class="s1">applyFlightData(navigatedAt, currentCache, cache, normalizedFlightData)</span><span class="s3">\n\n    </span><span class="s1">mutable.patchedTree = newTree</span><span class="s3">\n    </span><span class="s1">mutable.cache = cache</span><span class="s3">\n\n    </span><span class="s1">currentCache = cache</span><span class="s3">\n    </span><span class="s1">currentTree = newTree</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return handleMutable(state, mutable)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;serverPatchReducer&quot;</span><span class="s0">,</span><span class="s1">&quot;state&quot;</span><span class="s0">,</span><span class="s1">&quot;action&quot;</span><span class="s0">,</span><span class="s1">&quot;serverResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;flightData&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrlOverride&quot;</span><span class="s0">,</span><span class="s1">&quot;navigatedAt&quot;</span><span class="s0">,</span><span class="s1">&quot;mutable&quot;</span><span class="s0">,</span><span class="s1">&quot;preserveCustomHistoryState&quot;</span><span class="s0">,</span><span class="s1">&quot;handleExternalUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pushRef&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingPush&quot;</span><span class="s0">,</span><span class="s1">&quot;currentTree&quot;</span><span class="s0">,</span><span class="s1">&quot;tree&quot;</span><span class="s0">,</span><span class="s1">&quot;currentCache&quot;</span><span class="s0">,</span><span class="s1">&quot;cache&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizedFlightData&quot;</span><span class="s0">,</span><span class="s1">&quot;segmentPath&quot;</span><span class="s0">,</span><span class="s1">&quot;flightSegmentPath&quot;</span><span class="s0">,</span><span class="s1">&quot;treePatch&quot;</span><span class="s0">,</span><span class="s1">&quot;newTree&quot;</span><span class="s0">,</span><span class="s1">&quot;applyRouterStatePatchToTree&quot;</span><span class="s0">,</span><span class="s1">&quot;isNavigatingToNewRootLayout&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrlOverrideHref&quot;</span><span class="s0">,</span><span class="s1">&quot;createHrefFromUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;createEmptyCacheNode&quot;</span><span class="s0">,</span><span class="s1">&quot;applyFlightData&quot;</span><span class="s0">,</span><span class="s1">&quot;patchedTree&quot;</span><span class="s0">,</span><span class="s1">&quot;handleMutable&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAegBA;;;eAAAA;;;mCAfkB;6CACU;6CACA;iCAOV;iCACF;+BACF;2BAEO;AAE9B,SAASA,mBACdC,KAA2B,EAC3BC,MAAyB;IAEzB,MAAM,EACJC,gBAAgB,EAAEC,UAAU,EAAEC,cAAcC,oBAAoB,EAAE,EAClEC,WAAW,EACZ,GAAGL;IAEJ,MAAMM,UAAmB,CAAC;IAE1BA,QAAQC,0BAA0B,GAAG;IAErC,4DAA4D;IAC5D,IAAI,OAAOL,eAAe,UAAU;QAClC,OAAOM,IAAAA,kCAAiB,EACtBT,OACAO,SACAJ,YACAH,MAAMU,OAAO,CAACC,WAAW;IAE7B;IAEA,IAAIC,cAAcZ,MAAMa,IAAI;IAC5B,IAAIC,eAAed,MAAMe,KAAK;IAE9B,KAAK,MAAMC,wBAAwBb,WAAY;QAC7C,MAAM,EAAEc,aAAaC,iBAAiB,EAAEL,MAAMM,SAAS,EAAE,GACvDH;QAEF,MAAMI,UAAUC,IAAAA,wDAA2B,EACzC,sBAAsB;QACtB;YAAC;eAAOH;SAAkB,EAC1BN,aACAO,WACAnB,MAAMI,YAAY;QAGpB,kIAAkI;QAClI,8GAA8G;QAC9G,oIAAoI;QACpI,mIAAmI;QACnI,6BAA6B;QAC7B,IAAIgB,YAAY,MAAM;YACpB,OAAOpB;QACT;QAEA,IAAIsB,IAAAA,wDAA2B,EAACV,aAAaQ,UAAU;YACrD,OAAOX,IAAAA,kCAAiB,EACtBT,OACAO,SACAP,MAAMI,YAAY,EAClBJ,MAAMU,OAAO,CAACC,WAAW;QAE7B;QAEA,MAAMY,2BAA2BlB,uBAC7BmB,IAAAA,oCAAiB,EAACnB,wBAClBoB;QAEJ,IAAIF,0BAA0B;YAC5BhB,QAAQH,YAAY,GAAGmB;QACzB;QAEA,MAAMR,QAAmBW,IAAAA,+BAAoB;QAC7CC,IAAAA,gCAAe,EAACrB,aAAaQ,cAAcC,OAAOC;QAElDT,QAAQqB,WAAW,GAAGR;QACtBb,QAAQQ,KAAK,GAAGA;QAEhBD,eAAeC;QACfH,cAAcQ;IAChB;IAEA,OAAOS,IAAAA,4BAAa,EAAC7B,OAAOO;AAC9B&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>