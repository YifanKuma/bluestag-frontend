<html>
<head>
<title>mkdir.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mkdir.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">:</span><span class="s1">&quot;mkdir.js&quot;</span><span class="s0">,</span><span class="s1">&quot;sourceRoot&quot;</span><span class="s0">:</span><span class="s1">&quot;&quot;</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/mkdir.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { chownr, chownrSync } from 'chownr'</span><span class="s3">\n</span><span class="s1">import fs from 'node:fs'</span><span class="s3">\n</span><span class="s1">import fsp from 'node:fs/promises'</span><span class="s3">\n</span><span class="s1">import path from 'node:path'</span><span class="s3">\n</span><span class="s1">import { CwdError } from './cwd-error.js'</span><span class="s3">\n</span><span class="s1">import { normalizeWindowsPath } from './normalize-windows-path.js'</span><span class="s3">\n</span><span class="s1">import { SymlinkError } from './symlink-error.js'</span><span class="s3">\n\n</span><span class="s1">export type MkdirOptions = {</span><span class="s3">\n  </span><span class="s1">uid?: number</span><span class="s3">\n  </span><span class="s1">gid?: number</span><span class="s3">\n  </span><span class="s1">processUid?: number</span><span class="s3">\n  </span><span class="s1">processGid?: number</span><span class="s3">\n  </span><span class="s1">umask?: number</span><span class="s3">\n  </span><span class="s1">preserve: boolean</span><span class="s3">\n  </span><span class="s1">unlink: boolean</span><span class="s3">\n  </span><span class="s1">cwd: string</span><span class="s3">\n  </span><span class="s1">mode: number</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export type MkdirError =</span><span class="s3">\n  </span><span class="s1">| NodeJS.ErrnoException</span><span class="s3">\n  </span><span class="s1">| CwdError</span><span class="s3">\n  </span><span class="s1">| SymlinkError</span><span class="s3">\n\n</span><span class="s1">const checkCwd = (</span><span class="s3">\n  </span><span class="s1">dir: string,</span><span class="s3">\n  </span><span class="s1">cb: (er?: null | MkdirError) =&gt; any,</span><span class="s3">\n</span><span class="s1">) =&gt; {</span><span class="s3">\n  </span><span class="s1">fs.stat(dir, (er, st) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (er || !st.isDirectory()) {</span><span class="s3">\n      </span><span class="s1">er = new CwdError(</span><span class="s3">\n        </span><span class="s1">dir,</span><span class="s3">\n        </span><span class="s1">(er as NodeJS.ErrnoException)?.code || 'ENOTDIR',</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">cb(er)</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Wrapper around fs/promises.mkdir for tar's needs.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* The main purpose is to avoid creating directories if we know that</span><span class="s3">\n </span><span class="s1">* they already exist (and track which ones exist for this purpose),</span><span class="s3">\n </span><span class="s1">* and prevent entries from being extracted into symlinked folders,</span><span class="s3">\n </span><span class="s1">* if `preservePaths` is not set.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export const mkdir = (</span><span class="s3">\n  </span><span class="s1">dir: string,</span><span class="s3">\n  </span><span class="s1">opt: MkdirOptions,</span><span class="s3">\n  </span><span class="s1">cb: (er?: null | MkdirError, made?: string) =&gt; void,</span><span class="s3">\n</span><span class="s1">) =&gt; {</span><span class="s3">\n  </span><span class="s1">dir = normalizeWindowsPath(dir)</span><span class="s3">\n\n  </span><span class="s1">// if there's any overlap between mask and mode,</span><span class="s3">\n  </span><span class="s1">// then we'll need an explicit chmod</span><span class="s3">\n  </span><span class="s1">/* c8 ignore next */</span><span class="s3">\n  </span><span class="s1">const umask = opt.umask ?? 0o22</span><span class="s3">\n  </span><span class="s1">const mode = opt.mode | 0o0700</span><span class="s3">\n  </span><span class="s1">const needChmod = (mode &amp; umask) !== 0</span><span class="s3">\n\n  </span><span class="s1">const uid = opt.uid</span><span class="s3">\n  </span><span class="s1">const gid = opt.gid</span><span class="s3">\n  </span><span class="s1">const doChown =</span><span class="s3">\n    </span><span class="s1">typeof uid === 'number' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof gid === 'number' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">(uid !== opt.processUid || gid !== opt.processGid)</span><span class="s3">\n\n  </span><span class="s1">const preserve = opt.preserve</span><span class="s3">\n  </span><span class="s1">const unlink = opt.unlink</span><span class="s3">\n  </span><span class="s1">const cwd = normalizeWindowsPath(opt.cwd)</span><span class="s3">\n\n  </span><span class="s1">const done = (er?: null | MkdirError, created?: string) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (er) {</span><span class="s3">\n      </span><span class="s1">cb(er)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">if (created &amp;&amp; doChown) {</span><span class="s3">\n        </span><span class="s1">chownr(created, uid, gid, er =&gt;</span><span class="s3">\n          </span><span class="s1">done(er as NodeJS.ErrnoException),</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">} else if (needChmod) {</span><span class="s3">\n        </span><span class="s1">fs.chmod(dir, mode, cb)</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">cb()</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (dir === cwd) {</span><span class="s3">\n    </span><span class="s1">return checkCwd(dir, done)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (preserve) {</span><span class="s3">\n    </span><span class="s1">return fsp.mkdir(dir, { mode, recursive: true }).then(</span><span class="s3">\n      </span><span class="s1">made =&gt; done(null, made ?? undefined), // oh, ts</span><span class="s3">\n      </span><span class="s1">done,</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const sub = normalizeWindowsPath(path.relative(cwd, dir))</span><span class="s3">\n  </span><span class="s1">const parts = sub.split('/')</span><span class="s3">\n  </span><span class="s1">mkdir_(cwd, parts, mode, unlink, cwd, undefined, done)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const mkdir_ = (</span><span class="s3">\n  </span><span class="s1">base: string,</span><span class="s3">\n  </span><span class="s1">parts: string[],</span><span class="s3">\n  </span><span class="s1">mode: number,</span><span class="s3">\n  </span><span class="s1">unlink: boolean,</span><span class="s3">\n  </span><span class="s1">cwd: string,</span><span class="s3">\n  </span><span class="s1">created: string | undefined,</span><span class="s3">\n  </span><span class="s1">cb: (er?: null | MkdirError, made?: string) =&gt; void,</span><span class="s3">\n</span><span class="s1">): void =&gt; {</span><span class="s3">\n  </span><span class="s1">if (!parts.length) {</span><span class="s3">\n    </span><span class="s1">return cb(null, created)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const p = parts.shift()</span><span class="s3">\n  </span><span class="s1">const part = normalizeWindowsPath(path.resolve(base + '/' + p))</span><span class="s3">\n  </span><span class="s1">fs.mkdir(</span><span class="s3">\n    </span><span class="s1">part,</span><span class="s3">\n    </span><span class="s1">mode,</span><span class="s3">\n    </span><span class="s1">onmkdir(part, parts, mode, unlink, cwd, created, cb),</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const onmkdir =</span><span class="s3">\n  </span><span class="s1">(</span><span class="s3">\n    </span><span class="s1">part: string,</span><span class="s3">\n    </span><span class="s1">parts: string[],</span><span class="s3">\n    </span><span class="s1">mode: number,</span><span class="s3">\n    </span><span class="s1">unlink: boolean,</span><span class="s3">\n    </span><span class="s1">cwd: string,</span><span class="s3">\n    </span><span class="s1">created: string | undefined,</span><span class="s3">\n    </span><span class="s1">cb: (er?: null | MkdirError, made?: string) =&gt; void,</span><span class="s3">\n  </span><span class="s1">) =&gt;</span><span class="s3">\n  </span><span class="s1">(er?: null | NodeJS.ErrnoException) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (er) {</span><span class="s3">\n      </span><span class="s1">fs.lstat(part, (statEr, st) =&gt; {</span><span class="s3">\n        </span><span class="s1">if (statEr) {</span><span class="s3">\n          </span><span class="s1">statEr.path =</span><span class="s3">\n            </span><span class="s1">statEr.path &amp;&amp; normalizeWindowsPath(statEr.path)</span><span class="s3">\n          </span><span class="s1">cb(statEr)</span><span class="s3">\n        </span><span class="s1">} else if (st.isDirectory()) {</span><span class="s3">\n          </span><span class="s1">mkdir_(part, parts, mode, unlink, cwd, created, cb)</span><span class="s3">\n        </span><span class="s1">} else if (unlink) {</span><span class="s3">\n          </span><span class="s1">fs.unlink(part, er =&gt; {</span><span class="s3">\n            </span><span class="s1">if (er) {</span><span class="s3">\n              </span><span class="s1">return cb(er)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n            </span><span class="s1">fs.mkdir(</span><span class="s3">\n              </span><span class="s1">part,</span><span class="s3">\n              </span><span class="s1">mode,</span><span class="s3">\n              </span><span class="s1">onmkdir(</span><span class="s3">\n                </span><span class="s1">part,</span><span class="s3">\n                </span><span class="s1">parts,</span><span class="s3">\n                </span><span class="s1">mode,</span><span class="s3">\n                </span><span class="s1">unlink,</span><span class="s3">\n                </span><span class="s1">cwd,</span><span class="s3">\n                </span><span class="s1">created,</span><span class="s3">\n                </span><span class="s1">cb,</span><span class="s3">\n              </span><span class="s1">),</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">} else if (st.isSymbolicLink()) {</span><span class="s3">\n          </span><span class="s1">return cb(</span><span class="s3">\n            </span><span class="s1">new SymlinkError(part, part + '/' + parts.join('/')),</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">cb(er)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">created = created || part</span><span class="s3">\n      </span><span class="s1">mkdir_(part, parts, mode, unlink, cwd, created, cb)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const checkCwdSync = (dir: string) =&gt; {</span><span class="s3">\n  </span><span class="s1">let ok = false</span><span class="s3">\n  </span><span class="s1">let code: string | undefined = undefined</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">ok = fs.statSync(dir).isDirectory()</span><span class="s3">\n  </span><span class="s1">} catch (er) {</span><span class="s3">\n    </span><span class="s1">code = (er as NodeJS.ErrnoException)?.code</span><span class="s3">\n  </span><span class="s1">} finally {</span><span class="s3">\n    </span><span class="s1">if (!ok) {</span><span class="s3">\n      </span><span class="s1">throw new CwdError(dir, code ?? 'ENOTDIR')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export const mkdirSync = (dir: string, opt: MkdirOptions) =&gt; {</span><span class="s3">\n  </span><span class="s1">dir = normalizeWindowsPath(dir)</span><span class="s3">\n  </span><span class="s1">// if there's any overlap between mask and mode,</span><span class="s3">\n  </span><span class="s1">// then we'll need an explicit chmod</span><span class="s3">\n  </span><span class="s1">/* c8 ignore next */</span><span class="s3">\n  </span><span class="s1">const umask = opt.umask ?? 0o22</span><span class="s3">\n  </span><span class="s1">const mode = opt.mode | 0o700</span><span class="s3">\n  </span><span class="s1">const needChmod = (mode &amp; umask) !== 0</span><span class="s3">\n\n  </span><span class="s1">const uid = opt.uid</span><span class="s3">\n  </span><span class="s1">const gid = opt.gid</span><span class="s3">\n  </span><span class="s1">const doChown =</span><span class="s3">\n    </span><span class="s1">typeof uid === 'number' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof gid === 'number' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">(uid !== opt.processUid || gid !== opt.processGid)</span><span class="s3">\n\n  </span><span class="s1">const preserve = opt.preserve</span><span class="s3">\n  </span><span class="s1">const unlink = opt.unlink</span><span class="s3">\n  </span><span class="s1">const cwd = normalizeWindowsPath(opt.cwd)</span><span class="s3">\n\n  </span><span class="s1">const done = (created?: string | undefined) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (created &amp;&amp; doChown) {</span><span class="s3">\n      </span><span class="s1">chownrSync(created, uid, gid)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (needChmod) {</span><span class="s3">\n      </span><span class="s1">fs.chmodSync(dir, mode)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (dir === cwd) {</span><span class="s3">\n    </span><span class="s1">checkCwdSync(cwd)</span><span class="s3">\n    </span><span class="s1">return done()</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (preserve) {</span><span class="s3">\n    </span><span class="s1">return done(fs.mkdirSync(dir, { mode, recursive: true }) ?? undefined)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const sub = normalizeWindowsPath(path.relative(cwd, dir))</span><span class="s3">\n  </span><span class="s1">const parts = sub.split('/')</span><span class="s3">\n  </span><span class="s1">let created: string | undefined = undefined</span><span class="s3">\n  </span><span class="s1">for (</span><span class="s3">\n    </span><span class="s1">let p = parts.shift(), part = cwd;</span><span class="s3">\n    </span><span class="s1">p &amp;&amp; (part += '/' + p);</span><span class="s3">\n    </span><span class="s1">p = parts.shift()</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">part = normalizeWindowsPath(path.resolve(part))</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">fs.mkdirSync(part, mode)</span><span class="s3">\n      </span><span class="s1">created = created || part</span><span class="s3">\n    </span><span class="s1">} catch (er) {</span><span class="s3">\n      </span><span class="s1">const st = fs.lstatSync(part)</span><span class="s3">\n      </span><span class="s1">if (st.isDirectory()) {</span><span class="s3">\n        </span><span class="s1">continue</span><span class="s3">\n      </span><span class="s1">} else if (unlink) {</span><span class="s3">\n        </span><span class="s1">fs.unlinkSync(part)</span><span class="s3">\n        </span><span class="s1">fs.mkdirSync(part, mode)</span><span class="s3">\n        </span><span class="s1">created = created || part</span><span class="s3">\n        </span><span class="s1">continue</span><span class="s3">\n      </span><span class="s1">} else if (st.isSymbolicLink()) {</span><span class="s3">\n        </span><span class="s1">return new SymlinkError(part, part + '/' + parts.join('/'))</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return done(created)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">]}</span></pre>
</body>
</html>