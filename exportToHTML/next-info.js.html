<html>
<head>
<title>next-info.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #0033b3;}
.s4 { color: #1750eb;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
next-info.js</font>
</center></td></tr></table>
<pre><span class="s0">#!/usr/bin/env node</span>
<span class="s2">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s2">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s3">true</span>
<span class="s1">});</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s2">&quot;nextInfo&quot;</span><span class="s1">, {</span>
    <span class="s1">enumerable: </span><span class="s3">true</span><span class="s1">,</span>
    <span class="s1">get: </span><span class="s3">function</span><span class="s1">() {</span>
        <span class="s3">return </span><span class="s1">nextInfo;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s3">const </span><span class="s1">_os = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s2">&quot;os&quot;</span><span class="s1">));</span>
<span class="s3">const </span><span class="s1">_child_process = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s2">&quot;child_process&quot;</span><span class="s1">));</span>
<span class="s3">const </span><span class="s1">_picocolors = require(</span><span class="s2">&quot;../lib/picocolors&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_constants = require(</span><span class="s2">&quot;../shared/lib/constants&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_config = </span><span class="s0">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s2">&quot;../server/config&quot;</span><span class="s1">));</span>
<span class="s3">const </span><span class="s1">_getregistry = require(</span><span class="s2">&quot;../lib/helpers/get-registry&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_parseversioninfo = require(</span><span class="s2">&quot;../server/dev/parse-version-info&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_versionstaleness = require(</span><span class="s2">&quot;../next-devtools/shared/version-staleness&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">_log = require(</span><span class="s2">&quot;../build/output/log&quot;</span><span class="s1">);</span>
<span class="s3">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s3">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s3">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s3">function </span><span class="s1">getPackageVersion(packageName) {</span>
    <span class="s3">try </span><span class="s1">{</span>
        <span class="s3">return </span><span class="s1">require(</span><span class="s2">`</span><span class="s1">${packageName}</span><span class="s2">/package.json`</span><span class="s1">).version;</span>
    <span class="s1">} </span><span class="s3">catch  </span><span class="s1">{</span>
        <span class="s3">return </span><span class="s2">'N/A'</span><span class="s1">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s3">function </span><span class="s1">getNextConfig() {</span>
    <span class="s3">var </span><span class="s1">_config_experimental;</span>
    <span class="s3">const </span><span class="s1">config = </span><span class="s3">await </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, _config.default)(_constants.PHASE_INFO, process.cwd());</span>
    <span class="s3">return </span><span class="s1">{</span>
        <span class="s1">output: config.output ?? </span><span class="s2">'N/A'</span><span class="s1">,</span>
        <span class="s1">experimental: {</span>
            <span class="s1">useWasmBinary: (_config_experimental = config.experimental) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _config_experimental.useWasmBinary</span>
        <span class="s1">}</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s0">/**</span>
 <span class="s0">* Returns the version of the specified binary, by supplying `--version` argument.</span>
 <span class="s0">* N/A if it fails to run the binary.</span>
 <span class="s0">*/ </span><span class="s3">function </span><span class="s1">getBinaryVersion(binaryName) {</span>
    <span class="s3">try </span><span class="s1">{</span>
        <span class="s3">return </span><span class="s1">_child_process.default.execFileSync(binaryName, [</span>
            <span class="s2">'--version'</span>
        <span class="s1">]).toString().trim();</span>
    <span class="s1">} </span><span class="s3">catch  </span><span class="s1">{</span>
        <span class="s3">try </span><span class="s1">{</span>
            <span class="s3">return </span><span class="s1">_child_process.default.execSync(</span><span class="s2">`</span><span class="s1">${binaryName} </span><span class="s2">--version`</span><span class="s1">).toString().trim();</span>
        <span class="s1">} </span><span class="s3">catch  </span><span class="s1">{</span>
            <span class="s3">return </span><span class="s2">'N/A'</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s0">/**</span>
 <span class="s0">* Collect basic next.js installation information and print it to stdout.</span>
 <span class="s0">*/ </span><span class="s1">async </span><span class="s3">function </span><span class="s1">printInfo() {</span>
    <span class="s3">const </span><span class="s1">installedRelease = getPackageVersion(</span><span class="s2">'next'</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s1">nextConfig = </span><span class="s3">await </span><span class="s1">getNextConfig();</span>
    <span class="s3">let </span><span class="s1">stalenessWithTitle = </span><span class="s2">''</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s1">title = </span><span class="s2">''</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s1">versionInfo;</span>
    <span class="s3">try </span><span class="s1">{</span>
        <span class="s3">const </span><span class="s1">registry = (</span><span class="s4">0</span><span class="s1">, _getregistry.getRegistry)();</span>
        <span class="s3">const </span><span class="s1">res = </span><span class="s3">await </span><span class="s1">fetch(</span><span class="s2">`</span><span class="s1">${registry}</span><span class="s2">-/package/next/dist-tags`</span><span class="s1">);</span>
        <span class="s3">const </span><span class="s1">tags = </span><span class="s3">await </span><span class="s1">res.json();</span>
        <span class="s1">versionInfo = (</span><span class="s4">0</span><span class="s1">, _parseversioninfo.parseVersionInfo)({</span>
            <span class="s1">installed: installedRelease,</span>
            <span class="s1">latest: tags.latest,</span>
            <span class="s1">canary: tags.canary</span>
        <span class="s1">});</span>
        <span class="s1">title = (</span><span class="s4">0</span><span class="s1">, _versionstaleness.getStaleness)(versionInfo).title;</span>
        <span class="s3">if </span><span class="s1">(title) {</span>
            <span class="s1">stalenessWithTitle = </span><span class="s2">` // </span><span class="s1">${title}</span><span class="s2">`</span><span class="s1">;</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
        <span class="s1">console.warn(</span><span class="s2">`</span><span class="s1">${(</span><span class="s4">0</span><span class="s1">, _picocolors.yellow)((</span><span class="s4">0</span><span class="s1">, _picocolors.bold)(</span><span class="s2">'warn'</span><span class="s1">))}  </span><span class="s2">- Failed to fetch latest canary version. (Reason: </span><span class="s1">${e.message}</span><span class="s2">.) 
      Detected &quot;</span><span class="s1">${installedRelease}</span><span class="s2">&quot;. Visit https://github.com/vercel/next.js/releases. 
      Make sure to try the latest canary version (eg.: </span><span class="s5">\`</span><span class="s2">npm install next@canary</span><span class="s5">\`</span><span class="s2">) to confirm the issue still exists before creating a new issue. 
      </span><span class="s5">\n</span><span class="s2">Learn more: </span><span class="s1">${(</span><span class="s4">0</span><span class="s1">, _picocolors.cyan)(</span><span class="s2">'https://nextjs.org/docs/messages/opening-an-issue'</span><span class="s1">)}</span><span class="s2">`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s1">cpuCores = _os.default.cpus().length;</span>
    <span class="s3">let </span><span class="s1">relevantPackages = </span><span class="s2">`  next: </span><span class="s1">${installedRelease}${stalenessWithTitle}</span>
  <span class="s2">eslint-config-next: </span><span class="s1">${getPackageVersion(</span><span class="s2">'eslint-config-next'</span><span class="s1">)}</span>
  <span class="s2">react: </span><span class="s1">${getPackageVersion(</span><span class="s2">'react'</span><span class="s1">)}</span>
  <span class="s2">react-dom: </span><span class="s1">${getPackageVersion(</span><span class="s2">'react-dom'</span><span class="s1">)}</span>
  <span class="s2">typescript: </span><span class="s1">${getPackageVersion(</span><span class="s2">'typescript'</span><span class="s1">)}</span><span class="s2">`</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(process.env.NEXT_RSPACK) {</span>
        <span class="s1">relevantPackages += </span><span class="s2">`</span>
  <span class="s2">next-rspack: </span><span class="s1">${getPackageVersion(</span><span class="s2">'next-rspack'</span><span class="s1">)}</span><span class="s2">`</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s1">console.log(</span><span class="s2">`</span>
<span class="s2">Operating System: 
  Platform: </span><span class="s1">${_os.default.platform()}</span>
  <span class="s2">Arch: </span><span class="s1">${_os.default.arch()}</span>
  <span class="s2">Version: </span><span class="s1">${_os.default.version()}</span>
  <span class="s2">Available memory (MB): </span><span class="s1">${Math.ceil(_os.default.totalmem() / </span><span class="s4">1024 </span><span class="s1">/ </span><span class="s4">1024</span><span class="s1">)}</span>
  <span class="s2">Available CPU cores: </span><span class="s1">${cpuCores &gt; </span><span class="s4">0 </span><span class="s1">? cpuCores : </span><span class="s2">'N/A'</span><span class="s1">}</span>
<span class="s2">Binaries: 
  Node: </span><span class="s1">${process.versions.node}</span>
  <span class="s2">npm: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'npm'</span><span class="s1">)}</span>
  <span class="s2">Yarn: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'yarn'</span><span class="s1">)}</span>
  <span class="s2">pnpm: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'pnpm'</span><span class="s1">)}</span>
<span class="s2">Relevant Packages: 
</span><span class="s1">${relevantPackages}</span>
<span class="s2">Next.js Config: 
  output: </span><span class="s1">${nextConfig.output}</span><span class="s2">`</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(versionInfo == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: versionInfo.staleness.startsWith(</span><span class="s2">'stale'</span><span class="s1">)) {</span>
        <span class="s1">(</span><span class="s4">0</span><span class="s1">, _log.warn)(</span><span class="s2">`</span><span class="s1">${title}</span>
   <span class="s2">Please try the latest canary version (</span><span class="s5">\`</span><span class="s2">npm install next@canary</span><span class="s5">\`</span><span class="s2">) to confirm the issue still exists before creating a new issue. 
   Read more - https://nextjs.org/docs/messages/opening-an-issue`</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s0">/**</span>
 <span class="s0">* Using system-installed tools per each platform, trying to read shared dependencies of next-swc.</span>
 <span class="s0">* This is mainly for debugging DLOPEN failure.</span>
 <span class="s0">*</span>
 <span class="s0">* We don't / can't install these tools by ourselves, will skip the check if we can't find them.</span>
 <span class="s0">*/ </span><span class="s1">async </span><span class="s3">function </span><span class="s1">runSharedDependencyCheck(tools, skipMessage) {</span>
    <span class="s3">var </span><span class="s1">_getSupportedArchTriples_currentPlatform;</span>
    <span class="s3">const </span><span class="s1">currentPlatform = _os.default.platform();</span>
    <span class="s3">const </span><span class="s1">spawn = require(</span><span class="s2">'next/dist/compiled/cross-spawn'</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s1">{ getSupportedArchTriples } = require(</span><span class="s2">'../build/swc'</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s1">triples = ((_getSupportedArchTriples_currentPlatform = getSupportedArchTriples()[currentPlatform]) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _getSupportedArchTriples_currentPlatform[_os.default.arch()]) ?? [];</span>
    <span class="s0">// First, check if system have a tool installed. We can't install these by our own.</span>
    <span class="s3">const </span><span class="s1">availableTools = [];</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">tool of tools){</span>
        <span class="s3">try </span><span class="s1">{</span>
            <span class="s3">const </span><span class="s1">check = spawn.sync(tool.bin, tool.checkArgs);</span>
            <span class="s3">if </span><span class="s1">(check.status === </span><span class="s4">0</span><span class="s1">) {</span>
                <span class="s1">availableTools.push(tool);</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s3">catch  </span><span class="s1">{</span>
        <span class="s0">// ignore if existence check fails</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(availableTools.length === </span><span class="s4">0</span><span class="s1">) {</span>
        <span class="s3">return </span><span class="s1">{</span>
            <span class="s1">messages: skipMessage,</span>
            <span class="s1">result: </span><span class="s2">'skipped'</span>
        <span class="s1">};</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s1">outputs = [];</span>
    <span class="s3">let </span><span class="s1">result = </span><span class="s2">'fail'</span><span class="s1">;</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">triple of triples){</span>
        <span class="s3">const </span><span class="s1">triplePkgName = </span><span class="s2">`@next/swc-</span><span class="s1">${triple.platformArchABI}</span><span class="s2">`</span><span class="s1">;</span>
        <span class="s3">let </span><span class="s1">resolved;</span>
        <span class="s3">try </span><span class="s1">{</span>
            <span class="s1">resolved = require.resolve(triplePkgName);</span>
        <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
            <span class="s3">return </span><span class="s1">{</span>
                <span class="s1">messages: </span><span class="s2">'Cannot find next-swc installation, skipping dependencies check'</span><span class="s1">,</span>
                <span class="s1">result: </span><span class="s2">'skipped'</span>
            <span class="s1">};</span>
        <span class="s1">}</span>
        <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">tool of availableTools){</span>
            <span class="s3">const </span><span class="s1">proc = spawn(tool.bin, [</span>
                <span class="s1">...tool.args,</span>
                <span class="s1">resolved</span>
            <span class="s1">]);</span>
            <span class="s1">outputs.push(</span><span class="s2">`Running </span><span class="s1">${tool.bin} </span><span class="s2">------------- `</span><span class="s1">);</span>
            <span class="s0">// Captures output, doesn't matter if it fails or not since we'll forward both to output.</span>
            <span class="s3">const </span><span class="s1">procPromise = </span><span class="s3">new </span><span class="s1">Promise((resolve)=&gt;{</span>
                <span class="s1">proc.stdout.on(</span><span class="s2">'data'</span><span class="s1">, </span><span class="s3">function</span><span class="s1">(data) {</span>
                    <span class="s1">outputs.push(data);</span>
                <span class="s1">});</span>
                <span class="s1">proc.stderr.on(</span><span class="s2">'data'</span><span class="s1">, </span><span class="s3">function</span><span class="s1">(data) {</span>
                    <span class="s1">outputs.push(data);</span>
                <span class="s1">});</span>
                <span class="s1">proc.on(</span><span class="s2">'close'</span><span class="s1">, (c)=&gt;resolve(c));</span>
            <span class="s1">});</span>
            <span class="s3">let </span><span class="s1">code = </span><span class="s3">await </span><span class="s1">procPromise;</span>
            <span class="s3">if </span><span class="s1">(code === </span><span class="s4">0</span><span class="s1">) {</span>
                <span class="s1">result = </span><span class="s2">'pass'</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s1">{</span>
        <span class="s1">output: outputs.join(</span><span class="s2">'</span><span class="s5">\n</span><span class="s2">'</span><span class="s1">),</span>
        <span class="s1">result</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s0">/**</span>
 <span class="s0">* Collect additional diagnostics information.</span>
 <span class="s0">*/ </span><span class="s1">async </span><span class="s3">function </span><span class="s1">printVerboseInfo() {</span>
    <span class="s3">const </span><span class="s1">fs = require(</span><span class="s2">'fs'</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s1">currentPlatform = _os.default.platform();</span>
    <span class="s3">if </span><span class="s1">(currentPlatform !== </span><span class="s2">'win32' </span><span class="s1">&amp;&amp; currentPlatform !== </span><span class="s2">'linux' </span><span class="s1">&amp;&amp; currentPlatform !== </span><span class="s2">'darwin'</span><span class="s1">) {</span>
        <span class="s1">console.log(</span><span class="s2">'Unsupported platform, only win32, linux, darwin are supported.'</span><span class="s1">);</span>
        <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s0">// List of tasks to run.</span>
    <span class="s3">const </span><span class="s1">tasks = [</span>
        <span class="s1">{</span>
            <span class="s1">title: </span><span class="s2">'Host system information'</span><span class="s1">,</span>
            <span class="s1">scripts: {</span>
                <span class="s3">default</span><span class="s1">: async ()=&gt;{</span>
                    <span class="s0">// Node.js diagnostic report contains basic information, i.e OS version, CPU architecture, etc.</span>
                    <span class="s0">// Only collect few addtional details here.</span>
                    <span class="s3">const </span><span class="s1">isWsl = require(</span><span class="s2">'next/dist/compiled/is-wsl'</span><span class="s1">);</span>
                    <span class="s3">const </span><span class="s1">ciInfo = require(</span><span class="s2">'next/dist/compiled/ci-info'</span><span class="s1">);</span>
                    <span class="s3">const </span><span class="s1">isDocker = require(</span><span class="s2">'next/dist/compiled/is-docker'</span><span class="s1">);</span>
                    <span class="s3">const </span><span class="s1">output = </span><span class="s2">`</span>
  <span class="s2">WSL: </span><span class="s1">${isWsl}</span>
  <span class="s2">Docker: </span><span class="s1">${isDocker()}</span>
  <span class="s2">CI: </span><span class="s1">${ciInfo.isCI ? ciInfo.name || </span><span class="s2">'unknown' </span><span class="s1">: </span><span class="s2">'false'</span><span class="s1">}</span>
<span class="s2">`</span><span class="s1">;</span>
                    <span class="s3">return </span><span class="s1">{</span>
                        <span class="s1">output,</span>
                        <span class="s1">result: </span><span class="s2">'pass'</span>
                    <span class="s1">};</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">{</span>
            <span class="s1">title: </span><span class="s2">'Next.js installation'</span><span class="s1">,</span>
            <span class="s1">scripts: {</span>
                <span class="s3">default</span><span class="s1">: async ()=&gt;{</span>
                    <span class="s3">const </span><span class="s1">installedRelease = getPackageVersion(</span><span class="s2">'next'</span><span class="s1">);</span>
                    <span class="s3">const </span><span class="s1">nextConfig = </span><span class="s3">await </span><span class="s1">getNextConfig();</span>
                    <span class="s3">const </span><span class="s1">output = </span><span class="s2">`</span>
  <span class="s2">Binaries: 
    Node: </span><span class="s1">${process.versions.node}</span>
    <span class="s2">npm: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'npm'</span><span class="s1">)}</span>
    <span class="s2">Yarn: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'yarn'</span><span class="s1">)}</span>
    <span class="s2">pnpm: </span><span class="s1">${getBinaryVersion(</span><span class="s2">'pnpm'</span><span class="s1">)}</span>
  <span class="s2">Relevant Packages: 
    next: </span><span class="s1">${installedRelease}</span>
    <span class="s2">eslint-config-next: </span><span class="s1">${getPackageVersion(</span><span class="s2">'eslint-config-next'</span><span class="s1">)}</span>
    <span class="s2">react: </span><span class="s1">${getPackageVersion(</span><span class="s2">'react'</span><span class="s1">)}</span>
    <span class="s2">react-dom: </span><span class="s1">${getPackageVersion(</span><span class="s2">'react-dom'</span><span class="s1">)}</span>
    <span class="s2">typescript: </span><span class="s1">${getPackageVersion(</span><span class="s2">'typescript'</span><span class="s1">)}</span>
  <span class="s2">Next.js Config: 
    output: </span><span class="s1">${nextConfig.output}</span>

<span class="s2">`</span><span class="s1">;</span>
                    <span class="s3">return </span><span class="s1">{</span>
                        <span class="s1">output,</span>
                        <span class="s1">result: </span><span class="s2">'pass'</span>
                    <span class="s1">};</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">{</span>
            <span class="s1">title: </span><span class="s2">'Node.js diagnostic report'</span><span class="s1">,</span>
            <span class="s1">scripts: {</span>
                <span class="s3">default</span><span class="s1">: async ()=&gt;{</span>
                    <span class="s3">var </span><span class="s1">_process_report;</span>
                    <span class="s3">const </span><span class="s1">report = (_process_report = process.report) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _process_report.getReport();</span>
                    <span class="s3">if </span><span class="s1">(!report) {</span>
                        <span class="s3">return </span><span class="s1">{</span>
                            <span class="s1">messages: </span><span class="s2">'Node.js diagnostic report is not available.'</span><span class="s1">,</span>
                            <span class="s1">result: </span><span class="s2">'fail'</span>
                        <span class="s1">};</span>
                    <span class="s1">}</span>
                    <span class="s3">const </span><span class="s1">{ header, javascriptHeap, sharedObjects } = report;</span>
                    <span class="s0">// Delete some fields potentially containing sensitive information.</span>
                    <span class="s1">header == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">true </span><span class="s1">: </span><span class="s3">delete </span><span class="s1">header.cwd;</span>
                    <span class="s1">header == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">true </span><span class="s1">: </span><span class="s3">delete </span><span class="s1">header.commandLine;</span>
                    <span class="s1">header == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">true </span><span class="s1">: </span><span class="s3">delete </span><span class="s1">header.host;</span>
                    <span class="s1">header == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">true </span><span class="s1">: </span><span class="s3">delete </span><span class="s1">header.cpus;</span>
                    <span class="s1">header == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">true </span><span class="s1">: </span><span class="s3">delete </span><span class="s1">header.networkInterfaces;</span>
                    <span class="s3">const </span><span class="s1">reportSummary = {</span>
                        <span class="s1">header,</span>
                        <span class="s1">javascriptHeap,</span>
                        <span class="s1">sharedObjects</span>
                    <span class="s1">};</span>
                    <span class="s3">return </span><span class="s1">{</span>
                        <span class="s1">output: JSON.stringify(reportSummary, </span><span class="s3">null</span><span class="s1">, </span><span class="s4">2</span><span class="s1">),</span>
                        <span class="s1">result: </span><span class="s2">'pass'</span>
                    <span class="s1">};</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">{</span>
            <span class="s1">title: </span><span class="s2">'next-swc installation'</span><span class="s1">,</span>
            <span class="s1">scripts: {</span>
                <span class="s3">default</span><span class="s1">: async ()=&gt;{</span>
                    <span class="s3">var </span><span class="s1">_platformArchTriples_currentPlatform;</span>
                    <span class="s3">const </span><span class="s1">output = [];</span>
                    <span class="s0">// First, try to load next-swc via loadBindings.</span>
                    <span class="s3">try </span><span class="s1">{</span>
                        <span class="s3">var </span><span class="s1">_nextConfig_experimental;</span>
                        <span class="s3">let </span><span class="s1">nextConfig = </span><span class="s3">await </span><span class="s1">getNextConfig();</span>
                        <span class="s3">const </span><span class="s1">{ loadBindings } = require(</span><span class="s2">'../build/swc'</span><span class="s1">);</span>
                        <span class="s3">const </span><span class="s1">bindings = </span><span class="s3">await </span><span class="s1">loadBindings((_nextConfig_experimental = nextConfig.experimental) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _nextConfig_experimental.useWasmBinary);</span>
                        <span class="s0">// Run arbitrary function to verify the bindings are loaded correctly.</span>
                        <span class="s3">const </span><span class="s1">target = bindings.getTargetTriple();</span>
                        <span class="s0">// We think next-swc is installed correctly if getTargetTriple returns.</span>
                        <span class="s3">return </span><span class="s1">{</span>
                            <span class="s1">output: </span><span class="s2">`next-swc is installed correctly for </span><span class="s1">${target}</span><span class="s2">`</span><span class="s1">,</span>
                            <span class="s1">result: </span><span class="s2">'pass'</span>
                        <span class="s1">};</span>
                    <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
                        <span class="s1">output.push(</span><span class="s2">`loadBindings() failed: </span><span class="s1">${e.message}</span><span class="s2">`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s3">const </span><span class="s1">{ platformArchTriples } = require(</span><span class="s2">'next/dist/compiled/@napi-rs/triples'</span><span class="s1">);</span>
                    <span class="s3">const </span><span class="s1">triples = (_platformArchTriples_currentPlatform = platformArchTriples[currentPlatform]) == </span><span class="s3">null </span><span class="s1">? </span><span class="s3">void </span><span class="s4">0 </span><span class="s1">: _platformArchTriples_currentPlatform[_os.default.arch()];</span>
                    <span class="s3">if </span><span class="s1">(!triples || triples.length === </span><span class="s4">0</span><span class="s1">) {</span>
                        <span class="s3">return </span><span class="s1">{</span>
                            <span class="s1">messages: </span><span class="s2">`No target triples found for </span><span class="s1">${currentPlatform} </span><span class="s2">/ </span><span class="s1">${_os.default.arch()}</span><span class="s2">`</span><span class="s1">,</span>
                            <span class="s1">result: </span><span class="s2">'fail'</span>
                        <span class="s1">};</span>
                    <span class="s1">}</span>
                    <span class="s0">// Trying to manually resolve corresponding target triples to see if bindings are physically located.</span>
                    <span class="s3">const </span><span class="s1">path = require(</span><span class="s2">'path'</span><span class="s1">);</span>
                    <span class="s3">let </span><span class="s1">fallbackBindingsDirectory;</span>
                    <span class="s3">try </span><span class="s1">{</span>
                        <span class="s3">const </span><span class="s1">nextPath = path.dirname(require.resolve(</span><span class="s2">'next/package.json'</span><span class="s1">));</span>
                        <span class="s1">fallbackBindingsDirectory = path.join(nextPath, </span><span class="s2">'next-swc-fallback'</span><span class="s1">);</span>
                    <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
                    <span class="s0">// Not able to locate next package from current running location, skipping fallback bindings check.</span>
                    <span class="s1">}</span>
                    <span class="s3">const </span><span class="s1">tryResolve = (pkgName)=&gt;{</span>
                        <span class="s3">try </span><span class="s1">{</span>
                            <span class="s3">const </span><span class="s1">resolved = require.resolve(pkgName);</span>
                            <span class="s3">const </span><span class="s1">fileExists = fs.existsSync(resolved);</span>
                            <span class="s3">let </span><span class="s1">loadError;</span>
                            <span class="s3">let </span><span class="s1">loadSuccess;</span>
                            <span class="s3">try </span><span class="s1">{</span>
                                <span class="s1">loadSuccess = !!require(resolved).getTargetTriple();</span>
                            <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
                                <span class="s1">loadError = e.message;</span>
                            <span class="s1">}</span>
                            <span class="s1">output.push(</span><span class="s2">`</span><span class="s1">${pkgName} </span><span class="s2">exists: </span><span class="s1">${fileExists} </span><span class="s2">for the triple </span><span class="s1">${loadSuccess}</span><span class="s2">`</span><span class="s1">);</span>
                            <span class="s3">if </span><span class="s1">(loadError) {</span>
                                <span class="s1">output.push(</span><span class="s2">`</span><span class="s1">${pkgName} </span><span class="s2">load failed: </span><span class="s1">${loadError ?? </span><span class="s2">'unknown'</span><span class="s1">}</span><span class="s2">`</span><span class="s1">);</span>
                            <span class="s1">}</span>
                            <span class="s3">if </span><span class="s1">(loadSuccess) {</span>
                                <span class="s3">return true</span><span class="s1">;</span>
                            <span class="s1">}</span>
                        <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
                            <span class="s1">output.push(</span><span class="s2">`</span><span class="s1">${pkgName} </span><span class="s2">resolve failed: </span><span class="s1">${e.message ?? </span><span class="s2">'unknown'</span><span class="s1">}</span><span class="s2">`</span><span class="s1">);</span>
                        <span class="s1">}</span>
                        <span class="s3">return false</span><span class="s1">;</span>
                    <span class="s1">};</span>
                    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">triple of triples){</span>
                        <span class="s3">const </span><span class="s1">triplePkgName = </span><span class="s2">`@next/swc-</span><span class="s1">${triple.platformArchABI}</span><span class="s2">`</span><span class="s1">;</span>
                        <span class="s0">// Check installed optional dependencies. This is the normal way package being installed.</span>
                        <span class="s0">// For the targets have multiple triples (gnu / musl), if any of them loads successfully, we consider as installed.</span>
                        <span class="s3">if </span><span class="s1">(tryResolve(triplePkgName)) {</span>
                            <span class="s3">break</span><span class="s1">;</span>
                        <span class="s1">}</span>
                        <span class="s0">// Check if fallback binaries are installed.</span>
                        <span class="s3">if </span><span class="s1">(!fallbackBindingsDirectory) {</span>
                            <span class="s3">continue</span><span class="s1">;</span>
                        <span class="s1">}</span>
                        <span class="s1">tryResolve(path.join(fallbackBindingsDirectory, triplePkgName));</span>
                    <span class="s1">}</span>
                    <span class="s3">return </span><span class="s1">{</span>
                        <span class="s1">output: output.join(</span><span class="s2">'</span><span class="s5">\n</span><span class="s2">'</span><span class="s1">),</span>
                        <span class="s1">result: </span><span class="s2">'pass'</span>
                    <span class="s1">};</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">},</span>
        <span class="s1">{</span>
            <span class="s0">// For the simplicity, we only check the correctly installed optional dependencies -</span>
            <span class="s0">// as this is mainly for checking DLOPEN failure. If user hit MODULE_NOT_FOUND,</span>
            <span class="s0">// expect above next-swc installation would give some hint instead.</span>
            <span class="s1">title: </span><span class="s2">'next-swc shared object dependencies'</span><span class="s1">,</span>
            <span class="s1">scripts: {</span>
                <span class="s1">linux: async ()=&gt;{</span>
                    <span class="s3">const </span><span class="s1">skipMessage = </span><span class="s2">'This diagnostics uses system-installed tools (ldd) to check next-swc dependencies, but it is not found. Skipping dependencies check.'</span><span class="s1">;</span>
                    <span class="s3">return await </span><span class="s1">runSharedDependencyCheck([</span>
                        <span class="s1">{</span>
                            <span class="s1">bin: </span><span class="s2">'ldd'</span><span class="s1">,</span>
                            <span class="s1">checkArgs: [</span>
                                <span class="s2">'--help'</span>
                            <span class="s1">],</span>
                            <span class="s1">args: [</span>
                                <span class="s2">'--verbose'</span>
                            <span class="s1">]</span>
                        <span class="s1">}</span>
                    <span class="s1">], skipMessage);</span>
                <span class="s1">},</span>
                <span class="s1">win32: async ()=&gt;{</span>
                    <span class="s3">const </span><span class="s1">skipMessage = </span><span class="s2">`This diagnostics uses system-installed tools (dumpbin.exe) to check next-swc dependencies, but it was not found in the path. Skipping dependencies check. 
          dumpbin (https://learn.microsoft.com/en-us/cpp/build/reference/dumpbin-reference) is a part of Microsoft VC toolset, 
          can be installed with Windows SDK, Windows Build tools or Visual Studio. 
 
          Please make sure you have one of them installed and dumpbin.exe is in the path. 
          `</span><span class="s1">;</span>
                    <span class="s3">return await </span><span class="s1">runSharedDependencyCheck([</span>
                        <span class="s1">{</span>
                            <span class="s1">bin: </span><span class="s2">'dumpbin.exe'</span><span class="s1">,</span>
                            <span class="s1">checkArgs: [</span>
                                <span class="s2">'/summary'</span>
                            <span class="s1">],</span>
                            <span class="s1">args: [</span>
                                <span class="s2">'/imports'</span>
                            <span class="s1">]</span>
                        <span class="s1">}</span>
                    <span class="s1">], skipMessage);</span>
                <span class="s1">},</span>
                <span class="s1">darwin: async ()=&gt;{</span>
                    <span class="s3">const </span><span class="s1">skipMessage = </span><span class="s2">'This diagnostics uses system-installed tools (otools, dyld_info) to check next-swc dependencies, but none of them are found. Skipping dependencies check.'</span><span class="s1">;</span>
                    <span class="s3">return await </span><span class="s1">runSharedDependencyCheck([</span>
                        <span class="s1">{</span>
                            <span class="s1">bin: </span><span class="s2">'otool'</span><span class="s1">,</span>
                            <span class="s1">checkArgs: [</span>
                                <span class="s2">'--version'</span>
                            <span class="s1">],</span>
                            <span class="s1">args: [</span>
                                <span class="s2">'-L'</span>
                            <span class="s1">]</span>
                        <span class="s1">},</span>
                        <span class="s1">{</span>
                            <span class="s1">bin: </span><span class="s2">'dyld_info'</span><span class="s1">,</span>
                            <span class="s1">checkArgs: [],</span>
                            <span class="s1">args: []</span>
                        <span class="s1">}</span>
                    <span class="s1">], skipMessage);</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">];</span>
    <span class="s0">// Collected output after running all tasks.</span>
    <span class="s3">const </span><span class="s1">report = [];</span>
    <span class="s1">console.log(</span><span class="s2">'</span><span class="s5">\n</span><span class="s2">'</span><span class="s1">);</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">task of tasks){</span>
        <span class="s3">if </span><span class="s1">(task.targetPlatform &amp;&amp; task.targetPlatform !== currentPlatform) {</span>
            <span class="s1">report.push({</span>
                <span class="s1">title: task.title,</span>
                <span class="s1">result: {</span>
                    <span class="s1">messages: undefined,</span>
                    <span class="s1">output: </span><span class="s2">`[SKIPPED (</span><span class="s1">${_os.default.platform()} </span><span class="s2">/ </span><span class="s1">${task.targetPlatform}</span><span class="s2">)] </span><span class="s1">${task.title}</span><span class="s2">`</span><span class="s1">,</span>
                    <span class="s1">result: </span><span class="s2">'skipped'</span>
                <span class="s1">}</span>
            <span class="s1">});</span>
            <span class="s3">continue</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">const </span><span class="s1">taskScript = task.scripts[currentPlatform] ?? task.scripts.default;</span>
        <span class="s3">let </span><span class="s1">taskResult;</span>
        <span class="s3">try </span><span class="s1">{</span>
            <span class="s1">taskResult = </span><span class="s3">await </span><span class="s1">taskScript();</span>
        <span class="s1">} </span><span class="s3">catch </span><span class="s1">(e) {</span>
            <span class="s1">taskResult = {</span>
                <span class="s1">messages: </span><span class="s2">`Unexpected failure while running diagnostics: </span><span class="s1">${e.message}</span><span class="s2">`</span><span class="s1">,</span>
                <span class="s1">result: </span><span class="s2">'fail'</span>
            <span class="s1">};</span>
        <span class="s1">}</span>
        <span class="s1">console.log(</span><span class="s2">`- </span><span class="s1">${task.title}</span><span class="s2">: </span><span class="s1">${taskResult.result}</span><span class="s2">`</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(taskResult.messages) {</span>
            <span class="s1">console.log(</span><span class="s2">`  </span><span class="s1">${taskResult.messages}</span><span class="s2">`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">report.push({</span>
            <span class="s1">title: task.title,</span>
            <span class="s1">result: taskResult</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s1">console.log(</span><span class="s2">`</span><span class="s5">\n</span><span class="s1">${(</span><span class="s4">0</span><span class="s1">, _picocolors.bold)(</span><span class="s2">'Generated diagnostics report'</span><span class="s1">)}</span><span class="s2">`</span><span class="s1">);</span>
    <span class="s1">console.log(</span><span class="s2">`</span><span class="s5">\n</span><span class="s2">Please copy below report and paste it into your issue.`</span><span class="s1">);</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s1">{ title, result } of report){</span>
        <span class="s1">console.log(</span><span class="s2">`</span><span class="s5">\n</span><span class="s2">### </span><span class="s1">${title}</span><span class="s2">`</span><span class="s1">);</span>
        <span class="s3">if </span><span class="s1">(result.messages) {</span>
            <span class="s1">console.log(result.messages);</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(result.output) {</span>
            <span class="s1">console.log(result.output);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s0">/**</span>
 <span class="s0">* Runs few scripts to collect system information to help with debugging next.js installation issues.</span>
 <span class="s0">* There are 2 modes, by default it collects basic next.js installation with runtime information. If</span>
 <span class="s0">* `--verbose` mode is enabled it'll try to collect, verify more data for next-swc installation and others.</span>
 <span class="s0">*/ </span><span class="s3">const </span><span class="s1">nextInfo = async (options)=&gt;{</span>
    <span class="s3">if </span><span class="s1">(options.verbose) {</span>
        <span class="s3">await </span><span class="s1">printVerboseInfo();</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">await </span><span class="s1">printInfo();</span>
    <span class="s1">}</span>
<span class="s1">};</span>

<span class="s0">//# sourceMappingURL=next-info.js.map</span></pre>
</body>
</html>