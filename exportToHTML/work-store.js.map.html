<html>
<head>
<title>work-store.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
work-store.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/async-storage/work-store.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { WorkStore } from '../app-render/work-async-storage.external'</span><span class="s3">\n</span><span class="s1">import type { IncrementalCache } from '../lib/incremental-cache'</span><span class="s3">\n</span><span class="s1">import type { RenderOpts } from '../app-render/types'</span><span class="s3">\n</span><span class="s1">import type { FetchMetric } from '../base-http'</span><span class="s3">\n</span><span class="s1">import type { RequestLifecycleOpts } from '../base-server'</span><span class="s3">\n</span><span class="s1">import type { AppSegmentConfig } from '../../build/segment-config/app/app-segment-config'</span><span class="s3">\n</span><span class="s1">import type { CacheLife } from '../use-cache/cache-life'</span><span class="s3">\n\n</span><span class="s1">import { AfterContext } from '../after/after-context'</span><span class="s3">\n\n</span><span class="s1">import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'</span><span class="s3">\n</span><span class="s1">import { createLazyResult, type LazyResult } from '../lib/lazy-result'</span><span class="s3">\n</span><span class="s1">import { getCacheHandlerEntries } from '../use-cache/handlers'</span><span class="s3">\n</span><span class="s1">import { createSnapshot } from '../app-render/async-local-storage'</span><span class="s3">\n\n</span><span class="s1">export type WorkStoreContext = {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The page that is being rendered. This relates to the path to the page file.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">page: string</span><span class="s3">\n\n  </span><span class="s1">isPrefetchRequest?: boolean</span><span class="s3">\n  </span><span class="s1">renderOpts: {</span><span class="s3">\n    </span><span class="s1">cacheLifeProfiles?: { [profile: string]: CacheLife }</span><span class="s3">\n    </span><span class="s1">incrementalCache?: IncrementalCache</span><span class="s3">\n    </span><span class="s1">isOnDemandRevalidate?: boolean</span><span class="s3">\n    </span><span class="s1">fetchCache?: AppSegmentConfig['fetchCache']</span><span class="s3">\n    </span><span class="s1">isPossibleServerAction?: boolean</span><span class="s3">\n    </span><span class="s1">pendingWaitUntil?: Promise&lt;any&gt;</span><span class="s3">\n    </span><span class="s1">experimental: Pick&lt;</span><span class="s3">\n      </span><span class="s1">RenderOpts['experimental'],</span><span class="s3">\n      </span><span class="s1">'isRoutePPREnabled' | 'cacheComponents' | 'authInterrupts'</span><span class="s3">\n    </span><span class="s1">&gt;</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* Fetch metrics attached in patch-fetch.ts</span><span class="s3">\n     </span><span class="s1">**/</span><span class="s3">\n    </span><span class="s1">fetchMetrics?: FetchMetric[]</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* A hack around accessing the store value outside the context of the</span><span class="s3">\n     </span><span class="s1">* request.</span><span class="s3">\n     </span><span class="s1">*</span><span class="s3">\n     </span><span class="s1">* @internal</span><span class="s3">\n     </span><span class="s1">* @deprecated should only be used as a temporary workaround</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">// TODO: remove this when we resolve accessing the store outside the execution context</span><span class="s3">\n    </span><span class="s1">store?: WorkStore</span><span class="s3">\n  </span><span class="s1">} &amp; Pick&lt;</span><span class="s3">\n    </span><span class="s1">// Pull some properties from RenderOpts so that the docs are also</span><span class="s3">\n    </span><span class="s1">// mirrored.</span><span class="s3">\n    </span><span class="s1">RenderOpts,</span><span class="s3">\n    </span><span class="s1">| 'assetPrefix'</span><span class="s3">\n    </span><span class="s1">| 'supportsDynamicResponse'</span><span class="s3">\n    </span><span class="s1">| 'shouldWaitOnAllReady'</span><span class="s3">\n    </span><span class="s1">| 'isRevalidate'</span><span class="s3">\n    </span><span class="s1">| 'nextExport'</span><span class="s3">\n    </span><span class="s1">| 'isDraftMode'</span><span class="s3">\n    </span><span class="s1">| 'isDebugDynamicAccesses'</span><span class="s3">\n    </span><span class="s1">| 'dev'</span><span class="s3">\n    </span><span class="s1">| 'hasReadableErrorStacks'</span><span class="s3">\n  </span><span class="s1">&gt; &amp;</span><span class="s3">\n    </span><span class="s1">RequestLifecycleOpts &amp;</span><span class="s3">\n    </span><span class="s1">Partial&lt;Pick&lt;RenderOpts, 'reactLoadableManifest'&gt;&gt;</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* The build ID of the current build.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">buildId: string</span><span class="s3">\n\n  </span><span class="s1">// Tags that were previously revalidated (e.g. by a redirecting server action)</span><span class="s3">\n  </span><span class="s1">// and have already been sent to cache handlers.</span><span class="s3">\n  </span><span class="s1">previouslyRevalidatedTags: string[]</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function createWorkStore({</span><span class="s3">\n  </span><span class="s1">page,</span><span class="s3">\n  </span><span class="s1">renderOpts,</span><span class="s3">\n  </span><span class="s1">isPrefetchRequest,</span><span class="s3">\n  </span><span class="s1">buildId,</span><span class="s3">\n  </span><span class="s1">previouslyRevalidatedTags,</span><span class="s3">\n</span><span class="s1">}: WorkStoreContext): WorkStore {</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Rules of Static &amp; Dynamic HTML:</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">*    1.) We must generate static HTML unless the caller explicitly opts</span><span class="s3">\n   </span><span class="s1">*        in to dynamic HTML support.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">*    2.) If dynamic HTML support is requested, we must honor that request</span><span class="s3">\n   </span><span class="s1">*        or throw an error. It is the sole responsibility of the caller to</span><span class="s3">\n   </span><span class="s1">*        ensure they aren't e.g. requesting dynamic HTML for an AMP page.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">*    3.) If the request is in draft mode, we must generate dynamic HTML.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">*    4.) If the request is a server action, we must generate dynamic HTML.</span><span class="s3">\n   </span><span class="s1">*</span><span class="s3">\n   </span><span class="s1">* These rules help ensure that other existing features like request caching,</span><span class="s3">\n   </span><span class="s1">* coalescing, and ISR continue working as intended.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">const isStaticGeneration =</span><span class="s3">\n    </span><span class="s1">!renderOpts.shouldWaitOnAllReady &amp;&amp;</span><span class="s3">\n    </span><span class="s1">!renderOpts.supportsDynamicResponse &amp;&amp;</span><span class="s3">\n    </span><span class="s1">!renderOpts.isDraftMode &amp;&amp;</span><span class="s3">\n    </span><span class="s1">!renderOpts.isPossibleServerAction</span><span class="s3">\n\n  </span><span class="s1">const isDevelopment = renderOpts.dev ?? false</span><span class="s3">\n\n  </span><span class="s1">const shouldTrackFetchMetrics =</span><span class="s3">\n    </span><span class="s1">isDevelopment ||</span><span class="s3">\n    </span><span class="s1">// The only times we want to track fetch metrics outside of development is</span><span class="s3">\n    </span><span class="s1">// when we are performing a static generation and we either are in debug</span><span class="s3">\n    </span><span class="s1">// mode, or tracking fetch metrics was specifically opted into.</span><span class="s3">\n    </span><span class="s1">(isStaticGeneration &amp;&amp;</span><span class="s3">\n      </span><span class="s1">(!!process.env.NEXT_DEBUG_BUILD ||</span><span class="s3">\n        </span><span class="s1">process.env.NEXT_SSG_FETCH_METRICS === '1'))</span><span class="s3">\n\n  </span><span class="s1">const store: WorkStore = {</span><span class="s3">\n    </span><span class="s1">isStaticGeneration,</span><span class="s3">\n    </span><span class="s1">page,</span><span class="s3">\n    </span><span class="s1">route: normalizeAppPath(page),</span><span class="s3">\n    </span><span class="s1">incrementalCache:</span><span class="s3">\n      </span><span class="s1">// we fallback to a global incremental cache for edge-runtime locally</span><span class="s3">\n      </span><span class="s1">// so that it can access the fs cache without mocks</span><span class="s3">\n      </span><span class="s1">renderOpts.incrementalCache || (globalThis as any).__incrementalCache,</span><span class="s3">\n    </span><span class="s1">cacheLifeProfiles: renderOpts.cacheLifeProfiles,</span><span class="s3">\n    </span><span class="s1">isRevalidate: renderOpts.isRevalidate,</span><span class="s3">\n    </span><span class="s1">isBuildTimePrerendering: renderOpts.nextExport,</span><span class="s3">\n    </span><span class="s1">hasReadableErrorStacks: renderOpts.hasReadableErrorStacks,</span><span class="s3">\n    </span><span class="s1">fetchCache: renderOpts.fetchCache,</span><span class="s3">\n    </span><span class="s1">isOnDemandRevalidate: renderOpts.isOnDemandRevalidate,</span><span class="s3">\n\n    </span><span class="s1">isDraftMode: renderOpts.isDraftMode,</span><span class="s3">\n\n    </span><span class="s1">isPrefetchRequest,</span><span class="s3">\n    </span><span class="s1">buildId,</span><span class="s3">\n    </span><span class="s1">reactLoadableManifest: renderOpts?.reactLoadableManifest || {},</span><span class="s3">\n    </span><span class="s1">assetPrefix: renderOpts?.assetPrefix || '',</span><span class="s3">\n\n    </span><span class="s1">afterContext: createAfterContext(renderOpts),</span><span class="s3">\n    </span><span class="s1">cacheComponentsEnabled: renderOpts.experimental.cacheComponents,</span><span class="s3">\n    </span><span class="s1">dev: isDevelopment,</span><span class="s3">\n    </span><span class="s1">previouslyRevalidatedTags,</span><span class="s3">\n    </span><span class="s1">refreshTagsByCacheKind: createRefreshTagsByCacheKind(),</span><span class="s3">\n    </span><span class="s1">runInCleanSnapshot: createSnapshot(),</span><span class="s3">\n    </span><span class="s1">shouldTrackFetchMetrics,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// TODO: remove this when we resolve accessing the store outside the execution context</span><span class="s3">\n  </span><span class="s1">renderOpts.store = store</span><span class="s3">\n\n  </span><span class="s1">return store</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function createAfterContext(renderOpts: RequestLifecycleOpts): AfterContext {</span><span class="s3">\n  </span><span class="s1">const { waitUntil, onClose, onAfterTaskError } = renderOpts</span><span class="s3">\n  </span><span class="s1">return new AfterContext({</span><span class="s3">\n    </span><span class="s1">waitUntil,</span><span class="s3">\n    </span><span class="s1">onClose,</span><span class="s3">\n    </span><span class="s1">onTaskError: onAfterTaskError,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Creates a map with lazy results that refresh tags for the respective cache</span><span class="s3">\n </span><span class="s1">* kind when they're awaited for the first time.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function createRefreshTagsByCacheKind(): Map&lt;string, LazyResult&lt;void&gt;&gt; {</span><span class="s3">\n  </span><span class="s1">const refreshTagsByCacheKind = new Map&lt;string, LazyResult&lt;void&gt;&gt;()</span><span class="s3">\n  </span><span class="s1">const cacheHandlers = getCacheHandlerEntries()</span><span class="s3">\n\n  </span><span class="s1">if (cacheHandlers) {</span><span class="s3">\n    </span><span class="s1">for (const [kind, cacheHandler] of cacheHandlers) {</span><span class="s3">\n      </span><span class="s1">if ('refreshTags' in cacheHandler) {</span><span class="s3">\n        </span><span class="s1">refreshTagsByCacheKind.set(</span><span class="s3">\n          </span><span class="s1">kind,</span><span class="s3">\n          </span><span class="s1">createLazyResult(async () =&gt; cacheHandler.refreshTags())</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return refreshTagsByCacheKind</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;createWorkStore&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;renderOpts&quot;</span><span class="s0">,</span><span class="s1">&quot;isPrefetchRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;buildId&quot;</span><span class="s0">,</span><span class="s1">&quot;previouslyRevalidatedTags&quot;</span><span class="s0">,</span><span class="s1">&quot;isStaticGeneration&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldWaitOnAllReady&quot;</span><span class="s0">,</span><span class="s1">&quot;supportsDynamicResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;isDraftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;isPossibleServerAction&quot;</span><span class="s0">,</span><span class="s1">&quot;isDevelopment&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldTrackFetchMetrics&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_DEBUG_BUILD&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_SSG_FETCH_METRICS&quot;</span><span class="s0">,</span><span class="s1">&quot;store&quot;</span><span class="s0">,</span><span class="s1">&quot;route&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeAppPath&quot;</span><span class="s0">,</span><span class="s1">&quot;incrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;globalThis&quot;</span><span class="s0">,</span><span class="s1">&quot;__incrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheLifeProfiles&quot;</span><span class="s0">,</span><span class="s1">&quot;isRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;isBuildTimePrerendering&quot;</span><span class="s0">,</span><span class="s1">&quot;nextExport&quot;</span><span class="s0">,</span><span class="s1">&quot;hasReadableErrorStacks&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchCache&quot;</span><span class="s0">,</span><span class="s1">&quot;isOnDemandRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;reactLoadableManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;assetPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;afterContext&quot;</span><span class="s0">,</span><span class="s1">&quot;createAfterContext&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheComponentsEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;experimental&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;refreshTagsByCacheKind&quot;</span><span class="s0">,</span><span class="s1">&quot;createRefreshTagsByCacheKind&quot;</span><span class="s0">,</span><span class="s1">&quot;runInCleanSnapshot&quot;</span><span class="s0">,</span><span class="s1">&quot;createSnapshot&quot;</span><span class="s0">,</span><span class="s1">&quot;waitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;onClose&quot;</span><span class="s0">,</span><span class="s1">&quot;onAfterTaskError&quot;</span><span class="s0">,</span><span class="s1">&quot;AfterContext&quot;</span><span class="s0">,</span><span class="s1">&quot;onTaskError&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;getCacheHandlerEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;kind&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;createLazyResult&quot;</span><span class="s0">,</span><span class="s1">&quot;refreshTags&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BA2EgBA;;;eAAAA;;;8BAnEa;0BAEI;4BACiB;0BACX;mCACR;AA8DxB,SAASA,gBAAgB,EAC9BC,IAAI,EACJC,UAAU,EACVC,iBAAiB,EACjBC,OAAO,EACPC,yBAAyB,EACR;IACjB;;;;;;;;;;;;;;;;GAgBC,GACD,MAAMC,qBACJ,CAACJ,WAAWK,oBAAoB,IAChC,CAACL,WAAWM,uBAAuB,IACnC,CAACN,WAAWO,WAAW,IACvB,CAACP,WAAWQ,sBAAsB;IAEpC,MAAMC,gBAAgBT,WAAWU,GAAG,IAAI;IAExC,MAAMC,0BACJF,iBACA,0EAA0E;IAC1E,wEAAwE;IACxE,+DAA+D;IAC9DL,sBACE,CAAA,CAAC,CAACQ,QAAQC,GAAG,CAACC,gBAAgB,IAC7BF,QAAQC,GAAG,CAACE,sBAAsB,KAAK,GAAE;IAE/C,MAAMC,QAAmB;QACvBZ;QACAL;QACAkB,OAAOC,IAAAA,0BAAgB,EAACnB;QACxBoB,kBACE,qEAAqE;QACrE,mDAAmD;QACnDnB,WAAWmB,gBAAgB,IAAI,AAACC,WAAmBC,kBAAkB;QACvEC,mBAAmBtB,WAAWsB,iBAAiB;QAC/CC,cAAcvB,WAAWuB,YAAY;QACrCC,yBAAyBxB,WAAWyB,UAAU;QAC9CC,wBAAwB1B,WAAW0B,sBAAsB;QACzDC,YAAY3B,WAAW2B,UAAU;QACjCC,sBAAsB5B,WAAW4B,oBAAoB;QAErDrB,aAAaP,WAAWO,WAAW;QAEnCN;QACAC;QACA2B,uBAAuB7B,CAAAA,8BAAAA,WAAY6B,qBAAqB,KAAI,CAAC;QAC7DC,aAAa9B,CAAAA,8BAAAA,WAAY8B,WAAW,KAAI;QAExCC,cAAcC,mBAAmBhC;QACjCiC,wBAAwBjC,WAAWkC,YAAY,CAACC,eAAe;QAC/DzB,KAAKD;QACLN;QACAiC,wBAAwBC;QACxBC,oBAAoBC,IAAAA,iCAAc;QAClC5B;IACF;IAEA,sFAAsF;IACtFX,WAAWgB,KAAK,GAAGA;IAEnB,OAAOA;AACT;AAEA,SAASgB,mBAAmBhC,UAAgC;IAC1D,MAAM,EAAEwC,SAAS,EAAEC,OAAO,EAAEC,gBAAgB,EAAE,GAAG1C;IACjD,OAAO,IAAI2C,0BAAY,CAAC;QACtBH;QACAC;QACAG,aAAaF;IACf;AACF;AAEA;;;CAGC,GACD,SAASL;IACP,MAAMD,yBAAyB,IAAIS;IACnC,MAAMC,gBAAgBC,IAAAA,gCAAsB;IAE5C,IAAID,eAAe;QACjB,KAAK,MAAM,CAACE,MAAMC,aAAa,IAAIH,cAAe;YAChD,IAAI,iBAAiBG,cAAc;gBACjCb,uBAAuBc,GAAG,CACxBF,MACAG,IAAAA,4BAAgB,EAAC,UAAYF,aAAaG,WAAW;YAEzD;QACF;IACF;IAEA,OAAOhB;AACT&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>