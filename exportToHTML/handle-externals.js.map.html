<html>
<head>
<title>handle-externals.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
handle-externals.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/build/handle-externals.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { WebpackLayerName } from '../lib/constants'</span><span class="s3">\n</span><span class="s1">import type { NextConfigComplete } from '../server/config-shared'</span><span class="s3">\n</span><span class="s1">import type { ResolveOptions } from 'webpack'</span><span class="s3">\n</span><span class="s1">import { defaultOverrides } from '../server/require-hook'</span><span class="s3">\n</span><span class="s1">import { BARREL_OPTIMIZATION_PREFIX } from '../shared/lib/constants'</span><span class="s3">\n</span><span class="s1">import path from '../shared/lib/isomorphic/path'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">NODE_BASE_ESM_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">NODE_BASE_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">NODE_ESM_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">NODE_RESOLVE_OPTIONS,</span><span class="s3">\n</span><span class="s1">} from './webpack-config'</span><span class="s3">\n</span><span class="s1">import { isWebpackBundledLayer, shouldUseReactServerCondition } from './utils'</span><span class="s3">\n</span><span class="s1">import { normalizePathSep } from '../shared/lib/page-path/normalize-path-sep'</span><span class="s3">\n</span><span class="s1">const reactPackagesRegex = /^(react|react-dom|react-server-dom-webpack)($|</span><span class="s3">\\</span><span class="s1">/)/</span><span class="s3">\n\n</span><span class="s1">const pathSeparators = '[/</span><span class="s3">\\\\\\\\</span><span class="s1">]'</span><span class="s3">\n</span><span class="s1">const optionalEsmPart = `((${pathSeparators}esm)?${pathSeparators})`</span><span class="s3">\n</span><span class="s1">const externalFileEnd = '(</span><span class="s3">\\\\</span><span class="s1">.external(</span><span class="s3">\\\\</span><span class="s1">.js)?)$'</span><span class="s3">\n</span><span class="s1">const nextDist = `next${pathSeparators}dist`</span><span class="s3">\n\n</span><span class="s1">const externalPattern = new RegExp(</span><span class="s3">\n  </span><span class="s1">`${nextDist}${optionalEsmPart}.*${externalFileEnd}`</span><span class="s3">\n</span><span class="s1">)</span><span class="s3">\n\n</span><span class="s1">const nodeModulesRegex = /node_modules[/</span><span class="s3">\\\\</span><span class="s1">].*</span><span class="s3">\\</span><span class="s1">.[mc]?js$/</span><span class="s3">\n\n</span><span class="s1">export function isResourceInPackages(</span><span class="s3">\n  </span><span class="s1">resource: string,</span><span class="s3">\n  </span><span class="s1">packageNames?: string[],</span><span class="s3">\n  </span><span class="s1">packageDirMapping?: Map&lt;string, string&gt;</span><span class="s3">\n</span><span class="s1">): boolean {</span><span class="s3">\n  </span><span class="s1">if (!packageNames) return false</span><span class="s3">\n  </span><span class="s1">return packageNames.some((p: string) =&gt;</span><span class="s3">\n    </span><span class="s1">packageDirMapping &amp;&amp; packageDirMapping.has(p)</span><span class="s3">\n      </span><span class="s1">? resource.startsWith(packageDirMapping.get(p)! + path.sep)</span><span class="s3">\n      </span><span class="s1">: resource.includes(</span><span class="s3">\n          </span><span class="s1">path.sep +</span><span class="s3">\n            </span><span class="s1">path.join('node_modules', p.replace(/</span><span class="s3">\\</span><span class="s1">//g, path.sep)) +</span><span class="s3">\n            </span><span class="s1">path.sep</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function resolveExternal(</span><span class="s3">\n  </span><span class="s1">dir: string,</span><span class="s3">\n  </span><span class="s1">esmExternalsConfig: NextConfigComplete['experimental']['esmExternals'],</span><span class="s3">\n  </span><span class="s1">context: string,</span><span class="s3">\n  </span><span class="s1">request: string,</span><span class="s3">\n  </span><span class="s1">isEsmRequested: boolean,</span><span class="s3">\n  </span><span class="s1">getResolve: (</span><span class="s3">\n    </span><span class="s1">options: ResolveOptions</span><span class="s3">\n  </span><span class="s1">) =&gt; (</span><span class="s3">\n    </span><span class="s1">resolveContext: string,</span><span class="s3">\n    </span><span class="s1">resolveRequest: string</span><span class="s3">\n  </span><span class="s1">) =&gt; Promise&lt;[string | null, boolean]&gt;,</span><span class="s3">\n  </span><span class="s1">isLocalCallback?: (res: string) =&gt; any,</span><span class="s3">\n  </span><span class="s1">baseResolveCheck = true,</span><span class="s3">\n  </span><span class="s1">esmResolveOptions: any = NODE_ESM_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">nodeResolveOptions: any = NODE_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">baseEsmResolveOptions: any = NODE_BASE_ESM_RESOLVE_OPTIONS,</span><span class="s3">\n  </span><span class="s1">baseResolveOptions: any = NODE_BASE_RESOLVE_OPTIONS</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const esmExternals = !!esmExternalsConfig</span><span class="s3">\n  </span><span class="s1">const looseEsmExternals = esmExternalsConfig === 'loose'</span><span class="s3">\n\n  </span><span class="s1">let res: string | null = null</span><span class="s3">\n  </span><span class="s1">let isEsm: boolean = false</span><span class="s3">\n\n  </span><span class="s1">const preferEsmOptions =</span><span class="s3">\n    </span><span class="s1">esmExternals &amp;&amp; isEsmRequested ? [true, false] : [false]</span><span class="s3">\n\n  </span><span class="s1">for (const preferEsm of preferEsmOptions) {</span><span class="s3">\n    </span><span class="s1">const resolveOptions = preferEsm ? esmResolveOptions : nodeResolveOptions</span><span class="s3">\n\n    </span><span class="s1">const resolve = getResolve(resolveOptions)</span><span class="s3">\n\n    </span><span class="s1">// Resolve the import with the webpack provided context, this</span><span class="s3">\n    </span><span class="s1">// ensures we're resolving the correct version when multiple</span><span class="s3">\n    </span><span class="s1">// exist.</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">;[res, isEsm] = await resolve(context, request)</span><span class="s3">\n    </span><span class="s1">} catch (err) {</span><span class="s3">\n      </span><span class="s1">res = null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!res) {</span><span class="s3">\n      </span><span class="s1">continue</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// ESM externals can only be imported (and not required).</span><span class="s3">\n    </span><span class="s1">// Make an exception in loose mode.</span><span class="s3">\n    </span><span class="s1">if (!isEsmRequested &amp;&amp; isEsm &amp;&amp; !looseEsmExternals) {</span><span class="s3">\n      </span><span class="s1">continue</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (isLocalCallback) {</span><span class="s3">\n      </span><span class="s1">return { localRes: isLocalCallback(res) }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Bundled Node.js code is relocated without its node_modules tree.</span><span class="s3">\n    </span><span class="s1">// This means we need to make sure its request resolves to the same</span><span class="s3">\n    </span><span class="s1">// package that'll be available at runtime. If it's not identical,</span><span class="s3">\n    </span><span class="s1">// we need to bundle the code (even if it _should_ be external).</span><span class="s3">\n    </span><span class="s1">if (baseResolveCheck) {</span><span class="s3">\n      </span><span class="s1">let baseRes: string | null</span><span class="s3">\n      </span><span class="s1">let baseIsEsm: boolean</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const baseResolve = getResolve(</span><span class="s3">\n          </span><span class="s1">isEsm ? baseEsmResolveOptions : baseResolveOptions</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">;[baseRes, baseIsEsm] = await baseResolve(dir, request)</span><span class="s3">\n      </span><span class="s1">} catch (err) {</span><span class="s3">\n        </span><span class="s1">baseRes = null</span><span class="s3">\n        </span><span class="s1">baseIsEsm = false</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Same as above: if the package, when required from the root,</span><span class="s3">\n      </span><span class="s1">// would be different from what the real resolution would use, we</span><span class="s3">\n      </span><span class="s1">// cannot externalize it.</span><span class="s3">\n      </span><span class="s1">// if request is pointing to a symlink it could point to the same file,</span><span class="s3">\n      </span><span class="s1">// the resolver will resolve symlinks so this is handled</span><span class="s3">\n      </span><span class="s1">if (baseRes !== res || isEsm !== baseIsEsm) {</span><span class="s3">\n        </span><span class="s1">res = null</span><span class="s3">\n        </span><span class="s1">continue</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">break</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return { res, isEsm }</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function makeExternalHandler({</span><span class="s3">\n  </span><span class="s1">config,</span><span class="s3">\n  </span><span class="s1">optOutBundlingPackageRegex,</span><span class="s3">\n  </span><span class="s1">transpiledPackages,</span><span class="s3">\n  </span><span class="s1">dir,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">config: NextConfigComplete</span><span class="s3">\n  </span><span class="s1">optOutBundlingPackageRegex: RegExp</span><span class="s3">\n  </span><span class="s1">transpiledPackages: string[]</span><span class="s3">\n  </span><span class="s1">dir: string</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">let resolvedExternalPackageDirs: Map&lt;string, string&gt;</span><span class="s3">\n  </span><span class="s1">const looseEsmExternals = config.experimental?.esmExternals === 'loose'</span><span class="s3">\n\n  </span><span class="s1">return async function handleExternals(</span><span class="s3">\n    </span><span class="s1">context: string,</span><span class="s3">\n    </span><span class="s1">request: string,</span><span class="s3">\n    </span><span class="s1">dependencyType: string,</span><span class="s3">\n    </span><span class="s1">layer: WebpackLayerName | null,</span><span class="s3">\n    </span><span class="s1">getResolve: (</span><span class="s3">\n      </span><span class="s1">options: any</span><span class="s3">\n    </span><span class="s1">) =&gt; (</span><span class="s3">\n      </span><span class="s1">resolveContext: string,</span><span class="s3">\n      </span><span class="s1">resolveRequest: string</span><span class="s3">\n    </span><span class="s1">) =&gt; Promise&lt;[string | null, boolean]&gt;</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// We need to externalize internal requests for files intended to</span><span class="s3">\n    </span><span class="s1">// not be bundled.</span><span class="s3">\n    </span><span class="s1">const isLocal: boolean =</span><span class="s3">\n      </span><span class="s1">request.startsWith('.') ||</span><span class="s3">\n      </span><span class="s1">// Always check for unix-style path, as webpack sometimes</span><span class="s3">\n      </span><span class="s1">// normalizes as posix.</span><span class="s3">\n      </span><span class="s1">path.posix.isAbsolute(request) ||</span><span class="s3">\n      </span><span class="s1">// When on Windows, we also want to check for Windows-specific</span><span class="s3">\n      </span><span class="s1">// absolute paths.</span><span class="s3">\n      </span><span class="s1">(process.platform === 'win32' &amp;&amp; path.win32.isAbsolute(request))</span><span class="s3">\n\n    </span><span class="s1">// make sure import </span><span class="s3">\&quot;</span><span class="s1">next</span><span class="s3">\&quot; </span><span class="s1">shows a warning when imported</span><span class="s3">\n    </span><span class="s1">// in pages/components</span><span class="s3">\n    </span><span class="s1">if (request === 'next') {</span><span class="s3">\n      </span><span class="s1">return `commonjs next/dist/lib/import-next-warning`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const isAppLayer = isWebpackBundledLayer(layer)</span><span class="s3">\n\n    </span><span class="s1">// Relative requires don't need custom resolution, because they</span><span class="s3">\n    </span><span class="s1">// are relative to requests we've already resolved here.</span><span class="s3">\n    </span><span class="s1">// Absolute requires (require('/foo')) are extremely uncommon, but</span><span class="s3">\n    </span><span class="s1">// also have no need for customization as they're already resolved.</span><span class="s3">\n    </span><span class="s1">if (!isLocal) {</span><span class="s3">\n      </span><span class="s1">if (/^next$/.test(request)) {</span><span class="s3">\n        </span><span class="s1">return `commonjs ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (reactPackagesRegex.test(request) &amp;&amp; !isAppLayer) {</span><span class="s3">\n        </span><span class="s1">return `commonjs ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Handle Bun builtins as external modules</span><span class="s3">\n      </span><span class="s1">if (request === 'bun' || request.startsWith('bun:')) {</span><span class="s3">\n        </span><span class="s1">return `commonjs ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const notExternalModules =</span><span class="s3">\n        </span><span class="s1">/^(?:private-next-pages</span><span class="s3">\\</span><span class="s1">/|next</span><span class="s3">\\</span><span class="s1">/(?:dist</span><span class="s3">\\</span><span class="s1">/pages</span><span class="s3">\\</span><span class="s1">/|(?:app|cache|document|link|form|head|image|legacy</span><span class="s3">\\</span><span class="s1">/image|constants|dynamic|script|navigation|headers|router|compat</span><span class="s3">\\</span><span class="s1">/router|server)$)|string-hash|private-next-rsc-action-validate|private-next-rsc-action-client-wrapper|private-next-rsc-server-reference|private-next-rsc-cache-wrapper|private-next-rsc-track-dynamic-import$)/</span><span class="s3">\n      </span><span class="s1">if (notExternalModules.test(request)) {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// @swc/helpers should not be external as it would</span><span class="s3">\n    </span><span class="s1">// require hoisting the package which we can't rely on</span><span class="s3">\n    </span><span class="s1">if (request.includes('@swc/helpers')) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// BARREL_OPTIMIZATION_PREFIX is a special marker that tells Next.js to</span><span class="s3">\n    </span><span class="s1">// optimize the import by removing unused exports. This has to be compiled.</span><span class="s3">\n    </span><span class="s1">if (request.startsWith(BARREL_OPTIMIZATION_PREFIX)) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// When in esm externals mode, and using import, we resolve with</span><span class="s3">\n    </span><span class="s1">// ESM resolving options.</span><span class="s3">\n    </span><span class="s1">// Also disable esm request when appDir is enabled</span><span class="s3">\n    </span><span class="s1">const isEsmRequested = dependencyType === 'esm'</span><span class="s3">\n\n    </span><span class="s1">// Don't bundle @vercel/og nodejs bundle for nodejs runtime.</span><span class="s3">\n    </span><span class="s1">// TODO-APP: bundle route.js with different layer that externals common node_module deps.</span><span class="s3">\n    </span><span class="s1">// Make sure @vercel/og is loaded as ESM for Node.js runtime</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">shouldUseReactServerCondition(layer) &amp;&amp;</span><span class="s3">\n      </span><span class="s1">request === 'next/dist/compiled/@vercel/og/index.node.js'</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return `module ${request}`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Specific Next.js imports that should remain external</span><span class="s3">\n    </span><span class="s1">// TODO-APP: Investigate if we can remove this.</span><span class="s3">\n    </span><span class="s1">if (request.startsWith('next/dist/')) {</span><span class="s3">\n      </span><span class="s1">// Non external that needs to be transpiled</span><span class="s3">\n      </span><span class="s1">// Image loader needs to be transpiled</span><span class="s3">\n      </span><span class="s1">if (/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]shared[</span><span class="s3">\\\\</span><span class="s1">/]lib[</span><span class="s3">\\\\</span><span class="s1">/]image-loader/.test(request)) {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]compiled[</span><span class="s3">\\\\</span><span class="s1">/]next-server/.test(request)) {</span><span class="s3">\n        </span><span class="s1">return `commonjs ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]shared[</span><span class="s3">\\\\</span><span class="s1">/](?!lib[</span><span class="s3">\\\\</span><span class="s1">/]router[</span><span class="s3">\\\\</span><span class="s1">/]router)/.test(</span><span class="s3">\n          </span><span class="s1">request</span><span class="s3">\n        </span><span class="s1">) ||</span><span class="s3">\n        </span><span class="s1">/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]compiled[</span><span class="s3">\\\\</span><span class="s1">/].*</span><span class="s3">\\</span><span class="s1">.c?js$/.test(request)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">return `commonjs ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]esm[</span><span class="s3">\\\\</span><span class="s1">/]shared[</span><span class="s3">\\\\</span><span class="s1">/](?!lib[</span><span class="s3">\\\\</span><span class="s1">/]router[</span><span class="s3">\\\\</span><span class="s1">/]router)/.test(</span><span class="s3">\n          </span><span class="s1">request</span><span class="s3">\n        </span><span class="s1">) ||</span><span class="s3">\n        </span><span class="s1">/^next[</span><span class="s3">\\\\</span><span class="s1">/]dist[</span><span class="s3">\\\\</span><span class="s1">/]compiled[</span><span class="s3">\\\\</span><span class="s1">/].*</span><span class="s3">\\</span><span class="s1">.mjs$/.test(request)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">return `module ${request}`</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">return resolveNextExternal(request)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// TODO-APP: Let's avoid this resolve call as much as possible, and eventually get rid of it.</span><span class="s3">\n    </span><span class="s1">const resolveResult = await resolveExternal(</span><span class="s3">\n      </span><span class="s1">dir,</span><span class="s3">\n      </span><span class="s1">config.experimental.esmExternals,</span><span class="s3">\n      </span><span class="s1">context,</span><span class="s3">\n      </span><span class="s1">request,</span><span class="s3">\n      </span><span class="s1">isEsmRequested,</span><span class="s3">\n      </span><span class="s1">getResolve,</span><span class="s3">\n      </span><span class="s1">isLocal ? resolveNextExternal : undefined</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">if ('localRes' in resolveResult) {</span><span class="s3">\n      </span><span class="s1">return resolveResult.localRes</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Forcedly resolve the styled-jsx installed by next.js,</span><span class="s3">\n    </span><span class="s1">// since `resolveExternal` cannot find the styled-jsx dep with pnpm</span><span class="s3">\n    </span><span class="s1">if (request === 'styled-jsx/style') {</span><span class="s3">\n      </span><span class="s1">resolveResult.res = defaultOverrides['styled-jsx/style']</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const { res, isEsm } = resolveResult</span><span class="s3">\n\n    </span><span class="s1">// If the request cannot be resolved we need to have</span><span class="s3">\n    </span><span class="s1">// webpack </span><span class="s3">\&quot;</span><span class="s1">bundle</span><span class="s3">\&quot; </span><span class="s1">it so it surfaces the not found error.</span><span class="s3">\n    </span><span class="s1">if (!res) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const isOptOutBundling = optOutBundlingPackageRegex.test(res)</span><span class="s3">\n    </span><span class="s1">// Apply bundling rules to all app layers.</span><span class="s3">\n    </span><span class="s1">// Since handleExternals only handle the server layers, we don't need to exclude client here</span><span class="s3">\n    </span><span class="s1">if (!isOptOutBundling &amp;&amp; isAppLayer) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// ESM externals can only be imported (and not required).</span><span class="s3">\n    </span><span class="s1">// Make an exception in loose mode.</span><span class="s3">\n    </span><span class="s1">if (!isEsmRequested &amp;&amp; isEsm &amp;&amp; !looseEsmExternals &amp;&amp; !isLocal) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">`ESM packages (${request}) need to be imported. Use 'import' to reference the package instead. https://nextjs.org/docs/messages/import-esm-externals`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const externalType = isEsm ? 'module' : 'commonjs'</span><span class="s3">\n\n    </span><span class="s1">// Default pages have to be transpiled</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">// This is the @babel/plugin-transform-runtime </span><span class="s3">\&quot;</span><span class="s1">helpers: true</span><span class="s3">\&quot; </span><span class="s1">option</span><span class="s3">\n      </span><span class="s1">/node_modules[/</span><span class="s3">\\\\</span><span class="s1">]@babel[/</span><span class="s3">\\\\</span><span class="s1">]runtime[/</span><span class="s3">\\\\</span><span class="s1">]/.test(res)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Webpack itself has to be compiled because it doesn't always use module relative paths</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">/node_modules[/</span><span class="s3">\\\\</span><span class="s1">]webpack/.test(res) ||</span><span class="s3">\n      </span><span class="s1">/node_modules[/</span><span class="s3">\\\\</span><span class="s1">]css-loader/.test(res)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// If a package should be transpiled by Next.js, we skip making it external.</span><span class="s3">\n    </span><span class="s1">// It doesn't matter what the extension is, as we'll transpile it anyway.</span><span class="s3">\n    </span><span class="s1">if (transpiledPackages &amp;&amp; !resolvedExternalPackageDirs) {</span><span class="s3">\n      </span><span class="s1">resolvedExternalPackageDirs = new Map()</span><span class="s3">\n      </span><span class="s1">// We need to resolve all the external package dirs initially.</span><span class="s3">\n      </span><span class="s1">for (const pkg of transpiledPackages) {</span><span class="s3">\n        </span><span class="s1">const pkgRes = await resolveExternal(</span><span class="s3">\n          </span><span class="s1">dir,</span><span class="s3">\n          </span><span class="s1">config.experimental.esmExternals,</span><span class="s3">\n          </span><span class="s1">context,</span><span class="s3">\n          </span><span class="s1">pkg + '/package.json',</span><span class="s3">\n          </span><span class="s1">isEsmRequested,</span><span class="s3">\n          </span><span class="s1">getResolve,</span><span class="s3">\n          </span><span class="s1">isLocal ? resolveNextExternal : undefined</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">if (pkgRes.res) {</span><span class="s3">\n          </span><span class="s1">resolvedExternalPackageDirs.set(pkg, path.dirname(pkgRes.res))</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const resolvedBundlingOptOutRes = resolveBundlingOptOutPackages({</span><span class="s3">\n      </span><span class="s1">resolvedRes: res,</span><span class="s3">\n      </span><span class="s1">config,</span><span class="s3">\n      </span><span class="s1">resolvedExternalPackageDirs,</span><span class="s3">\n      </span><span class="s1">isAppLayer,</span><span class="s3">\n      </span><span class="s1">externalType,</span><span class="s3">\n      </span><span class="s1">isOptOutBundling,</span><span class="s3">\n      </span><span class="s1">request,</span><span class="s3">\n      </span><span class="s1">transpiledPackages,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">if (resolvedBundlingOptOutRes) {</span><span class="s3">\n      </span><span class="s1">return resolvedBundlingOptOutRes</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// if here, we default to bundling the file</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function resolveBundlingOptOutPackages({</span><span class="s3">\n  </span><span class="s1">resolvedRes,</span><span class="s3">\n  </span><span class="s1">config,</span><span class="s3">\n  </span><span class="s1">resolvedExternalPackageDirs,</span><span class="s3">\n  </span><span class="s1">isAppLayer,</span><span class="s3">\n  </span><span class="s1">externalType,</span><span class="s3">\n  </span><span class="s1">isOptOutBundling,</span><span class="s3">\n  </span><span class="s1">request,</span><span class="s3">\n  </span><span class="s1">transpiledPackages,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">resolvedRes: string</span><span class="s3">\n  </span><span class="s1">config: NextConfigComplete</span><span class="s3">\n  </span><span class="s1">resolvedExternalPackageDirs: Map&lt;string, string&gt;</span><span class="s3">\n  </span><span class="s1">isAppLayer: boolean</span><span class="s3">\n  </span><span class="s1">externalType: string</span><span class="s3">\n  </span><span class="s1">isOptOutBundling: boolean</span><span class="s3">\n  </span><span class="s1">request: string</span><span class="s3">\n  </span><span class="s1">transpiledPackages: string[]</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">if (nodeModulesRegex.test(resolvedRes)) {</span><span class="s3">\n    </span><span class="s1">const shouldBundlePages =</span><span class="s3">\n      </span><span class="s1">!isAppLayer &amp;&amp; config.bundlePagesRouterDependencies &amp;&amp; !isOptOutBundling</span><span class="s3">\n\n    </span><span class="s1">const shouldBeBundled =</span><span class="s3">\n      </span><span class="s1">shouldBundlePages ||</span><span class="s3">\n      </span><span class="s1">isResourceInPackages(</span><span class="s3">\n        </span><span class="s1">resolvedRes,</span><span class="s3">\n        </span><span class="s1">transpiledPackages,</span><span class="s3">\n        </span><span class="s1">resolvedExternalPackageDirs</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">if (!shouldBeBundled) {</span><span class="s3">\n      </span><span class="s1">return `${externalType} ${request}` // Externalize if not bundled or opted out</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* @param localRes the full path to the file</span><span class="s3">\n </span><span class="s1">* @returns the externalized path</span><span class="s3">\n </span><span class="s1">* @description returns an externalized path if the file is a Next.js file and ends with either `.shared-runtime.js` or `.external.js`</span><span class="s3">\n </span><span class="s1">* This is used to ensure that files used across the rendering runtime(s) and the user code are one and the same. The logic in this function</span><span class="s3">\n </span><span class="s1">* will rewrite the require to the correct bundle location depending on the layer at which the file is being used.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">function resolveNextExternal(localRes: string) {</span><span class="s3">\n  </span><span class="s1">const isExternal = externalPattern.test(localRes)</span><span class="s3">\n\n  </span><span class="s1">// if the file ends with .external, we need to make it a commonjs require in all cases</span><span class="s3">\n  </span><span class="s1">// this is used mainly to share the async local storage across the routing, rendering and user layers.</span><span class="s3">\n  </span><span class="s1">if (isExternal) {</span><span class="s3">\n    </span><span class="s1">// it's important we return the path that starts with `next/dist/` here instead of the absolute path</span><span class="s3">\n    </span><span class="s1">// otherwise NFT will get tripped up</span><span class="s3">\n    </span><span class="s1">return `commonjs ${normalizePathSep(</span><span class="s3">\n      </span><span class="s1">localRes.replace(/.*?next[/</span><span class="s3">\\\\</span><span class="s1">]dist/, 'next/dist')</span><span class="s3">\n    </span><span class="s1">)}`</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;isResourceInPackages&quot;</span><span class="s0">,</span><span class="s1">&quot;makeExternalHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveExternal&quot;</span><span class="s0">,</span><span class="s1">&quot;reactPackagesRegex&quot;</span><span class="s0">,</span><span class="s1">&quot;pathSeparators&quot;</span><span class="s0">,</span><span class="s1">&quot;optionalEsmPart&quot;</span><span class="s0">,</span><span class="s1">&quot;externalFileEnd&quot;</span><span class="s0">,</span><span class="s1">&quot;nextDist&quot;</span><span class="s0">,</span><span class="s1">&quot;externalPattern&quot;</span><span class="s0">,</span><span class="s1">&quot;RegExp&quot;</span><span class="s0">,</span><span class="s1">&quot;nodeModulesRegex&quot;</span><span class="s0">,</span><span class="s1">&quot;resource&quot;</span><span class="s0">,</span><span class="s1">&quot;packageNames&quot;</span><span class="s0">,</span><span class="s1">&quot;packageDirMapping&quot;</span><span class="s0">,</span><span class="s1">&quot;some&quot;</span><span class="s0">,</span><span class="s1">&quot;p&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;sep&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;esmExternalsConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;context&quot;</span><span class="s0">,</span><span class="s1">&quot;request&quot;</span><span class="s0">,</span><span class="s1">&quot;isEsmRequested&quot;</span><span class="s0">,</span><span class="s1">&quot;getResolve&quot;</span><span class="s0">,</span><span class="s1">&quot;isLocalCallback&quot;</span><span class="s0">,</span><span class="s1">&quot;baseResolveCheck&quot;</span><span class="s0">,</span><span class="s1">&quot;esmResolveOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ESM_RESOLVE_OPTIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;nodeResolveOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_RESOLVE_OPTIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;baseEsmResolveOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_BASE_ESM_RESOLVE_OPTIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;baseResolveOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_BASE_RESOLVE_OPTIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;esmExternals&quot;</span><span class="s0">,</span><span class="s1">&quot;looseEsmExternals&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;isEsm&quot;</span><span class="s0">,</span><span class="s1">&quot;preferEsmOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;preferEsm&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;localRes&quot;</span><span class="s0">,</span><span class="s1">&quot;baseRes&quot;</span><span class="s0">,</span><span class="s1">&quot;baseIsEsm&quot;</span><span class="s0">,</span><span class="s1">&quot;baseResolve&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;optOutBundlingPackageRegex&quot;</span><span class="s0">,</span><span class="s1">&quot;transpiledPackages&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedExternalPackageDirs&quot;</span><span class="s0">,</span><span class="s1">&quot;experimental&quot;</span><span class="s0">,</span><span class="s1">&quot;handleExternals&quot;</span><span class="s0">,</span><span class="s1">&quot;dependencyType&quot;</span><span class="s0">,</span><span class="s1">&quot;layer&quot;</span><span class="s0">,</span><span class="s1">&quot;isLocal&quot;</span><span class="s0">,</span><span class="s1">&quot;posix&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbsolute&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;platform&quot;</span><span class="s0">,</span><span class="s1">&quot;win32&quot;</span><span class="s0">,</span><span class="s1">&quot;isAppLayer&quot;</span><span class="s0">,</span><span class="s1">&quot;isWebpackBundledLayer&quot;</span><span class="s0">,</span><span class="s1">&quot;test&quot;</span><span class="s0">,</span><span class="s1">&quot;notExternalModules&quot;</span><span class="s0">,</span><span class="s1">&quot;BARREL_OPTIMIZATION_PREFIX&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldUseReactServerCondition&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveNextExternal&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveResult&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;defaultOverrides&quot;</span><span class="s0">,</span><span class="s1">&quot;isOptOutBundling&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;externalType&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;pkg&quot;</span><span class="s0">,</span><span class="s1">&quot;pkgRes&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;dirname&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedBundlingOptOutRes&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveBundlingOptOutPackages&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedRes&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldBundlePages&quot;</span><span class="s0">,</span><span class="s1">&quot;bundlePagesRouterDependencies&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldBeBundled&quot;</span><span class="s0">,</span><span class="s1">&quot;isExternal&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizePathSep&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>