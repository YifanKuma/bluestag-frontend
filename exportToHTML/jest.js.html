<html>
<head>
<title>jest.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #1750eb;}
.s6 { color: #0037a6;}
.s7 { color: #264eff;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
jest.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s3">/**</span>
 <span class="s3">* </span><span class="s4">@example</span>
 <span class="s3">* ```ts</span>
 <span class="s3">* // Usage in jest.config.js</span>
 <span class="s3">* const nextJest = require('next/jest');</span>
 <span class="s3">*</span>
 <span class="s3">* // Optionally provide path to Next.js app which will enable loading next.config.js and .env files</span>
 <span class="s3">* const createJestConfig = nextJest({ dir })</span>
 <span class="s3">*</span>
 <span class="s3">* // Any custom config you want to pass to Jest</span>
 <span class="s3">* const customJestConfig = {</span>
 <span class="s3">*     setupFilesAfterEnv: ['&lt;rootDir&gt;/jest.setup.js'],</span>
 <span class="s3">* }</span>
 <span class="s3">*</span>
 <span class="s3">* // createJestConfig is exported in this way to ensure that next/jest can load the Next.js config which is async</span>
 <span class="s3">* module.exports = createJestConfig(customJestConfig)</span>
 <span class="s3">* ```</span>
 <span class="s3">*</span>
 <span class="s3">* Read more: [Next.js Docs: Setting up Jest with Next.js](https://nextjs.org/docs/app/building-your-application/testing/jest)</span>
 <span class="s3">*/ </span><span class="s0">&quot;default&quot;</span><span class="s1">, {</span>
    <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
    <span class="s1">get: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">nextJest;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_env = require(</span><span class="s0">&quot;@next/env&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_path = require(</span><span class="s0">&quot;path&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_config = </span><span class="s3">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;../../server/config&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_constants = require(</span><span class="s0">&quot;../../shared/lib/constants&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_loadjsconfig = </span><span class="s3">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;../load-jsconfig&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_log = </span><span class="s3">/*#__PURE__*/ </span><span class="s1">_interop_require_wildcard(require(</span><span class="s0">&quot;../output/log&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_findpagesdir = require(</span><span class="s0">&quot;../../lib/find-pages-dir&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_swc = require(</span><span class="s0">&quot;../swc&quot;</span><span class="s1">);</span>
<span class="s2">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s2">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_getRequireWildcardCache(nodeInterop) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">WeakMap !== </span><span class="s0">&quot;function&quot;</span><span class="s1">) </span><span class="s2">return null</span><span class="s1">;</span>
    <span class="s2">var </span><span class="s1">cacheBabelInterop = </span><span class="s2">new </span><span class="s1">WeakMap();</span>
    <span class="s2">var </span><span class="s1">cacheNodeInterop = </span><span class="s2">new </span><span class="s1">WeakMap();</span>
    <span class="s2">return </span><span class="s1">(_getRequireWildcardCache = </span><span class="s2">function</span><span class="s1">(nodeInterop) {</span>
        <span class="s2">return </span><span class="s1">nodeInterop ? cacheNodeInterop : cacheBabelInterop;</span>
    <span class="s1">})(nodeInterop);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">_interop_require_wildcard(obj, nodeInterop) {</span>
    <span class="s2">if </span><span class="s1">(!nodeInterop &amp;&amp; obj &amp;&amp; obj.__esModule) {</span>
        <span class="s2">return </span><span class="s1">obj;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(obj === </span><span class="s2">null </span><span class="s1">|| </span><span class="s2">typeof </span><span class="s1">obj !== </span><span class="s0">&quot;object&quot; </span><span class="s1">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">obj !== </span><span class="s0">&quot;function&quot;</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">{</span>
            <span class="s2">default</span><span class="s1">: obj</span>
        <span class="s1">};</span>
    <span class="s1">}</span>
    <span class="s2">var </span><span class="s1">cache = _getRequireWildcardCache(nodeInterop);</span>
    <span class="s2">if </span><span class="s1">(cache &amp;&amp; cache.has(obj)) {</span>
        <span class="s2">return </span><span class="s1">cache.get(obj);</span>
    <span class="s1">}</span>
    <span class="s2">var </span><span class="s1">newObj = {</span>
        <span class="s1">__proto__: </span><span class="s2">null</span>
    <span class="s1">};</span>
    <span class="s2">var </span><span class="s1">hasPropertyDescriptor = Object.defineProperty &amp;&amp; Object.getOwnPropertyDescriptor;</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">key </span><span class="s2">in </span><span class="s1">obj){</span>
        <span class="s2">if </span><span class="s1">(key !== </span><span class="s0">&quot;default&quot; </span><span class="s1">&amp;&amp; Object.prototype.hasOwnProperty.call(obj, key)) {</span>
            <span class="s2">var </span><span class="s1">desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : </span><span class="s2">null</span><span class="s1">;</span>
            <span class="s2">if </span><span class="s1">(desc &amp;&amp; (desc.get || desc.set)) {</span>
                <span class="s1">Object.defineProperty(newObj, key, desc);</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                <span class="s1">newObj[key] = obj[key];</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s1">newObj.default = obj;</span>
    <span class="s2">if </span><span class="s1">(cache) {</span>
        <span class="s1">cache.set(obj, newObj);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">newObj;</span>
<span class="s1">}</span>
<span class="s2">const </span><span class="s1">DEFAULT_TRANSPILED_PACKAGES = require(</span><span class="s0">'../../lib/default-transpiled-packages.json'</span><span class="s1">);</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">getConfig(dir) {</span>
    <span class="s2">const </span><span class="s1">conf = </span><span class="s2">await </span><span class="s1">(</span><span class="s5">0</span><span class="s1">, _config.default)(_constants.PHASE_TEST, dir);</span>
    <span class="s2">return </span><span class="s1">conf;</span>
<span class="s1">}</span>
<span class="s3">/**</span>
 <span class="s3">* Loads closest package.json in the directory hierarchy</span>
 <span class="s3">*/ </span><span class="s2">function </span><span class="s1">loadClosestPackageJson(dir, attempts = </span><span class="s5">1</span><span class="s1">) {</span>
    <span class="s2">if </span><span class="s1">(attempts &gt; </span><span class="s5">5</span><span class="s1">) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">&quot;Can't resolve main package.json file&quot;</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E139&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">var </span><span class="s1">mainPath = attempts === </span><span class="s5">1 </span><span class="s1">? </span><span class="s0">'./' </span><span class="s1">: Array(attempts).join(</span><span class="s0">'../'</span><span class="s1">);</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s2">return </span><span class="s1">require((</span><span class="s5">0</span><span class="s1">, _path.join)(dir, mainPath + </span><span class="s0">'package.json'</span><span class="s1">));</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(e) {</span>
        <span class="s2">return </span><span class="s1">loadClosestPackageJson(dir, attempts + </span><span class="s5">1</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s3">/** Loads dotenv files and sets environment variables based on next config. */ </span><span class="s2">function </span><span class="s1">setUpEnv(dir) {</span>
    <span class="s2">const </span><span class="s1">dev = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s1">(</span><span class="s5">0</span><span class="s1">, _env.loadEnvConfig)(dir, dev, _log);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">nextJest(options = {}) {</span>
    <span class="s3">// createJestConfig</span>
    <span class="s2">return </span><span class="s1">(customJestConfig)=&gt;{</span>
        <span class="s3">// Function that is provided as the module.exports of jest.config.js</span>
        <span class="s3">// Will be called and awaited by Jest</span>
        <span class="s2">return </span><span class="s1">async ()=&gt;{</span>
            <span class="s2">var </span><span class="s1">_nextConfig_experimental, _nextConfig_experimental1;</span>
            <span class="s2">let </span><span class="s1">nextConfig;</span>
            <span class="s2">let </span><span class="s1">jsConfig;</span>
            <span class="s2">let </span><span class="s1">resolvedBaseUrl;</span>
            <span class="s2">let </span><span class="s1">isEsmProject = </span><span class="s2">false</span><span class="s1">;</span>
            <span class="s2">let </span><span class="s1">pagesDir;</span>
            <span class="s2">let </span><span class="s1">serverComponents;</span>
            <span class="s2">if </span><span class="s1">(options.dir) {</span>
                <span class="s2">const </span><span class="s1">resolvedDir = (</span><span class="s5">0</span><span class="s1">, _path.resolve)(options.dir);</span>
                <span class="s2">const </span><span class="s1">packageConfig = loadClosestPackageJson(resolvedDir);</span>
                <span class="s1">isEsmProject = packageConfig.type === </span><span class="s0">'module'</span><span class="s1">;</span>
                <span class="s1">nextConfig = </span><span class="s2">await </span><span class="s1">getConfig(resolvedDir);</span>
                <span class="s2">const </span><span class="s1">findPagesDirResult = (</span><span class="s5">0</span><span class="s1">, _findpagesdir.findPagesDir)(resolvedDir);</span>
                <span class="s1">serverComponents = !!findPagesDirResult.appDir;</span>
                <span class="s1">pagesDir = findPagesDirResult.pagesDir;</span>
                <span class="s1">setUpEnv(resolvedDir);</span>
                <span class="s3">// TODO: revisit when bug in SWC is fixed that strips `.css`</span>
                <span class="s2">const </span><span class="s1">result = </span><span class="s2">await </span><span class="s1">(</span><span class="s5">0</span><span class="s1">, _loadjsconfig.default)(resolvedDir, nextConfig);</span>
                <span class="s1">jsConfig = result.jsConfig;</span>
                <span class="s1">resolvedBaseUrl = result.resolvedBaseUrl;</span>
            <span class="s1">}</span>
            <span class="s3">// Ensure provided async config is supported</span>
            <span class="s2">const </span><span class="s1">resolvedJestConfig = (</span><span class="s2">typeof </span><span class="s1">customJestConfig === </span><span class="s0">'function' </span><span class="s1">? </span><span class="s2">await </span><span class="s1">customJestConfig() : customJestConfig) ?? {};</span>
            <span class="s3">// eagerly load swc bindings instead of waiting for transform calls</span>
            <span class="s2">await </span><span class="s1">(</span><span class="s5">0</span><span class="s1">, _swc.loadBindings)(nextConfig == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: (_nextConfig_experimental = nextConfig.experimental) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: _nextConfig_experimental.useWasmBinary);</span>
            <span class="s2">if </span><span class="s1">(_swc.lockfilePatchPromise.cur) {</span>
                <span class="s2">await </span><span class="s1">_swc.lockfilePatchPromise.cur;</span>
            <span class="s1">}</span>
            <span class="s2">const </span><span class="s1">transpiled = ((nextConfig == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: nextConfig.transpilePackages) ?? []).concat(DEFAULT_TRANSPILED_PACKAGES).join(</span><span class="s0">'|'</span><span class="s1">);</span>
            <span class="s2">const </span><span class="s1">jestTransformerConfig = {</span>
                <span class="s1">modularizeImports: nextConfig == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: nextConfig.modularizeImports,</span>
                <span class="s1">swcPlugins: nextConfig == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: (_nextConfig_experimental1 = nextConfig.experimental) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: _nextConfig_experimental1.swcPlugins,</span>
                <span class="s1">compilerOptions: nextConfig == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: nextConfig.compiler,</span>
                <span class="s1">jsConfig,</span>
                <span class="s1">resolvedBaseUrl,</span>
                <span class="s1">serverComponents,</span>
                <span class="s1">isEsmProject,</span>
                <span class="s1">pagesDir</span>
            <span class="s1">};</span>
            <span class="s2">return </span><span class="s1">{</span>
                <span class="s1">...resolvedJestConfig,</span>
                <span class="s1">moduleNameMapper: {</span>
                    <span class="s3">// Handle CSS imports (with CSS modules)</span>
                    <span class="s3">// https://jestjs.io/docs/webpack#mocking-css-modules</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.module</span><span class="s6">\\</span><span class="s0">.(css|sass|scss)$'</span><span class="s1">: require.resolve(</span><span class="s0">'./object-proxy.js'</span><span class="s1">),</span>
                    <span class="s3">// Handle CSS imports (without CSS modules)</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.(css|sass|scss)$'</span><span class="s1">: require.resolve(</span><span class="s0">'./__mocks__/styleMock.js'</span><span class="s1">),</span>
                    <span class="s3">// Handle image imports</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.(png|jpg|jpeg|gif|webp|avif|ico|bmp)$'</span><span class="s1">: require.resolve(</span><span class="s0">`./__mocks__/fileMock.js`</span><span class="s1">),</span>
                    <span class="s3">// Keep .svg to it's own rule to make overriding easy</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.(svg)$'</span><span class="s1">: require.resolve(</span><span class="s0">`./__mocks__/fileMock.js`</span><span class="s1">),</span>
                    <span class="s3">// Handle @next/font</span>
                    <span class="s0">'@next/font/(.*)'</span><span class="s1">: require.resolve(</span><span class="s0">'./__mocks__/nextFontMock.js'</span><span class="s1">),</span>
                    <span class="s3">// Handle next/font</span>
                    <span class="s0">'next/font/(.*)'</span><span class="s1">: require.resolve(</span><span class="s0">'./__mocks__/nextFontMock.js'</span><span class="s1">),</span>
                    <span class="s3">// Disable server-only</span>
                    <span class="s0">'^server-only$'</span><span class="s1">: require.resolve(</span><span class="s0">'./__mocks__/empty.js'</span><span class="s1">),</span>
                    <span class="s3">// custom config comes last to ensure the above rules are matched,</span>
                    <span class="s3">// fixes the case where @pages/(.*) -&gt; src/pages/$! doesn't break</span>
                    <span class="s3">// CSS/image mocks</span>
                    <span class="s1">...resolvedJestConfig.moduleNameMapper || {}</span>
                <span class="s1">},</span>
                <span class="s1">testPathIgnorePatterns: [</span>
                    <span class="s3">// Don't look for tests in node_modules</span>
                    <span class="s0">'/node_modules/'</span><span class="s1">,</span>
                    <span class="s3">// Don't look for tests in the Next.js build output</span>
                    <span class="s0">'/.next/'</span><span class="s1">,</span>
                    <span class="s3">// Custom config can append to testPathIgnorePatterns but not modify it</span>
                    <span class="s3">// This is to ensure `.next` and `node_modules` are always excluded</span>
                    <span class="s1">...resolvedJestConfig.testPathIgnorePatterns || []</span>
                <span class="s1">],</span>
                <span class="s1">transform: {</span>
                    <span class="s3">// Use SWC to compile tests</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.(js|jsx|ts|tsx|mjs)$'</span><span class="s1">: [</span>
                        <span class="s1">require.resolve(</span><span class="s0">'../swc/jest-transformer'</span><span class="s1">),</span>
                        <span class="s1">jestTransformerConfig</span>
                    <span class="s1">],</span>
                    <span class="s3">// Allow for appending/overriding the default transforms</span>
                    <span class="s1">...resolvedJestConfig.transform || {}</span>
                <span class="s1">},</span>
                <span class="s1">transformIgnorePatterns: [</span>
                    <span class="s3">// To match Next.js behavior node_modules is not transformed, only `transpiledPackages`</span>
                    <span class="s1">...transpiled ? [</span>
                        <span class="s0">`/node_modules/(?!.pnpm)(?!(</span><span class="s1">${transpiled}</span><span class="s0">)/)`</span><span class="s1">,</span>
                        <span class="s0">`/node_modules/.pnpm/(?!(</span><span class="s1">${transpiled.replace(</span><span class="s7">/\//g</span><span class="s1">, </span><span class="s0">'</span><span class="s6">\\</span><span class="s0">+'</span><span class="s1">)}</span><span class="s0">)@)`</span>
                    <span class="s1">] : [</span>
                        <span class="s0">'/node_modules/'</span>
                    <span class="s1">],</span>
                    <span class="s3">// CSS modules are mocked so they don't need to be transformed</span>
                    <span class="s0">'^.+</span><span class="s6">\\</span><span class="s0">.module</span><span class="s6">\\</span><span class="s0">.(css|sass|scss)$'</span><span class="s1">,</span>
                    <span class="s3">// Custom config can append to transformIgnorePatterns but not modify it</span>
                    <span class="s3">// This is to ensure `node_modules` and .module.css/sass/scss are always excluded</span>
                    <span class="s1">...resolvedJestConfig.transformIgnorePatterns || []</span>
                <span class="s1">],</span>
                <span class="s1">watchPathIgnorePatterns: [</span>
                    <span class="s3">// Don't re-run tests when the Next.js build output changes</span>
                    <span class="s0">'/.next/'</span><span class="s1">,</span>
                    <span class="s1">...resolvedJestConfig.watchPathIgnorePatterns || []</span>
                <span class="s1">]</span>
            <span class="s1">};</span>
        <span class="s1">};</span>
    <span class="s1">};</span>
<span class="s1">}</span>

<span class="s2">if </span><span class="s1">((</span><span class="s2">typeof </span><span class="s1">exports.default === </span><span class="s0">'function' </span><span class="s1">|| (</span><span class="s2">typeof </span><span class="s1">exports.default === </span><span class="s0">'object' </span><span class="s1">&amp;&amp; exports.default !== </span><span class="s2">null</span><span class="s1">)) &amp;&amp; </span><span class="s2">typeof </span><span class="s1">exports.default.__esModule === </span><span class="s0">'undefined'</span><span class="s1">) {</span>
  <span class="s1">Object.defineProperty(exports.default, </span><span class="s0">'__esModule'</span><span class="s1">, { value: </span><span class="s2">true </span><span class="s1">});</span>
  <span class="s1">Object.assign(exports.default, exports);</span>
  <span class="s1">module.exports = exports.default;</span>
<span class="s1">}</span>

<span class="s3">//# sourceMappingURL=jest.js.map</span></pre>
</body>
</html>