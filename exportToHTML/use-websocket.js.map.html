<html>
<head>
<title>use-websocket.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
use-websocket.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../../src/client/dev/hot-reloader/app/use-websocket.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { useCallback, useContext, useEffect, useRef } from 'react'</span><span class="s3">\n</span><span class="s1">import { GlobalLayoutRouterContext } from '../../../../shared/lib/app-router-context.shared-runtime'</span><span class="s3">\n</span><span class="s1">import { getSocketUrl } from '../get-socket-url'</span><span class="s3">\n</span><span class="s1">import type { TurbopackMsgToBrowser } from '../../../../server/dev/hot-reloader-types'</span><span class="s3">\n\n</span><span class="s1">export function useWebsocket(assetPrefix: string) {</span><span class="s3">\n  </span><span class="s1">const webSocketRef = useRef&lt;WebSocket&gt;(undefined)</span><span class="s3">\n\n  </span><span class="s1">useEffect(() =&gt; {</span><span class="s3">\n    </span><span class="s1">if (webSocketRef.current) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const url = getSocketUrl(assetPrefix)</span><span class="s3">\n\n    </span><span class="s1">webSocketRef.current = new window.WebSocket(`${url}/_next/webpack-hmr`)</span><span class="s3">\n  </span><span class="s1">}, [assetPrefix])</span><span class="s3">\n\n  </span><span class="s1">return webSocketRef</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function useSendMessage(webSocketRef: ReturnType&lt;typeof useWebsocket&gt;) {</span><span class="s3">\n  </span><span class="s1">const sendMessage = useCallback(</span><span class="s3">\n    </span><span class="s1">(data: string) =&gt; {</span><span class="s3">\n      </span><span class="s1">const socket = webSocketRef.current</span><span class="s3">\n      </span><span class="s1">if (!socket || socket.readyState !== socket.OPEN) {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">return socket.send(data)</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">[webSocketRef]</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">return sendMessage</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function useTurbopack(</span><span class="s3">\n  </span><span class="s1">sendMessage: ReturnType&lt;typeof useSendMessage&gt;,</span><span class="s3">\n  </span><span class="s1">onUpdateError: (err: unknown) =&gt; void</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const turbopackState = useRef&lt;{</span><span class="s3">\n    </span><span class="s1">init: boolean</span><span class="s3">\n    </span><span class="s1">queue: Array&lt;TurbopackMsgToBrowser&gt; | undefined</span><span class="s3">\n    </span><span class="s1">callback: ((msg: TurbopackMsgToBrowser) =&gt; void) | undefined</span><span class="s3">\n  </span><span class="s1">}&gt;({</span><span class="s3">\n    </span><span class="s1">init: false,</span><span class="s3">\n    </span><span class="s1">// Until the dynamic import resolves, queue any turbopack messages which will be replayed.</span><span class="s3">\n    </span><span class="s1">queue: [],</span><span class="s3">\n    </span><span class="s1">callback: undefined,</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">const processTurbopackMessage = useCallback((msg: TurbopackMsgToBrowser) =&gt; {</span><span class="s3">\n    </span><span class="s1">const { callback, queue } = turbopackState.current</span><span class="s3">\n    </span><span class="s1">if (callback) {</span><span class="s3">\n      </span><span class="s1">callback(msg)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">queue!.push(msg)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}, [])</span><span class="s3">\n\n  </span><span class="s1">useEffect(() =&gt; {</span><span class="s3">\n    </span><span class="s1">const { current: initCurrent } = turbopackState</span><span class="s3">\n    </span><span class="s1">// TODO(WEB-1589): only install if `process.turbopack` set.</span><span class="s3">\n    </span><span class="s1">if (initCurrent.init) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">initCurrent.init = true</span><span class="s3">\n\n    </span><span class="s1">import(</span><span class="s3">\n      </span><span class="s1">// @ts-expect-error requires </span><span class="s3">\&quot;</span><span class="s1">moduleResolution</span><span class="s3">\&quot;</span><span class="s1">: </span><span class="s3">\&quot;</span><span class="s1">node16</span><span class="s3">\&quot; </span><span class="s1">in tsconfig.json and not .ts extension</span><span class="s3">\n      </span><span class="s1">'@vercel/turbopack-ecmascript-runtime/browser/dev/hmr-client/hmr-client.ts'</span><span class="s3">\n    </span><span class="s1">).then(({ connect }) =&gt; {</span><span class="s3">\n      </span><span class="s1">const { current } = turbopackState</span><span class="s3">\n      </span><span class="s1">connect({</span><span class="s3">\n        </span><span class="s1">addMessageListener(cb: (msg: TurbopackMsgToBrowser) =&gt; void) {</span><span class="s3">\n          </span><span class="s1">current.callback = cb</span><span class="s3">\n\n          </span><span class="s1">// Replay all Turbopack messages before we were able to establish the HMR client.</span><span class="s3">\n          </span><span class="s1">for (const msg of current.queue!) {</span><span class="s3">\n            </span><span class="s1">cb(msg)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">current.queue = undefined</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">sendMessage,</span><span class="s3">\n        </span><span class="s1">onUpdateError,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}, [sendMessage, onUpdateError])</span><span class="s3">\n\n  </span><span class="s1">return processTurbopackMessage</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function useWebsocketPing(</span><span class="s3">\n  </span><span class="s1">websocketRef: ReturnType&lt;typeof useWebsocket&gt;</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const sendMessage = useSendMessage(websocketRef)</span><span class="s3">\n  </span><span class="s1">const { tree } = useContext(GlobalLayoutRouterContext)</span><span class="s3">\n\n  </span><span class="s1">useEffect(() =&gt; {</span><span class="s3">\n    </span><span class="s1">// Never send pings when using Turbopack as it's not used.</span><span class="s3">\n    </span><span class="s1">// Pings were originally used to keep track of active routes in on-demand-entries with webpack.</span><span class="s3">\n    </span><span class="s1">if (process.env.TURBOPACK) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Taken from on-demand-entries-client.js</span><span class="s3">\n    </span><span class="s1">const interval = setInterval(() =&gt; {</span><span class="s3">\n      </span><span class="s1">sendMessage(</span><span class="s3">\n        </span><span class="s1">JSON.stringify({</span><span class="s3">\n          </span><span class="s1">event: 'ping',</span><span class="s3">\n          </span><span class="s1">tree,</span><span class="s3">\n          </span><span class="s1">appDirRoute: true,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}, 2500)</span><span class="s3">\n    </span><span class="s1">return () =&gt; clearInterval(interval)</span><span class="s3">\n  </span><span class="s1">}, [tree, sendMessage])</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;useSendMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;useTurbopack&quot;</span><span class="s0">,</span><span class="s1">&quot;useWebsocket&quot;</span><span class="s0">,</span><span class="s1">&quot;useWebsocketPing&quot;</span><span class="s0">,</span><span class="s1">&quot;assetPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;webSocketRef&quot;</span><span class="s0">,</span><span class="s1">&quot;useRef&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;useEffect&quot;</span><span class="s0">,</span><span class="s1">&quot;current&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;getSocketUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;window&quot;</span><span class="s0">,</span><span class="s1">&quot;WebSocket&quot;</span><span class="s0">,</span><span class="s1">&quot;sendMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;useCallback&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;socket&quot;</span><span class="s0">,</span><span class="s1">&quot;readyState&quot;</span><span class="s0">,</span><span class="s1">&quot;OPEN&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;onUpdateError&quot;</span><span class="s0">,</span><span class="s1">&quot;turbopackState&quot;</span><span class="s0">,</span><span class="s1">&quot;init&quot;</span><span class="s0">,</span><span class="s1">&quot;queue&quot;</span><span class="s0">,</span><span class="s1">&quot;callback&quot;</span><span class="s0">,</span><span class="s1">&quot;processTurbopackMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;msg&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;initCurrent&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">,</span><span class="s1">&quot;connect&quot;</span><span class="s0">,</span><span class="s1">&quot;addMessageListener&quot;</span><span class="s0">,</span><span class="s1">&quot;cb&quot;</span><span class="s0">,</span><span class="s1">&quot;websocketRef&quot;</span><span class="s0">,</span><span class="s1">&quot;tree&quot;</span><span class="s0">,</span><span class="s1">&quot;useContext&quot;</span><span class="s0">,</span><span class="s1">&quot;GlobalLayoutRouterContext&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;TURBOPACK&quot;</span><span class="s0">,</span><span class="s1">&quot;interval&quot;</span><span class="s0">,</span><span class="s1">&quot;setInterval&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;event&quot;</span><span class="s0">,</span><span class="s1">&quot;appDirRoute&quot;</span><span class="s0">,</span><span class="s1">&quot;clearInterval&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;;;IAqBgBA,cAAc;eAAdA;;IAcAC,YAAY;eAAZA;;IA9BAC,YAAY;eAAZA;;IAsFAC,gBAAgB;eAAhBA;;;uBA3F2C;+CACjB;8BACb;AAGtB,SAASD,aAAaE,WAAmB;IAC9C,MAAMC,eAAeC,IAAAA,aAAM,EAAYC;IAEvCC,IAAAA,gBAAS,EAAC;QACR,IAAIH,aAAaI,OAAO,EAAE;YACxB;QACF;QAEA,MAAMC,MAAMC,IAAAA,0BAAY,EAACP;QAEzBC,aAAaI,OAAO,GAAG,IAAIG,OAAOC,SAAS,CAAC,AAAC,KAAEH,MAAI;IACrD,GAAG;QAACN;KAAY;IAEhB,OAAOC;AACT;AAEO,SAASL,eAAeK,YAA6C;IAC1E,MAAMS,cAAcC,IAAAA,kBAAW,EAC7B,CAACC;QACC,MAAMC,SAASZ,aAAaI,OAAO;QACnC,IAAI,CAACQ,UAAUA,OAAOC,UAAU,KAAKD,OAAOE,IAAI,EAAE;YAChD;QACF;QACA,OAAOF,OAAOG,IAAI,CAACJ;IACrB,GACA;QAACX;KAAa;IAEhB,OAAOS;AACT;AAEO,SAASb,aACda,WAA8C,EAC9CO,aAAqC;IAErC,MAAMC,iBAAiBhB,IAAAA,aAAM,EAI1B;QACDiB,MAAM;QACN,0FAA0F;QAC1FC,OAAO,EAAE;QACTC,UAAUlB;IACZ;IAEA,MAAMmB,0BAA0BX,IAAAA,kBAAW,EAAC,CAACY;QAC3C,MAAM,EAAEF,QAAQ,EAAED,KAAK,EAAE,GAAGF,eAAeb,OAAO;QAClD,IAAIgB,UAAU;YACZA,SAASE;QACX,OAAO;YACLH,MAAOI,IAAI,CAACD;QACd;IACF,GAAG,EAAE;IAELnB,IAAAA,gBAAS,EAAC;QACR,MAAM,EAAEC,SAASoB,WAAW,EAAE,GAAGP;QACjC,2DAA2D;QAC3D,IAAIO,YAAYN,IAAI,EAAE;YACpB;QACF;QACAM,YAAYN,IAAI,GAAG;QAEnB,MAAM,CACJ,gGAAgG;QAChG,6EACAO,IAAI,CAAC;gBAAC,EAAEC,OAAO,EAAE;YACjB,MAAM,EAAEtB,OAAO,EAAE,GAAGa;YACpBS,QAAQ;gBACNC,oBAAmBC,EAAwC;oBACzDxB,QAAQgB,QAAQ,GAAGQ;oBAEnB,iFAAiF;oBACjF,KAAK,MAAMN,OAAOlB,QAAQe,KAAK,CAAG;wBAChCS,GAAGN;oBACL;oBACAlB,QAAQe,KAAK,GAAGjB;gBAClB;gBACAO;gBACAO;YACF;QACF;IACF,GAAG;QAACP;QAAaO;KAAc;IAE/B,OAAOK;AACT;AAEO,SAASvB,iBACd+B,YAA6C;IAE7C,MAAMpB,cAAcd,eAAekC;IACnC,MAAM,EAAEC,IAAI,EAAE,GAAGC,IAAAA,iBAAU,EAACC,wDAAyB;IAErD7B,IAAAA,gBAAS,EAAC;QACR,0DAA0D;QAC1D,+FAA+F;QAC/F,IAAI8B,QAAQC,GAAG,CAACC,SAAS,EAAE;YACzB;QACF;QAEA,yCAAyC;QACzC,MAAMC,WAAWC,YAAY;YAC3B5B,YACE6B,KAAKC,SAAS,CAAC;gBACbC,OAAO;gBACPV;gBACAW,aAAa;YACf;QAEJ,GAAG;QACH,OAAO,IAAMC,cAAcN;IAC7B,GAAG;QAACN;QAAMrB;KAAY;AACxB&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>