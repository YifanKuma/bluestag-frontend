<html>
<head>
<title>dev-app-page-route-matcher-provider.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
dev-app-page-route-matcher-provider.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/server/route-matcher-providers/dev/dev-app-page-route-matcher-provider.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { FileReader } from './helpers/file-reader/file-reader'</span><span class="s3">\n</span><span class="s1">import { AppPageRouteMatcher } from '../../route-matchers/app-page-route-matcher'</span><span class="s3">\n</span><span class="s1">import { RouteKind } from '../../route-kind'</span><span class="s3">\n</span><span class="s1">import { FileCacheRouteMatcherProvider } from './file-cache-route-matcher-provider'</span><span class="s3">\n\n</span><span class="s1">import { DevAppNormalizers } from '../../normalizers/built/app'</span><span class="s3">\n</span><span class="s1">import { normalizeCatchAllRoutes } from '../../../build/normalize-catchall-routes'</span><span class="s3">\n\n</span><span class="s1">export class DevAppPageRouteMatcherProvider extends FileCacheRouteMatcherProvider&lt;AppPageRouteMatcher&gt; {</span><span class="s3">\n  </span><span class="s1">private readonly expression: RegExp</span><span class="s3">\n  </span><span class="s1">private readonly normalizers: DevAppNormalizers</span><span class="s3">\n  </span><span class="s1">private readonly isTurbopack: boolean</span><span class="s3">\n\n  </span><span class="s1">constructor(</span><span class="s3">\n    </span><span class="s1">appDir: string,</span><span class="s3">\n    </span><span class="s1">extensions: ReadonlyArray&lt;string&gt;,</span><span class="s3">\n    </span><span class="s1">reader: FileReader,</span><span class="s3">\n    </span><span class="s1">isTurbopack: boolean</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">super(appDir, reader)</span><span class="s3">\n\n    </span><span class="s1">this.normalizers = new DevAppNormalizers(appDir, extensions, isTurbopack)</span><span class="s3">\n\n    </span><span class="s1">// Match any page file that ends with `/page.${extension}` or `/default.${extension}` under the app</span><span class="s3">\n    </span><span class="s1">// directory.</span><span class="s3">\n    </span><span class="s1">this.expression = new RegExp(</span><span class="s3">\n      </span><span class="s1">`[/</span><span class="s3">\\\\\\\\</span><span class="s1">](page|default)</span><span class="s3">\\\\</span><span class="s1">.(?:${extensions.join('|')})$`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">this.isTurbopack = isTurbopack</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async transform(</span><span class="s3">\n    </span><span class="s1">files: ReadonlyArray&lt;string&gt;</span><span class="s3">\n  </span><span class="s1">): Promise&lt;ReadonlyArray&lt;AppPageRouteMatcher&gt;&gt; {</span><span class="s3">\n    </span><span class="s1">// Collect all the app paths for each page. This could include any parallel</span><span class="s3">\n    </span><span class="s1">// routes.</span><span class="s3">\n    </span><span class="s1">const cache = new Map&lt;</span><span class="s3">\n      </span><span class="s1">string,</span><span class="s3">\n      </span><span class="s1">{ page: string; pathname: string; bundlePath: string }</span><span class="s3">\n    </span><span class="s1">&gt;()</span><span class="s3">\n    </span><span class="s1">const routeFilenames = new Array&lt;string&gt;()</span><span class="s3">\n    </span><span class="s1">let appPaths: Record&lt;string, string[]&gt; = {}</span><span class="s3">\n    </span><span class="s1">for (const filename of files) {</span><span class="s3">\n      </span><span class="s1">// If the file isn't a match for this matcher, then skip it.</span><span class="s3">\n      </span><span class="s1">if (!this.expression.test(filename)) continue</span><span class="s3">\n\n      </span><span class="s1">let page = this.normalizers.page.normalize(filename)</span><span class="s3">\n\n      </span><span class="s1">// Validate that this is not an ignored page.</span><span class="s3">\n      </span><span class="s1">if (page.includes('/_')) continue</span><span class="s3">\n\n      </span><span class="s1">// Turbopack uses the correct page name with the underscore normalized.</span><span class="s3">\n      </span><span class="s1">// TODO: Move implementation to packages/next/src/server/normalizers/built/app/app-page-normalizer.ts.</span><span class="s3">\n      </span><span class="s1">// The `includes('/_')` check above needs to be moved for that to work as otherwise `%5Fsegmentname`</span><span class="s3">\n      </span><span class="s1">// will result in `_segmentname` which hits that includes check and be skipped.</span><span class="s3">\n      </span><span class="s1">if (this.isTurbopack) {</span><span class="s3">\n        </span><span class="s1">page = page.replace(/%5F/g, '_')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// This is a valid file that we want to create a matcher for.</span><span class="s3">\n      </span><span class="s1">routeFilenames.push(filename)</span><span class="s3">\n\n      </span><span class="s1">const pathname = this.normalizers.pathname.normalize(filename)</span><span class="s3">\n      </span><span class="s1">const bundlePath = this.normalizers.bundlePath.normalize(filename)</span><span class="s3">\n\n      </span><span class="s1">// Save the normalization results.</span><span class="s3">\n      </span><span class="s1">cache.set(filename, { page, pathname, bundlePath })</span><span class="s3">\n\n      </span><span class="s1">if (pathname in appPaths) appPaths[pathname].push(page)</span><span class="s3">\n      </span><span class="s1">else appPaths[pathname] = [page]</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">normalizeCatchAllRoutes(appPaths)</span><span class="s3">\n\n    </span><span class="s1">// Make sure to sort parallel routes to make the result deterministic.</span><span class="s3">\n    </span><span class="s1">appPaths = Object.fromEntries(</span><span class="s3">\n      </span><span class="s1">Object.entries(appPaths).map(([k, v]) =&gt; [k, v.sort()])</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">const matchers: Array&lt;AppPageRouteMatcher&gt; = []</span><span class="s3">\n    </span><span class="s1">for (const filename of routeFilenames) {</span><span class="s3">\n      </span><span class="s1">// Grab the cached values (and the appPaths).</span><span class="s3">\n      </span><span class="s1">const cached = cache.get(filename)</span><span class="s3">\n      </span><span class="s1">if (!cached) {</span><span class="s3">\n        </span><span class="s1">throw new Error('Invariant: expected filename to exist in cache')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">const { pathname, page, bundlePath } = cached</span><span class="s3">\n\n      </span><span class="s1">matchers.push(</span><span class="s3">\n        </span><span class="s1">new AppPageRouteMatcher({</span><span class="s3">\n          </span><span class="s1">kind: RouteKind.APP_PAGE,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">page,</span><span class="s3">\n          </span><span class="s1">bundlePath,</span><span class="s3">\n          </span><span class="s1">filename,</span><span class="s3">\n          </span><span class="s1">appPaths: appPaths[pathname],</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return matchers</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;DevAppPageRouteMatcherProvider&quot;</span><span class="s0">,</span><span class="s1">&quot;FileCacheRouteMatcherProvider&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;appDir&quot;</span><span class="s0">,</span><span class="s1">&quot;extensions&quot;</span><span class="s0">,</span><span class="s1">&quot;reader&quot;</span><span class="s0">,</span><span class="s1">&quot;isTurbopack&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizers&quot;</span><span class="s0">,</span><span class="s1">&quot;DevAppNormalizers&quot;</span><span class="s0">,</span><span class="s1">&quot;expression&quot;</span><span class="s0">,</span><span class="s1">&quot;RegExp&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;transform&quot;</span><span class="s0">,</span><span class="s1">&quot;files&quot;</span><span class="s0">,</span><span class="s1">&quot;cache&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;routeFilenames&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;appPaths&quot;</span><span class="s0">,</span><span class="s1">&quot;filename&quot;</span><span class="s0">,</span><span class="s1">&quot;test&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;normalize&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;bundlePath&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeCatchAllRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;fromEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;entries&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;k&quot;</span><span class="s0">,</span><span class="s1">&quot;v&quot;</span><span class="s0">,</span><span class="s1">&quot;sort&quot;</span><span class="s0">,</span><span class="s1">&quot;matchers&quot;</span><span class="s0">,</span><span class="s1">&quot;cached&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;AppPageRouteMatcher&quot;</span><span class="s0">,</span><span class="s1">&quot;kind&quot;</span><span class="s0">,</span><span class="s1">&quot;RouteKind&quot;</span><span class="s0">,</span><span class="s1">&quot;APP_PAGE&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAQaA;;;eAAAA;;;qCAPuB;2BACV;+CACoB;qBAEZ;yCACM;AAEjC,MAAMA,uCAAuCC,4DAA6B;IAK/EC,YACEC,MAAc,EACdC,UAAiC,EACjCC,MAAkB,EAClBC,WAAoB,CACpB;QACA,KAAK,CAACH,QAAQE;QAEd,IAAI,CAACE,WAAW,GAAG,IAAIC,sBAAiB,CAACL,QAAQC,YAAYE;QAE7D,mGAAmG;QACnG,aAAa;QACb,IAAI,CAACG,UAAU,GAAG,IAAIC,OACpB,CAAC,2BAA2B,EAAEN,WAAWO,IAAI,CAAC,KAAK,EAAE,CAAC;QAExD,IAAI,CAACL,WAAW,GAAGA;IACrB;IAEA,MAAgBM,UACdC,KAA4B,EACiB;QAC7C,2EAA2E;QAC3E,UAAU;QACV,MAAMC,QAAQ,IAAIC;QAIlB,MAAMC,iBAAiB,IAAIC;QAC3B,IAAIC,WAAqC,CAAC;QAC1C,KAAK,MAAMC,YAAYN,MAAO;YAC5B,4DAA4D;YAC5D,IAAI,CAAC,IAAI,CAACJ,UAAU,CAACW,IAAI,CAACD,WAAW;YAErC,IAAIE,OAAO,IAAI,CAACd,WAAW,CAACc,IAAI,CAACC,SAAS,CAACH;YAE3C,6CAA6C;YAC7C,IAAIE,KAAKE,QAAQ,CAAC,OAAO;YAEzB,uEAAuE;YACvE,sGAAsG;YACtG,oGAAoG;YACpG,+EAA+E;YAC/E,IAAI,IAAI,CAACjB,WAAW,EAAE;gBACpBe,OAAOA,KAAKG,OAAO,CAAC,QAAQ;YAC9B;YAEA,6DAA6D;YAC7DR,eAAeS,IAAI,CAACN;YAEpB,MAAMO,WAAW,IAAI,CAACnB,WAAW,CAACmB,QAAQ,CAACJ,SAAS,CAACH;YACrD,MAAMQ,aAAa,IAAI,CAACpB,WAAW,CAACoB,UAAU,CAACL,SAAS,CAACH;YAEzD,kCAAkC;YAClCL,MAAMc,GAAG,CAACT,UAAU;gBAAEE;gBAAMK;gBAAUC;YAAW;YAEjD,IAAID,YAAYR,UAAUA,QAAQ,CAACQ,SAAS,CAACD,IAAI,CAACJ;iBAC7CH,QAAQ,CAACQ,SAAS,GAAG;gBAACL;aAAK;QAClC;QAEAQ,IAAAA,gDAAuB,EAACX;QAExB,sEAAsE;QACtEA,WAAWY,OAAOC,WAAW,CAC3BD,OAAOE,OAAO,CAACd,UAAUe,GAAG,CAAC,CAAC,CAACC,GAAGC,EAAE,GAAK;gBAACD;gBAAGC,EAAEC,IAAI;aAAG;QAGxD,MAAMC,WAAuC,EAAE;QAC/C,KAAK,MAAMlB,YAAYH,eAAgB;YACrC,6CAA6C;YAC7C,MAAMsB,SAASxB,MAAMyB,GAAG,CAACpB;YACzB,IAAI,CAACmB,QAAQ;gBACX,MAAM,qBAA2D,CAA3D,IAAIE,MAAM,mDAAV,qBAAA;2BAAA;gCAAA;kCAAA;gBAA0D;YAClE;YACA,MAAM,EAAEd,QAAQ,EAAEL,IAAI,EAAEM,UAAU,EAAE,GAAGW;YAEvCD,SAASZ,IAAI,CACX,IAAIgB,wCAAmB,CAAC;gBACtBC,MAAMC,oBAAS,CAACC,QAAQ;gBACxBlB;gBACAL;gBACAM;gBACAR;gBACAD,UAAUA,QAAQ,CAACQ,SAAS;YAC9B;QAEJ;QACA,OAAOW;IACT;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>