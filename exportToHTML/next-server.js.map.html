<html>
<head>
<title>next-server.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
next-server.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/server/next-server.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import './node-environment'</span><span class="s3">\n</span><span class="s1">import './require-hook'</span><span class="s3">\n</span><span class="s1">import './node-polyfill-crypto'</span><span class="s3">\n\n</span><span class="s1">import type { CacheFs } from '../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">DecodeError,</span><span class="s3">\n  </span><span class="s1">PageNotFoundError,</span><span class="s3">\n  </span><span class="s1">MiddlewareNotFoundError,</span><span class="s3">\n</span><span class="s1">} from '../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import type { MiddlewareManifest } from '../build/webpack/plugins/middleware-plugin'</span><span class="s3">\n</span><span class="s1">import type RenderResult from './render-result'</span><span class="s3">\n</span><span class="s1">import type { FetchEventResult } from './web/types'</span><span class="s3">\n</span><span class="s1">import type { PrerenderManifest, RoutesManifest } from '../build'</span><span class="s3">\n</span><span class="s1">import type { PagesManifest } from '../build/webpack/plugins/pages-manifest-plugin'</span><span class="s3">\n</span><span class="s1">import type { NextParsedUrlQuery, NextUrlWithParsedQuery } from './request-meta'</span><span class="s3">\n</span><span class="s1">import type { Params } from './request/params'</span><span class="s3">\n</span><span class="s1">import type { MiddlewareRouteMatch } from '../shared/lib/router/utils/middleware-route-matcher'</span><span class="s3">\n</span><span class="s1">import type { RouteMatch } from './route-matches/route-match'</span><span class="s3">\n</span><span class="s1">import type { IncomingMessage, ServerResponse } from 'http'</span><span class="s3">\n</span><span class="s1">import type { UrlWithParsedQuery } from 'url'</span><span class="s3">\n</span><span class="s1">import type { ParsedUrlQuery } from 'querystring'</span><span class="s3">\n</span><span class="s1">import type { ParsedUrl } from '../shared/lib/router/utils/parse-url'</span><span class="s3">\n</span><span class="s1">import type { CacheControl } from './lib/cache-control'</span><span class="s3">\n</span><span class="s1">import type { WaitUntil } from './after/builtin-request-context'</span><span class="s3">\n\n</span><span class="s1">import fs from 'fs'</span><span class="s3">\n</span><span class="s1">import { join, relative } from 'path'</span><span class="s3">\n</span><span class="s1">import { getRouteMatcher } from '../shared/lib/router/utils/route-matcher'</span><span class="s3">\n</span><span class="s1">import { addRequestMeta, getRequestMeta } from './request-meta'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">PAGES_MANIFEST,</span><span class="s3">\n  </span><span class="s1">BUILD_ID_FILE,</span><span class="s3">\n  </span><span class="s1">MIDDLEWARE_MANIFEST,</span><span class="s3">\n  </span><span class="s1">PRERENDER_MANIFEST,</span><span class="s3">\n  </span><span class="s1">ROUTES_MANIFEST,</span><span class="s3">\n  </span><span class="s1">CLIENT_PUBLIC_FILES_PATH,</span><span class="s3">\n  </span><span class="s1">APP_PATHS_MANIFEST,</span><span class="s3">\n  </span><span class="s1">SERVER_DIRECTORY,</span><span class="s3">\n  </span><span class="s1">NEXT_FONT_MANIFEST,</span><span class="s3">\n  </span><span class="s1">UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,</span><span class="s3">\n  </span><span class="s1">FUNCTIONS_CONFIG_MANIFEST,</span><span class="s3">\n</span><span class="s1">} from '../shared/lib/constants'</span><span class="s3">\n</span><span class="s1">import { findDir } from '../lib/find-pages-dir'</span><span class="s3">\n</span><span class="s1">import { NodeNextRequest, NodeNextResponse } from './base-http/node'</span><span class="s3">\n</span><span class="s1">import { sendRenderResult } from './send-payload'</span><span class="s3">\n</span><span class="s1">import { parseUrl } from '../shared/lib/router/utils/parse-url'</span><span class="s3">\n</span><span class="s1">import * as Log from '../build/output/log'</span><span class="s3">\n\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">Options,</span><span class="s3">\n  </span><span class="s1">FindComponentsResult,</span><span class="s3">\n  </span><span class="s1">MiddlewareRoutingItem,</span><span class="s3">\n  </span><span class="s1">RequestContext,</span><span class="s3">\n  </span><span class="s1">NormalizedRouteManifest,</span><span class="s3">\n  </span><span class="s1">LoadedRenderOpts,</span><span class="s3">\n  </span><span class="s1">RouteHandler,</span><span class="s3">\n  </span><span class="s1">NextEnabledDirectories,</span><span class="s3">\n  </span><span class="s1">BaseRequestHandler,</span><span class="s3">\n</span><span class="s1">} from './base-server'</span><span class="s3">\n</span><span class="s1">import BaseServer from './base-server'</span><span class="s3">\n</span><span class="s1">import { getMaybePagePath, getPagePath } from './require'</span><span class="s3">\n</span><span class="s1">import { denormalizePagePath } from '../shared/lib/page-path/denormalize-page-path'</span><span class="s3">\n</span><span class="s1">import { normalizePagePath } from '../shared/lib/page-path/normalize-page-path'</span><span class="s3">\n</span><span class="s1">import { loadComponents } from './load-components'</span><span class="s3">\n</span><span class="s1">import type { LoadComponentsReturnType } from './load-components'</span><span class="s3">\n</span><span class="s1">import isError, { getProperError } from '../lib/is-error'</span><span class="s3">\n</span><span class="s1">import { splitCookiesString, toNodeOutgoingHttpHeaders } from './web/utils'</span><span class="s3">\n</span><span class="s1">import { getMiddlewareRouteMatcher } from '../shared/lib/router/utils/middleware-route-matcher'</span><span class="s3">\n</span><span class="s1">import { loadEnvConfig } from '@next/env'</span><span class="s3">\n</span><span class="s1">import { urlQueryToSearchParams } from '../shared/lib/router/utils/querystring'</span><span class="s3">\n</span><span class="s1">import { removeTrailingSlash } from '../shared/lib/router/utils/remove-trailing-slash'</span><span class="s3">\n</span><span class="s1">import { getNextPathnameInfo } from '../shared/lib/router/utils/get-next-pathname-info'</span><span class="s3">\n</span><span class="s1">import { getCloneableBody } from './body-streams'</span><span class="s3">\n</span><span class="s1">import { checkIsOnDemandRevalidate } from './api-utils'</span><span class="s3">\n</span><span class="s1">import ResponseCache, {</span><span class="s3">\n  </span><span class="s1">CachedRouteKind,</span><span class="s3">\n  </span><span class="s1">type IncrementalResponseCacheEntry,</span><span class="s3">\n</span><span class="s1">} from './response-cache'</span><span class="s3">\n</span><span class="s1">import { IncrementalCache } from './lib/incremental-cache'</span><span class="s3">\n</span><span class="s1">import { normalizeAppPath } from '../shared/lib/router/utils/app-paths'</span><span class="s3">\n\n</span><span class="s1">import { setHttpClientAndAgentOptions } from './setup-http-agent-env'</span><span class="s3">\n\n</span><span class="s1">import { isPagesAPIRouteMatch } from './route-matches/pages-api-route-match'</span><span class="s3">\n</span><span class="s1">import type { PagesAPIRouteMatch } from './route-matches/pages-api-route-match'</span><span class="s3">\n</span><span class="s1">import type { MatchOptions } from './route-matcher-managers/route-matcher-manager'</span><span class="s3">\n</span><span class="s1">import { BubbledError, getTracer } from './lib/trace/tracer'</span><span class="s3">\n</span><span class="s1">import { NextNodeServerSpan } from './lib/trace/constants'</span><span class="s3">\n</span><span class="s1">import { nodeFs } from './lib/node-fs-methods'</span><span class="s3">\n</span><span class="s1">import { getRouteRegex } from '../shared/lib/router/utils/route-regex'</span><span class="s3">\n</span><span class="s1">import { pipeToNodeResponse } from './pipe-readable'</span><span class="s3">\n</span><span class="s1">import { createRequestResponseMocks } from './lib/mock-request'</span><span class="s3">\n</span><span class="s1">import { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'</span><span class="s3">\n</span><span class="s1">import { signalFromNodeResponse } from './web/spec-extension/adapters/next-request'</span><span class="s3">\n</span><span class="s1">import { loadManifest } from './load-manifest.external'</span><span class="s3">\n</span><span class="s1">import { lazyRenderAppPage } from './route-modules/app-page/module.render'</span><span class="s3">\n</span><span class="s1">import { lazyRenderPagesPage } from './route-modules/pages/module.render'</span><span class="s3">\n</span><span class="s1">import { interopDefault } from '../lib/interop-default'</span><span class="s3">\n</span><span class="s1">import { formatDynamicImportPath } from '../lib/format-dynamic-import-path'</span><span class="s3">\n</span><span class="s1">import type { NextFontManifest } from '../build/webpack/plugins/next-font-manifest-plugin'</span><span class="s3">\n</span><span class="s1">import { isInterceptionRouteRewrite } from '../lib/generate-interception-routes-rewrites'</span><span class="s3">\n</span><span class="s1">import type { ServerOnInstrumentationRequestError } from './app-render/types'</span><span class="s3">\n</span><span class="s1">import { RouteKind } from './route-kind'</span><span class="s3">\n</span><span class="s1">import { InvariantError } from '../shared/lib/invariant-error'</span><span class="s3">\n</span><span class="s1">import { AwaiterOnce } from './after/awaiter'</span><span class="s3">\n</span><span class="s1">import { AsyncCallbackSet } from './lib/async-callback-set'</span><span class="s3">\n</span><span class="s1">import { initializeCacheHandlers, setCacheHandler } from './use-cache/handlers'</span><span class="s3">\n</span><span class="s1">import type { UnwrapPromise } from '../lib/coalesced-function'</span><span class="s3">\n</span><span class="s1">import { populateStaticEnv } from '../lib/static-env'</span><span class="s3">\n</span><span class="s1">import { isPostpone } from './lib/router-utils/is-postpone'</span><span class="s3">\n</span><span class="s1">import { NodeModuleLoader } from './lib/module-loader/node-module-loader'</span><span class="s3">\n</span><span class="s1">import { NoFallbackError } from '../shared/lib/no-fallback-error.external'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">ensureInstrumentationRegistered,</span><span class="s3">\n  </span><span class="s1">getInstrumentationModule,</span><span class="s3">\n</span><span class="s1">} from './lib/router-utils/instrumentation-globals.external'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">RouterServerContextSymbol,</span><span class="s3">\n  </span><span class="s1">routerServerGlobal,</span><span class="s3">\n</span><span class="s1">} from './lib/router-utils/router-server-context'</span><span class="s3">\n\n</span><span class="s1">export * from './base-server'</span><span class="s3">\n\n</span><span class="s1">// For module that can be both CJS or ESM</span><span class="s3">\n</span><span class="s1">const dynamicImportEsmDefault = process.env.NEXT_MINIMAL</span><span class="s3">\n  </span><span class="s1">? (id: string) =&gt;</span><span class="s3">\n      </span><span class="s1">import(/* webpackIgnore: true */ id).then((mod) =&gt; mod.default || mod)</span><span class="s3">\n  </span><span class="s1">: (id: string) =&gt; import(id).then((mod) =&gt; mod.default || mod)</span><span class="s3">\n\n</span><span class="s1">export type NodeRequestHandler = BaseRequestHandler&lt;</span><span class="s3">\n  </span><span class="s1">IncomingMessage | NodeNextRequest,</span><span class="s3">\n  </span><span class="s1">ServerResponse | NodeNextResponse</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">type NodeRouteHandler = RouteHandler&lt;NodeNextRequest, NodeNextResponse&gt;</span><span class="s3">\n\n</span><span class="s1">const MiddlewareMatcherCache = new WeakMap&lt;</span><span class="s3">\n  </span><span class="s1">MiddlewareManifest['middleware'][string],</span><span class="s3">\n  </span><span class="s1">MiddlewareRouteMatch</span><span class="s3">\n</span><span class="s1">&gt;()</span><span class="s3">\n\n</span><span class="s1">function getMiddlewareMatcher(</span><span class="s3">\n  </span><span class="s1">info: MiddlewareManifest['middleware'][string]</span><span class="s3">\n</span><span class="s1">): MiddlewareRouteMatch {</span><span class="s3">\n  </span><span class="s1">const stored = MiddlewareMatcherCache.get(info)</span><span class="s3">\n  </span><span class="s1">if (stored) {</span><span class="s3">\n    </span><span class="s1">return stored</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (!Array.isArray(info.matchers)) {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">`Invariant: invalid matchers for middleware ${JSON.stringify(info)}`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const matcher = getMiddlewareRouteMatcher(info.matchers)</span><span class="s3">\n  </span><span class="s1">MiddlewareMatcherCache.set(info, matcher)</span><span class="s3">\n  </span><span class="s1">return matcher</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function installProcessErrorHandlers(</span><span class="s3">\n  </span><span class="s1">shouldRemoveUncaughtErrorAndRejectionListeners: boolean</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">// The conventional wisdom of Node.js and other runtimes is to treat</span><span class="s3">\n  </span><span class="s1">// unhandled errors as fatal and exit the process.</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// But Next.js is not a generic JS runtime â€” it's a specialized runtime for</span><span class="s3">\n  </span><span class="s1">// React Server Components.</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// Many unhandled rejections are due to the late-awaiting pattern for</span><span class="s3">\n  </span><span class="s1">// prefetching data. In Next.js it's OK to call an async function without</span><span class="s3">\n  </span><span class="s1">// immediately awaiting it, to start the request as soon as possible</span><span class="s3">\n  </span><span class="s1">// without blocking unncessarily on the result. These can end up</span><span class="s3">\n  </span><span class="s1">// triggering an </span><span class="s3">\&quot;</span><span class="s1">unhandledRejection</span><span class="s3">\&quot; </span><span class="s1">if it later turns out that the</span><span class="s3">\n  </span><span class="s1">// data is not needed to render the page. Example:</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">//     const promise = fetchData()</span><span class="s3">\n  </span><span class="s1">//     const shouldShow = await checkCondition()</span><span class="s3">\n  </span><span class="s1">//     if (shouldShow) {</span><span class="s3">\n  </span><span class="s1">//       return &lt;Component promise={promise} /&gt;</span><span class="s3">\n  </span><span class="s1">//     }</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// In this example, `fetchData` is called immediately to start the request</span><span class="s3">\n  </span><span class="s1">// as soon as possible, but if `shouldShow` is false, then it will be</span><span class="s3">\n  </span><span class="s1">// discarded without unwrapping its result. If it errors, it will trigger</span><span class="s3">\n  </span><span class="s1">// an </span><span class="s3">\&quot;</span><span class="s1">unhandledRejection</span><span class="s3">\&quot; </span><span class="s1">event.</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// Ideally, we would suppress these rejections completely without warning,</span><span class="s3">\n  </span><span class="s1">// because we don't consider them real errors. (TODO: Currently we do warn.)</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// But regardless of whether we do or don't warn, we definitely shouldn't</span><span class="s3">\n  </span><span class="s1">// crash the entire process.</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// Even a </span><span class="s3">\&quot;</span><span class="s1">legit</span><span class="s3">\&quot; </span><span class="s1">unhandled error unrelated to prefetching shouldn't</span><span class="s3">\n  </span><span class="s1">// prevent the rest of the page from rendering.</span><span class="s3">\n  </span><span class="s1">//</span><span class="s3">\n  </span><span class="s1">// So, we're going to intentionally override the default error handling</span><span class="s3">\n  </span><span class="s1">// behavior of the outer JS runtime to be more forgiving</span><span class="s3">\n\n  </span><span class="s1">// Remove any existing </span><span class="s3">\&quot;</span><span class="s1">unhandledRejection</span><span class="s3">\&quot; </span><span class="s1">and </span><span class="s3">\&quot;</span><span class="s1">uncaughtException</span><span class="s3">\&quot; </span><span class="s1">handlers.</span><span class="s3">\n  </span><span class="s1">// This is gated behind an experimental flag until we've considered the impact</span><span class="s3">\n  </span><span class="s1">// in various deployment environments. It's possible this may always need to</span><span class="s3">\n  </span><span class="s1">// be configurable.</span><span class="s3">\n  </span><span class="s1">if (shouldRemoveUncaughtErrorAndRejectionListeners) {</span><span class="s3">\n    </span><span class="s1">process.removeAllListeners('uncaughtException')</span><span class="s3">\n    </span><span class="s1">process.removeAllListeners('unhandledRejection')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Install a new handler to prevent the process from crashing.</span><span class="s3">\n  </span><span class="s1">process.on('unhandledRejection', (reason: unknown) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (isPostpone(reason)) {</span><span class="s3">\n      </span><span class="s1">// React postpones that are unhandled might end up logged here but they're</span><span class="s3">\n      </span><span class="s1">// not really errors. They're just part of rendering.</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// Immediately log the error.</span><span class="s3">\n    </span><span class="s1">// TODO: Ideally, if we knew that this error was triggered by application</span><span class="s3">\n    </span><span class="s1">// code, we would suppress it entirely without logging. We can't reliably</span><span class="s3">\n    </span><span class="s1">// detect all of these, but when cacheComponents is enabled, we could suppress</span><span class="s3">\n    </span><span class="s1">// at least some of them by waiting to log the error until after all in-</span><span class="s3">\n    </span><span class="s1">// progress renders have completed. Then, only log errors for which there</span><span class="s3">\n    </span><span class="s1">// was not a corresponding </span><span class="s3">\&quot;</span><span class="s1">rejectionHandled</span><span class="s3">\&quot; </span><span class="s1">event.</span><span class="s3">\n    </span><span class="s1">console.error(reason)</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">process.on('rejectionHandled', () =&gt; {</span><span class="s3">\n    </span><span class="s1">// TODO: See note in the unhandledRejection handler above. In the future,</span><span class="s3">\n    </span><span class="s1">// we may use the </span><span class="s3">\&quot;</span><span class="s1">rejectionHandled</span><span class="s3">\&quot; </span><span class="s1">event to de-queue an error from</span><span class="s3">\n    </span><span class="s1">// being logged.</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">// Unhandled exceptions are errors triggered by non-async functions, so this</span><span class="s3">\n  </span><span class="s1">// is unrelated to the late-awaiting pattern. However, for similar reasons,</span><span class="s3">\n  </span><span class="s1">// we still shouldn't crash the process. Just log it.</span><span class="s3">\n  </span><span class="s1">process.on('uncaughtException', (reason: unknown) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (isPostpone(reason)) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">console.error(reason)</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export default class NextNodeServer extends BaseServer&lt;</span><span class="s3">\n  </span><span class="s1">Options,</span><span class="s3">\n  </span><span class="s1">NodeNextRequest,</span><span class="s3">\n  </span><span class="s1">NodeNextResponse</span><span class="s3">\n</span><span class="s1">&gt; {</span><span class="s3">\n  </span><span class="s1">protected middlewareManifestPath: string</span><span class="s3">\n  </span><span class="s1">private _serverDistDir: string | undefined</span><span class="s3">\n  </span><span class="s1">private imageResponseCache?: ResponseCache</span><span class="s3">\n  </span><span class="s1">protected renderWorkersPromises?: Promise&lt;void&gt;</span><span class="s3">\n  </span><span class="s1">protected dynamicRoutes?: {</span><span class="s3">\n    </span><span class="s1">match: import('../shared/lib/router/utils/route-matcher').RouteMatchFn</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">re: RegExp</span><span class="s3">\n  </span><span class="s1">}[]</span><span class="s3">\n  </span><span class="s1">private routerServerHandler?: (</span><span class="s3">\n    </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: ServerResponse</span><span class="s3">\n  </span><span class="s1">) =&gt; void</span><span class="s3">\n\n  </span><span class="s1">protected cleanupListeners = new AsyncCallbackSet()</span><span class="s3">\n  </span><span class="s1">protected internalWaitUntil: WaitUntil | undefined</span><span class="s3">\n  </span><span class="s1">private isDev: boolean</span><span class="s3">\n  </span><span class="s1">private sriEnabled: boolean</span><span class="s3">\n\n  </span><span class="s1">constructor(options: Options) {</span><span class="s3">\n    </span><span class="s1">// Initialize super class</span><span class="s3">\n    </span><span class="s1">super(options)</span><span class="s3">\n\n    </span><span class="s1">const isDev = options.dev ?? false</span><span class="s3">\n    </span><span class="s1">this.isDev = isDev</span><span class="s3">\n    </span><span class="s1">this.sriEnabled = Boolean(options.conf.experimental?.sri?.algorithm)</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* This sets environment variable to be used at the time of SSR by head.tsx.</span><span class="s3">\n     </span><span class="s1">* Using this from process.env allows targeting SSR by calling</span><span class="s3">\n     </span><span class="s1">* `process.env.__NEXT_OPTIMIZE_CSS`.</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">if (this.renderOpts.optimizeCss) {</span><span class="s3">\n      </span><span class="s1">process.env.__NEXT_OPTIMIZE_CSS = JSON.stringify(true)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (this.renderOpts.nextScriptWorkers) {</span><span class="s3">\n      </span><span class="s1">process.env.__NEXT_SCRIPT_WORKERS = JSON.stringify(true)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">process.env.NEXT_DEPLOYMENT_ID = this.nextConfig.experimental.useSkewCookie</span><span class="s3">\n      </span><span class="s1">? ''</span><span class="s3">\n      </span><span class="s1">: this.nextConfig.deploymentId || ''</span><span class="s3">\n\n    </span><span class="s1">if (!this.minimalMode) {</span><span class="s3">\n      </span><span class="s1">this.imageResponseCache = new ResponseCache(this.minimalMode)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const { appDocumentPreloading } = this.nextConfig.experimental</span><span class="s3">\n    </span><span class="s1">const isDefaultEnabled = typeof appDocumentPreloading === 'undefined'</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">!options.dev &amp;&amp;</span><span class="s3">\n      </span><span class="s1">(appDocumentPreloading === true ||</span><span class="s3">\n        </span><span class="s1">!(this.minimalMode &amp;&amp; isDefaultEnabled))</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">// pre-warm _document and _app as these will be</span><span class="s3">\n      </span><span class="s1">// needed for most requests</span><span class="s3">\n      </span><span class="s1">loadComponents({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">page: '/_document',</span><span class="s3">\n        </span><span class="s1">isAppPath: false,</span><span class="s3">\n        </span><span class="s1">isDev: this.isDev,</span><span class="s3">\n        </span><span class="s1">sriEnabled: this.sriEnabled,</span><span class="s3">\n      </span><span class="s1">}).catch(() =&gt; {})</span><span class="s3">\n      </span><span class="s1">loadComponents({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">page: '/_app',</span><span class="s3">\n        </span><span class="s1">isAppPath: false,</span><span class="s3">\n        </span><span class="s1">isDev: this.isDev,</span><span class="s3">\n        </span><span class="s1">sriEnabled: this.sriEnabled,</span><span class="s3">\n      </span><span class="s1">}).catch(() =&gt; {})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">!options.dev &amp;&amp;</span><span class="s3">\n      </span><span class="s1">!this.minimalMode &amp;&amp;</span><span class="s3">\n      </span><span class="s1">this.nextConfig.experimental.preloadEntriesOnStart</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">this.unstable_preloadEntries()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!options.dev) {</span><span class="s3">\n      </span><span class="s1">const { dynamicRoutes = [] } = this.getRoutesManifest() ?? {}</span><span class="s3">\n      </span><span class="s1">this.dynamicRoutes = dynamicRoutes.map((r) =&gt; {</span><span class="s3">\n        </span><span class="s1">// TODO: can we just re-use the regex from the manifest?</span><span class="s3">\n        </span><span class="s1">const regex = getRouteRegex(r.page)</span><span class="s3">\n        </span><span class="s1">const match = getRouteMatcher(regex)</span><span class="s3">\n\n        </span><span class="s1">return {</span><span class="s3">\n          </span><span class="s1">match,</span><span class="s3">\n          </span><span class="s1">page: r.page,</span><span class="s3">\n          </span><span class="s1">re: regex.re,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// ensure options are set when loadConfig isn't called</span><span class="s3">\n    </span><span class="s1">setHttpClientAndAgentOptions(this.nextConfig)</span><span class="s3">\n\n    </span><span class="s1">// Intercept fetch and other testmode apis.</span><span class="s3">\n    </span><span class="s1">if (this.serverOptions.experimentalTestProxy) {</span><span class="s3">\n      </span><span class="s1">process.env.NEXT_PRIVATE_TEST_PROXY = 'true'</span><span class="s3">\n      </span><span class="s1">const { interceptTestApis } =</span><span class="s3">\n        </span><span class="s1">// eslint-disable-next-line @next/internal/typechecked-require -- experimental/testmode is not built ins next/dist/esm</span><span class="s3">\n        </span><span class="s1">require('next/dist/experimental/testmode/server') as typeof import('../experimental/testmode/server')</span><span class="s3">\n      </span><span class="s1">interceptTestApis()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">this.middlewareManifestPath = join(this.serverDistDir, MIDDLEWARE_MANIFEST)</span><span class="s3">\n\n    </span><span class="s1">// This is just optimization to fire prepare as soon as possible. It will be</span><span class="s3">\n    </span><span class="s1">// properly awaited later. We add the catch here to ensure that it does not</span><span class="s3">\n    </span><span class="s1">// cause a unhandled promise rejection. The promise rejection will be</span><span class="s3">\n    </span><span class="s1">// handled later on via the `await` when the request handler is called.</span><span class="s3">\n    </span><span class="s1">if (!options.dev) {</span><span class="s3">\n      </span><span class="s1">this.prepare().catch((err) =&gt; {</span><span class="s3">\n        </span><span class="s1">console.error('Failed to prepare server', err)</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// when using compile mode static env isn't inlined so we</span><span class="s3">\n    </span><span class="s1">// need to populate in normal runtime env</span><span class="s3">\n    </span><span class="s1">if (this.renderOpts.isExperimentalCompile) {</span><span class="s3">\n      </span><span class="s1">populateStaticEnv(this.nextConfig)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const shouldRemoveUncaughtErrorAndRejectionListeners = Boolean(</span><span class="s3">\n      </span><span class="s1">options.conf.experimental?.removeUncaughtErrorAndRejectionListeners</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">installProcessErrorHandlers(shouldRemoveUncaughtErrorAndRejectionListeners)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async unstable_preloadEntries(): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">// Ensure prepare process will be finished before preloading entries.</span><span class="s3">\n    </span><span class="s1">await this.prepare()</span><span class="s3">\n\n    </span><span class="s1">const appPathsManifest = this.getAppPathsManifest()</span><span class="s3">\n    </span><span class="s1">const pagesManifest = this.getPagesManifest()</span><span class="s3">\n\n    </span><span class="s1">await this.loadCustomCacheHandlers()</span><span class="s3">\n\n    </span><span class="s1">for (const page of Object.keys(pagesManifest || {})) {</span><span class="s3">\n      </span><span class="s1">await loadComponents({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">page,</span><span class="s3">\n        </span><span class="s1">isAppPath: false,</span><span class="s3">\n        </span><span class="s1">isDev: this.isDev,</span><span class="s3">\n        </span><span class="s1">sriEnabled: this.sriEnabled,</span><span class="s3">\n      </span><span class="s1">}).catch(() =&gt; {})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (const page of Object.keys(appPathsManifest || {})) {</span><span class="s3">\n      </span><span class="s1">await loadComponents({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">page,</span><span class="s3">\n        </span><span class="s1">isAppPath: true,</span><span class="s3">\n        </span><span class="s1">isDev: this.isDev,</span><span class="s3">\n        </span><span class="s1">sriEnabled: this.sriEnabled,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">.then(async ({ ComponentMod }) =&gt; {</span><span class="s3">\n          </span><span class="s1">// we need to ensure fetch is patched before we require the page,</span><span class="s3">\n          </span><span class="s1">// otherwise if the fetch is patched by user code, we will be patching it</span><span class="s3">\n          </span><span class="s1">// too late and there won't be any caching behaviors</span><span class="s3">\n          </span><span class="s1">ComponentMod.patchFetch()</span><span class="s3">\n\n          </span><span class="s1">const webpackRequire = ComponentMod.__next_app__.require</span><span class="s3">\n          </span><span class="s1">if (webpackRequire?.m) {</span><span class="s3">\n            </span><span class="s1">for (const id of Object.keys(webpackRequire.m)) {</span><span class="s3">\n              </span><span class="s1">await webpackRequire(id)</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">.catch(() =&gt; {})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async handleUpgrade(): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">// The web server does not support web sockets, it's only used for HMR in</span><span class="s3">\n    </span><span class="s1">// development.</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async loadInstrumentationModule() {</span><span class="s3">\n    </span><span class="s1">if (!this.serverOptions.dev) {</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">this.instrumentation = await getInstrumentationModule(</span><span class="s3">\n          </span><span class="s1">this.dir,</span><span class="s3">\n          </span><span class="s1">this.nextConfig.distDir</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">} catch (err: any) {</span><span class="s3">\n        </span><span class="s1">if (err.code !== 'MODULE_NOT_FOUND') {</span><span class="s3">\n          </span><span class="s1">throw new Error(</span><span class="s3">\n            </span><span class="s1">'An error occurred while loading the instrumentation hook',</span><span class="s3">\n            </span><span class="s1">{ cause: err }</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return this.instrumentation</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async prepareImpl() {</span><span class="s3">\n    </span><span class="s1">await super.prepareImpl()</span><span class="s3">\n    </span><span class="s1">await this.runInstrumentationHookIfAvailable()</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async runInstrumentationHookIfAvailable() {</span><span class="s3">\n    </span><span class="s1">await ensureInstrumentationRegistered(this.dir, this.nextConfig.distDir)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected loadEnvConfig({</span><span class="s3">\n    </span><span class="s1">dev,</span><span class="s3">\n    </span><span class="s1">forceReload,</span><span class="s3">\n    </span><span class="s1">silent,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">dev: boolean</span><span class="s3">\n    </span><span class="s1">forceReload?: boolean</span><span class="s3">\n    </span><span class="s1">silent?: boolean</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">loadEnvConfig(</span><span class="s3">\n      </span><span class="s1">this.dir,</span><span class="s3">\n      </span><span class="s1">dev,</span><span class="s3">\n      </span><span class="s1">silent ? { info: () =&gt; {}, error: () =&gt; {} } : Log,</span><span class="s3">\n      </span><span class="s1">forceReload</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private async loadCustomCacheHandlers() {</span><span class="s3">\n    </span><span class="s1">const { cacheHandlers } = this.nextConfig.experimental</span><span class="s3">\n    </span><span class="s1">if (!cacheHandlers) return</span><span class="s3">\n\n    </span><span class="s1">// If we've already initialized the cache handlers interface, don't do it</span><span class="s3">\n    </span><span class="s1">// again.</span><span class="s3">\n    </span><span class="s1">if (!initializeCacheHandlers()) return</span><span class="s3">\n\n    </span><span class="s1">for (const [kind, handler] of Object.entries(cacheHandlers)) {</span><span class="s3">\n      </span><span class="s1">if (!handler) continue</span><span class="s3">\n\n      </span><span class="s1">setCacheHandler(</span><span class="s3">\n        </span><span class="s1">kind,</span><span class="s3">\n        </span><span class="s1">interopDefault(</span><span class="s3">\n          </span><span class="s1">await dynamicImportEsmDefault(</span><span class="s3">\n            </span><span class="s1">formatDynamicImportPath(this.distDir, handler)</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async getIncrementalCache({</span><span class="s3">\n    </span><span class="s1">requestHeaders,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">requestHeaders: IncrementalCache['requestHeaders']</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">const dev = !!this.renderOpts.dev</span><span class="s3">\n    </span><span class="s1">let CacheHandler: any</span><span class="s3">\n    </span><span class="s1">const { cacheHandler } = this.nextConfig</span><span class="s3">\n\n    </span><span class="s1">if (cacheHandler) {</span><span class="s3">\n      </span><span class="s1">CacheHandler = interopDefault(</span><span class="s3">\n        </span><span class="s1">await dynamicImportEsmDefault(</span><span class="s3">\n          </span><span class="s1">formatDynamicImportPath(this.distDir, cacheHandler)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">await this.loadCustomCacheHandlers()</span><span class="s3">\n\n    </span><span class="s1">// incremental-cache is request specific</span><span class="s3">\n    </span><span class="s1">// although can have shared caches in module scope</span><span class="s3">\n    </span><span class="s1">// per-cache handler</span><span class="s3">\n    </span><span class="s1">return new IncrementalCache({</span><span class="s3">\n      </span><span class="s1">fs: this.getCacheFilesystem(),</span><span class="s3">\n      </span><span class="s1">dev,</span><span class="s3">\n      </span><span class="s1">requestHeaders,</span><span class="s3">\n      </span><span class="s1">allowedRevalidateHeaderKeys:</span><span class="s3">\n        </span><span class="s1">this.nextConfig.experimental.allowedRevalidateHeaderKeys,</span><span class="s3">\n      </span><span class="s1">minimalMode: this.minimalMode,</span><span class="s3">\n      </span><span class="s1">serverDistDir: this.serverDistDir,</span><span class="s3">\n      </span><span class="s1">fetchCacheKeyPrefix: this.nextConfig.experimental.fetchCacheKeyPrefix,</span><span class="s3">\n      </span><span class="s1">maxMemoryCacheSize: this.nextConfig.cacheMaxMemorySize,</span><span class="s3">\n      </span><span class="s1">flushToDisk:</span><span class="s3">\n        </span><span class="s1">!this.minimalMode &amp;&amp; this.nextConfig.experimental.isrFlushToDisk,</span><span class="s3">\n      </span><span class="s1">getPrerenderManifest: () =&gt; this.getPrerenderManifest(),</span><span class="s3">\n      </span><span class="s1">CurCacheHandler: CacheHandler,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getResponseCache() {</span><span class="s3">\n    </span><span class="s1">return new ResponseCache(this.minimalMode)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getPublicDir(): string {</span><span class="s3">\n    </span><span class="s1">return join(this.dir, CLIENT_PUBLIC_FILES_PATH)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getHasStaticDir(): boolean {</span><span class="s3">\n    </span><span class="s1">return fs.existsSync(join(this.dir, 'static'))</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getPagesManifest(): PagesManifest | undefined {</span><span class="s3">\n    </span><span class="s1">return loadManifest(</span><span class="s3">\n      </span><span class="s1">join(this.serverDistDir, PAGES_MANIFEST)</span><span class="s3">\n    </span><span class="s1">) as PagesManifest</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getAppPathsManifest(): PagesManifest | undefined {</span><span class="s3">\n    </span><span class="s1">if (!this.enabledDirectories.app) return undefined</span><span class="s3">\n\n    </span><span class="s1">return loadManifest(</span><span class="s3">\n      </span><span class="s1">join(this.serverDistDir, APP_PATHS_MANIFEST)</span><span class="s3">\n    </span><span class="s1">) as PagesManifest</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getinterceptionRoutePatterns(): RegExp[] {</span><span class="s3">\n    </span><span class="s1">if (!this.enabledDirectories.app) return []</span><span class="s3">\n\n    </span><span class="s1">const routesManifest = this.getRoutesManifest()</span><span class="s3">\n    </span><span class="s1">return (</span><span class="s3">\n      </span><span class="s1">routesManifest?.rewrites.beforeFiles</span><span class="s3">\n        </span><span class="s1">.filter(isInterceptionRouteRewrite)</span><span class="s3">\n        </span><span class="s1">.map((rewrite) =&gt; new RegExp(rewrite.regex)) ?? []</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async hasPage(pathname: string): Promise&lt;boolean&gt; {</span><span class="s3">\n    </span><span class="s1">return !!getMaybePagePath(</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">this.distDir,</span><span class="s3">\n      </span><span class="s1">this.nextConfig.i18n?.locales,</span><span class="s3">\n      </span><span class="s1">this.enabledDirectories.app</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getBuildId(): string {</span><span class="s3">\n    </span><span class="s1">const buildIdFile = join(this.distDir, BUILD_ID_FILE)</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">return fs.readFileSync(buildIdFile, 'utf8').trim()</span><span class="s3">\n    </span><span class="s1">} catch (err: any) {</span><span class="s3">\n      </span><span class="s1">if (err.code === 'ENOENT') {</span><span class="s3">\n        </span><span class="s1">throw new Error(</span><span class="s3">\n          </span><span class="s1">`Could not find a production build in the '${this.distDir}' directory. Try building your app with 'next build' before starting the production server. https://nextjs.org/docs/messages/production-start-no-build-id`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">throw err</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getEnabledDirectories(dev: boolean): NextEnabledDirectories {</span><span class="s3">\n    </span><span class="s1">const dir = dev ? this.dir : this.serverDistDir</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n      </span><span class="s1">app: findDir(dir, 'app') ? true : false,</span><span class="s3">\n      </span><span class="s1">pages: findDir(dir, 'pages') ? true : false,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected sendRenderResult(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">options: {</span><span class="s3">\n      </span><span class="s1">result: RenderResult</span><span class="s3">\n      </span><span class="s1">generateEtags: boolean</span><span class="s3">\n      </span><span class="s1">poweredByHeader: boolean</span><span class="s3">\n      </span><span class="s1">cacheControl: CacheControl | undefined</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">return sendRenderResult({</span><span class="s3">\n      </span><span class="s1">req: req.originalRequest,</span><span class="s3">\n      </span><span class="s1">res: res.originalResponse,</span><span class="s3">\n      </span><span class="s1">result: options.result,</span><span class="s3">\n      </span><span class="s1">generateEtags: options.generateEtags,</span><span class="s3">\n      </span><span class="s1">poweredByHeader: options.poweredByHeader,</span><span class="s3">\n      </span><span class="s1">cacheControl: options.cacheControl,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async runApi(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">query: ParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">match: PagesAPIRouteMatch</span><span class="s3">\n  </span><span class="s1">): Promise&lt;boolean&gt; {</span><span class="s3">\n    </span><span class="s1">const edgeFunctionsPages = this.getEdgeFunctionsPages()</span><span class="s3">\n\n    </span><span class="s1">for (const edgeFunctionsPage of edgeFunctionsPages) {</span><span class="s3">\n      </span><span class="s1">if (edgeFunctionsPage === match.definition.pathname) {</span><span class="s3">\n        </span><span class="s1">const handledAsEdgeFunction = await this.runEdgeFunction({</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">res,</span><span class="s3">\n          </span><span class="s1">query,</span><span class="s3">\n          </span><span class="s1">params: match.params,</span><span class="s3">\n          </span><span class="s1">page: match.definition.pathname,</span><span class="s3">\n          </span><span class="s1">appPaths: null,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">if (handledAsEdgeFunction) {</span><span class="s3">\n          </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// The module supports minimal mode, load the minimal module.</span><span class="s3">\n    </span><span class="s1">// Restore original URL as the handler handles it's own parsing</span><span class="s3">\n    </span><span class="s1">const parsedInitUrl = parseUrl(getRequestMeta(req, 'initURL') || req.url)</span><span class="s3">\n    </span><span class="s1">req.url = `${parsedInitUrl.pathname}${parsedInitUrl.search || ''}`</span><span class="s3">\n\n    </span><span class="s1">const loader = new NodeModuleLoader()</span><span class="s3">\n    </span><span class="s1">const module = (await loader.load(match.definition.filename)) as {</span><span class="s3">\n      </span><span class="s1">handler: (</span><span class="s3">\n        </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n        </span><span class="s1">res: ServerResponse,</span><span class="s3">\n        </span><span class="s1">ctx: {</span><span class="s3">\n          </span><span class="s1">waitUntil: ReturnType&lt;BaseServer['getWaitUntil']&gt;</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">) =&gt; Promise&lt;void&gt;</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">addRequestMeta(</span><span class="s3">\n      </span><span class="s1">req.originalRequest,</span><span class="s3">\n      </span><span class="s1">'relativeProjectDir',</span><span class="s3">\n      </span><span class="s1">relative(process.cwd(), this.dir)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">addRequestMeta(req.originalRequest, 'distDir', this.distDir)</span><span class="s3">\n    </span><span class="s1">await module.handler(req.originalRequest, res.originalResponse, {</span><span class="s3">\n      </span><span class="s1">waitUntil: this.getWaitUntil(),</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">return true</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async renderHTML(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query: NextParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">renderOpts: LoadedRenderOpts</span><span class="s3">\n  </span><span class="s1">): Promise&lt;RenderResult&gt; {</span><span class="s3">\n    </span><span class="s1">return getTracer().trace(NextNodeServerSpan.renderHTML, async () =&gt;</span><span class="s3">\n      </span><span class="s1">this.renderHTMLImpl(req, res, pathname, query, renderOpts)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private async renderHTMLImpl(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query: NextParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">renderOpts: LoadedRenderOpts</span><span class="s3">\n  </span><span class="s1">): Promise&lt;RenderResult&gt; {</span><span class="s3">\n    </span><span class="s1">if (process.env.NEXT_MINIMAL) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'Invariant: renderHTML should not be called in minimal mode'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">// the `else` branch is needed for tree-shaking</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">// Due to the way we pass data by mutating `renderOpts`, we can't extend the</span><span class="s3">\n      </span><span class="s1">// object here but only updating its `nextFontManifest` field.</span><span class="s3">\n      </span><span class="s1">// https://github.com/vercel/next.js/blob/df7cbd904c3bd85f399d1ce90680c0ecf92d2752/packages/next/server/render.tsx#L947-L952</span><span class="s3">\n      </span><span class="s1">renderOpts.nextFontManifest = this.nextFontManifest</span><span class="s3">\n\n      </span><span class="s1">if (this.enabledDirectories.app &amp;&amp; renderOpts.isAppPath) {</span><span class="s3">\n        </span><span class="s1">return lazyRenderAppPage(</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">res,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">query,</span><span class="s3">\n          </span><span class="s1">// This code path does not service revalidations for unknown param</span><span class="s3">\n          </span><span class="s1">// shells. As a result, we don't need to pass in the unknown params.</span><span class="s3">\n          </span><span class="s1">null,</span><span class="s3">\n          </span><span class="s1">renderOpts,</span><span class="s3">\n          </span><span class="s1">this.getServerComponentsHmrCache(),</span><span class="s3">\n          </span><span class="s1">false,</span><span class="s3">\n          </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">buildId: this.buildId,</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// TODO: re-enable this once we've refactored to use implicit matches</span><span class="s3">\n      </span><span class="s1">// throw new Error('Invariant: render should have used routeModule')</span><span class="s3">\n\n      </span><span class="s1">return lazyRenderPagesPage(</span><span class="s3">\n        </span><span class="s1">req.originalRequest,</span><span class="s3">\n        </span><span class="s1">res.originalResponse,</span><span class="s3">\n        </span><span class="s1">pathname,</span><span class="s3">\n        </span><span class="s1">query,</span><span class="s3">\n        </span><span class="s1">renderOpts,</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">buildId: this.buildId,</span><span class="s3">\n          </span><span class="s1">deploymentId: this.nextConfig.deploymentId,</span><span class="s3">\n          </span><span class="s1">customServer: this.serverOptions.customServer || undefined,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">isFallback: false,</span><span class="s3">\n          </span><span class="s1">isDraftMode: renderOpts.isDraftMode,</span><span class="s3">\n          </span><span class="s1">developmentNotFoundSourcePage: getRequestMeta(</span><span class="s3">\n            </span><span class="s1">req,</span><span class="s3">\n            </span><span class="s1">'developmentNotFoundSourcePage'</span><span class="s3">\n          </span><span class="s1">),</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async imageOptimizer(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">paramsResult: import('./image-optimizer').ImageParamsResult,</span><span class="s3">\n    </span><span class="s1">previousCacheEntry?: IncrementalResponseCacheEntry | null</span><span class="s3">\n  </span><span class="s1">): Promise&lt;{</span><span class="s3">\n    </span><span class="s1">buffer: Buffer</span><span class="s3">\n    </span><span class="s1">contentType: string</span><span class="s3">\n    </span><span class="s1">maxAge: number</span><span class="s3">\n    </span><span class="s1">upstreamEtag: string</span><span class="s3">\n    </span><span class="s1">etag: string</span><span class="s3">\n  </span><span class="s1">}&gt; {</span><span class="s3">\n    </span><span class="s1">if (process.env.NEXT_MINIMAL) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'invariant: imageOptimizer should not be called in minimal mode'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">const { imageOptimizer, fetchExternalImage, fetchInternalImage } =</span><span class="s3">\n        </span><span class="s1">require('./image-optimizer') as typeof import('./image-optimizer')</span><span class="s3">\n\n      </span><span class="s1">const handleInternalReq = async (</span><span class="s3">\n        </span><span class="s1">newReq: IncomingMessage,</span><span class="s3">\n        </span><span class="s1">newRes: ServerResponse</span><span class="s3">\n      </span><span class="s1">) =&gt; {</span><span class="s3">\n        </span><span class="s1">if (newReq.url === req.url) {</span><span class="s3">\n          </span><span class="s1">throw new Error(`Invariant attempted to optimize _next/image itself`)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">if (!this.routerServerHandler) {</span><span class="s3">\n          </span><span class="s1">throw new Error(`Invariant missing routerServerHandler`)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">await this.routerServerHandler(newReq, newRes)</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const { isAbsolute, href } = paramsResult</span><span class="s3">\n\n      </span><span class="s1">const imageUpstream = isAbsolute</span><span class="s3">\n        </span><span class="s1">? await fetchExternalImage(href)</span><span class="s3">\n        </span><span class="s1">: await fetchInternalImage(</span><span class="s3">\n            </span><span class="s1">href,</span><span class="s3">\n            </span><span class="s1">req.originalRequest,</span><span class="s3">\n            </span><span class="s1">res.originalResponse,</span><span class="s3">\n            </span><span class="s1">handleInternalReq</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">return imageOptimizer(imageUpstream, paramsResult, this.nextConfig, {</span><span class="s3">\n        </span><span class="s1">isDev: this.renderOpts.dev,</span><span class="s3">\n        </span><span class="s1">previousCacheEntry,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getPagePath(pathname: string, locales?: string[]): string {</span><span class="s3">\n    </span><span class="s1">return getPagePath(</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">this.distDir,</span><span class="s3">\n      </span><span class="s1">locales,</span><span class="s3">\n      </span><span class="s1">this.enabledDirectories.app</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async renderPageComponent(</span><span class="s3">\n    </span><span class="s1">ctx: RequestContext&lt;NodeNextRequest, NodeNextResponse&gt;,</span><span class="s3">\n    </span><span class="s1">bubbleNoFallback: boolean</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">const edgeFunctionsPages = this.getEdgeFunctionsPages() || []</span><span class="s3">\n    </span><span class="s1">if (edgeFunctionsPages.length) {</span><span class="s3">\n      </span><span class="s1">const appPaths = this.getOriginalAppPaths(ctx.pathname)</span><span class="s3">\n      </span><span class="s1">const isAppPath = Array.isArray(appPaths)</span><span class="s3">\n\n      </span><span class="s1">let page = ctx.pathname</span><span class="s3">\n      </span><span class="s1">if (isAppPath) {</span><span class="s3">\n        </span><span class="s1">// When it's an array, we need to pass all parallel routes to the loader.</span><span class="s3">\n        </span><span class="s1">page = appPaths[0]</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">for (const edgeFunctionsPage of edgeFunctionsPages) {</span><span class="s3">\n        </span><span class="s1">if (edgeFunctionsPage === page) {</span><span class="s3">\n          </span><span class="s1">await this.runEdgeFunction({</span><span class="s3">\n            </span><span class="s1">req: ctx.req,</span><span class="s3">\n            </span><span class="s1">res: ctx.res,</span><span class="s3">\n            </span><span class="s1">query: ctx.query,</span><span class="s3">\n            </span><span class="s1">params: ctx.renderOpts.params,</span><span class="s3">\n            </span><span class="s1">page,</span><span class="s3">\n            </span><span class="s1">appPaths,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n          </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return super.renderPageComponent(ctx, bubbleNoFallback)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async findPageComponents({</span><span class="s3">\n    </span><span class="s1">locale,</span><span class="s3">\n    </span><span class="s1">page,</span><span class="s3">\n    </span><span class="s1">query,</span><span class="s3">\n    </span><span class="s1">params,</span><span class="s3">\n    </span><span class="s1">isAppPath,</span><span class="s3">\n    </span><span class="s1">url,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">locale: string | undefined</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">query: NextParsedUrlQuery</span><span class="s3">\n    </span><span class="s1">params: Params</span><span class="s3">\n    </span><span class="s1">isAppPath: boolean</span><span class="s3">\n    </span><span class="s1">// The following parameters are used in the development server's</span><span class="s3">\n    </span><span class="s1">// implementation.</span><span class="s3">\n    </span><span class="s1">sriEnabled?: boolean</span><span class="s3">\n    </span><span class="s1">appPaths?: ReadonlyArray&lt;string&gt; | null</span><span class="s3">\n    </span><span class="s1">shouldEnsure: boolean</span><span class="s3">\n    </span><span class="s1">url?: string</span><span class="s3">\n  </span><span class="s1">}): Promise&lt;FindComponentsResult | null&gt; {</span><span class="s3">\n    </span><span class="s1">return getTracer().trace(</span><span class="s3">\n      </span><span class="s1">NextNodeServerSpan.findPageComponents,</span><span class="s3">\n      </span><span class="s1">{</span><span class="s3">\n        </span><span class="s1">spanName: 'resolve page components',</span><span class="s3">\n        </span><span class="s1">attributes: {</span><span class="s3">\n          </span><span class="s1">'next.route': isAppPath ? normalizeAppPath(page) : page,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">() =&gt;</span><span class="s3">\n        </span><span class="s1">this.findPageComponentsImpl({</span><span class="s3">\n          </span><span class="s1">locale,</span><span class="s3">\n          </span><span class="s1">page,</span><span class="s3">\n          </span><span class="s1">query,</span><span class="s3">\n          </span><span class="s1">params,</span><span class="s3">\n          </span><span class="s1">isAppPath,</span><span class="s3">\n          </span><span class="s1">url,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private async findPageComponentsImpl({</span><span class="s3">\n    </span><span class="s1">locale,</span><span class="s3">\n    </span><span class="s1">page,</span><span class="s3">\n    </span><span class="s1">query,</span><span class="s3">\n    </span><span class="s1">params,</span><span class="s3">\n    </span><span class="s1">isAppPath,</span><span class="s3">\n    </span><span class="s1">url: _url,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">locale: string | undefined</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">query: NextParsedUrlQuery</span><span class="s3">\n    </span><span class="s1">params: Params</span><span class="s3">\n    </span><span class="s1">isAppPath: boolean</span><span class="s3">\n    </span><span class="s1">url?: string</span><span class="s3">\n  </span><span class="s1">}): Promise&lt;FindComponentsResult | null&gt; {</span><span class="s3">\n    </span><span class="s1">const pagePaths: string[] = [page]</span><span class="s3">\n    </span><span class="s1">if (query.amp) {</span><span class="s3">\n      </span><span class="s1">// try serving a static AMP version first</span><span class="s3">\n      </span><span class="s1">pagePaths.unshift(</span><span class="s3">\n        </span><span class="s1">(isAppPath ? normalizeAppPath(page) : normalizePagePath(page)) + '.amp'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (locale) {</span><span class="s3">\n      </span><span class="s1">pagePaths.unshift(</span><span class="s3">\n        </span><span class="s1">...pagePaths.map((path) =&gt; `/${locale}${path === '/' ? '' : path}`)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">for (const pagePath of pagePaths) {</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const components = await loadComponents({</span><span class="s3">\n          </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n          </span><span class="s1">page: pagePath,</span><span class="s3">\n          </span><span class="s1">isAppPath,</span><span class="s3">\n          </span><span class="s1">isDev: this.isDev,</span><span class="s3">\n          </span><span class="s1">sriEnabled: this.sriEnabled,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">locale &amp;&amp;</span><span class="s3">\n          </span><span class="s1">typeof components.Component === 'string' &amp;&amp;</span><span class="s3">\n          </span><span class="s1">!pagePath.startsWith(`/${locale}/`) &amp;&amp;</span><span class="s3">\n          </span><span class="s1">pagePath !== `/${locale}`</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">// if loading an static HTML file the locale is required</span><span class="s3">\n          </span><span class="s1">// to be present since all HTML files are output under their locale</span><span class="s3">\n          </span><span class="s1">continue</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">return {</span><span class="s3">\n          </span><span class="s1">components,</span><span class="s3">\n          </span><span class="s1">query: {</span><span class="s3">\n            </span><span class="s1">...(!this.renderOpts.isExperimentalCompile &amp;&amp;</span><span class="s3">\n            </span><span class="s1">components.getStaticProps</span><span class="s3">\n              </span><span class="s1">? ({</span><span class="s3">\n                  </span><span class="s1">amp: query.amp,</span><span class="s3">\n                </span><span class="s1">} as NextParsedUrlQuery)</span><span class="s3">\n              </span><span class="s1">: query),</span><span class="s3">\n            </span><span class="s1">// For appDir params is excluded.</span><span class="s3">\n            </span><span class="s1">...((isAppPath ? {} : params) || {}),</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} catch (err) {</span><span class="s3">\n        </span><span class="s1">// we should only not throw if we failed to find the page</span><span class="s3">\n        </span><span class="s1">// in the pages-manifest</span><span class="s3">\n        </span><span class="s1">if (!(err instanceof PageNotFoundError)) {</span><span class="s3">\n          </span><span class="s1">throw err</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return null</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getNextFontManifest(): NextFontManifest | undefined {</span><span class="s3">\n    </span><span class="s1">return loadManifest(</span><span class="s3">\n      </span><span class="s1">join(this.distDir, 'server', NEXT_FONT_MANIFEST + '.json')</span><span class="s3">\n    </span><span class="s1">) as NextFontManifest</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected handleNextImageRequest: NodeRouteHandler = async (</span><span class="s3">\n    </span><span class="s1">req,</span><span class="s3">\n    </span><span class="s1">res,</span><span class="s3">\n    </span><span class="s1">parsedUrl</span><span class="s3">\n  </span><span class="s1">) =&gt; {</span><span class="s3">\n    </span><span class="s1">if (!parsedUrl.pathname || !parsedUrl.pathname.startsWith('/_next/image')) {</span><span class="s3">\n      </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// Ignore if its a middleware request</span><span class="s3">\n    </span><span class="s1">if (getRequestMeta(req, 'middlewareInvoke')) {</span><span class="s3">\n      </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">this.minimalMode ||</span><span class="s3">\n      </span><span class="s1">this.nextConfig.output === 'export' ||</span><span class="s3">\n      </span><span class="s1">process.env.NEXT_MINIMAL</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">res.statusCode = 400</span><span class="s3">\n      </span><span class="s1">res.body('Bad Request').send()</span><span class="s3">\n      </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">// the `else` branch is needed for tree-shaking</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">const { ImageOptimizerCache } =</span><span class="s3">\n        </span><span class="s1">require('./image-optimizer') as typeof import('./image-optimizer')</span><span class="s3">\n\n      </span><span class="s1">const imageOptimizerCache = new ImageOptimizerCache({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">nextConfig: this.nextConfig,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">const { sendResponse, ImageError } =</span><span class="s3">\n        </span><span class="s1">require('./image-optimizer') as typeof import('./image-optimizer')</span><span class="s3">\n\n      </span><span class="s1">if (!this.imageResponseCache) {</span><span class="s3">\n        </span><span class="s1">throw new Error('invariant image optimizer cache was not initialized')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">const imagesConfig = this.nextConfig.images</span><span class="s3">\n\n      </span><span class="s1">if (imagesConfig.loader !== 'default' || imagesConfig.unoptimized) {</span><span class="s3">\n        </span><span class="s1">await this.render404(req, res)</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const paramsResult = ImageOptimizerCache.validateParams(</span><span class="s3">\n        </span><span class="s1">req.originalRequest,</span><span class="s3">\n        </span><span class="s1">parsedUrl.query,</span><span class="s3">\n        </span><span class="s1">this.nextConfig,</span><span class="s3">\n        </span><span class="s1">!!this.renderOpts.dev</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">if ('errorMessage' in paramsResult) {</span><span class="s3">\n        </span><span class="s1">res.statusCode = 400</span><span class="s3">\n        </span><span class="s1">res.body(paramsResult.errorMessage).send()</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const cacheKey = ImageOptimizerCache.getCacheKey(paramsResult)</span><span class="s3">\n\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const { getExtension } =</span><span class="s3">\n          </span><span class="s1">require('./serve-static') as typeof import('./serve-static')</span><span class="s3">\n        </span><span class="s1">const cacheEntry = await this.imageResponseCache.get(</span><span class="s3">\n          </span><span class="s1">cacheKey,</span><span class="s3">\n          </span><span class="s1">async ({ previousCacheEntry }) =&gt; {</span><span class="s3">\n            </span><span class="s1">const { buffer, contentType, maxAge, upstreamEtag, etag } =</span><span class="s3">\n              </span><span class="s1">await this.imageOptimizer(</span><span class="s3">\n                </span><span class="s1">req,</span><span class="s3">\n                </span><span class="s1">res,</span><span class="s3">\n                </span><span class="s1">paramsResult,</span><span class="s3">\n                </span><span class="s1">previousCacheEntry</span><span class="s3">\n              </span><span class="s1">)</span><span class="s3">\n\n            </span><span class="s1">return {</span><span class="s3">\n              </span><span class="s1">value: {</span><span class="s3">\n                </span><span class="s1">kind: CachedRouteKind.IMAGE,</span><span class="s3">\n                </span><span class="s1">buffer,</span><span class="s3">\n                </span><span class="s1">etag,</span><span class="s3">\n                </span><span class="s1">extension: getExtension(contentType) as string,</span><span class="s3">\n                </span><span class="s1">upstreamEtag,</span><span class="s3">\n              </span><span class="s1">},</span><span class="s3">\n              </span><span class="s1">cacheControl: { revalidate: maxAge, expire: undefined },</span><span class="s3">\n            </span><span class="s1">}</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n          </span><span class="s1">{</span><span class="s3">\n            </span><span class="s1">routeKind: RouteKind.IMAGE,</span><span class="s3">\n            </span><span class="s1">incrementalCache: imageOptimizerCache,</span><span class="s3">\n            </span><span class="s1">isFallback: false,</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n        </span><span class="s1">if (cacheEntry?.value?.kind !== CachedRouteKind.IMAGE) {</span><span class="s3">\n          </span><span class="s1">throw new Error(</span><span class="s3">\n            </span><span class="s1">'invariant did not get entry from image response cache'</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">sendResponse(</span><span class="s3">\n          </span><span class="s1">req.originalRequest,</span><span class="s3">\n          </span><span class="s1">res.originalResponse,</span><span class="s3">\n          </span><span class="s1">paramsResult.href,</span><span class="s3">\n          </span><span class="s1">cacheEntry.value.extension,</span><span class="s3">\n          </span><span class="s1">cacheEntry.value.buffer,</span><span class="s3">\n          </span><span class="s1">cacheEntry.value.etag,</span><span class="s3">\n          </span><span class="s1">paramsResult.isStatic,</span><span class="s3">\n          </span><span class="s1">cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT',</span><span class="s3">\n          </span><span class="s1">imagesConfig,</span><span class="s3">\n          </span><span class="s1">cacheEntry.cacheControl?.revalidate || 0,</span><span class="s3">\n          </span><span class="s1">Boolean(this.renderOpts.dev)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">} catch (err) {</span><span class="s3">\n        </span><span class="s1">if (err instanceof ImageError) {</span><span class="s3">\n          </span><span class="s1">res.statusCode = err.statusCode</span><span class="s3">\n          </span><span class="s1">res.body(err.message).send()</span><span class="s3">\n          </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected handleCatchallRenderRequest: NodeRouteHandler = async (</span><span class="s3">\n    </span><span class="s1">req,</span><span class="s3">\n    </span><span class="s1">res,</span><span class="s3">\n    </span><span class="s1">parsedUrl</span><span class="s3">\n  </span><span class="s1">) =&gt; {</span><span class="s3">\n    </span><span class="s1">let { pathname, query } = parsedUrl</span><span class="s3">\n    </span><span class="s1">if (!pathname) {</span><span class="s3">\n      </span><span class="s1">throw new Error('Invariant: pathname is undefined')</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// When in minimal mode we do not bubble the fallback as the</span><span class="s3">\n    </span><span class="s1">// router-server is not present to handle the error</span><span class="s3">\n    </span><span class="s1">addRequestMeta(req, 'bubbleNoFallback', this.minimalMode ? undefined : true)</span><span class="s3">\n\n    </span><span class="s1">// This is needed to expose render404 and nextConfig</span><span class="s3">\n    </span><span class="s1">// for environments without router-server</span><span class="s3">\n    </span><span class="s1">if (!routerServerGlobal[RouterServerContextSymbol]) {</span><span class="s3">\n      </span><span class="s1">routerServerGlobal[RouterServerContextSymbol] = {}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">const relativeProjectDir = relative(process.cwd(), this.dir)</span><span class="s3">\n    </span><span class="s1">const existingServerContext =</span><span class="s3">\n      </span><span class="s1">routerServerGlobal[RouterServerContextSymbol][relativeProjectDir]</span><span class="s3">\n\n    </span><span class="s1">if (!existingServerContext) {</span><span class="s3">\n      </span><span class="s1">routerServerGlobal[RouterServerContextSymbol][relativeProjectDir] = {</span><span class="s3">\n        </span><span class="s1">render404: this.render404.bind(this),</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">routerServerGlobal[RouterServerContextSymbol][</span><span class="s3">\n      </span><span class="s1">relativeProjectDir</span><span class="s3">\n    </span><span class="s1">].nextConfig = this.nextConfig</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">// next.js core assumes page path without trailing slash</span><span class="s3">\n      </span><span class="s1">pathname = removeTrailingSlash(pathname)</span><span class="s3">\n\n      </span><span class="s1">const options: MatchOptions = {</span><span class="s3">\n        </span><span class="s1">i18n: this.i18nProvider?.fromRequest(req, pathname),</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">const match = await this.matchers.match(pathname, options)</span><span class="s3">\n\n      </span><span class="s1">// If we don't have a match, try to render it anyways.</span><span class="s3">\n      </span><span class="s1">if (!match) {</span><span class="s3">\n        </span><span class="s1">await this.render(req, res, pathname, query, parsedUrl, true)</span><span class="s3">\n\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Add the match to the request so we don't have to re-run the matcher</span><span class="s3">\n      </span><span class="s1">// for the same request.</span><span class="s3">\n      </span><span class="s1">addRequestMeta(req, 'match', match)</span><span class="s3">\n\n      </span><span class="s1">// TODO-APP: move this to a route handler</span><span class="s3">\n      </span><span class="s1">const edgeFunctionsPages = this.getEdgeFunctionsPages()</span><span class="s3">\n      </span><span class="s1">for (const edgeFunctionsPage of edgeFunctionsPages) {</span><span class="s3">\n        </span><span class="s1">// If the page doesn't match the edge function page, skip it.</span><span class="s3">\n        </span><span class="s1">if (edgeFunctionsPage !== match.definition.page) continue</span><span class="s3">\n\n        </span><span class="s1">if (this.nextConfig.output === 'export') {</span><span class="s3">\n          </span><span class="s1">await this.render404(req, res, parsedUrl)</span><span class="s3">\n          </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">delete query[NEXT_RSC_UNION_QUERY]</span><span class="s3">\n\n        </span><span class="s1">// If we handled the request, we can return early.</span><span class="s3">\n        </span><span class="s1">// For api routes edge runtime</span><span class="s3">\n        </span><span class="s1">try {</span><span class="s3">\n          </span><span class="s1">const handled = await this.runEdgeFunction({</span><span class="s3">\n            </span><span class="s1">req,</span><span class="s3">\n            </span><span class="s1">res,</span><span class="s3">\n            </span><span class="s1">query,</span><span class="s3">\n            </span><span class="s1">params: match.params,</span><span class="s3">\n            </span><span class="s1">page: match.definition.page,</span><span class="s3">\n            </span><span class="s1">match,</span><span class="s3">\n            </span><span class="s1">appPaths: null,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n          </span><span class="s1">if (handled) return true</span><span class="s3">\n        </span><span class="s1">} catch (apiError) {</span><span class="s3">\n          </span><span class="s1">await this.instrumentationOnRequestError(apiError, req, {</span><span class="s3">\n            </span><span class="s1">routePath: match.definition.page,</span><span class="s3">\n            </span><span class="s1">routerKind: 'Pages Router',</span><span class="s3">\n            </span><span class="s1">routeType: 'route',</span><span class="s3">\n            </span><span class="s1">// Edge runtime does not support ISR</span><span class="s3">\n            </span><span class="s1">revalidateReason: undefined,</span><span class="s3">\n          </span><span class="s1">})</span><span class="s3">\n          </span><span class="s1">throw apiError</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// If the route was detected as being a Pages API route, then handle</span><span class="s3">\n      </span><span class="s1">// it.</span><span class="s3">\n      </span><span class="s1">// TODO: move this behavior into a route handler.</span><span class="s3">\n      </span><span class="s1">if (isPagesAPIRouteMatch(match)) {</span><span class="s3">\n        </span><span class="s1">if (this.nextConfig.output === 'export') {</span><span class="s3">\n          </span><span class="s1">await this.render404(req, res, parsedUrl)</span><span class="s3">\n          </span><span class="s1">return true</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">const handled = await this.handleApiRequest(req, res, query, match)</span><span class="s3">\n        </span><span class="s1">if (handled) return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">await this.render(req, res, pathname, query, parsedUrl, true)</span><span class="s3">\n\n      </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">} catch (err: any) {</span><span class="s3">\n      </span><span class="s1">if (err instanceof NoFallbackError) {</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">if (this.renderOpts.dev) {</span><span class="s3">\n          </span><span class="s1">const { formatServerError } =</span><span class="s3">\n            </span><span class="s1">require('../lib/format-server-error') as typeof import('../lib/format-server-error')</span><span class="s3">\n          </span><span class="s1">formatServerError(err)</span><span class="s3">\n          </span><span class="s1">this.logErrorWithOriginalStack(err)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">this.logError(err)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">res.statusCode = 500</span><span class="s3">\n        </span><span class="s1">await this.renderError(err, req, res, pathname, query)</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">} catch {}</span><span class="s3">\n\n      </span><span class="s1">throw err</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Used in development only, overloaded in next-dev-server</span><span class="s3">\n  </span><span class="s1">protected logErrorWithOriginalStack(</span><span class="s3">\n    </span><span class="s1">_err?: unknown,</span><span class="s3">\n    </span><span class="s1">_type?: 'unhandledRejection' | 'uncaughtException' | 'warning' | 'app-dir'</span><span class="s3">\n  </span><span class="s1">): void {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">'Invariant: logErrorWithOriginalStack can only be called on the development server'</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Used in development only, overloaded in next-dev-server</span><span class="s3">\n  </span><span class="s1">protected async ensurePage(_opts: {</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">clientOnly: boolean</span><span class="s3">\n    </span><span class="s1">appPaths?: ReadonlyArray&lt;string&gt; | null</span><span class="s3">\n    </span><span class="s1">match?: RouteMatch</span><span class="s3">\n    </span><span class="s1">url?: string</span><span class="s3">\n  </span><span class="s1">}): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">'Invariant: ensurePage can only be called on the development server'</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Resolves `API` request, in development builds on demand</span><span class="s3">\n   </span><span class="s1">* @param req http request</span><span class="s3">\n   </span><span class="s1">* @param res http response</span><span class="s3">\n   </span><span class="s1">* @param pathname path of request</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">protected async handleApiRequest(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse,</span><span class="s3">\n    </span><span class="s1">query: ParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">match: PagesAPIRouteMatch</span><span class="s3">\n  </span><span class="s1">): Promise&lt;boolean&gt; {</span><span class="s3">\n    </span><span class="s1">return this.runApi(req, res, query, match)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getCacheFilesystem(): CacheFs {</span><span class="s3">\n    </span><span class="s1">return nodeFs</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected normalizeReq(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage</span><span class="s3">\n  </span><span class="s1">): NodeNextRequest {</span><span class="s3">\n    </span><span class="s1">return !(req instanceof NodeNextRequest) ? new NodeNextRequest(req) : req</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected normalizeRes(</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse</span><span class="s3">\n  </span><span class="s1">): NodeNextResponse {</span><span class="s3">\n    </span><span class="s1">return !(res instanceof NodeNextResponse) ? new NodeNextResponse(res) : res</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public getRequestHandler(): NodeRequestHandler {</span><span class="s3">\n    </span><span class="s1">const handler = this.makeRequestHandler()</span><span class="s3">\n    </span><span class="s1">if (this.serverOptions.experimentalTestProxy) {</span><span class="s3">\n      </span><span class="s1">const { wrapRequestHandlerNode } =</span><span class="s3">\n        </span><span class="s1">// eslint-disable-next-line @next/internal/typechecked-require -- experimental/testmode is not built ins next/dist/esm</span><span class="s3">\n        </span><span class="s1">require('next/dist/experimental/testmode/server') as typeof import('../experimental/testmode/server')</span><span class="s3">\n      </span><span class="s1">return wrapRequestHandlerNode(handler)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return handler</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private makeRequestHandler(): NodeRequestHandler {</span><span class="s3">\n    </span><span class="s1">// This is just optimization to fire prepare as soon as possible. It will be</span><span class="s3">\n    </span><span class="s1">// properly awaited later. We add the catch here to ensure that it does not</span><span class="s3">\n    </span><span class="s1">// cause an unhandled promise rejection. The promise rejection will be</span><span class="s3">\n    </span><span class="s1">// handled later on via the `await` when the request handler is called.</span><span class="s3">\n    </span><span class="s1">this.prepare().catch((err) =&gt; {</span><span class="s3">\n      </span><span class="s1">console.error('Failed to prepare server', err)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const handler = super.getRequestHandler()</span><span class="s3">\n\n    </span><span class="s1">return (req, res, parsedUrl) =&gt;</span><span class="s3">\n      </span><span class="s1">handler(this.normalizeReq(req), this.normalizeRes(res), parsedUrl)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async revalidate({</span><span class="s3">\n    </span><span class="s1">urlPath,</span><span class="s3">\n    </span><span class="s1">revalidateHeaders,</span><span class="s3">\n    </span><span class="s1">opts,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">urlPath: string</span><span class="s3">\n    </span><span class="s1">revalidateHeaders: { [key: string]: string | string[] }</span><span class="s3">\n    </span><span class="s1">opts: { unstable_onlyGenerated?: boolean }</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">const mocked = createRequestResponseMocks({</span><span class="s3">\n      </span><span class="s1">url: urlPath,</span><span class="s3">\n      </span><span class="s1">headers: revalidateHeaders,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const handler = this.getRequestHandler()</span><span class="s3">\n    </span><span class="s1">await handler(</span><span class="s3">\n      </span><span class="s1">new NodeNextRequest(mocked.req),</span><span class="s3">\n      </span><span class="s1">new NodeNextResponse(mocked.res)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">await mocked.res.hasStreamed</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">mocked.res.getHeader('x-nextjs-cache') !== 'REVALIDATED' &amp;&amp;</span><span class="s3">\n      </span><span class="s1">mocked.res.statusCode !== 200 &amp;&amp;</span><span class="s3">\n      </span><span class="s1">!(mocked.res.statusCode === 404 &amp;&amp; opts.unstable_onlyGenerated)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">throw new Error(`Invalid response ${mocked.res.statusCode}`)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async render(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query?: NextParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">parsedUrl?: NextUrlWithParsedQuery,</span><span class="s3">\n    </span><span class="s1">internal = false</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">return super.render(</span><span class="s3">\n      </span><span class="s1">this.normalizeReq(req),</span><span class="s3">\n      </span><span class="s1">this.normalizeRes(res),</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">query,</span><span class="s3">\n      </span><span class="s1">parsedUrl,</span><span class="s3">\n      </span><span class="s1">internal</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async renderToHTML(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query?: ParsedUrlQuery</span><span class="s3">\n  </span><span class="s1">): Promise&lt;string | null&gt; {</span><span class="s3">\n    </span><span class="s1">return super.renderToHTML(</span><span class="s3">\n      </span><span class="s1">this.normalizeReq(req),</span><span class="s3">\n      </span><span class="s1">this.normalizeRes(res),</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">query</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async renderErrorToResponseImpl(</span><span class="s3">\n    </span><span class="s1">ctx: RequestContext&lt;NodeNextRequest, NodeNextResponse&gt;,</span><span class="s3">\n    </span><span class="s1">err: Error | null</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">const { req, res, query } = ctx</span><span class="s3">\n    </span><span class="s1">const is404 = res.statusCode === 404</span><span class="s3">\n\n    </span><span class="s1">if (is404 &amp;&amp; this.enabledDirectories.app) {</span><span class="s3">\n      </span><span class="s1">if (this.renderOpts.dev) {</span><span class="s3">\n        </span><span class="s1">await this.ensurePage({</span><span class="s3">\n          </span><span class="s1">page: UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,</span><span class="s3">\n          </span><span class="s1">clientOnly: false,</span><span class="s3">\n          </span><span class="s1">url: req.url,</span><span class="s3">\n        </span><span class="s1">}).catch(() =&gt; {})</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (</span><span class="s3">\n        </span><span class="s1">this.getEdgeFunctionsPages().includes(UNDERSCORE_NOT_FOUND_ROUTE_ENTRY)</span><span class="s3">\n      </span><span class="s1">) {</span><span class="s3">\n        </span><span class="s1">await this.runEdgeFunction({</span><span class="s3">\n          </span><span class="s1">req,</span><span class="s3">\n          </span><span class="s1">res,</span><span class="s3">\n          </span><span class="s1">query: query || {},</span><span class="s3">\n          </span><span class="s1">params: {},</span><span class="s3">\n          </span><span class="s1">page: UNDERSCORE_NOT_FOUND_ROUTE_ENTRY,</span><span class="s3">\n          </span><span class="s1">appPaths: null,</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">return null</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return super.renderErrorToResponseImpl(ctx, err)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async renderError(</span><span class="s3">\n    </span><span class="s1">err: Error | null,</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query?: NextParsedUrlQuery,</span><span class="s3">\n    </span><span class="s1">setHeaders?: boolean</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">return super.renderError(</span><span class="s3">\n      </span><span class="s1">err,</span><span class="s3">\n      </span><span class="s1">this.normalizeReq(req),</span><span class="s3">\n      </span><span class="s1">this.normalizeRes(res),</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">query,</span><span class="s3">\n      </span><span class="s1">setHeaders</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async renderErrorToHTML(</span><span class="s3">\n    </span><span class="s1">err: Error | null,</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse,</span><span class="s3">\n    </span><span class="s1">pathname: string,</span><span class="s3">\n    </span><span class="s1">query?: ParsedUrlQuery</span><span class="s3">\n  </span><span class="s1">): Promise&lt;string | null&gt; {</span><span class="s3">\n    </span><span class="s1">return super.renderErrorToHTML(</span><span class="s3">\n      </span><span class="s1">err,</span><span class="s3">\n      </span><span class="s1">this.normalizeReq(req),</span><span class="s3">\n      </span><span class="s1">this.normalizeRes(res),</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">query</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">public async render404(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest | IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse | ServerResponse,</span><span class="s3">\n    </span><span class="s1">parsedUrl?: NextUrlWithParsedQuery,</span><span class="s3">\n    </span><span class="s1">setHeaders?: boolean</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">return super.render404(</span><span class="s3">\n      </span><span class="s1">this.normalizeReq(req),</span><span class="s3">\n      </span><span class="s1">this.normalizeRes(res),</span><span class="s3">\n      </span><span class="s1">parsedUrl,</span><span class="s3">\n      </span><span class="s1">setHeaders</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getMiddlewareManifest(): MiddlewareManifest | null {</span><span class="s3">\n    </span><span class="s1">if (this.minimalMode) {</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">const manifest: MiddlewareManifest = require(this.middlewareManifestPath)</span><span class="s3">\n      </span><span class="s1">return manifest</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/** Returns the middleware routing item if there is one. */</span><span class="s3">\n  </span><span class="s1">protected async getMiddleware(): Promise&lt;MiddlewareRoutingItem | undefined&gt; {</span><span class="s3">\n    </span><span class="s1">const manifest = this.getMiddlewareManifest()</span><span class="s3">\n    </span><span class="s1">const middleware = manifest?.middleware?.['/']</span><span class="s3">\n    </span><span class="s1">if (!middleware) {</span><span class="s3">\n      </span><span class="s1">const middlewareModule = await this.loadNodeMiddleware()</span><span class="s3">\n\n      </span><span class="s1">if (middlewareModule) {</span><span class="s3">\n        </span><span class="s1">return {</span><span class="s3">\n          </span><span class="s1">match: getMiddlewareRouteMatcher(</span><span class="s3">\n            </span><span class="s1">middlewareModule.config?.matchers || [</span><span class="s3">\n              </span><span class="s1">{ regexp: '.*', originalSource: '/:path*' },</span><span class="s3">\n            </span><span class="s1">]</span><span class="s3">\n          </span><span class="s1">),</span><span class="s3">\n          </span><span class="s1">page: '/',</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n      </span><span class="s1">match: getMiddlewareMatcher(middleware),</span><span class="s3">\n      </span><span class="s1">page: '/',</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getEdgeFunctionsPages(): string[] {</span><span class="s3">\n    </span><span class="s1">const manifest = this.getMiddlewareManifest()</span><span class="s3">\n    </span><span class="s1">if (!manifest) {</span><span class="s3">\n      </span><span class="s1">return []</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return Object.keys(manifest.functions)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Get information for the edge function located in the provided page</span><span class="s3">\n   </span><span class="s1">* folder. If the edge function info can't be found it will throw</span><span class="s3">\n   </span><span class="s1">* an error.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">protected getEdgeFunctionInfo(params: {</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">/** Whether we should look for a middleware or not */</span><span class="s3">\n    </span><span class="s1">middleware: boolean</span><span class="s3">\n  </span><span class="s1">}): {</span><span class="s3">\n    </span><span class="s1">name: string</span><span class="s3">\n    </span><span class="s1">paths: string[]</span><span class="s3">\n    </span><span class="s1">wasm: { filePath: string; name: string }[]</span><span class="s3">\n    </span><span class="s1">env: { [key: string]: string }</span><span class="s3">\n    </span><span class="s1">assets?: { filePath: string; name: string }[]</span><span class="s3">\n  </span><span class="s1">} | null {</span><span class="s3">\n    </span><span class="s1">const manifest = this.getMiddlewareManifest()</span><span class="s3">\n    </span><span class="s1">if (!manifest) {</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let foundPage: string</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">foundPage = denormalizePagePath(normalizePagePath(params.page))</span><span class="s3">\n    </span><span class="s1">} catch (err) {</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let pageInfo = params.middleware</span><span class="s3">\n      </span><span class="s1">? manifest.middleware[foundPage]</span><span class="s3">\n      </span><span class="s1">: manifest.functions[foundPage]</span><span class="s3">\n\n    </span><span class="s1">if (!pageInfo) {</span><span class="s3">\n      </span><span class="s1">if (!params.middleware) {</span><span class="s3">\n        </span><span class="s1">throw new PageNotFoundError(foundPage)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return {</span><span class="s3">\n      </span><span class="s1">name: pageInfo.name,</span><span class="s3">\n      </span><span class="s1">paths: pageInfo.files.map((file) =&gt; join(this.distDir, file)),</span><span class="s3">\n      </span><span class="s1">wasm: (pageInfo.wasm ?? []).map((binding) =&gt; ({</span><span class="s3">\n        </span><span class="s1">...binding,</span><span class="s3">\n        </span><span class="s1">filePath: join(this.distDir, binding.filePath),</span><span class="s3">\n      </span><span class="s1">})),</span><span class="s3">\n      </span><span class="s1">assets:</span><span class="s3">\n        </span><span class="s1">pageInfo.assets &amp;&amp;</span><span class="s3">\n        </span><span class="s1">pageInfo.assets.map((binding) =&gt; {</span><span class="s3">\n          </span><span class="s1">return {</span><span class="s3">\n            </span><span class="s1">...binding,</span><span class="s3">\n            </span><span class="s1">filePath: join(this.distDir, binding.filePath),</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}),</span><span class="s3">\n      </span><span class="s1">env: pageInfo.env,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private async loadNodeMiddleware() {</span><span class="s3">\n    </span><span class="s1">if (!process.env.NEXT_MINIMAL) {</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const functionsConfig = this.renderOpts.dev</span><span class="s3">\n          </span><span class="s1">? {}</span><span class="s3">\n          </span><span class="s1">: require(join(this.distDir, 'server', FUNCTIONS_CONFIG_MANIFEST))</span><span class="s3">\n\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">this.renderOpts.dev ||</span><span class="s3">\n          </span><span class="s1">functionsConfig?.functions?.['/_middleware']</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">// if used with top level await, this will be a promise</span><span class="s3">\n          </span><span class="s1">return require(join(this.distDir, 'server', 'middleware.js'))</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} catch (err) {</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">isError(err) &amp;&amp;</span><span class="s3">\n          </span><span class="s1">err.code !== 'ENOENT' &amp;&amp;</span><span class="s3">\n          </span><span class="s1">err.code !== 'MODULE_NOT_FOUND'</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">throw err</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Checks if a middleware exists. This method is useful for the development</span><span class="s3">\n   </span><span class="s1">* server where we need to check the filesystem. Here we just check the</span><span class="s3">\n   </span><span class="s1">* middleware manifest.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">protected async hasMiddleware(pathname: string): Promise&lt;boolean&gt; {</span><span class="s3">\n    </span><span class="s1">const info = this.getEdgeFunctionInfo({ page: pathname, middleware: true })</span><span class="s3">\n    </span><span class="s1">const nodeMiddleware = await this.loadNodeMiddleware()</span><span class="s3">\n\n    </span><span class="s1">if (!info &amp;&amp; nodeMiddleware) {</span><span class="s3">\n      </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">return Boolean(info &amp;&amp; info.paths.length &gt; 0)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* A placeholder for a function to be defined in the development server.</span><span class="s3">\n   </span><span class="s1">* It will make sure that the root middleware or an edge function has been compiled</span><span class="s3">\n   </span><span class="s1">* so that we can run it.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">protected async ensureMiddleware(_url?: string) {}</span><span class="s3">\n  </span><span class="s1">protected async ensureEdgeFunction(_params: {</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">appPaths: string[] | null</span><span class="s3">\n    </span><span class="s1">url?: string</span><span class="s3">\n  </span><span class="s1">}) {}</span><span class="s3">\n\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* This method gets all middleware matchers and execute them when the request</span><span class="s3">\n   </span><span class="s1">* matches. It will make sure that each middleware exists and is compiled and</span><span class="s3">\n   </span><span class="s1">* ready to be invoked. The development server will decorate it to add warns</span><span class="s3">\n   </span><span class="s1">* and errors with rich traces.</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">protected async runMiddleware(params: {</span><span class="s3">\n    </span><span class="s1">request: NodeNextRequest</span><span class="s3">\n    </span><span class="s1">response: NodeNextResponse</span><span class="s3">\n    </span><span class="s1">parsedUrl: ParsedUrl</span><span class="s3">\n    </span><span class="s1">parsed: UrlWithParsedQuery</span><span class="s3">\n    </span><span class="s1">onWarning?: (warning: Error) =&gt; void</span><span class="s3">\n  </span><span class="s1">}) {</span><span class="s3">\n    </span><span class="s1">if (process.env.NEXT_MINIMAL) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'invariant: runMiddleware should not be called in minimal mode'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Middleware is skipped for on-demand revalidate requests</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">checkIsOnDemandRevalidate(params.request, this.renderOpts.previewProps)</span><span class="s3">\n        </span><span class="s1">.isOnDemandRevalidate</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return {</span><span class="s3">\n        </span><span class="s1">response: new Response(null, { headers: { 'x-middleware-next': '1' } }),</span><span class="s3">\n      </span><span class="s1">} as FetchEventResult</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let url: string</span><span class="s3">\n\n    </span><span class="s1">if (this.nextConfig.skipMiddlewareUrlNormalize) {</span><span class="s3">\n      </span><span class="s1">url = getRequestMeta(params.request, 'initURL')!</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">// For middleware to </span><span class="s3">\&quot;</span><span class="s1">fetch</span><span class="s3">\&quot; </span><span class="s1">we must always provide an absolute URL</span><span class="s3">\n      </span><span class="s1">const query = urlQueryToSearchParams(params.parsed.query).toString()</span><span class="s3">\n      </span><span class="s1">const locale = getRequestMeta(params.request, 'locale')</span><span class="s3">\n\n      </span><span class="s1">url = `${getRequestMeta(params.request, 'initProtocol')}://${</span><span class="s3">\n        </span><span class="s1">this.fetchHostname || 'localhost'</span><span class="s3">\n      </span><span class="s1">}:${this.port}${locale ? `/${locale}` : ''}${params.parsed.pathname}${</span><span class="s3">\n        </span><span class="s1">query ? `?${query}` : ''</span><span class="s3">\n      </span><span class="s1">}`</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!url.startsWith('http')) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'To use middleware you must provide a `hostname` and `port` to the Next.js Server'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const page: {</span><span class="s3">\n      </span><span class="s1">name?: string</span><span class="s3">\n      </span><span class="s1">params?: { [key: string]: string | string[] }</span><span class="s3">\n    </span><span class="s1">} = {}</span><span class="s3">\n\n    </span><span class="s1">const middleware = await this.getMiddleware()</span><span class="s3">\n    </span><span class="s1">if (!middleware) {</span><span class="s3">\n      </span><span class="s1">return { finished: false }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (!(await this.hasMiddleware(middleware.page))) {</span><span class="s3">\n      </span><span class="s1">return { finished: false }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">await this.ensureMiddleware(params.request.url)</span><span class="s3">\n    </span><span class="s1">const middlewareInfo = this.getEdgeFunctionInfo({</span><span class="s3">\n      </span><span class="s1">page: middleware.page,</span><span class="s3">\n      </span><span class="s1">middleware: true,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const method = (params.request.method || 'GET').toUpperCase()</span><span class="s3">\n    </span><span class="s1">const requestData = {</span><span class="s3">\n      </span><span class="s1">headers: params.request.headers,</span><span class="s3">\n      </span><span class="s1">method,</span><span class="s3">\n      </span><span class="s1">nextConfig: {</span><span class="s3">\n        </span><span class="s1">basePath: this.nextConfig.basePath,</span><span class="s3">\n        </span><span class="s1">i18n: this.nextConfig.i18n,</span><span class="s3">\n        </span><span class="s1">trailingSlash: this.nextConfig.trailingSlash,</span><span class="s3">\n        </span><span class="s1">experimental: this.nextConfig.experimental,</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">url: url,</span><span class="s3">\n      </span><span class="s1">page,</span><span class="s3">\n      </span><span class="s1">body:</span><span class="s3">\n        </span><span class="s1">method !== 'GET' &amp;&amp; method !== 'HEAD'</span><span class="s3">\n          </span><span class="s1">? (getRequestMeta(params.request, 'clonableBody') as any)</span><span class="s3">\n          </span><span class="s1">: undefined,</span><span class="s3">\n\n      </span><span class="s1">signal: signalFromNodeResponse(params.response.originalResponse),</span><span class="s3">\n      </span><span class="s1">waitUntil: this.getWaitUntil(),</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">let result:</span><span class="s3">\n      </span><span class="s1">| UnwrapPromise&lt;ReturnType&lt;typeof import('./web/sandbox').run&gt;&gt;</span><span class="s3">\n      </span><span class="s1">| undefined</span><span class="s3">\n\n    </span><span class="s1">// if no middleware info check for Node.js middleware</span><span class="s3">\n    </span><span class="s1">// this is not in the middleware-manifest as that historically</span><span class="s3">\n    </span><span class="s1">// has only included edge-functions, we need to do a breaking</span><span class="s3">\n    </span><span class="s1">// version bump for that manifest to write this info there if</span><span class="s3">\n    </span><span class="s1">// we decide we want to</span><span class="s3">\n    </span><span class="s1">if (!middlewareInfo) {</span><span class="s3">\n      </span><span class="s1">let middlewareModule</span><span class="s3">\n      </span><span class="s1">middlewareModule = await this.loadNodeMiddleware()</span><span class="s3">\n\n      </span><span class="s1">if (!middlewareModule) {</span><span class="s3">\n        </span><span class="s1">throw new MiddlewareNotFoundError()</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">const adapterFn: typeof import('./web/adapter').adapter =</span><span class="s3">\n        </span><span class="s1">middlewareModule.default || middlewareModule</span><span class="s3">\n\n      </span><span class="s1">const hasRequestBody =</span><span class="s3">\n        </span><span class="s1">!['HEAD', 'GET'].includes(params.request.method) &amp;&amp;</span><span class="s3">\n        </span><span class="s1">Boolean(requestData.body)</span><span class="s3">\n\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">result = await adapterFn({</span><span class="s3">\n          </span><span class="s1">handler: middlewareModule.middleware || middlewareModule,</span><span class="s3">\n          </span><span class="s1">request: {</span><span class="s3">\n            </span><span class="s1">...requestData,</span><span class="s3">\n            </span><span class="s1">body: hasRequestBody</span><span class="s3">\n              </span><span class="s1">? requestData.body.cloneBodyStream()</span><span class="s3">\n              </span><span class="s1">: undefined,</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n          </span><span class="s1">page: 'middleware',</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">} finally {</span><span class="s3">\n        </span><span class="s1">if (hasRequestBody) {</span><span class="s3">\n          </span><span class="s1">requestData.body.finalize()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">const { run } = require('./web/sandbox') as typeof import('./web/sandbox')</span><span class="s3">\n\n      </span><span class="s1">result = await run({</span><span class="s3">\n        </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n        </span><span class="s1">name: middlewareInfo.name,</span><span class="s3">\n        </span><span class="s1">paths: middlewareInfo.paths,</span><span class="s3">\n        </span><span class="s1">edgeFunctionEntry: middlewareInfo,</span><span class="s3">\n        </span><span class="s1">request: requestData,</span><span class="s3">\n        </span><span class="s1">useCache: true,</span><span class="s3">\n        </span><span class="s1">onWarning: params.onWarning,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!this.renderOpts.dev) {</span><span class="s3">\n      </span><span class="s1">result.waitUntil.catch((error) =&gt; {</span><span class="s3">\n        </span><span class="s1">console.error(`Uncaught: middleware waitUntil errored`, error)</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!result) {</span><span class="s3">\n      </span><span class="s1">this.render404(params.request, params.response, params.parsed)</span><span class="s3">\n      </span><span class="s1">return { finished: true }</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Split compound (comma-separated) set-cookie headers</span><span class="s3">\n    </span><span class="s1">if (result.response.headers.has('set-cookie')) {</span><span class="s3">\n      </span><span class="s1">const cookies = result.response.headers</span><span class="s3">\n        </span><span class="s1">.getSetCookie()</span><span class="s3">\n        </span><span class="s1">.flatMap((maybeCompoundCookie) =&gt;</span><span class="s3">\n          </span><span class="s1">splitCookiesString(maybeCompoundCookie)</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">// Clear existing header(s)</span><span class="s3">\n      </span><span class="s1">result.response.headers.delete('set-cookie')</span><span class="s3">\n\n      </span><span class="s1">// Append each cookie individually.</span><span class="s3">\n      </span><span class="s1">for (const cookie of cookies) {</span><span class="s3">\n        </span><span class="s1">result.response.headers.append('set-cookie', cookie)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// Add cookies to request meta.</span><span class="s3">\n      </span><span class="s1">addRequestMeta(params.request, 'middlewareCookie', cookies)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return result</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected handleCatchallMiddlewareRequest: NodeRouteHandler = async (</span><span class="s3">\n    </span><span class="s1">req,</span><span class="s3">\n    </span><span class="s1">res,</span><span class="s3">\n    </span><span class="s1">parsed</span><span class="s3">\n  </span><span class="s1">) =&gt; {</span><span class="s3">\n    </span><span class="s1">const isMiddlewareInvoke = getRequestMeta(req, 'middlewareInvoke')</span><span class="s3">\n\n    </span><span class="s1">if (!isMiddlewareInvoke) {</span><span class="s3">\n      </span><span class="s1">return false</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const handleFinished = () =&gt; {</span><span class="s3">\n      </span><span class="s1">addRequestMeta(req, 'middlewareInvoke', true)</span><span class="s3">\n      </span><span class="s1">res.body('').send()</span><span class="s3">\n      </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const middleware = await this.getMiddleware()</span><span class="s3">\n    </span><span class="s1">if (!middleware) {</span><span class="s3">\n      </span><span class="s1">return handleFinished()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const initUrl = getRequestMeta(req, 'initURL')!</span><span class="s3">\n    </span><span class="s1">const parsedUrl = parseUrl(initUrl)</span><span class="s3">\n    </span><span class="s1">const pathnameInfo = getNextPathnameInfo(parsedUrl.pathname, {</span><span class="s3">\n      </span><span class="s1">nextConfig: this.nextConfig,</span><span class="s3">\n      </span><span class="s1">i18nProvider: this.i18nProvider,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">parsedUrl.pathname = pathnameInfo.pathname</span><span class="s3">\n    </span><span class="s1">const normalizedPathname = removeTrailingSlash(parsed.pathname || '')</span><span class="s3">\n    </span><span class="s1">let maybeDecodedPathname = normalizedPathname</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">maybeDecodedPathname = decodeURIComponent(normalizedPathname)</span><span class="s3">\n    </span><span class="s1">} catch {</span><span class="s3">\n      </span><span class="s1">/* non-fatal we can't decode so can't match it */</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">!(</span><span class="s3">\n        </span><span class="s1">middleware.match(normalizedPathname, req, parsedUrl.query) ||</span><span class="s3">\n        </span><span class="s1">middleware.match(maybeDecodedPathname, req, parsedUrl.query)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">return handleFinished()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let result: Awaited&lt;</span><span class="s3">\n      </span><span class="s1">ReturnType&lt;typeof NextNodeServer.prototype.runMiddleware&gt;</span><span class="s3">\n    </span><span class="s1">&gt;</span><span class="s3">\n    </span><span class="s1">let bubblingResult = false</span><span class="s3">\n\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">await this.ensureMiddleware(req.url)</span><span class="s3">\n\n      </span><span class="s1">result = await this.runMiddleware({</span><span class="s3">\n        </span><span class="s1">request: req,</span><span class="s3">\n        </span><span class="s1">response: res,</span><span class="s3">\n        </span><span class="s1">parsedUrl: parsedUrl,</span><span class="s3">\n        </span><span class="s1">parsed: parsed,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n\n      </span><span class="s1">if ('response' in result) {</span><span class="s3">\n        </span><span class="s1">if (isMiddlewareInvoke) {</span><span class="s3">\n          </span><span class="s1">bubblingResult = true</span><span class="s3">\n          </span><span class="s1">throw new BubbledError(true, result)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n\n        </span><span class="s1">for (const [key, value] of Object.entries(</span><span class="s3">\n          </span><span class="s1">toNodeOutgoingHttpHeaders(result.response.headers)</span><span class="s3">\n        </span><span class="s1">)) {</span><span class="s3">\n          </span><span class="s1">if (key !== 'content-encoding' &amp;&amp; value !== undefined) {</span><span class="s3">\n            </span><span class="s1">res.setHeader(key, value as string | string[])</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">res.statusCode = result.response.status</span><span class="s3">\n\n        </span><span class="s1">const { originalResponse } = res</span><span class="s3">\n        </span><span class="s1">if (result.response.body) {</span><span class="s3">\n          </span><span class="s1">await pipeToNodeResponse(result.response.body, originalResponse)</span><span class="s3">\n        </span><span class="s1">} else {</span><span class="s3">\n          </span><span class="s1">originalResponse.end()</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">} catch (err: unknown) {</span><span class="s3">\n      </span><span class="s1">if (bubblingResult) {</span><span class="s3">\n        </span><span class="s1">throw err</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (isError(err) &amp;&amp; err.code === 'ENOENT') {</span><span class="s3">\n        </span><span class="s1">await this.render404(req, res, parsed)</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (err instanceof DecodeError) {</span><span class="s3">\n        </span><span class="s1">res.statusCode = 400</span><span class="s3">\n        </span><span class="s1">await this.renderError(err, req, res, parsed.pathname || '')</span><span class="s3">\n        </span><span class="s1">return true</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">const error = getProperError(err)</span><span class="s3">\n      </span><span class="s1">console.error(error)</span><span class="s3">\n      </span><span class="s1">res.statusCode = 500</span><span class="s3">\n      </span><span class="s1">await this.renderError(error, req, res, parsed.pathname || '')</span><span class="s3">\n      </span><span class="s1">return true</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return result.finished</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private _cachedPreviewManifest: PrerenderManifest | undefined</span><span class="s3">\n  </span><span class="s1">protected getPrerenderManifest(): PrerenderManifest {</span><span class="s3">\n    </span><span class="s1">if (this._cachedPreviewManifest) {</span><span class="s3">\n      </span><span class="s1">return this._cachedPreviewManifest</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">this._cachedPreviewManifest = loadManifest(</span><span class="s3">\n      </span><span class="s1">join(this.distDir, PRERENDER_MANIFEST)</span><span class="s3">\n    </span><span class="s1">) as PrerenderManifest</span><span class="s3">\n\n    </span><span class="s1">return this._cachedPreviewManifest</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getRoutesManifest(): NormalizedRouteManifest | undefined {</span><span class="s3">\n    </span><span class="s1">return getTracer().trace(</span><span class="s3">\n      </span><span class="s1">NextNodeServerSpan.getRoutesManifest,</span><span class="s3">\n      </span><span class="s1">() =&gt; loadManifest(join(this.distDir, ROUTES_MANIFEST)) as RoutesManifest</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected attachRequestMeta(</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest,</span><span class="s3">\n    </span><span class="s1">parsedUrl: NextUrlWithParsedQuery,</span><span class="s3">\n    </span><span class="s1">isUpgradeReq?: boolean</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// Injected in base-server.ts</span><span class="s3">\n    </span><span class="s1">const protocol = req.headers['x-forwarded-proto']?.includes('https')</span><span class="s3">\n      </span><span class="s1">? 'https'</span><span class="s3">\n      </span><span class="s1">: 'http'</span><span class="s3">\n\n    </span><span class="s1">// When there are hostname and port we build an absolute URL</span><span class="s3">\n    </span><span class="s1">const initUrl =</span><span class="s3">\n      </span><span class="s1">this.fetchHostname &amp;&amp; this.port</span><span class="s3">\n        </span><span class="s1">? `${protocol}://${this.fetchHostname}:${this.port}${req.url}`</span><span class="s3">\n        </span><span class="s1">: this.nextConfig.experimental.trustHostHeader</span><span class="s3">\n          </span><span class="s1">? `https://${req.headers.host || 'localhost'}${req.url}`</span><span class="s3">\n          </span><span class="s1">: req.url</span><span class="s3">\n\n    </span><span class="s1">addRequestMeta(req, 'initURL', initUrl)</span><span class="s3">\n    </span><span class="s1">addRequestMeta(req, 'initQuery', { ...parsedUrl.query })</span><span class="s3">\n    </span><span class="s1">addRequestMeta(req, 'initProtocol', protocol)</span><span class="s3">\n\n    </span><span class="s1">if (!isUpgradeReq) {</span><span class="s3">\n      </span><span class="s1">addRequestMeta(req, 'clonableBody', getCloneableBody(req.originalRequest))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async runEdgeFunction(params: {</span><span class="s3">\n    </span><span class="s1">req: NodeNextRequest</span><span class="s3">\n    </span><span class="s1">res: NodeNextResponse</span><span class="s3">\n    </span><span class="s1">query: ParsedUrlQuery</span><span class="s3">\n    </span><span class="s1">params: Params | undefined</span><span class="s3">\n    </span><span class="s1">page: string</span><span class="s3">\n    </span><span class="s1">appPaths: string[] | null</span><span class="s3">\n    </span><span class="s1">match?: RouteMatch</span><span class="s3">\n    </span><span class="s1">onError?: (err: unknown) =&gt; void</span><span class="s3">\n    </span><span class="s1">onWarning?: (warning: Error) =&gt; void</span><span class="s3">\n  </span><span class="s1">}): Promise&lt;FetchEventResult | null&gt; {</span><span class="s3">\n    </span><span class="s1">if (process.env.NEXT_MINIMAL) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'Middleware is not supported in minimal mode. Please remove the `NEXT_MINIMAL` environment variable.'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">let edgeInfo: ReturnType&lt;typeof this.getEdgeFunctionInfo&gt; | undefined</span><span class="s3">\n\n    </span><span class="s1">const { query, page, match } = params</span><span class="s3">\n\n    </span><span class="s1">if (!match)</span><span class="s3">\n      </span><span class="s1">await this.ensureEdgeFunction({</span><span class="s3">\n        </span><span class="s1">page,</span><span class="s3">\n        </span><span class="s1">appPaths: params.appPaths,</span><span class="s3">\n        </span><span class="s1">url: params.req.url,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">edgeInfo = this.getEdgeFunctionInfo({</span><span class="s3">\n      </span><span class="s1">page,</span><span class="s3">\n      </span><span class="s1">middleware: false,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">if (!edgeInfo) {</span><span class="s3">\n      </span><span class="s1">return null</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// For edge to </span><span class="s3">\&quot;</span><span class="s1">fetch</span><span class="s3">\&quot; </span><span class="s1">we must always provide an absolute URL</span><span class="s3">\n    </span><span class="s1">const isNextDataRequest = getRequestMeta(params.req, 'isNextDataReq')</span><span class="s3">\n    </span><span class="s1">const initialUrl = new URL(</span><span class="s3">\n      </span><span class="s1">getRequestMeta(params.req, 'initURL') || '/',</span><span class="s3">\n      </span><span class="s1">'http://n'</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">const queryString = urlQueryToSearchParams({</span><span class="s3">\n      </span><span class="s1">...Object.fromEntries(initialUrl.searchParams),</span><span class="s3">\n      </span><span class="s1">...query,</span><span class="s3">\n      </span><span class="s1">...params.params,</span><span class="s3">\n    </span><span class="s1">}).toString()</span><span class="s3">\n\n    </span><span class="s1">if (isNextDataRequest) {</span><span class="s3">\n      </span><span class="s1">params.req.headers['x-nextjs-data'] = '1'</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">initialUrl.search = queryString</span><span class="s3">\n    </span><span class="s1">const url = initialUrl.toString()</span><span class="s3">\n\n    </span><span class="s1">if (!url.startsWith('http')) {</span><span class="s3">\n      </span><span class="s1">throw new Error(</span><span class="s3">\n        </span><span class="s1">'To use middleware you must provide a `hostname` and `port` to the Next.js Server'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const { run } = require('./web/sandbox') as typeof import('./web/sandbox')</span><span class="s3">\n    </span><span class="s1">const result = await run({</span><span class="s3">\n      </span><span class="s1">distDir: this.distDir,</span><span class="s3">\n      </span><span class="s1">name: edgeInfo.name,</span><span class="s3">\n      </span><span class="s1">paths: edgeInfo.paths,</span><span class="s3">\n      </span><span class="s1">edgeFunctionEntry: edgeInfo,</span><span class="s3">\n      </span><span class="s1">request: {</span><span class="s3">\n        </span><span class="s1">headers: params.req.headers,</span><span class="s3">\n        </span><span class="s1">method: params.req.method,</span><span class="s3">\n        </span><span class="s1">nextConfig: {</span><span class="s3">\n          </span><span class="s1">basePath: this.nextConfig.basePath,</span><span class="s3">\n          </span><span class="s1">i18n: this.nextConfig.i18n,</span><span class="s3">\n          </span><span class="s1">trailingSlash: this.nextConfig.trailingSlash,</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">url,</span><span class="s3">\n        </span><span class="s1">page: {</span><span class="s3">\n          </span><span class="s1">name: params.page,</span><span class="s3">\n          </span><span class="s1">...(params.params &amp;&amp; { params: params.params }),</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">body: getRequestMeta(params.req, 'clonableBody'),</span><span class="s3">\n        </span><span class="s1">signal: signalFromNodeResponse(params.res.originalResponse),</span><span class="s3">\n        </span><span class="s1">waitUntil: this.getWaitUntil(),</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n      </span><span class="s1">useCache: true,</span><span class="s3">\n      </span><span class="s1">onError: params.onError,</span><span class="s3">\n      </span><span class="s1">onWarning: params.onWarning,</span><span class="s3">\n      </span><span class="s1">incrementalCache:</span><span class="s3">\n        </span><span class="s1">(globalThis as any).__incrementalCache ||</span><span class="s3">\n        </span><span class="s1">getRequestMeta(params.req, 'incrementalCache'),</span><span class="s3">\n      </span><span class="s1">serverComponentsHmrCache: getRequestMeta(</span><span class="s3">\n        </span><span class="s1">params.req,</span><span class="s3">\n        </span><span class="s1">'serverComponentsHmrCache'</span><span class="s3">\n      </span><span class="s1">),</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">if (result.fetchMetrics) {</span><span class="s3">\n      </span><span class="s1">params.req.fetchMetrics = result.fetchMetrics</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (!params.res.statusCode || params.res.statusCode &lt; 400) {</span><span class="s3">\n      </span><span class="s1">params.res.statusCode = result.response.status</span><span class="s3">\n      </span><span class="s1">params.res.statusMessage = result.response.statusText</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// TODO: (wyattjoh) investigate improving this</span><span class="s3">\n\n    </span><span class="s1">result.response.headers.forEach((value, key) =&gt; {</span><span class="s3">\n      </span><span class="s1">// The append handling is special cased for `set-cookie`.</span><span class="s3">\n      </span><span class="s1">if (key.toLowerCase() === 'set-cookie') {</span><span class="s3">\n        </span><span class="s1">// TODO: (wyattjoh) replace with native response iteration when we can upgrade undici</span><span class="s3">\n        </span><span class="s1">for (const cookie of splitCookiesString(value)) {</span><span class="s3">\n          </span><span class="s1">params.res.appendHeader(key, cookie)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">params.res.appendHeader(key, value)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">const { originalResponse } = params.res</span><span class="s3">\n    </span><span class="s1">if (result.response.body) {</span><span class="s3">\n      </span><span class="s1">await pipeToNodeResponse(result.response.body, originalResponse)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">originalResponse.end()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">return result</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected get serverDistDir(): string {</span><span class="s3">\n    </span><span class="s1">if (this._serverDistDir) {</span><span class="s3">\n      </span><span class="s1">return this._serverDistDir</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">const serverDistDir = join(this.distDir, SERVER_DIRECTORY)</span><span class="s3">\n    </span><span class="s1">this._serverDistDir = serverDistDir</span><span class="s3">\n    </span><span class="s1">return serverDistDir</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async getFallbackErrorComponents(</span><span class="s3">\n    </span><span class="s1">_url?: string</span><span class="s3">\n  </span><span class="s1">): Promise&lt;LoadComponentsReturnType | null&gt; {</span><span class="s3">\n    </span><span class="s1">// Not implemented for production use cases, this is implemented on the</span><span class="s3">\n    </span><span class="s1">// development server.</span><span class="s3">\n    </span><span class="s1">return null</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected async instrumentationOnRequestError(</span><span class="s3">\n    </span><span class="s1">...args: Parameters&lt;ServerOnInstrumentationRequestError&gt;</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">await super.instrumentationOnRequestError(...args)</span><span class="s3">\n\n    </span><span class="s1">// For Node.js runtime production logs, in dev it will be overridden by next-dev-server</span><span class="s3">\n    </span><span class="s1">if (!this.renderOpts.dev) {</span><span class="s3">\n      </span><span class="s1">this.logError(args[0] as Error)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected onServerClose(listener: () =&gt; Promise&lt;void&gt;) {</span><span class="s3">\n    </span><span class="s1">this.cleanupListeners.add(listener)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">async close(): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">await this.cleanupListeners.runAll()</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">protected getInternalWaitUntil(): WaitUntil {</span><span class="s3">\n    </span><span class="s1">this.internalWaitUntil ??= this.createInternalWaitUntil()</span><span class="s3">\n    </span><span class="s1">return this.internalWaitUntil</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">private createInternalWaitUntil() {</span><span class="s3">\n    </span><span class="s1">if (this.minimalMode) {</span><span class="s3">\n      </span><span class="s1">throw new InvariantError(</span><span class="s3">\n        </span><span class="s1">'createInternalWaitUntil should never be called in minimal mode'</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const awaiter = new AwaiterOnce({ onError: console.error })</span><span class="s3">\n\n    </span><span class="s1">// TODO(after): warn if the process exits before these are awaited</span><span class="s3">\n    </span><span class="s1">this.onServerClose(() =&gt; awaiter.awaiting())</span><span class="s3">\n\n    </span><span class="s1">return awaiter.waitUntil</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;NextNodeServer&quot;</span><span class="s0">,</span><span class="s1">&quot;dynamicImportEsmDefault&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_MINIMAL&quot;</span><span class="s0">,</span><span class="s1">&quot;id&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">,</span><span class="s1">&quot;mod&quot;</span><span class="s0">,</span><span class="s1">&quot;default&quot;</span><span class="s0">,</span><span class="s1">&quot;MiddlewareMatcherCache&quot;</span><span class="s0">,</span><span class="s1">&quot;WeakMap&quot;</span><span class="s0">,</span><span class="s1">&quot;getMiddlewareMatcher&quot;</span><span class="s0">,</span><span class="s1">&quot;info&quot;</span><span class="s0">,</span><span class="s1">&quot;stored&quot;</span><span class="s0">,</span><span class="s1">&quot;get&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;isArray&quot;</span><span class="s0">,</span><span class="s1">&quot;matchers&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;matcher&quot;</span><span class="s0">,</span><span class="s1">&quot;getMiddlewareRouteMatcher&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;installProcessErrorHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;shouldRemoveUncaughtErrorAndRejectionListeners&quot;</span><span class="s0">,</span><span class="s1">&quot;removeAllListeners&quot;</span><span class="s0">,</span><span class="s1">&quot;on&quot;</span><span class="s0">,</span><span class="s1">&quot;reason&quot;</span><span class="s0">,</span><span class="s1">&quot;isPostpone&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;BaseServer&quot;</span><span class="s0">,</span><span class="s1">&quot;constructor&quot;</span><span class="s0">,</span><span class="s1">&quot;options&quot;</span><span class="s0">,</span><span class="s1">&quot;cleanupListeners&quot;</span><span class="s0">,</span><span class="s1">&quot;AsyncCallbackSet&quot;</span><span class="s0">,</span><span class="s1">&quot;handleNextImageRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;parsedUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;getRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;minimalMode&quot;</span><span class="s0">,</span><span class="s1">&quot;nextConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;output&quot;</span><span class="s0">,</span><span class="s1">&quot;statusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;send&quot;</span><span class="s0">,</span><span class="s1">&quot;ImageOptimizerCache&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;imageOptimizerCache&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;sendResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;ImageError&quot;</span><span class="s0">,</span><span class="s1">&quot;imageResponseCache&quot;</span><span class="s0">,</span><span class="s1">&quot;imagesConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;images&quot;</span><span class="s0">,</span><span class="s1">&quot;loader&quot;</span><span class="s0">,</span><span class="s1">&quot;unoptimized&quot;</span><span class="s0">,</span><span class="s1">&quot;render404&quot;</span><span class="s0">,</span><span class="s1">&quot;paramsResult&quot;</span><span class="s0">,</span><span class="s1">&quot;validateParams&quot;</span><span class="s0">,</span><span class="s1">&quot;originalRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;query&quot;</span><span class="s0">,</span><span class="s1">&quot;renderOpts&quot;</span><span class="s0">,</span><span class="s1">&quot;dev&quot;</span><span class="s0">,</span><span class="s1">&quot;errorMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheKey&quot;</span><span class="s0">,</span><span class="s1">&quot;getCacheKey&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;getExtension&quot;</span><span class="s0">,</span><span class="s1">&quot;previousCacheEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;contentType&quot;</span><span class="s0">,</span><span class="s1">&quot;maxAge&quot;</span><span class="s0">,</span><span class="s1">&quot;upstreamEtag&quot;</span><span class="s0">,</span><span class="s1">&quot;etag&quot;</span><span class="s0">,</span><span class="s1">&quot;imageOptimizer&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;kind&quot;</span><span class="s0">,</span><span class="s1">&quot;CachedRouteKind&quot;</span><span class="s0">,</span><span class="s1">&quot;IMAGE&quot;</span><span class="s0">,</span><span class="s1">&quot;extension&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheControl&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;expire&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;routeKind&quot;</span><span class="s0">,</span><span class="s1">&quot;RouteKind&quot;</span><span class="s0">,</span><span class="s1">&quot;incrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;isFallback&quot;</span><span class="s0">,</span><span class="s1">&quot;originalResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;href&quot;</span><span class="s0">,</span><span class="s1">&quot;isStatic&quot;</span><span class="s0">,</span><span class="s1">&quot;isMiss&quot;</span><span class="s0">,</span><span class="s1">&quot;isStale&quot;</span><span class="s0">,</span><span class="s1">&quot;Boolean&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;handleCatchallRenderRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;addRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;routerServerGlobal&quot;</span><span class="s0">,</span><span class="s1">&quot;RouterServerContextSymbol&quot;</span><span class="s0">,</span><span class="s1">&quot;relativeProjectDir&quot;</span><span class="s0">,</span><span class="s1">&quot;relative&quot;</span><span class="s0">,</span><span class="s1">&quot;cwd&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;existingServerContext&quot;</span><span class="s0">,</span><span class="s1">&quot;bind&quot;</span><span class="s0">,</span><span class="s1">&quot;removeTrailingSlash&quot;</span><span class="s0">,</span><span class="s1">&quot;i18n&quot;</span><span class="s0">,</span><span class="s1">&quot;i18nProvider&quot;</span><span class="s0">,</span><span class="s1">&quot;fromRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;match&quot;</span><span class="s0">,</span><span class="s1">&quot;render&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeFunctionsPages&quot;</span><span class="s0">,</span><span class="s1">&quot;getEdgeFunctionsPages&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeFunctionsPage&quot;</span><span class="s0">,</span><span class="s1">&quot;definition&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_RSC_UNION_QUERY&quot;</span><span class="s0">,</span><span class="s1">&quot;handled&quot;</span><span class="s0">,</span><span class="s1">&quot;runEdgeFunction&quot;</span><span class="s0">,</span><span class="s1">&quot;params&quot;</span><span class="s0">,</span><span class="s1">&quot;appPaths&quot;</span><span class="s0">,</span><span class="s1">&quot;apiError&quot;</span><span class="s0">,</span><span class="s1">&quot;instrumentationOnRequestError&quot;</span><span class="s0">,</span><span class="s1">&quot;routePath&quot;</span><span class="s0">,</span><span class="s1">&quot;routerKind&quot;</span><span class="s0">,</span><span class="s1">&quot;routeType&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidateReason&quot;</span><span class="s0">,</span><span class="s1">&quot;isPagesAPIRouteMatch&quot;</span><span class="s0">,</span><span class="s1">&quot;handleApiRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;NoFallbackError&quot;</span><span class="s0">,</span><span class="s1">&quot;formatServerError&quot;</span><span class="s0">,</span><span class="s1">&quot;logErrorWithOriginalStack&quot;</span><span class="s0">,</span><span class="s1">&quot;logError&quot;</span><span class="s0">,</span><span class="s1">&quot;renderError&quot;</span><span class="s0">,</span><span class="s1">&quot;handleCatchallMiddlewareRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;parsed&quot;</span><span class="s0">,</span><span class="s1">&quot;isMiddlewareInvoke&quot;</span><span class="s0">,</span><span class="s1">&quot;handleFinished&quot;</span><span class="s0">,</span><span class="s1">&quot;middleware&quot;</span><span class="s0">,</span><span class="s1">&quot;getMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;initUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;parseUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pathnameInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;getNextPathnameInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizedPathname&quot;</span><span class="s0">,</span><span class="s1">&quot;maybeDecodedPathname&quot;</span><span class="s0">,</span><span class="s1">&quot;decodeURIComponent&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;bubblingResult&quot;</span><span class="s0">,</span><span class="s1">&quot;ensureMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;runMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;request&quot;</span><span class="s0">,</span><span class="s1">&quot;response&quot;</span><span class="s0">,</span><span class="s1">&quot;BubbledError&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;entries&quot;</span><span class="s0">,</span><span class="s1">&quot;toNodeOutgoingHttpHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;setHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;pipeToNodeResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;end&quot;</span><span class="s0">,</span><span class="s1">&quot;isError&quot;</span><span class="s0">,</span><span class="s1">&quot;code&quot;</span><span class="s0">,</span><span class="s1">&quot;DecodeError&quot;</span><span class="s0">,</span><span class="s1">&quot;getProperError&quot;</span><span class="s0">,</span><span class="s1">&quot;finished&quot;</span><span class="s0">,</span><span class="s1">&quot;isDev&quot;</span><span class="s0">,</span><span class="s1">&quot;sriEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;conf&quot;</span><span class="s0">,</span><span class="s1">&quot;experimental&quot;</span><span class="s0">,</span><span class="s1">&quot;sri&quot;</span><span class="s0">,</span><span class="s1">&quot;algorithm&quot;</span><span class="s0">,</span><span class="s1">&quot;optimizeCss&quot;</span><span class="s0">,</span><span class="s1">&quot;__NEXT_OPTIMIZE_CSS&quot;</span><span class="s0">,</span><span class="s1">&quot;nextScriptWorkers&quot;</span><span class="s0">,</span><span class="s1">&quot;__NEXT_SCRIPT_WORKERS&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_DEPLOYMENT_ID&quot;</span><span class="s0">,</span><span class="s1">&quot;useSkewCookie&quot;</span><span class="s0">,</span><span class="s1">&quot;deploymentId&quot;</span><span class="s0">,</span><span class="s1">&quot;ResponseCache&quot;</span><span class="s0">,</span><span class="s1">&quot;appDocumentPreloading&quot;</span><span class="s0">,</span><span class="s1">&quot;isDefaultEnabled&quot;</span><span class="s0">,</span><span class="s1">&quot;loadComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;isAppPath&quot;</span><span class="s0">,</span><span class="s1">&quot;catch&quot;</span><span class="s0">,</span><span class="s1">&quot;preloadEntriesOnStart&quot;</span><span class="s0">,</span><span class="s1">&quot;unstable_preloadEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;dynamicRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;getRoutesManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;r&quot;</span><span class="s0">,</span><span class="s1">&quot;regex&quot;</span><span class="s0">,</span><span class="s1">&quot;getRouteRegex&quot;</span><span class="s0">,</span><span class="s1">&quot;getRouteMatcher&quot;</span><span class="s0">,</span><span class="s1">&quot;re&quot;</span><span class="s0">,</span><span class="s1">&quot;setHttpClientAndAgentOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;serverOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;experimentalTestProxy&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_PRIVATE_TEST_PROXY&quot;</span><span class="s0">,</span><span class="s1">&quot;interceptTestApis&quot;</span><span class="s0">,</span><span class="s1">&quot;middlewareManifestPath&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;serverDistDir&quot;</span><span class="s0">,</span><span class="s1">&quot;MIDDLEWARE_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;prepare&quot;</span><span class="s0">,</span><span class="s1">&quot;isExperimentalCompile&quot;</span><span class="s0">,</span><span class="s1">&quot;populateStaticEnv&quot;</span><span class="s0">,</span><span class="s1">&quot;removeUncaughtErrorAndRejectionListeners&quot;</span><span class="s0">,</span><span class="s1">&quot;appPathsManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;getAppPathsManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;pagesManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;getPagesManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;loadCustomCacheHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;ComponentMod&quot;</span><span class="s0">,</span><span class="s1">&quot;patchFetch&quot;</span><span class="s0">,</span><span class="s1">&quot;webpackRequire&quot;</span><span class="s0">,</span><span class="s1">&quot;__next_app__&quot;</span><span class="s0">,</span><span class="s1">&quot;m&quot;</span><span class="s0">,</span><span class="s1">&quot;handleUpgrade&quot;</span><span class="s0">,</span><span class="s1">&quot;loadInstrumentationModule&quot;</span><span class="s0">,</span><span class="s1">&quot;instrumentation&quot;</span><span class="s0">,</span><span class="s1">&quot;getInstrumentationModule&quot;</span><span class="s0">,</span><span class="s1">&quot;cause&quot;</span><span class="s0">,</span><span class="s1">&quot;prepareImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;runInstrumentationHookIfAvailable&quot;</span><span class="s0">,</span><span class="s1">&quot;ensureInstrumentationRegistered&quot;</span><span class="s0">,</span><span class="s1">&quot;loadEnvConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;forceReload&quot;</span><span class="s0">,</span><span class="s1">&quot;silent&quot;</span><span class="s0">,</span><span class="s1">&quot;Log&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;initializeCacheHandlers&quot;</span><span class="s0">,</span><span class="s1">&quot;handler&quot;</span><span class="s0">,</span><span class="s1">&quot;setCacheHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;interopDefault&quot;</span><span class="s0">,</span><span class="s1">&quot;formatDynamicImportPath&quot;</span><span class="s0">,</span><span class="s1">&quot;getIncrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;requestHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;CacheHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;IncrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;getCacheFilesystem&quot;</span><span class="s0">,</span><span class="s1">&quot;allowedRevalidateHeaderKeys&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchCacheKeyPrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;maxMemoryCacheSize&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheMaxMemorySize&quot;</span><span class="s0">,</span><span class="s1">&quot;flushToDisk&quot;</span><span class="s0">,</span><span class="s1">&quot;isrFlushToDisk&quot;</span><span class="s0">,</span><span class="s1">&quot;getPrerenderManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;CurCacheHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;getResponseCache&quot;</span><span class="s0">,</span><span class="s1">&quot;getPublicDir&quot;</span><span class="s0">,</span><span class="s1">&quot;CLIENT_PUBLIC_FILES_PATH&quot;</span><span class="s0">,</span><span class="s1">&quot;getHasStaticDir&quot;</span><span class="s0">,</span><span class="s1">&quot;existsSync&quot;</span><span class="s0">,</span><span class="s1">&quot;loadManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;PAGES_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;enabledDirectories&quot;</span><span class="s0">,</span><span class="s1">&quot;app&quot;</span><span class="s0">,</span><span class="s1">&quot;APP_PATHS_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;getinterceptionRoutePatterns&quot;</span><span class="s0">,</span><span class="s1">&quot;routesManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;rewrites&quot;</span><span class="s0">,</span><span class="s1">&quot;beforeFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;filter&quot;</span><span class="s0">,</span><span class="s1">&quot;isInterceptionRouteRewrite&quot;</span><span class="s0">,</span><span class="s1">&quot;rewrite&quot;</span><span class="s0">,</span><span class="s1">&quot;RegExp&quot;</span><span class="s0">,</span><span class="s1">&quot;hasPage&quot;</span><span class="s0">,</span><span class="s1">&quot;getMaybePagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;locales&quot;</span><span class="s0">,</span><span class="s1">&quot;getBuildId&quot;</span><span class="s0">,</span><span class="s1">&quot;buildIdFile&quot;</span><span class="s0">,</span><span class="s1">&quot;BUILD_ID_FILE&quot;</span><span class="s0">,</span><span class="s1">&quot;readFileSync&quot;</span><span class="s0">,</span><span class="s1">&quot;trim&quot;</span><span class="s0">,</span><span class="s1">&quot;getEnabledDirectories&quot;</span><span class="s0">,</span><span class="s1">&quot;findDir&quot;</span><span class="s0">,</span><span class="s1">&quot;pages&quot;</span><span class="s0">,</span><span class="s1">&quot;sendRenderResult&quot;</span><span class="s0">,</span><span class="s1">&quot;generateEtags&quot;</span><span class="s0">,</span><span class="s1">&quot;poweredByHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;runApi&quot;</span><span class="s0">,</span><span class="s1">&quot;handledAsEdgeFunction&quot;</span><span class="s0">,</span><span class="s1">&quot;parsedInitUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;search&quot;</span><span class="s0">,</span><span class="s1">&quot;NodeModuleLoader&quot;</span><span class="s0">,</span><span class="s1">&quot;module&quot;</span><span class="s0">,</span><span class="s1">&quot;load&quot;</span><span class="s0">,</span><span class="s1">&quot;filename&quot;</span><span class="s0">,</span><span class="s1">&quot;waitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;getWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;renderHTML&quot;</span><span class="s0">,</span><span class="s1">&quot;getTracer&quot;</span><span class="s0">,</span><span class="s1">&quot;trace&quot;</span><span class="s0">,</span><span class="s1">&quot;NextNodeServerSpan&quot;</span><span class="s0">,</span><span class="s1">&quot;renderHTMLImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;nextFontManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;lazyRenderAppPage&quot;</span><span class="s0">,</span><span class="s1">&quot;getServerComponentsHmrCache&quot;</span><span class="s0">,</span><span class="s1">&quot;buildId&quot;</span><span class="s0">,</span><span class="s1">&quot;lazyRenderPagesPage&quot;</span><span class="s0">,</span><span class="s1">&quot;customServer&quot;</span><span class="s0">,</span><span class="s1">&quot;isDraftMode&quot;</span><span class="s0">,</span><span class="s1">&quot;developmentNotFoundSourcePage&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchExternalImage&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchInternalImage&quot;</span><span class="s0">,</span><span class="s1">&quot;handleInternalReq&quot;</span><span class="s0">,</span><span class="s1">&quot;newReq&quot;</span><span class="s0">,</span><span class="s1">&quot;newRes&quot;</span><span class="s0">,</span><span class="s1">&quot;routerServerHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;isAbsolute&quot;</span><span class="s0">,</span><span class="s1">&quot;imageUpstream&quot;</span><span class="s0">,</span><span class="s1">&quot;getPagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;renderPageComponent&quot;</span><span class="s0">,</span><span class="s1">&quot;ctx&quot;</span><span class="s0">,</span><span class="s1">&quot;bubbleNoFallback&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;getOriginalAppPaths&quot;</span><span class="s0">,</span><span class="s1">&quot;findPageComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;locale&quot;</span><span class="s0">,</span><span class="s1">&quot;spanName&quot;</span><span class="s0">,</span><span class="s1">&quot;attributes&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeAppPath&quot;</span><span class="s0">,</span><span class="s1">&quot;findPageComponentsImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;_url&quot;</span><span class="s0">,</span><span class="s1">&quot;pagePaths&quot;</span><span class="s0">,</span><span class="s1">&quot;amp&quot;</span><span class="s0">,</span><span class="s1">&quot;unshift&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizePagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;pagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;components&quot;</span><span class="s0">,</span><span class="s1">&quot;Component&quot;</span><span class="s0">,</span><span class="s1">&quot;getStaticProps&quot;</span><span class="s0">,</span><span class="s1">&quot;PageNotFoundError&quot;</span><span class="s0">,</span><span class="s1">&quot;getNextFontManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_FONT_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;_err&quot;</span><span class="s0">,</span><span class="s1">&quot;_type&quot;</span><span class="s0">,</span><span class="s1">&quot;ensurePage&quot;</span><span class="s0">,</span><span class="s1">&quot;_opts&quot;</span><span class="s0">,</span><span class="s1">&quot;nodeFs&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeReq&quot;</span><span class="s0">,</span><span class="s1">&quot;NodeNextRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;normalizeRes&quot;</span><span class="s0">,</span><span class="s1">&quot;NodeNextResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;getRequestHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;makeRequestHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;wrapRequestHandlerNode&quot;</span><span class="s0">,</span><span class="s1">&quot;urlPath&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidateHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;opts&quot;</span><span class="s0">,</span><span class="s1">&quot;mocked&quot;</span><span class="s0">,</span><span class="s1">&quot;createRequestResponseMocks&quot;</span><span class="s0">,</span><span class="s1">&quot;hasStreamed&quot;</span><span class="s0">,</span><span class="s1">&quot;getHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;unstable_onlyGenerated&quot;</span><span class="s0">,</span><span class="s1">&quot;internal&quot;</span><span class="s0">,</span><span class="s1">&quot;renderToHTML&quot;</span><span class="s0">,</span><span class="s1">&quot;renderErrorToResponseImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;is404&quot;</span><span class="s0">,</span><span class="s1">&quot;UNDERSCORE_NOT_FOUND_ROUTE_ENTRY&quot;</span><span class="s0">,</span><span class="s1">&quot;clientOnly&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;setHeaders&quot;</span><span class="s0">,</span><span class="s1">&quot;renderErrorToHTML&quot;</span><span class="s0">,</span><span class="s1">&quot;getMiddlewareManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;manifest&quot;</span><span class="s0">,</span><span class="s1">&quot;middlewareModule&quot;</span><span class="s0">,</span><span class="s1">&quot;loadNodeMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;regexp&quot;</span><span class="s0">,</span><span class="s1">&quot;originalSource&quot;</span><span class="s0">,</span><span class="s1">&quot;functions&quot;</span><span class="s0">,</span><span class="s1">&quot;getEdgeFunctionInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;foundPage&quot;</span><span class="s0">,</span><span class="s1">&quot;denormalizePagePath&quot;</span><span class="s0">,</span><span class="s1">&quot;pageInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;paths&quot;</span><span class="s0">,</span><span class="s1">&quot;files&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;wasm&quot;</span><span class="s0">,</span><span class="s1">&quot;binding&quot;</span><span class="s0">,</span><span class="s1">&quot;filePath&quot;</span><span class="s0">,</span><span class="s1">&quot;assets&quot;</span><span class="s0">,</span><span class="s1">&quot;functionsConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;FUNCTIONS_CONFIG_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;hasMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;nodeMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;ensureEdgeFunction&quot;</span><span class="s0">,</span><span class="s1">&quot;_params&quot;</span><span class="s0">,</span><span class="s1">&quot;checkIsOnDemandRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;previewProps&quot;</span><span class="s0">,</span><span class="s1">&quot;isOnDemandRevalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;Response&quot;</span><span class="s0">,</span><span class="s1">&quot;skipMiddlewareUrlNormalize&quot;</span><span class="s0">,</span><span class="s1">&quot;urlQueryToSearchParams&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchHostname&quot;</span><span class="s0">,</span><span class="s1">&quot;port&quot;</span><span class="s0">,</span><span class="s1">&quot;middlewareInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;toUpperCase&quot;</span><span class="s0">,</span><span class="s1">&quot;requestData&quot;</span><span class="s0">,</span><span class="s1">&quot;basePath&quot;</span><span class="s0">,</span><span class="s1">&quot;trailingSlash&quot;</span><span class="s0">,</span><span class="s1">&quot;signal&quot;</span><span class="s0">,</span><span class="s1">&quot;signalFromNodeResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;MiddlewareNotFoundError&quot;</span><span class="s0">,</span><span class="s1">&quot;adapterFn&quot;</span><span class="s0">,</span><span class="s1">&quot;hasRequestBody&quot;</span><span class="s0">,</span><span class="s1">&quot;cloneBodyStream&quot;</span><span class="s0">,</span><span class="s1">&quot;finalize&quot;</span><span class="s0">,</span><span class="s1">&quot;run&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeFunctionEntry&quot;</span><span class="s0">,</span><span class="s1">&quot;useCache&quot;</span><span class="s0">,</span><span class="s1">&quot;onWarning&quot;</span><span class="s0">,</span><span class="s1">&quot;has&quot;</span><span class="s0">,</span><span class="s1">&quot;cookies&quot;</span><span class="s0">,</span><span class="s1">&quot;getSetCookie&quot;</span><span class="s0">,</span><span class="s1">&quot;flatMap&quot;</span><span class="s0">,</span><span class="s1">&quot;maybeCompoundCookie&quot;</span><span class="s0">,</span><span class="s1">&quot;splitCookiesString&quot;</span><span class="s0">,</span><span class="s1">&quot;delete&quot;</span><span class="s0">,</span><span class="s1">&quot;cookie&quot;</span><span class="s0">,</span><span class="s1">&quot;append&quot;</span><span class="s0">,</span><span class="s1">&quot;_cachedPreviewManifest&quot;</span><span class="s0">,</span><span class="s1">&quot;PRERENDER_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;ROUTES_MANIFEST&quot;</span><span class="s0">,</span><span class="s1">&quot;attachRequestMeta&quot;</span><span class="s0">,</span><span class="s1">&quot;isUpgradeReq&quot;</span><span class="s0">,</span><span class="s1">&quot;protocol&quot;</span><span class="s0">,</span><span class="s1">&quot;trustHostHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;host&quot;</span><span class="s0">,</span><span class="s1">&quot;getCloneableBody&quot;</span><span class="s0">,</span><span class="s1">&quot;edgeInfo&quot;</span><span class="s0">,</span><span class="s1">&quot;isNextDataRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;initialUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;URL&quot;</span><span class="s0">,</span><span class="s1">&quot;queryString&quot;</span><span class="s0">,</span><span class="s1">&quot;fromEntries&quot;</span><span class="s0">,</span><span class="s1">&quot;searchParams&quot;</span><span class="s0">,</span><span class="s1">&quot;onError&quot;</span><span class="s0">,</span><span class="s1">&quot;globalThis&quot;</span><span class="s0">,</span><span class="s1">&quot;__incrementalCache&quot;</span><span class="s0">,</span><span class="s1">&quot;serverComponentsHmrCache&quot;</span><span class="s0">,</span><span class="s1">&quot;fetchMetrics&quot;</span><span class="s0">,</span><span class="s1">&quot;statusMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;statusText&quot;</span><span class="s0">,</span><span class="s1">&quot;forEach&quot;</span><span class="s0">,</span><span class="s1">&quot;toLowerCase&quot;</span><span class="s0">,</span><span class="s1">&quot;appendHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;_serverDistDir&quot;</span><span class="s0">,</span><span class="s1">&quot;SERVER_DIRECTORY&quot;</span><span class="s0">,</span><span class="s1">&quot;getFallbackErrorComponents&quot;</span><span class="s0">,</span><span class="s1">&quot;args&quot;</span><span class="s0">,</span><span class="s1">&quot;onServerClose&quot;</span><span class="s0">,</span><span class="s1">&quot;listener&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;close&quot;</span><span class="s0">,</span><span class="s1">&quot;runAll&quot;</span><span class="s0">,</span><span class="s1">&quot;getInternalWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;internalWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;createInternalWaitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;InvariantError&quot;</span><span class="s0">,</span><span class="s1">&quot;awaiter&quot;</span><span class="s0">,</span><span class="s1">&quot;AwaiterOnce&quot;</span><span class="s0">,</span><span class="s1">&quot;awaiting&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>