<html>
<head>
<title>Tag.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #8c8c8c; font-style: italic;}
.s2 { color: #080808;}
.s3 { color: #067d17;}
.s4 { color: #0033b3;}
.s5 { color: #1750eb;}
.s6 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Tag.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Matthew Caruana Galizia &lt;mattcg@gmail.com&gt;</span>
 <span class="s0">* </span><span class="s1">@license </span><span class="s0">MIT: http://mattcg.mit-license.org/</span>
 <span class="s0">* </span><span class="s1">@copyright </span><span class="s0">Copyright (c) 2013, Matthew Caruana Galizia</span>
 <span class="s0">*/</span>

<span class="s3">'use strict'</span><span class="s2">;</span>

<span class="s4">function </span><span class="s2">_typeof(obj) { </span><span class="s3">&quot;@babel/helpers - typeof&quot;</span><span class="s2">; </span><span class="s4">return </span><span class="s2">_typeof = </span><span class="s3">&quot;function&quot; </span><span class="s2">== </span><span class="s4">typeof </span><span class="s2">Symbol &amp;&amp; </span><span class="s3">&quot;symbol&quot; </span><span class="s2">== </span><span class="s4">typeof </span><span class="s2">Symbol.iterator ? </span><span class="s4">function </span><span class="s2">(obj) { </span><span class="s4">return typeof </span><span class="s2">obj; } : </span><span class="s4">function </span><span class="s2">(obj) { </span><span class="s4">return </span><span class="s2">obj &amp;&amp; </span><span class="s3">&quot;function&quot; </span><span class="s2">== </span><span class="s4">typeof </span><span class="s2">Symbol &amp;&amp; obj.constructor === Symbol &amp;&amp; obj !== Symbol.prototype ? </span><span class="s3">&quot;symbol&quot; </span><span class="s2">: </span><span class="s4">typeof </span><span class="s2">obj; }, _typeof(obj); }</span>
<span class="s4">function </span><span class="s2">_classCallCheck(instance, Constructor) { </span><span class="s4">if </span><span class="s2">(!(instance </span><span class="s4">instanceof </span><span class="s2">Constructor)) { </span><span class="s4">throw new </span><span class="s2">TypeError(</span><span class="s3">&quot;Cannot call a class as a function&quot;</span><span class="s2">); } }</span>
<span class="s4">function </span><span class="s2">_defineProperties(target, props) { </span><span class="s4">for </span><span class="s2">(</span><span class="s4">var </span><span class="s2">i = </span><span class="s5">0</span><span class="s2">; i &lt; props.length; i++) { </span><span class="s4">var </span><span class="s2">descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || </span><span class="s4">false</span><span class="s2">; descriptor.configurable = </span><span class="s4">true</span><span class="s2">; </span><span class="s4">if </span><span class="s2">(</span><span class="s3">&quot;value&quot; </span><span class="s4">in </span><span class="s2">descriptor) descriptor.writable = </span><span class="s4">true</span><span class="s2">; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }</span>
<span class="s4">function </span><span class="s2">_createClass(Constructor, protoProps, staticProps) { </span><span class="s4">if </span><span class="s2">(protoProps) _defineProperties(Constructor.prototype, protoProps); </span><span class="s4">if </span><span class="s2">(staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, </span><span class="s3">&quot;prototype&quot;</span><span class="s2">, { writable: </span><span class="s4">false </span><span class="s2">}); </span><span class="s4">return </span><span class="s2">Constructor; }</span>
<span class="s4">function </span><span class="s2">_defineProperty(obj, key, value) { key = _toPropertyKey(key); </span><span class="s4">if </span><span class="s2">(key </span><span class="s4">in </span><span class="s2">obj) { Object.defineProperty(obj, key, { value: value, enumerable: </span><span class="s4">true</span><span class="s2">, configurable: </span><span class="s4">true</span><span class="s2">, writable: </span><span class="s4">true </span><span class="s2">}); } </span><span class="s4">else </span><span class="s2">{ obj[key] = value; } </span><span class="s4">return </span><span class="s2">obj; }</span>
<span class="s4">function </span><span class="s2">_toPropertyKey(arg) { </span><span class="s4">var </span><span class="s2">key = _toPrimitive(arg, </span><span class="s3">&quot;string&quot;</span><span class="s2">); </span><span class="s4">return </span><span class="s2">_typeof(key) === </span><span class="s3">&quot;symbol&quot; </span><span class="s2">? key : String(key); }</span>
<span class="s4">function </span><span class="s2">_toPrimitive(input, hint) { </span><span class="s4">if </span><span class="s2">(_typeof(input) !== </span><span class="s3">&quot;object&quot; </span><span class="s2">|| input === </span><span class="s4">null</span><span class="s2">) </span><span class="s4">return </span><span class="s2">input; </span><span class="s4">var </span><span class="s2">prim = input[Symbol.toPrimitive]; </span><span class="s4">if </span><span class="s2">(prim !== undefined) { </span><span class="s4">var </span><span class="s2">res = prim.call(input, hint || </span><span class="s3">&quot;default&quot;</span><span class="s2">); </span><span class="s4">if </span><span class="s2">(_typeof(res) !== </span><span class="s3">&quot;object&quot;</span><span class="s2">) </span><span class="s4">return </span><span class="s2">res; </span><span class="s4">throw new </span><span class="s2">TypeError(</span><span class="s3">&quot;@@toPrimitive must return a primitive value.&quot;</span><span class="s2">); } </span><span class="s4">return </span><span class="s2">(hint === </span><span class="s3">&quot;string&quot; </span><span class="s2">? String : Number)(input); }</span>
<span class="s4">var </span><span class="s2">index = require(</span><span class="s3">'language-subtag-registry/data/json/index.json'</span><span class="s2">);</span>
<span class="s4">var </span><span class="s2">registry = require(</span><span class="s3">'language-subtag-registry/data/json/registry.json'</span><span class="s2">);</span>
<span class="s4">var </span><span class="s2">Subtag = require(</span><span class="s3">'./Subtag.js'</span><span class="s2">);</span>
<span class="s4">var </span><span class="s2">Tag = </span><span class="s0">/*#__PURE__*/</span><span class="s4">function </span><span class="s2">() {</span>
  <span class="s0">/** </span><span class="s1">@param </span><span class="s0">{string} tag */</span>
  <span class="s4">function </span><span class="s2">Tag(tag) {</span>
    <span class="s2">_classCallCheck(</span><span class="s4">this</span><span class="s2">, Tag);</span>
    <span class="s4">var </span><span class="s2">types;</span>

    <span class="s0">// Lowercase for consistency (case is only a formatting convention, not a standard requirement).</span>
    <span class="s2">tag = tag.trim().toLowerCase();</span>
    <span class="s4">this</span><span class="s2">.data = {</span>
      <span class="s2">tag: tag</span>
    <span class="s2">};</span>

    <span class="s0">// Check if the input tag is grandfathered or redundant.</span>
    <span class="s2">types = index[tag];</span>
    <span class="s4">if </span><span class="s2">(types &amp;&amp; (types.grandfathered || types.redundant)) {</span>
      <span class="s4">this</span><span class="s2">.data.record = registry[types.grandfathered || types.redundant];</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s2">_createClass(Tag, [{</span>
    <span class="s2">key: </span><span class="s3">&quot;preferred&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">preferred() {</span>
      <span class="s4">var </span><span class="s2">preferred = </span><span class="s4">this</span><span class="s2">.data.record[</span><span class="s3">'Preferred-Value'</span><span class="s2">];</span>
      <span class="s4">if </span><span class="s2">(preferred) {</span>
        <span class="s4">return new </span><span class="s2">Tag(preferred);</span>
      <span class="s2">}</span>
      <span class="s4">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">/** </span><span class="s1">@return </span><span class="s0">{Subtag[]} */</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;subtags&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">subtags() {</span>
      <span class="s4">var </span><span class="s2">codes,</span>
        <span class="s2">data = </span><span class="s4">this</span><span class="s2">.data,</span>
        <span class="s2">subtags = [];</span>

      <span class="s0">// No subtags if the tag is grandfathered.</span>
      <span class="s4">if </span><span class="s2">(data.record &amp;&amp; </span><span class="s4">this</span><span class="s2">.type() === </span><span class="s3">'grandfathered'</span><span class="s2">) {</span>
        <span class="s4">return </span><span class="s2">subtags;</span>
      <span class="s2">}</span>
      <span class="s2">codes = data.tag.split(</span><span class="s3">'-'</span><span class="s2">);</span>
      <span class="s4">if </span><span class="s2">(!codes.length) {</span>
        <span class="s4">return </span><span class="s2">subtags;</span>
      <span class="s2">}</span>

      <span class="s0">// Try and find the language tag.</span>
      <span class="s2">codes.some(</span><span class="s4">function </span><span class="s2">(code, i) {</span>
        <span class="s4">var </span><span class="s2">types;</span>

        <span class="s0">// Singletons and anything after are unhandled.</span>
        <span class="s4">if </span><span class="s2">(code.length &lt; </span><span class="s5">2</span><span class="s2">) {</span>
          <span class="s4">return true</span><span class="s2">; </span><span class="s0">// Stop the loop (stop processing after a singleton).</span>
        <span class="s2">}</span>

        <span class="s2">types = index[code];</span>

        <span class="s0">// Check for non-existent tag.</span>
        <span class="s4">if </span><span class="s2">(!types) {</span>
          <span class="s4">return</span><span class="s2">; </span><span class="s0">// Skip to the next item.</span>
        <span class="s2">}</span>

        <span class="s0">// Check against undefined because value could be 0.</span>
        <span class="s0">// Language subtags may only appear at the beginning of the tag, otherwise the subtag type is indeterminate.</span>
        <span class="s4">if </span><span class="s2">(</span><span class="s5">0 </span><span class="s2">=== i &amp;&amp; undefined !== types.language) {</span>
          <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'language'</span><span class="s2">));</span>
          <span class="s4">return</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s4">switch </span><span class="s2">(code.length) {</span>
          <span class="s4">case </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s0">// Should be a region.</span>
            <span class="s4">if </span><span class="s2">(types.region) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'region'</span><span class="s2">));</span>

              <span class="s0">// Error case: language subtag in the wrong place.</span>
            <span class="s2">} </span><span class="s4">else if </span><span class="s2">(types.language) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'language'</span><span class="s2">));</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s5">3</span><span class="s2">:</span>
            <span class="s0">// Could be a numeric region code e.g. '001' for 'World'.</span>
            <span class="s4">if </span><span class="s2">(types.region) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'region'</span><span class="s2">));</span>
            <span class="s2">} </span><span class="s4">else if </span><span class="s2">(types.extlang) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'extlang'</span><span class="s2">));</span>

              <span class="s0">// Error case: language subtag in the wrong place.</span>
            <span class="s2">} </span><span class="s4">else if </span><span class="s2">(types.language) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'language'</span><span class="s2">));</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s5">4</span><span class="s2">:</span>
            <span class="s0">// Could be a numeric variant.</span>
            <span class="s4">if </span><span class="s2">(types.variant) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'variant'</span><span class="s2">));</span>
            <span class="s2">} </span><span class="s4">else if </span><span class="s2">(types.script) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'script'</span><span class="s2">));</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">default</span><span class="s2">:</span>
            <span class="s0">// Should be a variant.</span>
            <span class="s4">if </span><span class="s2">(types.variant) {</span>
              <span class="s2">subtags.push(</span><span class="s4">new </span><span class="s2">Subtag(code, </span><span class="s3">'variant'</span><span class="s2">));</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
      <span class="s4">return </span><span class="s2">subtags;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;language&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">language() {</span>
      <span class="s4">return this</span><span class="s2">.find(</span><span class="s3">'language'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;region&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">region() {</span>
      <span class="s4">return this</span><span class="s2">.find(</span><span class="s3">'region'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;script&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">script() {</span>
      <span class="s4">return this</span><span class="s2">.find(</span><span class="s3">'script'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">/** </span><span class="s1">@param </span><span class="s0">{string} type */</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;find&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">find(type) {</span>
      <span class="s4">var </span><span class="s2">i,</span>
        <span class="s2">l,</span>
        <span class="s2">subtag,</span>
        <span class="s2">subtags = </span><span class="s4">this</span><span class="s2">.subtags();</span>
      <span class="s4">for </span><span class="s2">(i = </span><span class="s5">0</span><span class="s2">, l = subtags.length; i &lt; l; i++) {</span>
        <span class="s2">subtag = subtags[i];</span>
        <span class="s4">if </span><span class="s2">(subtag.type() === type) {</span>
          <span class="s4">return </span><span class="s2">subtag;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;valid&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">valid() {</span>
      <span class="s4">return this</span><span class="s2">.errors().length &lt; </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;errors&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">errors() {</span>
      <span class="s4">var </span><span class="s2">error,</span>
        <span class="s2">subtags,</span>
        <span class="s2">data = </span><span class="s4">this</span><span class="s2">.data,</span>
        <span class="s2">errors = [];</span>
      <span class="s2">error = </span><span class="s4">function </span><span class="s2">error(code, subtag) {</span>
        <span class="s4">var </span><span class="s2">err, message;</span>
        <span class="s4">switch </span><span class="s2">(code) {</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_DEPRECATED:</span>
            <span class="s2">message = </span><span class="s3">'The tag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ data.tag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">is deprecated.'</span><span class="s2">;</span>

            <span class="s0">// Note that a record that contains a 'Deprecated' field and no corresponding 'Preferred-Value' field has no replacement mapping (RFC 5646 section 3.1.6).</span>
            <span class="s4">if </span><span class="s2">(data.record[</span><span class="s3">'Preferred-Value'</span><span class="s2">]) {</span>
              <span class="s2">message += </span><span class="s3">' Use </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ data.record[</span><span class="s3">'Preferred-Value'</span><span class="s2">] + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">instead.'</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_SUBTAG_DEPRECATED:</span>
            <span class="s2">message = </span><span class="s3">'The subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">is deprecated.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_NO_LANGUAGE:</span>
            <span class="s4">if </span><span class="s2">(!data.tag) {</span>
              <span class="s2">message = </span><span class="s3">'Empty tag.'</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s4">else </span><span class="s2">{</span>
              <span class="s2">message = </span><span class="s3">'Missing language tag in </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ data.tag + </span><span class="s3">'</span><span class="s6">\'</span><span class="s3">.'</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_UNKNOWN:</span>
            <span class="s2">message = </span><span class="s3">'Unknown code </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\'</span><span class="s3">'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_TOO_LONG:</span>
            <span class="s2">message = </span><span class="s3">'The private-use subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">is too long.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_EXTRA_LANGUAGE:</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_EXTRA_EXTLANG:</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_EXTRA_REGION:</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_EXTRA_SCRIPT:</span>
            <span class="s2">message = </span><span class="s3">'Extra ' </span><span class="s2">+ subtag.type() + </span><span class="s3">' subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">found.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_DUPLICATE_VARIANT:</span>
            <span class="s2">message = </span><span class="s3">'Duplicate variant subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">found.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_WRONG_ORDER:</span>
            <span class="s2">message = </span><span class="s3">'The subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag[</span><span class="s5">0</span><span class="s2">] + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">should not appear before </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag[</span><span class="s5">1</span><span class="s2">] + </span><span class="s3">'</span><span class="s6">\'</span><span class="s3">.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s2">Tag.ERR_SUPPRESS_SCRIPT:</span>
            <span class="s2">message = </span><span class="s3">'The script subtag </span><span class="s6">\'</span><span class="s3">' </span><span class="s2">+ subtag + </span><span class="s3">'</span><span class="s6">\' </span><span class="s3">is the same as the language suppress-script.'</span><span class="s2">;</span>
            <span class="s4">break</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s2">err = </span><span class="s4">new </span><span class="s2">Error(message);</span>
        <span class="s2">err.code = code;</span>
        <span class="s2">err.tag = data.tag;</span>
        <span class="s2">err.subtag = subtag;</span>
        <span class="s2">errors.push(err);</span>
      <span class="s2">};</span>

      <span class="s0">// Check if the tag is grandfathered and if the grandfathered tag is deprecated (e.g. no-nyn).</span>
      <span class="s4">if </span><span class="s2">(data.record) {</span>
        <span class="s4">if </span><span class="s2">(data.record.Deprecated) {</span>
          <span class="s2">error(Tag.ERR_DEPRECATED);</span>
        <span class="s2">}</span>

        <span class="s0">// Only check every subtag if the tag is not explicitly listed as grandfathered or redundant.</span>
        <span class="s4">return </span><span class="s2">errors;</span>
      <span class="s2">}</span>

      <span class="s0">// Check that all subtag codes are meaningful.</span>
      <span class="s2">data.tag.split(</span><span class="s3">'-'</span><span class="s2">).some(</span><span class="s4">function </span><span class="s2">(code, i, codes) {</span>
        <span class="s4">var </span><span class="s2">types;</span>

        <span class="s0">// Ignore anything after a singleton.</span>
        <span class="s4">if </span><span class="s2">(code.length &lt; </span><span class="s5">2</span><span class="s2">) {</span>
          <span class="s0">// Check that each private-use subtag is within the maximum allowed length.</span>
          <span class="s2">codes.slice(i).forEach(</span><span class="s4">function </span><span class="s2">(code) {</span>
            <span class="s4">if </span><span class="s2">(code.length &gt; </span><span class="s5">8</span><span class="s2">) {</span>
              <span class="s2">error(Tag.ERR_TOO_LONG, code);</span>
            <span class="s2">}</span>
          <span class="s2">});</span>
          <span class="s4">return true</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s2">types = index[code];</span>
        <span class="s4">if </span><span class="s2">(!types) {</span>
          <span class="s2">error(Tag.ERR_UNKNOWN, code);</span>
        <span class="s2">}</span>
        <span class="s4">return false</span><span class="s2">; </span><span class="s0">// Continue to the next item.</span>
      <span class="s2">});</span>

      <span class="s0">// Check that first tag is a language tag.</span>
      <span class="s2">subtags = </span><span class="s4">this</span><span class="s2">.subtags();</span>
      <span class="s4">if </span><span class="s2">(!subtags.length || </span><span class="s3">'language' </span><span class="s2">!== subtags[</span><span class="s5">0</span><span class="s2">].type()) {</span>
        <span class="s2">error(Tag.ERR_NO_LANGUAGE);</span>
        <span class="s4">return </span><span class="s2">errors;</span>
      <span class="s2">}</span>

      <span class="s0">// Check for more than one of some types and for deprecation.</span>
      <span class="s2">subtags.forEach(</span><span class="s4">function </span><span class="s2">(subtag, i) {</span>
        <span class="s4">var </span><span class="s2">type = subtag.type(),</span>
          <span class="s2">language,</span>
          <span class="s2">script,</span>
          <span class="s2">found = </span><span class="s4">this</span><span class="s2">;</span>
        <span class="s4">if </span><span class="s2">(subtag.deprecated()) {</span>
          <span class="s2">error(Tag.ERR_SUBTAG_DEPRECATED, subtag);</span>
        <span class="s2">}</span>
        <span class="s4">if </span><span class="s2">(found[type]) {</span>
          <span class="s2">found[type].push(subtag);</span>
        <span class="s2">}</span>
        <span class="s4">switch </span><span class="s2">(type) {</span>
          <span class="s4">case </span><span class="s3">'language'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(found.language.length &gt; </span><span class="s5">1</span><span class="s2">) {</span>
              <span class="s2">error(Tag.ERR_EXTRA_LANGUAGE, subtag);</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s3">'region'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(found.region.length &gt; </span><span class="s5">1</span><span class="s2">) {</span>
              <span class="s2">error(Tag.ERR_EXTRA_REGION, subtag);</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s3">'extlang'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(found.extlang.length &gt; </span><span class="s5">1</span><span class="s2">) {</span>
              <span class="s2">error(Tag.ERR_EXTRA_EXTLANG, subtag);</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s3">'script'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(found.script.length &gt; </span><span class="s5">1</span><span class="s2">) {</span>
              <span class="s2">error(Tag.ERR_EXTRA_SCRIPT, subtag);</span>

              <span class="s0">// Check if script is same as language suppress-script.</span>
            <span class="s2">} </span><span class="s4">else </span><span class="s2">{</span>
              <span class="s2">language = subtags[</span><span class="s5">0</span><span class="s2">];</span>
              <span class="s4">if </span><span class="s2">(</span><span class="s3">'language' </span><span class="s2">=== language.type()) {</span>
                <span class="s2">script = language.script();</span>
                <span class="s4">if </span><span class="s2">(script &amp;&amp; script.format() === subtag.format()) {</span>
                  <span class="s2">error(Tag.ERR_SUPPRESS_SCRIPT, subtag);</span>
                <span class="s2">}</span>
              <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s4">break</span><span class="s2">;</span>
          <span class="s4">case </span><span class="s3">'variant'</span><span class="s2">:</span>
            <span class="s4">if </span><span class="s2">(found.variant.length &gt; </span><span class="s5">1 </span><span class="s2">&amp;&amp; found.variant.some(</span><span class="s4">function </span><span class="s2">(variant) {</span>
              <span class="s4">return </span><span class="s2">variant.format() === subtag.format();</span>
            <span class="s2">})) {</span>
              <span class="s2">error(Tag.ERR_DUPLICATE_VARIANT, subtag);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">}, {</span>
        <span class="s2">language: [],</span>
        <span class="s2">extlang: [],</span>
        <span class="s2">variant: [],</span>
        <span class="s2">script: [],</span>
        <span class="s2">region: []</span>
      <span class="s2">});</span>

      <span class="s0">// Check for correct order.</span>
      <span class="s2">subtags.forEach(</span><span class="s4">function </span><span class="s2">(subtag, i, subtags) {</span>
        <span class="s4">var </span><span class="s2">priority = </span><span class="s4">this</span><span class="s2">,</span>
          <span class="s2">next = subtags[i + </span><span class="s5">1</span><span class="s2">];</span>
        <span class="s4">if </span><span class="s2">(next &amp;&amp; priority[subtag.type()] &gt; priority[next.type()]) {</span>
          <span class="s2">error(Tag.ERR_WRONG_ORDER, [subtag, next]);</span>
        <span class="s2">}</span>
      <span class="s2">}, {</span>
        <span class="s2">language: </span><span class="s5">4</span><span class="s2">,</span>
        <span class="s2">extlang: </span><span class="s5">5</span><span class="s2">,</span>
        <span class="s2">script: </span><span class="s5">6</span><span class="s2">,</span>
        <span class="s2">region: </span><span class="s5">7</span><span class="s2">,</span>
        <span class="s2">variant: </span><span class="s5">8</span>
      <span class="s2">});</span>
      <span class="s4">return </span><span class="s2">errors;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;type&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">type() {</span>
      <span class="s4">var </span><span class="s2">record = </span><span class="s4">this</span><span class="s2">.data.record;</span>
      <span class="s4">if </span><span class="s2">(record) {</span>
        <span class="s4">return </span><span class="s2">record.Type;</span>
      <span class="s2">}</span>
      <span class="s4">return </span><span class="s3">'tag'</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;added&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">added() {</span>
      <span class="s4">var </span><span class="s2">record = </span><span class="s4">this</span><span class="s2">.data.record;</span>
      <span class="s4">return </span><span class="s2">record &amp;&amp; record.Added;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;deprecated&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">deprecated() {</span>
      <span class="s4">var </span><span class="s2">record = </span><span class="s4">this</span><span class="s2">.data.record;</span>
      <span class="s4">return </span><span class="s2">record &amp;&amp; record.Deprecated;</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;descriptions&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">descriptions() {</span>
      <span class="s4">var </span><span class="s2">record = </span><span class="s4">this</span><span class="s2">.data.record;</span>
      <span class="s4">if </span><span class="s2">(record &amp;&amp; record.Description) {</span>
        <span class="s4">return </span><span class="s2">record.Description;</span>
      <span class="s2">}</span>
      <span class="s4">return </span><span class="s2">[];</span>
    <span class="s2">}</span>
  <span class="s2">}, {</span>
    <span class="s2">key: </span><span class="s3">&quot;format&quot;</span><span class="s2">,</span>
    <span class="s2">value: </span><span class="s4">function </span><span class="s2">format() {</span>
      <span class="s4">var </span><span class="s2">tag = </span><span class="s4">this</span><span class="s2">.data.tag;</span>

      <span class="s0">// Format according to algorithm defined in RFC 5646 section 2.1.1.</span>
      <span class="s4">return </span><span class="s2">tag.split(</span><span class="s3">'-'</span><span class="s2">).reduce(</span><span class="s4">function </span><span class="s2">(p, c, i, a) {</span>
        <span class="s4">if </span><span class="s2">(i === </span><span class="s5">0</span><span class="s2">) {</span>
          <span class="s4">return </span><span class="s2">c;</span>
        <span class="s2">}</span>
        <span class="s4">if </span><span class="s2">(a[i - </span><span class="s5">1</span><span class="s2">].length === </span><span class="s5">1</span><span class="s2">) {</span>
          <span class="s4">return </span><span class="s2">p + </span><span class="s3">'-' </span><span class="s2">+ c;</span>
        <span class="s2">}</span>
        <span class="s4">switch </span><span class="s2">(c.length) {</span>
          <span class="s4">case </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s2">p + </span><span class="s3">'-' </span><span class="s2">+ c.toUpperCase();</span>
          <span class="s4">case </span><span class="s5">4</span><span class="s2">:</span>
            <span class="s4">return </span><span class="s2">p + </span><span class="s3">'-' </span><span class="s2">+ c[</span><span class="s5">0</span><span class="s2">].toUpperCase() + c.substr(</span><span class="s5">1</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s4">return </span><span class="s2">p + </span><span class="s3">'-' </span><span class="s2">+ c;</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
  <span class="s2">}]);</span>
  <span class="s4">return </span><span class="s2">Tag;</span>
<span class="s2">}();</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_DEPRECATED&quot;</span><span class="s2">, </span><span class="s5">1</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_NO_LANGUAGE&quot;</span><span class="s2">, </span><span class="s5">2</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_UNKNOWN&quot;</span><span class="s2">, </span><span class="s5">3</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_TOO_LONG&quot;</span><span class="s2">, </span><span class="s5">4</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_EXTRA_REGION&quot;</span><span class="s2">, </span><span class="s5">5</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_EXTRA_EXTLANG&quot;</span><span class="s2">, </span><span class="s5">6</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_EXTRA_SCRIPT&quot;</span><span class="s2">, </span><span class="s5">7</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_DUPLICATE_VARIANT&quot;</span><span class="s2">, </span><span class="s5">8</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_WRONG_ORDER&quot;</span><span class="s2">, </span><span class="s5">9</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_SUPPRESS_SCRIPT&quot;</span><span class="s2">, </span><span class="s5">10</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_SUBTAG_DEPRECATED&quot;</span><span class="s2">, </span><span class="s5">11</span><span class="s2">);</span>
<span class="s2">_defineProperty(Tag, </span><span class="s3">&quot;ERR_EXTRA_LANGUAGE&quot;</span><span class="s2">, </span><span class="s5">12</span><span class="s2">);</span>
<span class="s2">module.exports = Tag;</span></pre>
</body>
</html>