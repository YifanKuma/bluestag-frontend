<html>
<head>
<title>image-optimizer.d.ts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
image-optimizer.d.ts</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">type { IncomingMessage, ServerResponse } from </span><span class="s2">'http'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ type UrlWithParsedQuery } from </span><span class="s2">'url'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">type { ImageConfigComplete } from </span><span class="s2">'../shared/lib/image-config'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">type { NextConfigComplete } from </span><span class="s2">'./config-shared'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">type { NextUrlWithParsedQuery } from </span><span class="s2">'./request-meta'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ type CachedImageValue, type IncrementalCacheEntry, type IncrementalCacheValue, type IncrementalResponseCacheEntry } from </span><span class="s2">'./response-cache'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">type { CacheControl } from </span><span class="s2">'./lib/cache-control'</span><span class="s1">;</span>
<span class="s1">type XCacheHeader = </span><span class="s2">'MISS' </span><span class="s1">| </span><span class="s2">'HIT' </span><span class="s1">| </span><span class="s2">'STALE'</span><span class="s1">;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getSharp(concurrency: number | </span><span class="s0">null </span><span class="s1">| undefined): </span><span class="s0">typeof import</span><span class="s1">(</span><span class="s2">&quot;sharp&quot;</span><span class="s1">);</span>
<span class="s0">export interface </span><span class="s1">ImageParamsResult {</span>
    <span class="s1">href: string;</span>
    <span class="s1">isAbsolute: boolean;</span>
    <span class="s1">isStatic: boolean;</span>
    <span class="s1">width: number;</span>
    <span class="s1">quality: number;</span>
    <span class="s1">mimeType: string;</span>
    <span class="s1">sizes: number[];</span>
    <span class="s1">minimumCacheTTL: number;</span>
<span class="s1">}</span>
<span class="s0">interface </span><span class="s1">ImageUpstream {</span>
    <span class="s1">buffer: Buffer;</span>
    <span class="s1">contentType: string | </span><span class="s0">null </span><span class="s1">| undefined;</span>
    <span class="s1">cacheControl: string | </span><span class="s0">null </span><span class="s1">| undefined;</span>
    <span class="s1">etag: string;</span>
<span class="s1">}</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getHash(items: (string | number | Buffer)[]): string;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">extractEtag(etag: string | </span><span class="s0">null </span><span class="s1">| undefined, imageBuffer: Buffer): string;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getImageEtag(image: Buffer): string;</span>
<span class="s3">/**</span>
 <span class="s3">* Inspects the first few bytes of a buffer to determine if</span>
 <span class="s3">* it matches the &quot;magic number&quot; of known file signatures.</span>
 <span class="s3">* https://en.wikipedia.org/wiki/List_of_file_signatures</span>
 <span class="s3">*/</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">detectContentType(buffer: Buffer, skipMetadata: boolean | </span><span class="s0">null </span><span class="s1">| undefined, concurrency?: number | </span><span class="s0">null </span><span class="s1">| undefined): Promise&lt;string | </span><span class="s0">null</span><span class="s1">&gt;;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">class </span><span class="s1">ImageOptimizerCache {</span>
    <span class="s0">private </span><span class="s1">cacheDir;</span>
    <span class="s0">private </span><span class="s1">nextConfig;</span>
    <span class="s0">static </span><span class="s1">validateParams(req: IncomingMessage, query: UrlWithParsedQuery[</span><span class="s2">'query'</span><span class="s1">], nextConfig: NextConfigComplete, isDev: boolean): ImageParamsResult | {</span>
        <span class="s1">errorMessage: string;</span>
    <span class="s1">};</span>
    <span class="s0">static </span><span class="s1">getCacheKey({ href, width, quality, mimeType, }: {</span>
        <span class="s1">href: string;</span>
        <span class="s1">width: number;</span>
        <span class="s1">quality: number;</span>
        <span class="s1">mimeType: string;</span>
    <span class="s1">}): string;</span>
    <span class="s1">constructor({ distDir, nextConfig, }: {</span>
        <span class="s1">distDir: string;</span>
        <span class="s1">nextConfig: NextConfigComplete;</span>
    <span class="s1">});</span>
    <span class="s1">get(cacheKey: string): Promise&lt;IncrementalResponseCacheEntry | </span><span class="s0">null</span><span class="s1">&gt;;</span>
    <span class="s1">set(cacheKey: string, value: IncrementalCacheValue | </span><span class="s0">null</span><span class="s1">, { cacheControl, }: {</span>
        <span class="s1">cacheControl?: CacheControl;</span>
    <span class="s1">}): Promise&lt;</span><span class="s0">void</span><span class="s1">&gt;;</span>
<span class="s1">}</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">class </span><span class="s1">ImageError </span><span class="s0">extends </span><span class="s1">Error {</span>
    <span class="s1">statusCode: number;</span>
    <span class="s1">constructor(statusCode: number, message: string);</span>
<span class="s1">}</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getMaxAge(str: string | </span><span class="s0">null </span><span class="s1">| undefined): number;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getPreviouslyCachedImageOrNull(upstreamImage: ImageUpstream, previousCacheEntry: IncrementalCacheEntry | </span><span class="s0">null </span><span class="s1">| undefined): CachedImageValue | </span><span class="s0">null</span><span class="s1">;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">optimizeImage({ buffer, contentType, quality, width, height, concurrency, limitInputPixels, sequentialRead, timeoutInSeconds, }: {</span>
    <span class="s1">buffer: Buffer;</span>
    <span class="s1">contentType: string;</span>
    <span class="s1">quality: number;</span>
    <span class="s1">width: number;</span>
    <span class="s1">height?: number;</span>
    <span class="s1">concurrency?: number | </span><span class="s0">null</span><span class="s1">;</span>
    <span class="s1">limitInputPixels?: number;</span>
    <span class="s1">sequentialRead?: boolean | </span><span class="s0">null</span><span class="s1">;</span>
    <span class="s1">timeoutInSeconds?: number;</span>
<span class="s1">}): Promise&lt;Buffer&gt;;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">fetchExternalImage(href: string): Promise&lt;ImageUpstream&gt;;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">fetchInternalImage(href: string, _req: IncomingMessage, _res: ServerResponse, handleRequest: (newReq: IncomingMessage, newRes: ServerResponse, newParsedUrl?: NextUrlWithParsedQuery) =&gt; Promise&lt;</span><span class="s0">void</span><span class="s1">&gt;): Promise&lt;ImageUpstream&gt;;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">imageOptimizer(imageUpstream: ImageUpstream, paramsResult: Pick&lt;ImageParamsResult, </span><span class="s2">'href' </span><span class="s1">| </span><span class="s2">'width' </span><span class="s1">| </span><span class="s2">'quality' </span><span class="s1">| </span><span class="s2">'mimeType'</span><span class="s1">&gt;, nextConfig: {</span>
    <span class="s1">experimental: Pick&lt;NextConfigComplete[</span><span class="s2">'experimental'</span><span class="s1">], </span><span class="s2">'imgOptConcurrency' </span><span class="s1">| </span><span class="s2">'imgOptMaxInputPixels' </span><span class="s1">| </span><span class="s2">'imgOptSequentialRead' </span><span class="s1">| </span><span class="s2">'imgOptSkipMetadata' </span><span class="s1">| </span><span class="s2">'imgOptTimeoutInSeconds'</span><span class="s1">&gt;;</span>
    <span class="s1">images: Pick&lt;NextConfigComplete[</span><span class="s2">'images'</span><span class="s1">], </span><span class="s2">'dangerouslyAllowSVG' </span><span class="s1">| </span><span class="s2">'minimumCacheTTL'</span><span class="s1">&gt;;</span>
<span class="s1">}, opts: {</span>
    <span class="s1">isDev?: boolean;</span>
    <span class="s1">silent?: boolean;</span>
    <span class="s1">previousCacheEntry?: IncrementalResponseCacheEntry | </span><span class="s0">null</span><span class="s1">;</span>
<span class="s1">}): Promise&lt;{</span>
    <span class="s1">buffer: Buffer;</span>
    <span class="s1">contentType: string;</span>
    <span class="s1">maxAge: number;</span>
    <span class="s1">etag: string;</span>
    <span class="s1">upstreamEtag: string;</span>
    <span class="s1">error?: unknown;</span>
<span class="s1">}&gt;;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">sendResponse(req: IncomingMessage, res: ServerResponse, url: string, extension: string, buffer: Buffer, etag: string, isStatic: boolean, xCache: XCacheHeader, imagesConfig: ImageConfigComplete, maxAge: number, isDev: boolean): </span><span class="s0">void</span><span class="s1">;</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">function </span><span class="s1">getImageSize(buffer: Buffer): Promise&lt;{</span>
    <span class="s1">width?: number;</span>
    <span class="s1">height?: number;</span>
<span class="s1">}&gt;;</span>
<span class="s0">export </span><span class="s1">{};</span>
</pre>
</body>
</html>