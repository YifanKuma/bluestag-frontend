<html>
<head>
<title>findNumbers.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
findNumbers.test.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">findNumbers from </span><span class="s2">'./findNumbers.js'</span>
<span class="s0">import </span><span class="s1">metadata from </span><span class="s2">'../../metadata.max.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>

<span class="s1">describe(</span><span class="s2">'findNumbers'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s2">'should find numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'2133734253'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">10</span>
		<span class="s1">}])</span>

		<span class="s1">expect(findNumbers(</span><span class="s2">'(213) 373-4253'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">14</span>
		<span class="s1">}])</span>

		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 and not (213) 373-4253 as written in the document.'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">32</span>
		<span class="s1">}, {</span>
			<span class="s1">phone    : </span><span class="s2">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">55</span>
		<span class="s1">}])</span>

		<span class="s4">// Opening parenthesis issue.</span>
		<span class="s4">// https://github.com/catamphetamine/libphonenumber-js/issues/252</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 and not (213) 373-4253 (that</span><span class="s5">\'</span><span class="s2">s not even in the same country!) as written in the document.'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">32</span>
		<span class="s1">}, {</span>
			<span class="s1">phone    : </span><span class="s2">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">55</span>
		<span class="s1">}])</span>

		<span class="s4">// No default country.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">32</span>
		<span class="s1">}])</span>

		<span class="s4">// Passing `options` and default country.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, { leniency: </span><span class="s2">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">32</span>
		<span class="s1">}])</span>

		<span class="s4">// Passing `options`.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, { leniency: </span><span class="s2">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">32</span>
		<span class="s1">}])</span>

		<span class="s4">// Not a phone number and a phone number.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'Digits 12 are not a number, but +7 (800) 555-35-35 is.'</span><span class="s1">, { leniency: </span><span class="s2">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">32</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">50</span>
		<span class="s1">}])</span>

		<span class="s4">// Phone number extension.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'Date 02/17/2018 is not a number, but +7 (800) 555-35-35 ext. 123 is.'</span><span class="s1">, { leniency: </span><span class="s2">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s2">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s2">'RU'</span><span class="s1">,</span>
			<span class="s1">ext      : </span><span class="s2">'123'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">37</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">64</span>
		<span class="s1">}])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should find numbers (v2)'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumbers = findNumbers(</span><span class="s2">'The number is +7 (800) 555-35-35 ext. 1234 and not (213) 373-4253 as written in the document.'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, { v2: </span><span class="s0">true </span><span class="s1">}, metadata)</span>

		<span class="s1">expect(phoneNumbers.length).to.equal(</span><span class="s3">2</span><span class="s1">)</span>

		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].startsAt).to.equal(</span><span class="s3">14</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].endsAt).to.equal(</span><span class="s3">42</span><span class="s1">)</span>

		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].number.number).to.equal(</span><span class="s2">'+78005553535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].number.nationalNumber).to.equal(</span><span class="s2">'8005553535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].number.country).to.equal(</span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].number.countryCallingCode).to.equal(</span><span class="s2">'7'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">0</span><span class="s1">].number.ext).to.equal(</span><span class="s2">'1234'</span><span class="s1">)</span>

		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].startsAt).to.equal(</span><span class="s3">51</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].endsAt).to.equal(</span><span class="s3">65</span><span class="s1">)</span>

		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].number.number).to.equal(</span><span class="s2">'+12133734253'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].number.nationalNumber).to.equal(</span><span class="s2">'2133734253'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].number.country).to.equal(</span><span class="s2">'US'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumbers[</span><span class="s3">1</span><span class="s1">].number.countryCallingCode).to.equal(</span><span class="s2">'1'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'shouldn</span><span class="s5">\'</span><span class="s2">t find non-valid numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// Not a valid phone number for US.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'1111111111'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should find non-European digits'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// E.g. in Iraq they don't write `+442323234` but rather `+٤٤٢٣٢٣٢٣٤`.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'العَرَبِيَّة‎ +٤٤٣٣٣٣٣٣٣٣٣٣عَرَبِيّ‎'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s2">'GB'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s2">'3333333333'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">27</span>
		<span class="s1">}])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should work in edge cases'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">let </span><span class="s1">thrower</span>

		<span class="s4">// No input</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">''</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s4">// // No country metadata for this `require` country code</span>
		<span class="s4">// thrower = () =&gt; findNumbers('123', 'ZZ', metadata)</span>
		<span class="s4">// thrower.should.throw('Unknown country')</span>

		<span class="s4">// Numerical `value`</span>
		<span class="s1">thrower = () =&gt; findNumbers(</span><span class="s3">2141111111</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">)</span>
		<span class="s1">expect(thrower).to.throw(</span><span class="s2">'A text for parsing must be a string.'</span><span class="s1">)</span>

		<span class="s4">// // No metadata</span>
		<span class="s4">// thrower = () =&gt; findNumbers('')</span>
		<span class="s4">// thrower.should.throw('`metadata` argument not passed')</span>

		<span class="s4">// No metadata, no default country, no phone numbers.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">''</span><span class="s1">)).to.deep.equal([])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should find international numbers when passed a non-existent default country'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">numbers = findNumbers(</span><span class="s2">'Phone: +7 (800) 555 35 35. National: 8 (800) 555-55-55'</span><span class="s1">, { defaultCountry: </span><span class="s2">'XX'</span><span class="s1">, v2: </span><span class="s0">true </span><span class="s1">}, metadata)</span>
		<span class="s1">expect(numbers.length).to.equal(</span><span class="s3">1</span><span class="s1">)</span>
		<span class="s1">expect(numbers[</span><span class="s3">0</span><span class="s1">].number.nationalNumber).to.equal(</span><span class="s2">'8005553535'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'shouldn</span><span class="s5">\'</span><span class="s2">t find phone numbers which are not phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// A timestamp.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'2012-01-02 08:00'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s4">// A valid number (not a complete timestamp).</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'2012-01-02 08'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s2">'US'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s2">'2012010208'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">13</span>
		<span class="s1">}])</span>

		<span class="s4">// Invalid parens.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'213(3734253'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s4">// Letters after phone number.</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'2133734253a'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s4">// Valid phone (same as the one found in the UUID below).</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'The phone number is 231354125.'</span><span class="s1">, </span><span class="s2">'FR'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s2">'FR'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s2">'231354125'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s3">20</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s3">29</span>
		<span class="s1">}])</span>

		<span class="s4">// Not a phone number (part of a UUID).</span>
		<span class="s4">// Should parse in `{ extended: true }` mode.</span>
		<span class="s0">const </span><span class="s1">possibleNumbers = findNumbers(</span><span class="s2">'The UUID is CA801c26f98cd16e231354125ad046e40b.'</span><span class="s1">, </span><span class="s2">'FR'</span><span class="s1">, { extended: </span><span class="s0">true </span><span class="s1">}, metadata)</span>
		<span class="s1">expect(possibleNumbers.length).to.equal(</span><span class="s3">1</span><span class="s1">)</span>
		<span class="s1">expect(possibleNumbers[</span><span class="s3">0</span><span class="s1">].country).to.equal(</span><span class="s2">'FR'</span><span class="s1">)</span>
		<span class="s1">expect(possibleNumbers[</span><span class="s3">0</span><span class="s1">].phone).to.equal(</span><span class="s2">'231354125'</span><span class="s1">)</span>

		<span class="s4">// Not a phone number (part of a UUID).</span>
		<span class="s4">// Shouldn't parse by default.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s2">'The UUID is CA801c26f98cd16e231354125ad046e40b.'</span><span class="s1">, </span><span class="s2">'FR'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([])</span>
	<span class="s1">})</span>

	<span class="s4">// https://gitlab.com/catamphetamine/libphonenumber-js/-/merge_requests/4</span>
	<span class="s1">it(</span><span class="s2">'should return correct `startsAt` and `endsAt` when matching &quot;inner&quot; candidates in a could-be-a-candidate substring'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(findNumbers(</span><span class="s2">'39945926 77200596 16533084'</span><span class="s1">, </span><span class="s2">'ID'</span><span class="s1">, metadata)).to.deep.equal([{</span>
				<span class="s1">country: </span><span class="s2">'ID'</span><span class="s1">,</span>
				<span class="s1">phone: </span><span class="s2">'77200596'</span><span class="s1">,</span>
				<span class="s1">startsAt: </span><span class="s3">9</span><span class="s1">,</span>
				<span class="s1">endsAt: </span><span class="s3">17</span>
			<span class="s1">}])</span>
	<span class="s1">})</span>
<span class="s1">})</span>
</pre>
</body>
</html>