<html>
<head>
<title>build-diagnostics.test.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
build-diagnostics.test.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/diagnostics/build-diagnostics.test.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { mkdtemp, readFile } from 'fs/promises'</span><span class="s3">\n</span><span class="s1">import { tmpdir } from 'os'</span><span class="s3">\n</span><span class="s1">import { join } from 'path'</span><span class="s3">\n</span><span class="s1">import { setGlobal } from '../trace/shared'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">recordFrameworkVersion,</span><span class="s3">\n  </span><span class="s1">updateBuildDiagnostics,</span><span class="s3">\n</span><span class="s1">} from './build-diagnostics'</span><span class="s3">\n\n</span><span class="s1">async function readBuildDiagnostics(dir: string) {</span><span class="s3">\n  </span><span class="s1">return JSON.parse(</span><span class="s3">\n    </span><span class="s1">await readFile(join(dir, 'diagnostics', 'build-diagnostics.json'), 'utf8')</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">describe('build-diagnostics', () =&gt; {</span><span class="s3">\n  </span><span class="s1">it('records framework version to framework.json correctly', async () =&gt; {</span><span class="s3">\n    </span><span class="s1">const tmpDir = await mkdtemp(join(tmpdir(), 'build-diagnostics'))</span><span class="s3">\n    </span><span class="s1">setGlobal('distDir', tmpDir)</span><span class="s3">\n\n    </span><span class="s1">// Record the initial diagnostics and make sure it's correct.</span><span class="s3">\n    </span><span class="s1">await recordFrameworkVersion('14.2.3')</span><span class="s3">\n    </span><span class="s1">let diagnostics = JSON.parse(</span><span class="s3">\n      </span><span class="s1">await readFile(join(tmpDir, 'diagnostics', 'framework.json'), 'utf8')</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.version).toEqual('14.2.3')</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">it('records build diagnostics to a file correctly', async () =&gt; {</span><span class="s3">\n    </span><span class="s1">const tmpDir = await mkdtemp(join(tmpdir(), 'build-diagnostics'))</span><span class="s3">\n    </span><span class="s1">setGlobal('distDir', tmpDir)</span><span class="s3">\n\n    </span><span class="s1">// Record the initial diagnostics and make sure it's correct.</span><span class="s3">\n    </span><span class="s1">await updateBuildDiagnostics({</span><span class="s3">\n      </span><span class="s1">buildStage: 'compile',</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">let diagnostics = await readBuildDiagnostics(tmpDir)</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.buildStage).toEqual('compile')</span><span class="s3">\n\n    </span><span class="s1">// Add a new build option. Make sure that existing fields are preserved.</span><span class="s3">\n    </span><span class="s1">await updateBuildDiagnostics({</span><span class="s3">\n      </span><span class="s1">buildStage: 'compile-server',</span><span class="s3">\n      </span><span class="s1">buildOptions: {</span><span class="s3">\n        </span><span class="s1">useBuildWorker: String(false),</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">diagnostics = await readBuildDiagnostics(tmpDir)</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.buildStage).toEqual('compile-server')</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.buildOptions).toEqual({</span><span class="s3">\n      </span><span class="s1">useBuildWorker: 'false',</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">// Make sure that it keeps existing build options when adding a new one.</span><span class="s3">\n    </span><span class="s1">await updateBuildDiagnostics({</span><span class="s3">\n      </span><span class="s1">buildStage: 'compile-client',</span><span class="s3">\n      </span><span class="s1">buildOptions: {</span><span class="s3">\n        </span><span class="s1">experimentalBuildMode: 'compile',</span><span class="s3">\n      </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">diagnostics = await readBuildDiagnostics(tmpDir)</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.buildStage).toEqual('compile-client')</span><span class="s3">\n    </span><span class="s1">expect(diagnostics.buildOptions).toEqual({</span><span class="s3">\n      </span><span class="s1">experimentalBuildMode: 'compile',</span><span class="s3">\n      </span><span class="s1">useBuildWorker: 'false',</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n</span><span class="s1">})</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;readBuildDiagnostics&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;readFile&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;describe&quot;</span><span class="s0">,</span><span class="s1">&quot;it&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpDir&quot;</span><span class="s0">,</span><span class="s1">&quot;mkdtemp&quot;</span><span class="s0">,</span><span class="s1">&quot;tmpdir&quot;</span><span class="s0">,</span><span class="s1">&quot;setGlobal&quot;</span><span class="s0">,</span><span class="s1">&quot;recordFrameworkVersion&quot;</span><span class="s0">,</span><span class="s1">&quot;diagnostics&quot;</span><span class="s0">,</span><span class="s1">&quot;expect&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;toEqual&quot;</span><span class="s0">,</span><span class="s1">&quot;updateBuildDiagnostics&quot;</span><span class="s0">,</span><span class="s1">&quot;buildStage&quot;</span><span class="s0">,</span><span class="s1">&quot;buildOptions&quot;</span><span class="s0">,</span><span class="s1">&quot;useBuildWorker&quot;</span><span class="s0">,</span><span class="s1">&quot;String&quot;</span><span class="s0">,</span><span class="s1">&quot;experimentalBuildMode&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;0BAAkC;oBACX;sBACF;wBACK;kCAInB;AAEP,eAAeA,qBAAqBC,GAAW;IAC7C,OAAOC,KAAKC,KAAK,CACf,MAAMC,IAAAA,kBAAQ,EAACC,IAAAA,UAAI,EAACJ,KAAK,eAAe,2BAA2B;AAEvE;AAEAK,SAAS,qBAAqB;IAC5BC,GAAG,yDAAyD;QAC1D,MAAMC,SAAS,MAAMC,IAAAA,iBAAO,EAACJ,IAAAA,UAAI,EAACK,IAAAA,UAAM,KAAI;QAC5CC,IAAAA,iBAAS,EAAC,WAAWH;QAErB,6DAA6D;QAC7D,MAAMI,IAAAA,wCAAsB,EAAC;QAC7B,IAAIC,cAAcX,KAAKC,KAAK,CAC1B,MAAMC,IAAAA,kBAAQ,EAACC,IAAAA,UAAI,EAACG,QAAQ,eAAe,mBAAmB;QAEhEM,OAAOD,YAAYE,OAAO,EAAEC,OAAO,CAAC;IACtC;IAEAT,GAAG,iDAAiD;QAClD,MAAMC,SAAS,MAAMC,IAAAA,iBAAO,EAACJ,IAAAA,UAAI,EAACK,IAAAA,UAAM,KAAI;QAC5CC,IAAAA,iBAAS,EAAC,WAAWH;QAErB,6DAA6D;QAC7D,MAAMS,IAAAA,wCAAsB,EAAC;YAC3BC,YAAY;QACd;QACA,IAAIL,cAAc,MAAMb,qBAAqBQ;QAC7CM,OAAOD,YAAYK,UAAU,EAAEF,OAAO,CAAC;QAEvC,wEAAwE;QACxE,MAAMC,IAAAA,wCAAsB,EAAC;YAC3BC,YAAY;YACZC,cAAc;gBACZC,gBAAgBC,OAAO;YACzB;QACF;QACAR,cAAc,MAAMb,qBAAqBQ;QACzCM,OAAOD,YAAYK,UAAU,EAAEF,OAAO,CAAC;QACvCF,OAAOD,YAAYM,YAAY,EAAEH,OAAO,CAAC;YACvCI,gBAAgB;QAClB;QAEA,wEAAwE;QACxE,MAAMH,IAAAA,wCAAsB,EAAC;YAC3BC,YAAY;YACZC,cAAc;gBACZG,uBAAuB;YACzB;QACF;QACAT,cAAc,MAAMb,qBAAqBQ;QACzCM,OAAOD,YAAYK,UAAU,EAAEF,OAAO,CAAC;QACvCF,OAAOD,YAAYM,YAAY,EAAEH,OAAO,CAAC;YACvCM,uBAAuB;YACvBF,gBAAgB;QAClB;IACF;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>