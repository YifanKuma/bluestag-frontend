<html>
<head>
<title>download-swc.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
download-swc.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/lib/download-swc.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import fs from 'fs'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import * as Log from '../build/output/log'</span><span class="s3">\n</span><span class="s1">import tar from 'next/dist/compiled/tar'</span><span class="s3">\n</span><span class="s1">const { WritableStream } =</span><span class="s3">\n  </span><span class="s1">require('node:stream/web') as typeof import('node:stream/web')</span><span class="s3">\n</span><span class="s1">import { getRegistry } from './helpers/get-registry'</span><span class="s3">\n</span><span class="s1">import { getCacheDirectory } from './helpers/get-cache-directory'</span><span class="s3">\n\n</span><span class="s1">const MAX_VERSIONS_TO_CACHE = 8</span><span class="s3">\n\n</span><span class="s1">async function extractBinary(</span><span class="s3">\n  </span><span class="s1">outputDirectory: string,</span><span class="s3">\n  </span><span class="s1">pkgName: string,</span><span class="s3">\n  </span><span class="s1">tarFileName: string</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const cacheDirectory = getCacheDirectory(</span><span class="s3">\n    </span><span class="s1">'next-swc',</span><span class="s3">\n    </span><span class="s1">process.env['NEXT_SWC_PATH']</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const extractFromTar = () =&gt;</span><span class="s3">\n    </span><span class="s1">tar.x({</span><span class="s3">\n      </span><span class="s1">file: path.join(cacheDirectory, tarFileName),</span><span class="s3">\n      </span><span class="s1">cwd: outputDirectory,</span><span class="s3">\n      </span><span class="s1">strip: 1,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">if (!fs.existsSync(path.join(cacheDirectory, tarFileName))) {</span><span class="s3">\n    </span><span class="s1">Log.info(`Downloading swc package ${pkgName}... to ${cacheDirectory}`)</span><span class="s3">\n    </span><span class="s1">await fs.promises.mkdir(cacheDirectory, { recursive: true })</span><span class="s3">\n    </span><span class="s1">const tempFile = path.join(</span><span class="s3">\n      </span><span class="s1">cacheDirectory,</span><span class="s3">\n      </span><span class="s1">`${tarFileName}.temp-${Date.now()}`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n\n    </span><span class="s1">const registry = getRegistry()</span><span class="s3">\n\n    </span><span class="s1">const downloadUrl = `${registry}${pkgName}/-/${tarFileName}`</span><span class="s3">\n\n    </span><span class="s1">await fetch(downloadUrl).then((res) =&gt; {</span><span class="s3">\n      </span><span class="s1">const { ok, body } = res</span><span class="s3">\n      </span><span class="s1">if (!ok || !body) {</span><span class="s3">\n        </span><span class="s1">Log.error(`Failed to download swc package from ${downloadUrl}`)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (!ok) {</span><span class="s3">\n        </span><span class="s1">throw new Error(`request failed with status ${res.status}`)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">if (!body) {</span><span class="s3">\n        </span><span class="s1">throw new Error('request failed with empty body')</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">const cacheWriteStream = fs.createWriteStream(tempFile)</span><span class="s3">\n      </span><span class="s1">return body.pipeTo(</span><span class="s3">\n        </span><span class="s1">new WritableStream({</span><span class="s3">\n          </span><span class="s1">write(chunk) {</span><span class="s3">\n            </span><span class="s1">return new Promise&lt;void&gt;((resolve, reject) =&gt;</span><span class="s3">\n              </span><span class="s1">cacheWriteStream.write(chunk, (error) =&gt; {</span><span class="s3">\n                </span><span class="s1">if (error) {</span><span class="s3">\n                  </span><span class="s1">reject(error)</span><span class="s3">\n                  </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">resolve()</span><span class="s3">\n              </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n          </span><span class="s1">close() {</span><span class="s3">\n            </span><span class="s1">return new Promise&lt;void&gt;((resolve, reject) =&gt;</span><span class="s3">\n              </span><span class="s1">cacheWriteStream.close((error) =&gt; {</span><span class="s3">\n                </span><span class="s1">if (error) {</span><span class="s3">\n                  </span><span class="s1">reject(error)</span><span class="s3">\n                  </span><span class="s1">return</span><span class="s3">\n                </span><span class="s1">}</span><span class="s3">\n\n                </span><span class="s1">resolve()</span><span class="s3">\n              </span><span class="s1">})</span><span class="s3">\n            </span><span class="s1">)</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">await fs.promises.access(tempFile) // ensure the temp file existed</span><span class="s3">\n    </span><span class="s1">await fs.promises.rename(tempFile, path.join(cacheDirectory, tarFileName))</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">Log.info(`Using cached swc package ${pkgName}...`)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">await extractFromTar()</span><span class="s3">\n\n  </span><span class="s1">const cacheFiles = await fs.promises.readdir(cacheDirectory)</span><span class="s3">\n\n  </span><span class="s1">if (cacheFiles.length &gt; MAX_VERSIONS_TO_CACHE) {</span><span class="s3">\n    </span><span class="s1">cacheFiles.sort((a, b) =&gt; {</span><span class="s3">\n      </span><span class="s1">if (a.length &lt; b.length) return -1</span><span class="s3">\n      </span><span class="s1">return a.localeCompare(b)</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">// prune oldest versions in cache</span><span class="s3">\n    </span><span class="s1">for (let i = 0; i++; i &lt; cacheFiles.length - MAX_VERSIONS_TO_CACHE) {</span><span class="s3">\n      </span><span class="s1">await fs.promises</span><span class="s3">\n        </span><span class="s1">.unlink(path.join(cacheDirectory, cacheFiles[i]))</span><span class="s3">\n        </span><span class="s1">.catch(() =&gt; {})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function downloadNativeNextSwc(</span><span class="s3">\n  </span><span class="s1">version: string,</span><span class="s3">\n  </span><span class="s1">bindingsDirectory: string,</span><span class="s3">\n  </span><span class="s1">triplesABI: Array&lt;string&gt;</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">for (const triple of triplesABI) {</span><span class="s3">\n    </span><span class="s1">const pkgName = `@next/swc-${triple}`</span><span class="s3">\n    </span><span class="s1">const tarFileName = `${pkgName.substring(6)}-${version}.tgz`</span><span class="s3">\n    </span><span class="s1">const outputDirectory = path.join(bindingsDirectory, pkgName)</span><span class="s3">\n\n    </span><span class="s1">if (fs.existsSync(outputDirectory)) {</span><span class="s3">\n      </span><span class="s1">// if the package is already downloaded a different</span><span class="s3">\n      </span><span class="s1">// failure occurred than not being present</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">await fs.promises.mkdir(outputDirectory, { recursive: true })</span><span class="s3">\n    </span><span class="s1">await extractBinary(outputDirectory, pkgName, tarFileName)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function downloadWasmSwc(</span><span class="s3">\n  </span><span class="s1">version: string,</span><span class="s3">\n  </span><span class="s1">wasmDirectory: string,</span><span class="s3">\n  </span><span class="s1">variant: 'nodejs' | 'web' = 'nodejs'</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const pkgName = `@next/swc-wasm-${variant}`</span><span class="s3">\n  </span><span class="s1">const tarFileName = `${pkgName.substring(6)}-${version}.tgz`</span><span class="s3">\n  </span><span class="s1">const outputDirectory = path.join(wasmDirectory, pkgName)</span><span class="s3">\n\n  </span><span class="s1">if (fs.existsSync(outputDirectory)) {</span><span class="s3">\n    </span><span class="s1">// if the package is already downloaded a different</span><span class="s3">\n    </span><span class="s1">// failure occurred than not being present</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">await fs.promises.mkdir(outputDirectory, { recursive: true })</span><span class="s3">\n  </span><span class="s1">await extractBinary(outputDirectory, pkgName, tarFileName)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;downloadNativeNextSwc&quot;</span><span class="s0">,</span><span class="s1">&quot;downloadWasmSwc&quot;</span><span class="s0">,</span><span class="s1">&quot;WritableStream&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;MAX_VERSIONS_TO_CACHE&quot;</span><span class="s0">,</span><span class="s1">&quot;extractBinary&quot;</span><span class="s0">,</span><span class="s1">&quot;outputDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;pkgName&quot;</span><span class="s0">,</span><span class="s1">&quot;tarFileName&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;getCacheDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;extractFromTar&quot;</span><span class="s0">,</span><span class="s1">&quot;tar&quot;</span><span class="s0">,</span><span class="s1">&quot;x&quot;</span><span class="s0">,</span><span class="s1">&quot;file&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;cwd&quot;</span><span class="s0">,</span><span class="s1">&quot;strip&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;existsSync&quot;</span><span class="s0">,</span><span class="s1">&quot;Log&quot;</span><span class="s0">,</span><span class="s1">&quot;info&quot;</span><span class="s0">,</span><span class="s1">&quot;promises&quot;</span><span class="s0">,</span><span class="s1">&quot;mkdir&quot;</span><span class="s0">,</span><span class="s1">&quot;recursive&quot;</span><span class="s0">,</span><span class="s1">&quot;tempFile&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;registry&quot;</span><span class="s0">,</span><span class="s1">&quot;getRegistry&quot;</span><span class="s0">,</span><span class="s1">&quot;downloadUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;fetch&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;ok&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheWriteStream&quot;</span><span class="s0">,</span><span class="s1">&quot;createWriteStream&quot;</span><span class="s0">,</span><span class="s1">&quot;pipeTo&quot;</span><span class="s0">,</span><span class="s1">&quot;write&quot;</span><span class="s0">,</span><span class="s1">&quot;chunk&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;reject&quot;</span><span class="s0">,</span><span class="s1">&quot;close&quot;</span><span class="s0">,</span><span class="s1">&quot;access&quot;</span><span class="s0">,</span><span class="s1">&quot;rename&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;readdir&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;sort&quot;</span><span class="s0">,</span><span class="s1">&quot;a&quot;</span><span class="s0">,</span><span class="s1">&quot;b&quot;</span><span class="s0">,</span><span class="s1">&quot;localeCompare&quot;</span><span class="s0">,</span><span class="s1">&quot;i&quot;</span><span class="s0">,</span><span class="s1">&quot;unlink&quot;</span><span class="s0">,</span><span class="s1">&quot;catch&quot;</span><span class="s0">,</span><span class="s1">&quot;version&quot;</span><span class="s0">,</span><span class="s1">&quot;bindingsDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;triplesABI&quot;</span><span class="s0">,</span><span class="s1">&quot;triple&quot;</span><span class="s0">,</span><span class="s1">&quot;substring&quot;</span><span class="s0">,</span><span class="s1">&quot;wasmDirectory&quot;</span><span class="s0">,</span><span class="s1">&quot;variant&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>