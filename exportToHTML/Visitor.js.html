<html>
<head>
<title>visitor.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
visitor.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span><span class="s1">;Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { value: </span><span class="s2">true </span><span class="s1">});</span><span class="s2">var </span><span class="s1">_createClass = </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">defineProperties(target, props) {</span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; props.length; i++) {</span><span class="s2">var </span><span class="s1">descriptor = props[i];descriptor.enumerable = descriptor.enumerable || </span><span class="s2">false</span><span class="s1">;descriptor.configurable = </span><span class="s2">true</span><span class="s1">;</span><span class="s2">if </span><span class="s1">(</span><span class="s0">&quot;value&quot; </span><span class="s2">in </span><span class="s1">descriptor) descriptor.writable = </span><span class="s2">true</span><span class="s1">;Object.defineProperty(target, descriptor.key, descriptor);}}</span><span class="s2">return function </span><span class="s1">(Constructor, protoProps, staticProps) {</span><span class="s2">if </span><span class="s1">(protoProps) defineProperties(Constructor.prototype, protoProps);</span><span class="s2">if </span><span class="s1">(staticProps) defineProperties(Constructor, staticProps);</span><span class="s2">return </span><span class="s1">Constructor;};}();</span><span class="s2">var </span><span class="s1">_arrayIncludes = require(</span><span class="s0">'array-includes'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_arrayIncludes2 = _interopRequireDefault(_arrayIncludes);</span>
<span class="s2">var </span><span class="s1">_eslint = require(</span><span class="s0">'eslint'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_doc = require(</span><span class="s0">'./doc'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_namespace = require(</span><span class="s0">'./namespace'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_namespace2 = _interopRequireDefault(_namespace);</span>
<span class="s2">var </span><span class="s1">_specifier = require(</span><span class="s0">'./specifier'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_specifier2 = _interopRequireDefault(_specifier);</span>
<span class="s2">var </span><span class="s1">_captureDependency = require(</span><span class="s0">'./captureDependency'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_patternCapture = require(</span><span class="s0">'./patternCapture'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_patternCapture2 = _interopRequireDefault(_patternCapture);</span>
<span class="s2">var </span><span class="s1">_remotePath = require(</span><span class="s0">'./remotePath'</span><span class="s1">);</span><span class="s2">function </span><span class="s1">_interopRequireDefault(obj) {</span><span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : { </span><span class="s0">'default'</span><span class="s1">: obj };}</span><span class="s2">function </span><span class="s1">_classCallCheck(instance, Constructor) {</span><span class="s2">if </span><span class="s1">(!(instance </span><span class="s2">instanceof </span><span class="s1">Constructor)) {</span><span class="s2">throw new </span><span class="s1">TypeError(</span><span class="s0">&quot;Cannot call a class as a function&quot;</span><span class="s1">);}}</span>

<span class="s4">/**</span>
                                                                                                                                                                                                                                                                                                <span class="s4">* sometimes legacy support isn't _that_ hard... right?</span>
                                                                                                                                                                                                                                                                                                <span class="s4">*/</span>
<span class="s2">function </span><span class="s1">makeSourceCode(text, ast) {</span>
  <span class="s2">if </span><span class="s1">(_eslint.SourceCode.length &gt; </span><span class="s3">1</span><span class="s1">) {</span>
    <span class="s4">// ESLint 3</span>
    <span class="s2">return new </span><span class="s1">_eslint.SourceCode(text, ast);</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s4">// ESLint 4, 5</span>
    <span class="s2">return new </span><span class="s1">_eslint.SourceCode({ text: text, ast: ast });</span>
  <span class="s1">}</span>
<span class="s1">}</span><span class="s2">var</span>

<span class="s1">ImportExportVisitorBuilder = </span><span class="s2">function </span><span class="s1">() {</span>
  <span class="s2">function </span><span class="s1">ImportExportVisitorBuilder(</span>
  <span class="s1">path,</span>
  <span class="s1">context,</span>
  <span class="s1">exportMap,</span>
  <span class="s1">ExportMapBuilder,</span>
  <span class="s1">content,</span>
  <span class="s1">ast,</span>
  <span class="s1">isEsModuleInteropTrue,</span>
  <span class="s1">thunkFor)</span>
  <span class="s1">{</span><span class="s2">var </span><span class="s1">_this = </span><span class="s2">this</span><span class="s1">;_classCallCheck(</span><span class="s2">this</span><span class="s1">, ImportExportVisitorBuilder);</span>
    <span class="s2">this</span><span class="s1">.context = context;</span>
    <span class="s2">this</span><span class="s1">.namespace = </span><span class="s2">new </span><span class="s1">_namespace2[</span><span class="s0">'default'</span><span class="s1">](path, context, ExportMapBuilder);</span>
    <span class="s2">this</span><span class="s1">.remotePathResolver = </span><span class="s2">new </span><span class="s1">_remotePath.RemotePath(path, context);</span>
    <span class="s2">this</span><span class="s1">.source = makeSourceCode(content, ast);</span>
    <span class="s2">this</span><span class="s1">.exportMap = exportMap;</span>
    <span class="s2">this</span><span class="s1">.ast = ast;</span>
    <span class="s2">this</span><span class="s1">.isEsModuleInteropTrue = isEsModuleInteropTrue;</span>
    <span class="s2">this</span><span class="s1">.thunkFor = thunkFor;</span>
    <span class="s2">var </span><span class="s1">docstyle = </span><span class="s2">this</span><span class="s1">.context.settings &amp;&amp; </span><span class="s2">this</span><span class="s1">.context.settings[</span><span class="s0">'import/docstyle'</span><span class="s1">] || [</span><span class="s0">'jsdoc'</span><span class="s1">];</span>
    <span class="s2">this</span><span class="s1">.docStyleParsers = {};</span>
    <span class="s1">docstyle.forEach(</span><span class="s2">function </span><span class="s1">(style) {</span>
      <span class="s1">_this.docStyleParsers[style] = _doc.availableDocStyleParsers[style];</span>
    <span class="s1">});</span>
  <span class="s1">}_createClass(ImportExportVisitorBuilder, [{ key: </span><span class="s0">'build'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">build(</span>

      <span class="s1">astNode) {</span><span class="s2">var </span><span class="s1">_this3 = </span><span class="s2">this</span><span class="s1">;</span>
        <span class="s2">return </span><span class="s1">Object.assign({</span>
          <span class="s1">ExportDefaultDeclaration: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ExportDefaultDeclaration() {</span>
              <span class="s2">var </span><span class="s1">exportMeta = (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(</span><span class="s2">this</span><span class="s1">.source, </span><span class="s2">this</span><span class="s1">.docStyleParsers, astNode);</span>
              <span class="s2">if </span><span class="s1">(astNode.declaration.type === </span><span class="s0">'Identifier'</span><span class="s1">) {</span>
                <span class="s2">this</span><span class="s1">.namespace.add(exportMeta, astNode.declaration);</span>
              <span class="s1">}</span>
              <span class="s2">this</span><span class="s1">.exportMap.namespace.set(</span><span class="s0">'default'</span><span class="s1">, exportMeta);</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">ExportDefaultDeclaration;}(),</span>
          <span class="s1">ExportAllDeclaration: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ExportAllDeclaration() {</span>
              <span class="s2">var </span><span class="s1">getter = (</span><span class="s3">0</span><span class="s1">, _captureDependency.captureDependency)(astNode, astNode.exportKind === </span><span class="s0">'type'</span><span class="s1">, </span><span class="s2">this</span><span class="s1">.remotePathResolver, </span><span class="s2">this</span><span class="s1">.exportMap, </span><span class="s2">this</span><span class="s1">.context, </span><span class="s2">this</span><span class="s1">.thunkFor);</span>
              <span class="s2">if </span><span class="s1">(getter) {</span><span class="s2">this</span><span class="s1">.exportMap.dependencies.add(getter);}</span>
              <span class="s2">if </span><span class="s1">(astNode.exported) {</span>
                <span class="s1">(</span><span class="s3">0</span><span class="s1">, _specifier2[</span><span class="s0">'default'</span><span class="s1">])(astNode, astNode.exported, </span><span class="s2">this</span><span class="s1">.exportMap, </span><span class="s2">this</span><span class="s1">.namespace);</span>
              <span class="s1">}</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">ExportAllDeclaration;}(),</span>
          <span class="s4">/** capture namespaces in case of later export */</span>
          <span class="s1">ImportDeclaration: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ImportDeclaration() {</span>
              <span class="s1">(</span><span class="s3">0</span><span class="s1">, _captureDependency.captureDependencyWithSpecifiers)(astNode, </span><span class="s2">this</span><span class="s1">.remotePathResolver, </span><span class="s2">this</span><span class="s1">.exportMap, </span><span class="s2">this</span><span class="s1">.context, </span><span class="s2">this</span><span class="s1">.thunkFor);</span>
              <span class="s2">var </span><span class="s1">ns = astNode.specifiers.find(</span><span class="s2">function </span><span class="s1">(s) {</span><span class="s2">return </span><span class="s1">s.type === </span><span class="s0">'ImportNamespaceSpecifier'</span><span class="s1">;});</span>
              <span class="s2">if </span><span class="s1">(ns) {</span>
                <span class="s2">this</span><span class="s1">.namespace.rawSet(ns.local.name, astNode.source.value);</span>
              <span class="s1">}</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">ImportDeclaration;}(),</span>
          <span class="s1">ExportNamedDeclaration: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ExportNamedDeclaration() {</span><span class="s2">var </span><span class="s1">_this2 = </span><span class="s2">this</span><span class="s1">;</span>
              <span class="s1">(</span><span class="s3">0</span><span class="s1">, _captureDependency.captureDependencyWithSpecifiers)(astNode, </span><span class="s2">this</span><span class="s1">.remotePathResolver, </span><span class="s2">this</span><span class="s1">.exportMap, </span><span class="s2">this</span><span class="s1">.context, </span><span class="s2">this</span><span class="s1">.thunkFor);</span>
              <span class="s4">// capture declaration</span>
              <span class="s2">if </span><span class="s1">(astNode.declaration != </span><span class="s2">null</span><span class="s1">) {</span>
                <span class="s2">switch </span><span class="s1">(astNode.declaration.type) {</span>
                  <span class="s2">case </span><span class="s0">'FunctionDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'ClassDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TypeAlias'</span><span class="s1">: </span><span class="s4">// flowtype with babel-eslint parser</span>
                  <span class="s2">case </span><span class="s0">'InterfaceDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'DeclareFunction'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSDeclareFunction'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSEnumDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSTypeAliasDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSInterfaceDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSAbstractClassDeclaration'</span><span class="s1">:</span>
                  <span class="s2">case </span><span class="s0">'TSModuleDeclaration'</span><span class="s1">:</span>
                    <span class="s2">this</span><span class="s1">.exportMap.namespace.set(astNode.declaration.id.name, (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(</span><span class="s2">this</span><span class="s1">.source, </span><span class="s2">this</span><span class="s1">.docStyleParsers, astNode));</span>
                    <span class="s2">break</span><span class="s1">;</span>
                  <span class="s2">case </span><span class="s0">'VariableDeclaration'</span><span class="s1">:</span>
                    <span class="s1">astNode.declaration.declarations.forEach(</span><span class="s2">function </span><span class="s1">(d) {</span>
                      <span class="s1">(</span><span class="s3">0</span><span class="s1">, _patternCapture2[</span><span class="s0">'default'</span><span class="s1">])(</span>
                      <span class="s1">d.id,</span>
                      <span class="s2">function </span><span class="s1">(id) {</span><span class="s2">return </span><span class="s1">_this2.exportMap.namespace.set(id.name, (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(_this2.source, _this2.docStyleParsers, d, astNode));});</span>

                    <span class="s1">});</span>
                    <span class="s2">break</span><span class="s1">;</span>
                  <span class="s2">default</span><span class="s1">:}</span>

              <span class="s1">}</span>
              <span class="s1">astNode.specifiers.forEach(</span><span class="s2">function </span><span class="s1">(s) {</span><span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _specifier2[</span><span class="s0">'default'</span><span class="s1">])(s, astNode, _this2.exportMap, _this2.namespace);});</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">ExportNamedDeclaration;}(),</span>
          <span class="s1">TSExportAssignment: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">TSExportAssignment() {</span><span class="s2">return </span><span class="s1">_this3.typeScriptExport(astNode);}</span><span class="s2">return </span><span class="s1">TSExportAssignment;}() },</span>
        <span class="s2">this</span><span class="s1">.isEsModuleInteropTrue &amp;&amp; { TSNamespaceExportDeclaration: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">TSNamespaceExportDeclaration() {</span><span class="s2">return </span><span class="s1">_this3.typeScriptExport(astNode);}</span><span class="s2">return </span><span class="s1">TSNamespaceExportDeclaration;}() });</span>

      <span class="s1">}</span><span class="s2">return </span><span class="s1">build;}()</span>

    <span class="s4">// This doesn't declare anything, but changes what's being exported.</span>
  <span class="s1">}, { key: </span><span class="s0">'typeScriptExport'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">typeScriptExport(astNode) {</span><span class="s2">var </span><span class="s1">_this4 = </span><span class="s2">this</span><span class="s1">;</span>
        <span class="s2">var </span><span class="s1">exportedName = astNode.type === </span><span class="s0">'TSNamespaceExportDeclaration' </span><span class="s1">?</span>
        <span class="s1">(astNode.id || astNode.name).name :</span>
        <span class="s1">astNode.expression &amp;&amp; astNode.expression.name || astNode.expression.id &amp;&amp; astNode.expression.id.name || </span><span class="s2">null</span><span class="s1">;</span>
        <span class="s2">var </span><span class="s1">declTypes = [</span>
        <span class="s0">'VariableDeclaration'</span><span class="s1">,</span>
        <span class="s0">'ClassDeclaration'</span><span class="s1">,</span>
        <span class="s0">'TSDeclareFunction'</span><span class="s1">,</span>
        <span class="s0">'TSEnumDeclaration'</span><span class="s1">,</span>
        <span class="s0">'TSTypeAliasDeclaration'</span><span class="s1">,</span>
        <span class="s0">'TSInterfaceDeclaration'</span><span class="s1">,</span>
        <span class="s0">'TSAbstractClassDeclaration'</span><span class="s1">,</span>
        <span class="s0">'TSModuleDeclaration'</span><span class="s1">];</span>

        <span class="s2">var </span><span class="s1">exportedDecls = </span><span class="s2">this</span><span class="s1">.ast.body.filter(</span><span class="s2">function </span><span class="s1">(_ref) {</span><span class="s2">var </span><span class="s1">type = _ref.type,id = _ref.id,declarations = _ref.declarations;</span><span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _arrayIncludes2[</span><span class="s0">'default'</span><span class="s1">])(declTypes, type) &amp;&amp; (</span>
          <span class="s1">id &amp;&amp; id.name === exportedName || declarations &amp;&amp; declarations.find(</span><span class="s2">function </span><span class="s1">(d) {</span><span class="s2">return </span><span class="s1">d.id.name === exportedName;}));});</span>

        <span class="s2">if </span><span class="s1">(exportedDecls.length === </span><span class="s3">0</span><span class="s1">) {</span>
          <span class="s4">// Export is not referencing any local declaration, must be re-exporting</span>
          <span class="s2">this</span><span class="s1">.exportMap.namespace.set(</span><span class="s0">'default'</span><span class="s1">, (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(</span><span class="s2">this</span><span class="s1">.source, </span><span class="s2">this</span><span class="s1">.docStyleParsers, astNode));</span>
          <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(</span>
        <span class="s2">this</span><span class="s1">.isEsModuleInteropTrue </span><span class="s4">// esModuleInterop is on in tsconfig</span>
        <span class="s1">&amp;&amp; !</span><span class="s2">this</span><span class="s1">.exportMap.namespace.has(</span><span class="s0">'default'</span><span class="s1">) </span><span class="s4">// and default isn't added already</span>
        <span class="s1">) {</span>
            <span class="s2">this</span><span class="s1">.exportMap.namespace.set(</span><span class="s0">'default'</span><span class="s1">, {}); </span><span class="s4">// add default export</span>
          <span class="s1">}</span>
        <span class="s1">exportedDecls.forEach(</span><span class="s2">function </span><span class="s1">(decl) {</span>
          <span class="s2">if </span><span class="s1">(decl.type === </span><span class="s0">'TSModuleDeclaration'</span><span class="s1">) {</span>
            <span class="s2">if </span><span class="s1">(decl.body &amp;&amp; decl.body.type === </span><span class="s0">'TSModuleDeclaration'</span><span class="s1">) {</span>
              <span class="s1">_this4.exportMap.namespace.set(decl.body.id.name, (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(_this4.source, _this4.docStyleParsers, decl.body));</span>
            <span class="s1">} </span><span class="s2">else if </span><span class="s1">(decl.body &amp;&amp; decl.body.body) {</span>
              <span class="s1">decl.body.body.forEach(</span><span class="s2">function </span><span class="s1">(moduleBlockNode) {</span>
                <span class="s4">// Export-assignment exports all members in the namespace,</span>
                <span class="s4">// explicitly exported or not.</span>
                <span class="s2">var </span><span class="s1">namespaceDecl = moduleBlockNode.type === </span><span class="s0">'ExportNamedDeclaration' </span><span class="s1">?</span>
                <span class="s1">moduleBlockNode.declaration :</span>
                <span class="s1">moduleBlockNode;</span>

                <span class="s2">if </span><span class="s1">(!namespaceDecl) {</span>
                  <span class="s4">// TypeScript can check this for us; we needn't</span>
                <span class="s1">} </span><span class="s2">else if </span><span class="s1">(namespaceDecl.type === </span><span class="s0">'VariableDeclaration'</span><span class="s1">) {</span>
                  <span class="s1">namespaceDecl.declarations.forEach(</span><span class="s2">function </span><span class="s1">(d) {</span><span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _patternCapture2[</span><span class="s0">'default'</span><span class="s1">])(d.id, </span><span class="s2">function </span><span class="s1">(id) {</span><span class="s2">return </span><span class="s1">_this4.exportMap.namespace.set(</span>
                      <span class="s1">id.name,</span>
                      <span class="s1">(</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(_this4.source, _this4.docStyleParsers, decl, namespaceDecl, moduleBlockNode));});});</span>


                <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                  <span class="s1">_this4.exportMap.namespace.set(</span>
                  <span class="s1">namespaceDecl.id.name,</span>
                  <span class="s1">(</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(_this4.source, _this4.docStyleParsers, moduleBlockNode));</span>
                <span class="s1">}</span>
              <span class="s1">});</span>
            <span class="s1">}</span>
          <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s4">// Export as default</span>
            <span class="s1">_this4.exportMap.namespace.set(</span><span class="s0">'default'</span><span class="s1">, (</span><span class="s3">0</span><span class="s1">, _doc.captureDoc)(_this4.source, _this4.docStyleParsers, decl));</span>
          <span class="s1">}</span>
        <span class="s1">});</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">typeScriptExport;}() }]);</span><span class="s2">return </span><span class="s1">ImportExportVisitorBuilder;}();exports[</span><span class="s0">'default'</span><span class="s1">] = ImportExportVisitorBuilder;</span>
<span class="s4">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leHBvcnRNYXAvdmlzaXRvci5qcyJdLCJuYW1lcyI6WyJtYWtlU291cmNlQ29kZSIsInRleHQiLCJhc3QiLCJTb3VyY2VDb2RlIiwibGVuZ3RoIiwiSW1wb3J0RXhwb3J0VmlzaXRvckJ1aWxkZXIiLCJwYXRoIiwiY29udGV4dCIsImV4cG9ydE1hcCIsIkV4cG9ydE1hcEJ1aWxkZXIiLCJjb250ZW50IiwiaXNFc01vZHVsZUludGVyb3BUcnVlIiwidGh1bmtGb3IiLCJuYW1lc3BhY2UiLCJOYW1lc3BhY2UiLCJyZW1vdGVQYXRoUmVzb2x2ZXIiLCJSZW1vdGVQYXRoIiwic291cmNlIiwiZG9jc3R5bGUiLCJzZXR0aW5ncyIsImRvY1N0eWxlUGFyc2VycyIsImZvckVhY2giLCJzdHlsZSIsImF2YWlsYWJsZURvY1N0eWxlUGFyc2VycyIsImFzdE5vZGUiLCJFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24iLCJleHBvcnRNZXRhIiwiZGVjbGFyYXRpb24iLCJ0eXBlIiwiYWRkIiwic2V0IiwiRXhwb3J0QWxsRGVjbGFyYXRpb24iLCJnZXR0ZXIiLCJleHBvcnRLaW5kIiwiZGVwZW5kZW5jaWVzIiwiZXhwb3J0ZWQiLCJJbXBvcnREZWNsYXJhdGlvbiIsIm5zIiwic3BlY2lmaWVycyIsImZpbmQiLCJzIiwicmF3U2V0IiwibG9jYWwiLCJuYW1lIiwidmFsdWUiLCJFeHBvcnROYW1lZERlY2xhcmF0aW9uIiwiaWQiLCJkZWNsYXJhdGlvbnMiLCJkIiwiVFNFeHBvcnRBc3NpZ25tZW50IiwidHlwZVNjcmlwdEV4cG9ydCIsIlRTTmFtZXNwYWNlRXhwb3J0RGVjbGFyYXRpb24iLCJleHBvcnRlZE5hbWUiLCJleHByZXNzaW9uIiwiZGVjbFR5cGVzIiwiZXhwb3J0ZWREZWNscyIsImJvZHkiLCJmaWx0ZXIiLCJoYXMiLCJkZWNsIiwibW9kdWxlQmxvY2tOb2RlIiwibmFtZXNwYWNlRGVjbCJdLCJtYXBwaW5ncyI6ImduQkFBQSwrQztBQUNBO0FBQ0E7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QTdCLEVBQXdDLHFCQUFXLE9BQUtiLE1BQWhCLEVBQXdCLE9BQUtHLGVBQTdCLEVBQThDdUMsSUFBOUMsQ0FBeEM7QUFDRDtBQUNGLFNBL0JEO0FBZ0NELE8sMkZBbkprQnRELDBCIiwiZmlsZSI6InZpc2l0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgaW5jbHVkZXMgZnJvbSAnYXJyYXktaW5jbHVkZXMnO1xuaW1wb3J0IHsgU291cmNlQ29kZSB9IGZyb20gJ2VzbGludCc7XG5pbXBvcnQgeyBhdmFpbGFibGVEb2NTdHlsZVBhcnNlcnMsIGNhcHR1cmVEb2MgfSBmcm9tICcuL2RvYyc7XG5pbXBvcnQgTmFtZXNwYWNlIGZyb20gJy4vbmFtZXNwYWNlJztcbmltcG9ydCBwcm9jZXNzU3BlY2lmaWVyIGZyb20gJy4vc3BlY2lmaWVyJztcbmltcG9ydCB7IGNhcHR1cmVEZXBlbmRlbmN5LCBjYXB0dXJlRGVwZW5kZW5jeVdpdGhTcGVjaWZpZXJzIH0gZnJvbSAnLi9jYXB0dXJlRGVwZW5kZW5jeSc7XG5pbXBvcnQgcmVjdXJzaXZlUGF0dGVybkNhcHR1cmUgZnJvbSAnLi9wYXR0ZXJuQ2FwdHVyZSc7XG5pbXBvcnQgeyBSZW1vdGVQYXRoIH0gZnJvbSAnLi9yZW1vdGVQYXRoJztcblxuLyoqXG4gKiBzb21ldGltZXMgbGVnYWN5IHN1cHBvcnQgaXNuJ3QgX3RoYXRfIGhhcmQuLi4gcmlnaHQ/XG4gKi9cbmZ1bmN0aW9uIG1ha2VTb3VyY2VDb2RlKHRleHQsIGFzdCkge1xuICBpZiAoU291cmNlQ29kZS5sZW5ndGggPiAxKSB7XG4gICAgLy8gRVNMaW50IDNcbiAgICByZXR1cm4gbmV3IFNvdXJjZUNvZGUodGV4dCwgYXN0KTtcbiAgfSBlbHNlIHtcbiAgICAvLyBFU0xpbnQgNCwgNVxuICAgIHJldHVybiBuZXcgU291cmNlQ29kZSh7IHRleHQsIGFzdCB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbXBvcnRFeHBvcnRWaXNpdG9yQnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHBhdGgsXG4gICAgY29udGV4dCxcbiAgICBleHBvcnRNYXAsXG4gICAgRXhwb3J0TWFwQnVpbGRlcixcbiAgICBjb250ZW50LFxuICAgIGFzdCxcbiAgICBpc0VzTW9kdWxlSW50ZXJvcFRydWUsXG4gICAgdGh1bmtGb3IsXG4gICkge1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgdGhpcy5uYW1lc3BhY2UgPSBuZXcgTmFtZXNwYWNlKHBhdGgsIGNvbnRleHQsIEV4cG9ydE1hcEJ1aWxkZXIpO1xuICAgIHRoaXMucmVtb3RlUGF0aFJlc29sdmVyID0gbmV3IFJlbW90ZVBhdGgocGF0aCwgY29udGV4dCk7XG4gICAgdGhpcy5zb3VyY2UgPSBtYWtlU291cmNlQ29kZShjb250ZW50LCBhc3QpO1xuICAgIHRoaXMuZXhwb3J0TWFwID0gZXhwb3J0TWFwO1xuICAgIHRoaXMuYXN0ID0gYXN0O1xuICAgIHRoaXMuaXNFc01vZHVsZUludGVyb3BUcnVlID0gaXNFc01vZHVsZUludGVyb3BUcnVlO1xuICAgIHRoaXMudGh1bmtGb3IgPSB0aHVua0ZvcjtcbiAgICBjb25zdCBkb2NzdHlsZSA9IHRoaXMuY29udGV4dC5zZXR0aW5ncyAmJiB0aGlzLmNvbnRleHQuc2V0dGluZ3NbJ2ltcG9ydC9kb2NzdHlsZSddIHx8IFsnanNkb2MnXTtcbiAgICB0aGlzLmRvY1N0eWxlUGFyc2VycyA9IHt9O1xuICAgIGRvY3N0eWxlLmZvckVhY2goKHN0eWxlKSA9PiB7XG4gICAgICB0aGlzLmRvY1N0eWxlUGFyc2Vyc1tzdHlsZV0gPSBhdmFpbGFibGVEb2NTdHlsZVBhcnNlcnNbc3R5bGVdO1xuICAgIH0pO1xuICB9XG5cbiAgYnVpbGQoYXN0Tm9kZSkge1xuICAgIHJldHVybiB7XG4gICAgICBFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGV4cG9ydE1ldGEgPSBjYXB0dXJlRG9jKHRoaXMuc291cmNlLCB0aGlzLmRvY1N0eWxlUGFyc2VycywgYXN0Tm9kZSk7XG4gICAgICAgIGlmIChhc3ROb2RlLmRlY2xhcmF0aW9uLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgIHRoaXMubmFtZXNwYWNlLmFkZChleHBvcnRNZXRhLCBhc3ROb2RlLmRlY2xhcmF0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmV4cG9ydE1hcC5uYW1lc3BhY2Uuc2V0KCdkZWZhdWx0JywgZXhwb3J0TWV0YSk7XG4gICAgICB9LFxuICAgICAgRXhwb3J0QWxsRGVjbGFyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGdldHRlciA9IGNhcHR1cmVEZXBlbmRlbmN5KGFzdE5vZGUsIGFzdE5vZGUuZXhwb3J0S2luZCA9PT0gJ3R5cGUnLCB0aGlzLnJlbW90ZVBhdGhSZXNvbHZlciwgdGhpcy5leHBvcnRNYXAsIHRoaXMuY29udGV4dCwgdGhpcy50aHVua0Zvcik7XG4gICAgICAgIGlmIChnZXR0ZXIpIHsgdGhpcy5leHBvcnRNYXAuZGVwZW5kZW5jaWVzLmFkZChnZXR0ZXIpOyB9XG4gICAgICAgIGlmIChhc3ROb2RlLmV4cG9ydGVkKSB7XG4gICAgICAgICAgcHJvY2Vzc1NwZWNpZmllcihhc3ROb2RlLCBhc3ROb2RlLmV4cG9ydGVkLCB0aGlzLmV4cG9ydE1hcCwgdGhpcy5uYW1lc3BhY2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqIGNhcHR1cmUgbmFtZXNwYWNlcyBpbiBjYXNlIG9mIGxhdGVyIGV4cG9ydCAqL1xuICAgICAgSW1wb3J0RGVjbGFyYXRpb24oKSB7XG4gICAgICAgIGNhcHR1cmVEZXBlbmRlbmN5V2l0aFNwZWNpZmllcnMoYXN0Tm9kZSwgdGhpcy5yZW1vdGVQYXRoUmVzb2x2ZXIsIHRoaXMuZXhwb3J0TWFwLCB0aGlzLmNvbnRleHQsIHRoaXMudGh1bmtGb3IpO1xuICAgICAgICBjb25zdCBucyA9IGFzdE5vZGUuc3BlY2lmaWVycy5maW5kKChzKSA9PiBzLnR5cGUgPT09ICdJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXInKTtcbiAgICAgICAgaWYgKG5zKSB7XG4gICAgICAgICAgdGhpcy5uYW1lc3BhY2UucmF3U2V0KG5zLmxvY2FsLm5hbWUsIGFzdE5vZGUuc291cmNlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIEV4cG9ydE5hbWVkRGVjbGFyYXRpb24oKSB7XG4gICAgICAgIGNhcHR1cmVEZXBlbmRlbmN5V2l0aFNwZWNpZmllcnMoYXN0Tm9kZSwgdGhpcy5yZW1vdGVQYXRoUmVzb2x2ZXIsIHRoaXMuZXhwb3J0TWFwLCB0aGlzLmNvbnRleHQsIHRoaXMudGh1bmtGb3IpO1xuICAgICAgICAvLyBjYXB0dXJlIGRlY2xhcmF0aW9uXG4gICAgICAgIGlmIChhc3ROb2RlLmRlY2xhcmF0aW9uICE9IG51bGwpIHtcbiAgICAgICAgICBzd2l0Y2ggKGFzdE5vZGUuZGVjbGFyYXRpb24udHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnRnVuY3Rpb25EZWNsYXJhdGlvbic6XG4gICAgICAgICAgICBjYXNlICdDbGFzc0RlY2xhcmF0aW9uJzpcbiAgICAgICAgICAgIGNhc2UgJ1R5cGVBbGlhcyc6IC8vIGZsb3d0eXBlIHdpdGggYmFiZWwtZXNsaW50IHBhcnNlclxuICAgICAgICAgICAgY2FzZSAnSW50ZXJmYWNlRGVjbGFyYXRpb24nOlxuICAgICAgICAgICAgY2FzZSAnRGVjbGFyZUZ1bmN0aW9uJzpcbiAgICAgICAgICAgIGNhc2UgJ1RTRGVjbGFyZUZ1bmN0aW9uJzpcbiAgICAgICAgICAgIGNhc2UgJ1RTRW51bURlY2xhcmF0aW9uJzpcbiAgICAgICAgICAgIGNhc2UgJ1RTVHlwZUFsaWFzRGVjbGFyYXRpb24nOlxuICAgICAgICAgICAgY2FzZSAnVFNJbnRlcmZhY2VEZWNsYXJhdGlvbic6XG4gICAgICAgICAgICBjYXNlICdUU0Fic3RyYWN0Q2xhc3NEZWNsYXJhdGlvbic6XG4gICAgICAgICAgICBjYXNlICdUU01vZHVsZURlY2xhcmF0aW9uJzpcbiAgICAgICAgICAgICAgdGhpcy5leHBvcnRNYXAubmFtZXNwYWNlLnNldChhc3ROb2RlLmRlY2xhcmF0aW9uLmlkLm5hbWUsIGNhcHR1cmVEb2ModGhpcy5zb3VyY2UsIHRoaXMuZG9jU3R5bGVQYXJzZXJzLCBhc3ROb2RlKSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnVmFyaWFibGVEZWNsYXJhdGlvbic6XG4gICAgICAgICAgICAgIGFzdE5vZGUuZGVjbGFyYXRpb24uZGVjbGFyYXRpb25zLmZvckVhY2goKGQpID0+IHtcbiAgICAgICAgICAgICAgICByZWN1cnNpdmVQYXR0ZXJuQ2FwdHVyZShcbiAgICAgICAgICAgICAgICAgIGQuaWQsXG4gICAgICAgICAgICAgICAgICAoaWQpID0+IHRoaXMuZXhwb3J0TWFwLm5hbWVzcGFjZS5zZXQoaWQubmFtZSwgY2FwdHVyZURvYyh0aGlzLnNvdXJjZSwgdGhpcy5kb2NTdHlsZVBhcnNlcnMsIGQsIGFzdE5vZGUpKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhc3ROb2RlLnNwZWNpZmllcnMuZm9yRWFjaCgocykgPT4gcHJvY2Vzc1NwZWNpZmllcihzLCBhc3ROb2RlLCB0aGlzLmV4cG9ydE1hcCwgdGhpcy5uYW1lc3BhY2UpKTtcbiAgICAgIH0sXG4gICAgICBUU0V4cG9ydEFzc2lnbm1lbnQ6ICgpID0+IHRoaXMudHlwZVNjcmlwdEV4cG9ydChhc3ROb2RlKSxcbiAgICAgIC4uLnRoaXMuaXNFc01vZHVsZUludGVyb3BUcnVlICYmIHsgVFNOYW1lc3BhY2VFeHBvcnREZWNsYXJhdGlvbjogKCkgPT4gdGhpcy50eXBlU2NyaXB0RXhwb3J0KGFzdE5vZGUpIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8vIFRoaXMgZG9lc24ndCBkZWNsYXJlIGFueXRoaW5nLCBidXQgY2hhbmdlcyB3aGF0J3MgYmVpbmcgZXhwb3J0ZWQuXG4gIHR5cGVTY3JpcHRFeHBvcnQoYXN0Tm9kZSkge1xuICAgIGNvbnN0IGV4cG9ydGVkTmFtZSA9IGFzdE5vZGUudHlwZSA9PT0gJ1RTTmFtZXNwYWNlRXhwb3J0RGVjbGFyYXRpb24nXG4gICAgICA/IChhc3ROb2RlLmlkIHx8IGFzdE5vZGUubmFtZSkubmFtZVxuICAgICAgOiBhc3ROb2RlLmV4cHJlc3Npb24gJiYgYXN0Tm9kZS5leHByZXNzaW9uLm5hbWUgfHwgYXN0Tm9kZS5leHByZXNzaW9uLmlkICYmIGFzdE5vZGUuZXhwcmVzc2lvbi5pZC5uYW1lIHx8IG51bGw7XG4gICAgY29uc3QgZGVjbFR5cGVzID0gW1xuICAgICAgJ1ZhcmlhYmxlRGVjbGFyYXRpb24nLFxuICAgICAgJ0NsYXNzRGVjbGFyYXRpb24nLFxuICAgICAgJ1RTRGVjbGFyZUZ1bmN0aW9uJyxcbiAgICAgICdUU0VudW1EZWNsYXJhdGlvbicsXG4gICAgICAnVFNUeXBlQWxpYXNEZWNsYXJhdGlvbicsXG4gICAgICAnVFNJbnRlcmZhY2VEZWNsYXJhdGlvbicsXG4gICAgICAnVFNBYnN0cmFjdENsYXNzRGVjbGFyYXRpb24nLFxuICAgICAgJ1RTTW9kdWxlRGVjbGFyYXRpb24nLFxuICAgIF07XG4gICAgY29uc3QgZXhwb3J0ZWREZWNscyA9IHRoaXMuYXN0LmJvZHkuZmlsdGVyKCh7IHR5cGUsIGlkLCBkZWNsYXJhdGlvbnMgfSkgPT4gaW5jbHVkZXMoZGVjbFR5cGVzLCB0eXBlKSAmJiAoXG4gICAgICBpZCAmJiBpZC5uYW1lID09PSBleHBvcnRlZE5hbWUgfHwgZGVjbGFyYXRpb25zICYmIGRlY2xhcmF0aW9ucy5maW5kKChkKSA9PiBkLmlkLm5hbWUgPT09IGV4cG9ydGVkTmFtZSlcbiAgICApKTtcbiAgICBpZiAoZXhwb3J0ZWREZWNscy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIEV4cG9ydCBpcyBub3QgcmVmZXJlbmNpbmcgYW55IGxvY2FsIGRlY2xhcmF0aW9uLCBtdXN0IGJlIHJlLWV4cG9ydGluZ1xuICAgICAgdGhpcy5leHBvcnRNYXAubmFtZXNwYWNlLnNldCgnZGVmYXVsdCcsIGNhcHR1cmVEb2ModGhpcy5zb3VyY2UsIHRoaXMuZG9jU3R5bGVQYXJzZXJzLCBhc3ROb2RlKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChcbiAgICAgIHRoaXMuaXNFc01vZHVsZUludGVyb3BUcnVlIC8vIGVzTW9kdWxlSW50ZXJvcCBpcyBvbiBpbiB0c2NvbmZpZ1xuICAgICAgJiYgIXRoaXMuZXhwb3J0TWFwLm5hbWVzcGFjZS5oYXMoJ2RlZmF1bHQnKSAvLyBhbmQgZGVmYXVsdCBpc24ndCBhZGRlZCBhbHJlYWR5XG4gICAgKSB7XG4gICAgICB0aGlzLmV4cG9ydE1hcC5uYW1lc3BhY2Uuc2V0KCdkZWZhdWx0Jywge30pOyAvLyBhZGQgZGVmYXVsdCBleHBvcnRcbiAgICB9XG4gICAgZXhwb3J0ZWREZWNscy5mb3JFYWNoKChkZWNsKSA9PiB7XG4gICAgICBpZiAoZGVjbC50eXBlID09PSAnVFNNb2R1bGVEZWNsYXJhdGlvbicpIHtcbiAgICAgICAgaWYgKGRlY2wuYm9keSAmJiBkZWNsLmJvZHkudHlwZSA9PT0gJ1RTTW9kdWxlRGVjbGFyYXRpb24nKSB7XG4gICAgICAgICAgdGhpcy5leHBvcnRNYXAubmFtZXNwYWNlLnNldChkZWNsLmJvZHkuaWQubmFtZSwgY2FwdHVyZURvYyh0aGlzLnNvdXJjZSwgdGhpcy5kb2NTdHlsZVBhcnNlcnMsIGRlY2wuYm9keSkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRlY2wuYm9keSAmJiBkZWNsLmJvZHkuYm9keSkge1xuICAgICAgICAgIGRlY2wuYm9keS5ib2R5LmZvckVhY2goKG1vZHVsZUJsb2NrTm9kZSkgPT4ge1xuICAgICAgICAgICAgLy8gRXhwb3J0LWFzc2lnbm1lbnQgZXhwb3J0cyBhbGwgbWVtYmVycyBpbiB0aGUgbmFtZXNwYWNlLFxuICAgICAgICAgICAgLy8gZXhwbGljaXRseSBleHBvcnRlZCBvciBub3QuXG4gICAgICAgICAgICBjb25zdCBuYW1lc3BhY2VEZWNsID0gbW9kdWxlQmxvY2tOb2RlLnR5cGUgPT09ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJ1xuICAgICAgICAgICAgICA/IG1vZHVsZUJsb2NrTm9kZS5kZWNsYXJhdGlvblxuICAgICAgICAgICAgICA6IG1vZHVsZUJsb2NrTm9kZTtcblxuICAgICAgICAgICAgaWYgKCFuYW1lc3BhY2VEZWNsKSB7XG4gICAgICAgICAgICAgIC8vIFR5cGVTY3JpcHQgY2FuIGNoZWNrIHRoaXMgZm9yIHVzOyB3ZSBuZWVkbid0XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWVzcGFjZURlY2wudHlwZSA9PT0gJ1ZhcmlhYmxlRGVjbGFyYXRpb24nKSB7XG4gICAgICAgICAgICAgIG5hbWVzcGFjZURlY2wuZGVjbGFyYXRpb25zLmZvckVhY2goKGQpID0+IHJlY3Vyc2l2ZVBhdHRlcm5DYXB0dXJlKGQuaWQsIChpZCkgPT4gdGhpcy5leHBvcnRNYXAubmFtZXNwYWNlLnNldChcbiAgICAgICAgICAgICAgICBpZC5uYW1lLFxuICAgICAgICAgICAgICAgIGNhcHR1cmVEb2ModGhpcy5zb3VyY2UsIHRoaXMuZG9jU3R5bGVQYXJzZXJzLCBkZWNsLCBuYW1lc3BhY2VEZWNsLCBtb2R1bGVCbG9ja05vZGUpLFxuICAgICAgICAgICAgICApKSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZXhwb3J0TWFwLm5hbWVzcGFjZS5zZXQoXG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlRGVjbC5pZC5uYW1lLFxuICAgICAgICAgICAgICAgIGNhcHR1cmVEb2ModGhpcy5zb3VyY2UsIHRoaXMuZG9jU3R5bGVQYXJzZXJzLCBtb2R1bGVCbG9ja05vZGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXhwb3J0IGFzIGRlZmF1bHRcbiAgICAgICAgdGhpcy5leHBvcnRNYXAubmFtZXNwYWNlLnNldCgnZGVmYXVsdCcsIGNhcHR1cmVEb2ModGhpcy5zb3VyY2UsIHRoaXMuZG9jU3R5bGVQYXJzZXJzLCBkZWNsKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==</span></pre>
</body>
</html>