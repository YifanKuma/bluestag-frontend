<html>
<head>
<title>get-metadata-route.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
get-metadata-route.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s3">0 </span><span class="s1">&amp;&amp; (module.exports = {</span>
    <span class="s1">fillMetadataSegment: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s1">normalizeMetadataPageToRoute: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s1">normalizeMetadataRoute: </span><span class="s2">null</span>
<span class="s1">});</span>
<span class="s2">function </span><span class="s1">_export(target, all) {</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">name </span><span class="s2">in </span><span class="s1">all)Object.defineProperty(target, name, {</span>
        <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
        <span class="s1">get: all[name]</span>
    <span class="s1">});</span>
<span class="s1">}</span>
<span class="s1">_export(exports, {</span>
    <span class="s1">fillMetadataSegment: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">fillMetadataSegment;</span>
    <span class="s1">},</span>
    <span class="s1">normalizeMetadataPageToRoute: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">normalizeMetadataPageToRoute;</span>
    <span class="s1">},</span>
    <span class="s1">normalizeMetadataRoute: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">normalizeMetadataRoute;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_ismetadataroute = require(</span><span class="s0">&quot;./is-metadata-route&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_path = </span><span class="s4">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;../../shared/lib/isomorphic/path&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_serverutils = require(</span><span class="s0">&quot;../../server/server-utils&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_routeregex = require(</span><span class="s0">&quot;../../shared/lib/router/utils/route-regex&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_hash = require(</span><span class="s0">&quot;../../shared/lib/hash&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_apppaths = require(</span><span class="s0">&quot;../../shared/lib/router/utils/app-paths&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_normalizepathsep = require(</span><span class="s0">&quot;../../shared/lib/page-path/normalize-path-sep&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_segment = require(</span><span class="s0">&quot;../../shared/lib/segment&quot;</span><span class="s1">);</span>
<span class="s2">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s2">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s4">/* 
 * If there's special convention like (...) or @ in the page path, 
 * Give it a unique hash suffix to avoid conflicts 
 * 
 * e.g. 
 * /opengraph-image -&gt; /opengraph-image 
 * /(post)/opengraph-image.tsx -&gt; /opengraph-image-[0-9a-z]{6} 
 * 
 * Sitemap is an exception, it should not have a suffix. 
 * Each sitemap contains all the urls of sub routes, we don't have the case of duplicates `/(group)/sitemap.[ext]` and `/sitemap.[ext]` since they should be the same. 
 * Hence we always normalize the urls for sitemap and do not append hash suffix, and ensure user-land only contains one sitemap per pathname. 
 * 
 * /sitemap -&gt; /sitemap 
 * /(post)/sitemap -&gt; /sitemap 
 */ </span><span class="s2">function </span><span class="s1">getMetadataRouteSuffix(page) {</span>
    <span class="s4">// Remove the last segment and get the parent pathname</span>
    <span class="s4">// e.g. /parent/a/b/c -&gt; /parent/a/b</span>
    <span class="s4">// e.g. /parent/opengraph-image -&gt; /parent</span>
    <span class="s2">const </span><span class="s1">parentPathname = _path.default.dirname(page);</span>
    <span class="s4">// Only apply suffix to metadata routes except for sitemaps</span>
    <span class="s2">if </span><span class="s1">(page.endsWith(</span><span class="s0">'/sitemap'</span><span class="s1">)) {</span>
        <span class="s2">return </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s4">// Calculate the hash suffix based on the parent path</span>
    <span class="s2">let </span><span class="s1">suffix = </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s4">// Check if there's any special characters in the parent pathname.</span>
    <span class="s2">const </span><span class="s1">segments = parentPathname.split(</span><span class="s0">'/'</span><span class="s1">);</span>
    <span class="s2">if </span><span class="s1">(segments.some((seg)=&gt;(</span><span class="s3">0</span><span class="s1">, _segment.isGroupSegment)(seg) || (</span><span class="s3">0</span><span class="s1">, _segment.isParallelRouteSegment)(seg))) {</span>
        <span class="s4">// Hash the parent path to get a unique suffix</span>
        <span class="s1">suffix = (</span><span class="s3">0</span><span class="s1">, _hash.djb2Hash)(parentPathname).toString(</span><span class="s3">36</span><span class="s1">).slice(</span><span class="s3">0</span><span class="s1">, </span><span class="s3">6</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">suffix;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">fillMetadataSegment(segment, params, lastSegment) {</span>
    <span class="s2">const </span><span class="s1">pathname = (</span><span class="s3">0</span><span class="s1">, _apppaths.normalizeAppPath)(segment);</span>
    <span class="s2">const </span><span class="s1">routeRegex = (</span><span class="s3">0</span><span class="s1">, _routeregex.getNamedRouteRegex)(pathname, {</span>
        <span class="s1">prefixRouteKeys: </span><span class="s2">false</span>
    <span class="s1">});</span>
    <span class="s2">const </span><span class="s1">route = (</span><span class="s3">0</span><span class="s1">, _serverutils.interpolateDynamicPath)(pathname, params, routeRegex);</span>
    <span class="s2">const </span><span class="s1">{ name, ext } = _path.default.parse(lastSegment);</span>
    <span class="s2">const </span><span class="s1">pagePath = _path.default.posix.join(segment, name);</span>
    <span class="s2">const </span><span class="s1">suffix = getMetadataRouteSuffix(pagePath);</span>
    <span class="s2">const </span><span class="s1">routeSuffix = suffix ? </span><span class="s0">`-</span><span class="s1">${suffix}</span><span class="s0">` </span><span class="s1">: </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s2">return </span><span class="s1">(</span><span class="s3">0</span><span class="s1">, _normalizepathsep.normalizePathSep)(_path.default.join(route, </span><span class="s0">`</span><span class="s1">${name}${routeSuffix}${ext}</span><span class="s0">`</span><span class="s1">));</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">normalizeMetadataRoute(page) {</span>
    <span class="s2">if </span><span class="s1">(!(</span><span class="s3">0</span><span class="s1">, _ismetadataroute.isMetadataPage)(page)) {</span>
        <span class="s2">return </span><span class="s1">page;</span>
    <span class="s1">}</span>
    <span class="s2">let </span><span class="s1">route = page;</span>
    <span class="s2">let </span><span class="s1">suffix = </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(page === </span><span class="s0">'/robots'</span><span class="s1">) {</span>
        <span class="s1">route += </span><span class="s0">'.txt'</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(page === </span><span class="s0">'/manifest'</span><span class="s1">) {</span>
        <span class="s1">route += </span><span class="s0">'.webmanifest'</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">suffix = getMetadataRouteSuffix(page);</span>
    <span class="s1">}</span>
    <span class="s4">// Support both /&lt;metadata-route.ext&gt; and custom routes /&lt;metadata-route&gt;/route.ts.</span>
    <span class="s4">// If it's a metadata file route, we need to append /[id]/route to the page.</span>
    <span class="s2">if </span><span class="s1">(!route.endsWith(</span><span class="s0">'/route'</span><span class="s1">)) {</span>
        <span class="s2">const </span><span class="s1">{ dir, name: baseName, ext } = _path.default.parse(route);</span>
        <span class="s1">route = _path.default.posix.join(dir, </span><span class="s0">`</span><span class="s1">${baseName}${suffix ? </span><span class="s0">`-</span><span class="s1">${suffix}</span><span class="s0">` </span><span class="s1">: </span><span class="s0">''</span><span class="s1">}${ext}</span><span class="s0">`</span><span class="s1">, </span><span class="s0">'route'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">route;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">normalizeMetadataPageToRoute(page, isDynamic) {</span>
    <span class="s2">const </span><span class="s1">isRoute = page.endsWith(</span><span class="s0">'/route'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">routePagePath = isRoute ? page.slice(</span><span class="s3">0</span><span class="s1">, -</span><span class="s0">'/route'</span><span class="s1">.length) : page;</span>
    <span class="s2">const </span><span class="s1">metadataRouteExtension = routePagePath.endsWith(</span><span class="s0">'/sitemap'</span><span class="s1">) ? </span><span class="s0">'.xml' </span><span class="s1">: </span><span class="s0">''</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">mapped = isDynamic ? </span><span class="s0">`</span><span class="s1">${routePagePath}</span><span class="s0">/[__metadata_id__]` </span><span class="s1">: </span><span class="s0">`</span><span class="s1">${routePagePath}${metadataRouteExtension}</span><span class="s0">`</span><span class="s1">;</span>
    <span class="s2">return </span><span class="s1">mapped + (isRoute ? </span><span class="s0">'/route' </span><span class="s1">: </span><span class="s0">''</span><span class="s1">);</span>
<span class="s1">}</span>

<span class="s4">//# sourceMappingURL=get-metadata-route.js.map</span></pre>
</body>
</html>