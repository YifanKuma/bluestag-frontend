<html>
<head>
<title>rename.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
rename.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/lib/fs/rename.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;/*</span><span class="s3">\n</span><span class="s1">MIT License</span><span class="s3">\n\n</span><span class="s1">Copyright (c) 2015 - present Microsoft Corporation</span><span class="s3">\n\n</span><span class="s1">Permission is hereby granted, free of charge, to any person obtaining a copy</span><span class="s3">\n</span><span class="s1">of this software and associated documentation files (the </span><span class="s3">\&quot;</span><span class="s1">Software</span><span class="s3">\&quot;</span><span class="s1">), to deal</span><span class="s3">\n</span><span class="s1">in the Software without restriction, including without limitation the rights</span><span class="s3">\n</span><span class="s1">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><span class="s3">\n</span><span class="s1">copies of the Software, and to permit persons to whom the Software is</span><span class="s3">\n</span><span class="s1">furnished to do so, subject to the following conditions:</span><span class="s3">\n\n</span><span class="s1">The above copyright notice and this permission notice shall be included in all</span><span class="s3">\n</span><span class="s1">copies or substantial portions of the Software.</span><span class="s3">\n\n</span><span class="s1">THE SOFTWARE IS PROVIDED </span><span class="s3">\&quot;</span><span class="s1">AS IS</span><span class="s3">\&quot;</span><span class="s1">, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><span class="s3">\n</span><span class="s1">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><span class="s3">\n</span><span class="s1">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><span class="s3">\n</span><span class="s1">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><span class="s3">\n</span><span class="s1">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><span class="s3">\n</span><span class="s1">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span><span class="s3">\n</span><span class="s1">SOFTWARE.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n\n</span><span class="s1">// This file is based on https://github.com/microsoft/vscode/blob/f860fcf11022f10a992440fd54c6e45674e39617/src/vs/base/node/pfs.ts</span><span class="s3">\n</span><span class="s1">// See the LICENSE at the top of the file</span><span class="s3">\n\n</span><span class="s1">import { rename as fsRename, stat } from 'node:fs/promises'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* A drop-in replacement for `fs.rename` that:</span><span class="s3">\n </span><span class="s1">* - allows to move across multiple disks</span><span class="s3">\n </span><span class="s1">* - attempts to retry the operation for certain error codes on Windows</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export async function rename(</span><span class="s3">\n  </span><span class="s1">source: string,</span><span class="s3">\n  </span><span class="s1">target: string,</span><span class="s3">\n  </span><span class="s1">windowsRetryTimeout: number | false = 60000 /* matches graceful-fs */</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">if (source === target) {</span><span class="s3">\n    </span><span class="s1">return // simulate node.js behaviour here and do a no-op if paths match</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (process.platform === 'win32' &amp;&amp; typeof windowsRetryTimeout === 'number') {</span><span class="s3">\n    </span><span class="s1">// On Windows, a rename can fail when either source or target</span><span class="s3">\n    </span><span class="s1">// is locked by AV software. We do leverage graceful-fs to iron</span><span class="s3">\n    </span><span class="s1">// out these issues, however in case the target file exists,</span><span class="s3">\n    </span><span class="s1">// graceful-fs will immediately return without retry for fs.rename().</span><span class="s3">\n    </span><span class="s1">await renameWithRetry(source, target, Date.now(), windowsRetryTimeout)</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">await fsRename(source, target)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">async function renameWithRetry(</span><span class="s3">\n  </span><span class="s1">source: string,</span><span class="s3">\n  </span><span class="s1">target: string,</span><span class="s3">\n  </span><span class="s1">startTime: number,</span><span class="s3">\n  </span><span class="s1">retryTimeout: number,</span><span class="s3">\n  </span><span class="s1">attempt = 0</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">return await fsRename(source, target)</span><span class="s3">\n  </span><span class="s1">} catch (error: any) {</span><span class="s3">\n    </span><span class="s1">if (</span><span class="s3">\n      </span><span class="s1">error.code !== 'EACCES' &amp;&amp;</span><span class="s3">\n      </span><span class="s1">error.code !== 'EPERM' &amp;&amp;</span><span class="s3">\n      </span><span class="s1">error.code !== 'EBUSY'</span><span class="s3">\n    </span><span class="s1">) {</span><span class="s3">\n      </span><span class="s1">throw error // only for errors we think are temporary</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (Date.now() - startTime &gt;= retryTimeout) {</span><span class="s3">\n      </span><span class="s1">console.error(</span><span class="s3">\n        </span><span class="s1">`[node.js fs] rename failed after ${attempt} retries with error: ${error}`</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n\n      </span><span class="s1">throw error // give up after configurable timeout</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (attempt === 0) {</span><span class="s3">\n      </span><span class="s1">let abortRetry = false</span><span class="s3">\n      </span><span class="s1">try {</span><span class="s3">\n        </span><span class="s1">const statTarget = await stat(target)</span><span class="s3">\n        </span><span class="s1">if (!statTarget.isFile()) {</span><span class="s3">\n          </span><span class="s1">abortRetry = true // if target is not a file, EPERM error may be raised and we should not attempt to retry</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} catch (e) {</span><span class="s3">\n        </span><span class="s1">// Ignore</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">if (abortRetry) {</span><span class="s3">\n        </span><span class="s1">throw error</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">// Delay with incremental backoff up to 100ms</span><span class="s3">\n    </span><span class="s1">await timeout(Math.min(100, attempt * 10))</span><span class="s3">\n\n    </span><span class="s1">// Attempt again</span><span class="s3">\n    </span><span class="s1">return renameWithRetry(source, target, startTime, retryTimeout, attempt + 1)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const timeout = (millis: number) =&gt;</span><span class="s3">\n  </span><span class="s1">new Promise((resolve) =&gt; setTimeout(resolve, millis))</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;rename&quot;</span><span class="s0">,</span><span class="s1">&quot;source&quot;</span><span class="s0">,</span><span class="s1">&quot;target&quot;</span><span class="s0">,</span><span class="s1">&quot;windowsRetryTimeout&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;platform&quot;</span><span class="s0">,</span><span class="s1">&quot;renameWithRetry&quot;</span><span class="s0">,</span><span class="s1">&quot;Date&quot;</span><span class="s0">,</span><span class="s1">&quot;now&quot;</span><span class="s0">,</span><span class="s1">&quot;fsRename&quot;</span><span class="s0">,</span><span class="s1">&quot;startTime&quot;</span><span class="s0">,</span><span class="s1">&quot;retryTimeout&quot;</span><span class="s0">,</span><span class="s1">&quot;attempt&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;code&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;abortRetry&quot;</span><span class="s0">,</span><span class="s1">&quot;statTarget&quot;</span><span class="s0">,</span><span class="s1">&quot;stat&quot;</span><span class="s0">,</span><span class="s1">&quot;isFile&quot;</span><span class="s0">,</span><span class="s1">&quot;e&quot;</span><span class="s0">,</span><span class="s1">&quot;timeout&quot;</span><span class="s0">,</span><span class="s1">&quot;Math&quot;</span><span class="s0">,</span><span class="s1">&quot;min&quot;</span><span class="s0">,</span><span class="s1">&quot;millis&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;setTimeout&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;AAAA;;;;;;;;;;;;;;;;;;;;;;CAsBC,GAED,kIAAkI;AAClI,yCAAyC;;;;;+BASnBA;;;eAAAA;;;0BAPmB;AAOlC,eAAeA,OACpBC,MAAc,EACdC,MAAc,EACdC,sBAAsC,MAAM,uBAAuB,GAAxB;IAE3C,IAAIF,WAAWC,QAAQ;QACrB,QAAO,gEAAgE;IACzE;IAEA,IAAIE,QAAQC,QAAQ,KAAK,WAAW,OAAOF,wBAAwB,UAAU;QAC3E,6DAA6D;QAC7D,+DAA+D;QAC/D,4DAA4D;QAC5D,qEAAqE;QACrE,MAAMG,gBAAgBL,QAAQC,QAAQK,KAAKC,GAAG,IAAIL;IACpD,OAAO;QACL,MAAMM,IAAAA,gBAAQ,EAACR,QAAQC;IACzB;AACF;AAEA,eAAeI,gBACbL,MAAc,EACdC,MAAc,EACdQ,SAAiB,EACjBC,YAAoB,EACpBC,UAAU,CAAC;IAEX,IAAI;QACF,OAAO,MAAMH,IAAAA,gBAAQ,EAACR,QAAQC;IAChC,EAAE,OAAOW,OAAY;QACnB,IACEA,MAAMC,IAAI,KAAK,YACfD,MAAMC,IAAI,KAAK,WACfD,MAAMC,IAAI,KAAK,SACf;YACA,MAAMD,MAAM,yCAAyC;;QACvD;QAEA,IAAIN,KAAKC,GAAG,KAAKE,aAAaC,cAAc;YAC1CI,QAAQF,KAAK,CACX,CAAC,iCAAiC,EAAED,QAAQ,qBAAqB,EAAEC,OAAO;YAG5E,MAAMA,MAAM,qCAAqC;;QACnD;QAEA,IAAID,YAAY,GAAG;YACjB,IAAII,aAAa;YACjB,IAAI;gBACF,MAAMC,aAAa,MAAMC,IAAAA,cAAI,EAAChB;gBAC9B,IAAI,CAACe,WAAWE,MAAM,IAAI;oBACxBH,aAAa,KAAK,wFAAwF;;gBAC5G;YACF,EAAE,OAAOI,GAAG;YACV,SAAS;YACX;YAEA,IAAIJ,YAAY;gBACd,MAAMH;YACR;QACF;QAEA,6CAA6C;QAC7C,MAAMQ,QAAQC,KAAKC,GAAG,CAAC,KAAKX,UAAU;QAEtC,gBAAgB;QAChB,OAAON,gBAAgBL,QAAQC,QAAQQ,WAAWC,cAAcC,UAAU;IAC5E;AACF;AAEA,MAAMS,UAAU,CAACG,SACf,IAAIC,QAAQ,CAACC,UAAYC,WAAWD,SAASF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>