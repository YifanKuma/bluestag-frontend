<html>
<head>
<title>crypto-utils.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
crypto-utils.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/server/crypto-utils.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import crypto from 'crypto'</span><span class="s3">\n\n</span><span class="s1">// Background:</span><span class="s3">\n</span><span class="s1">// https://security.stackexchange.com/questions/184305/why-would-i-ever-use-aes-256-cbc-if-aes-256-gcm-is-more-secure</span><span class="s3">\n\n</span><span class="s1">const CIPHER_ALGORITHM = `aes-256-gcm`,</span><span class="s3">\n  </span><span class="s1">CIPHER_KEY_LENGTH = 32, // https://stackoverflow.com/a/28307668/4397028</span><span class="s3">\n  </span><span class="s1">CIPHER_IV_LENGTH = 16, // https://stackoverflow.com/a/28307668/4397028</span><span class="s3">\n  </span><span class="s1">CIPHER_TAG_LENGTH = 16,</span><span class="s3">\n  </span><span class="s1">CIPHER_SALT_LENGTH = 64</span><span class="s3">\n\n</span><span class="s1">const PBKDF2_ITERATIONS = 100_000 // https://support.1password.com/pbkdf2/</span><span class="s3">\n\n</span><span class="s1">export function encryptWithSecret(secret: Buffer, data: string): string {</span><span class="s3">\n  </span><span class="s1">const iv = crypto.randomBytes(CIPHER_IV_LENGTH)</span><span class="s3">\n  </span><span class="s1">const salt = crypto.randomBytes(CIPHER_SALT_LENGTH)</span><span class="s3">\n\n  </span><span class="s1">// https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest</span><span class="s3">\n  </span><span class="s1">const key = crypto.pbkdf2Sync(</span><span class="s3">\n    </span><span class="s1">secret,</span><span class="s3">\n    </span><span class="s1">salt,</span><span class="s3">\n    </span><span class="s1">PBKDF2_ITERATIONS,</span><span class="s3">\n    </span><span class="s1">CIPHER_KEY_LENGTH,</span><span class="s3">\n    </span><span class="s1">`sha512`</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const cipher = crypto.createCipheriv(CIPHER_ALGORITHM, key, iv)</span><span class="s3">\n  </span><span class="s1">const encrypted = Buffer.concat([cipher.update(data, `utf8`), cipher.final()])</span><span class="s3">\n\n  </span><span class="s1">// https://nodejs.org/api/crypto.html#crypto_cipher_getauthtag</span><span class="s3">\n  </span><span class="s1">const tag = cipher.getAuthTag()</span><span class="s3">\n\n  </span><span class="s1">return Buffer.concat([</span><span class="s3">\n    </span><span class="s1">// Data as required by:</span><span class="s3">\n    </span><span class="s1">// Salt for Key: https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest</span><span class="s3">\n    </span><span class="s1">// IV: https://nodejs.org/api/crypto.html#crypto_class_decipher</span><span class="s3">\n    </span><span class="s1">// Tag: https://nodejs.org/api/crypto.html#crypto_decipher_setauthtag_buffer</span><span class="s3">\n    </span><span class="s1">salt,</span><span class="s3">\n    </span><span class="s1">iv,</span><span class="s3">\n    </span><span class="s1">tag,</span><span class="s3">\n    </span><span class="s1">encrypted,</span><span class="s3">\n  </span><span class="s1">]).toString(`hex`)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function decryptWithSecret(</span><span class="s3">\n  </span><span class="s1">secret: Buffer,</span><span class="s3">\n  </span><span class="s1">encryptedData: string</span><span class="s3">\n</span><span class="s1">): string {</span><span class="s3">\n  </span><span class="s1">const buffer = Buffer.from(encryptedData, `hex`)</span><span class="s3">\n\n  </span><span class="s1">const salt = buffer.slice(0, CIPHER_SALT_LENGTH)</span><span class="s3">\n  </span><span class="s1">const iv = buffer.slice(</span><span class="s3">\n    </span><span class="s1">CIPHER_SALT_LENGTH,</span><span class="s3">\n    </span><span class="s1">CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">const tag = buffer.slice(</span><span class="s3">\n    </span><span class="s1">CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH,</span><span class="s3">\n    </span><span class="s1">CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH + CIPHER_TAG_LENGTH</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">const encrypted = buffer.slice(</span><span class="s3">\n    </span><span class="s1">CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH + CIPHER_TAG_LENGTH</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">// https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest</span><span class="s3">\n  </span><span class="s1">const key = crypto.pbkdf2Sync(</span><span class="s3">\n    </span><span class="s1">secret,</span><span class="s3">\n    </span><span class="s1">salt,</span><span class="s3">\n    </span><span class="s1">PBKDF2_ITERATIONS,</span><span class="s3">\n    </span><span class="s1">CIPHER_KEY_LENGTH,</span><span class="s3">\n    </span><span class="s1">`sha512`</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">const decipher = crypto.createDecipheriv(CIPHER_ALGORITHM, key, iv)</span><span class="s3">\n  </span><span class="s1">decipher.setAuthTag(tag)</span><span class="s3">\n\n  </span><span class="s1">return decipher.update(encrypted) + decipher.final(`utf8`)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;decryptWithSecret&quot;</span><span class="s0">,</span><span class="s1">&quot;encryptWithSecret&quot;</span><span class="s0">,</span><span class="s1">&quot;CIPHER_ALGORITHM&quot;</span><span class="s0">,</span><span class="s1">&quot;CIPHER_KEY_LENGTH&quot;</span><span class="s0">,</span><span class="s1">&quot;CIPHER_IV_LENGTH&quot;</span><span class="s0">,</span><span class="s1">&quot;CIPHER_TAG_LENGTH&quot;</span><span class="s0">,</span><span class="s1">&quot;CIPHER_SALT_LENGTH&quot;</span><span class="s0">,</span><span class="s1">&quot;PBKDF2_ITERATIONS&quot;</span><span class="s0">,</span><span class="s1">&quot;secret&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;iv&quot;</span><span class="s0">,</span><span class="s1">&quot;crypto&quot;</span><span class="s0">,</span><span class="s1">&quot;randomBytes&quot;</span><span class="s0">,</span><span class="s1">&quot;salt&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;pbkdf2Sync&quot;</span><span class="s0">,</span><span class="s1">&quot;cipher&quot;</span><span class="s0">,</span><span class="s1">&quot;createCipheriv&quot;</span><span class="s0">,</span><span class="s1">&quot;encrypted&quot;</span><span class="s0">,</span><span class="s1">&quot;Buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;concat&quot;</span><span class="s0">,</span><span class="s1">&quot;update&quot;</span><span class="s0">,</span><span class="s1">&quot;final&quot;</span><span class="s0">,</span><span class="s1">&quot;tag&quot;</span><span class="s0">,</span><span class="s1">&quot;getAuthTag&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;encryptedData&quot;</span><span class="s0">,</span><span class="s1">&quot;buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;slice&quot;</span><span class="s0">,</span><span class="s1">&quot;decipher&quot;</span><span class="s0">,</span><span class="s1">&quot;createDecipheriv&quot;</span><span class="s0">,</span><span class="s1">&quot;setAuthTag&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;IA4CgBA,iBAAiB;eAAjBA;;IA/BAC,iBAAiB;eAAjBA;;;+DAbG;;;;;;AAEnB,cAAc;AACd,qHAAqH;AAErH,MAAMC,mBAAmB,CAAC,WAAW,CAAC,EACpCC,oBAAoB,IACpBC,mBAAmB,IACnBC,oBAAoB,IACpBC,qBAAqB;AAEvB,MAAMC,oBAAoB,OAAQ,wCAAwC;;AAEnE,SAASN,kBAAkBO,MAAc,EAAEC,IAAY;IAC5D,MAAMC,KAAKC,eAAM,CAACC,WAAW,CAACR;IAC9B,MAAMS,OAAOF,eAAM,CAACC,WAAW,CAACN;IAEhC,qGAAqG;IACrG,MAAMQ,MAAMH,eAAM,CAACI,UAAU,CAC3BP,QACAK,MACAN,mBACAJ,mBACA,CAAC,MAAM,CAAC;IAGV,MAAMa,SAASL,eAAM,CAACM,cAAc,CAACf,kBAAkBY,KAAKJ;IAC5D,MAAMQ,YAAYC,OAAOC,MAAM,CAAC;QAACJ,OAAOK,MAAM,CAACZ,MAAM,CAAC,IAAI,CAAC;QAAGO,OAAOM,KAAK;KAAG;IAE7E,8DAA8D;IAC9D,MAAMC,MAAMP,OAAOQ,UAAU;IAE7B,OAAOL,OAAOC,MAAM,CAAC;QACnB,uBAAuB;QACvB,mHAAmH;QACnH,+DAA+D;QAC/D,4EAA4E;QAC5EP;QACAH;QACAa;QACAL;KACD,EAAEO,QAAQ,CAAC,CAAC,GAAG,CAAC;AACnB;AAEO,SAASzB,kBACdQ,MAAc,EACdkB,aAAqB;IAErB,MAAMC,SAASR,OAAOS,IAAI,CAACF,eAAe,CAAC,GAAG,CAAC;IAE/C,MAAMb,OAAOc,OAAOE,KAAK,CAAC,GAAGvB;IAC7B,MAAMI,KAAKiB,OAAOE,KAAK,CACrBvB,oBACAA,qBAAqBF;IAEvB,MAAMmB,MAAMI,OAAOE,KAAK,CACtBvB,qBAAqBF,kBACrBE,qBAAqBF,mBAAmBC;IAE1C,MAAMa,YAAYS,OAAOE,KAAK,CAC5BvB,qBAAqBF,mBAAmBC;IAG1C,qGAAqG;IACrG,MAAMS,MAAMH,eAAM,CAACI,UAAU,CAC3BP,QACAK,MACAN,mBACAJ,mBACA,CAAC,MAAM,CAAC;IAGV,MAAM2B,WAAWnB,eAAM,CAACoB,gBAAgB,CAAC7B,kBAAkBY,KAAKJ;IAChEoB,SAASE,UAAU,CAACT;IAEpB,OAAOO,SAAST,MAAM,CAACH,aAAaY,SAASR,KAAK,CAAC,CAAC,IAAI,CAAC;AAC3D&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>