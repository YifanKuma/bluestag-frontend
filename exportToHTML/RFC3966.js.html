<html>
<head>
<title>RFC3966.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #264eff;}
.s6 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RFC3966.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">isViablePhoneNumber from </span><span class="s2">'./isViablePhoneNumber.js'</span>

<span class="s3">// https://www.ietf.org/rfc/rfc3966.txt</span>

<span class="s3">/**</span>
 <span class="s3">* </span><span class="s4">@param  </span><span class="s3">{string} text - Phone URI (RFC 3966).</span>
 <span class="s3">* </span><span class="s4">@return </span><span class="s3">{object} `{ ?number, ?ext }`.</span>
 <span class="s3">*/</span>
<span class="s0">export function </span><span class="s1">parseRFC3966(text) {</span>
	<span class="s0">let </span><span class="s1">number</span>
	<span class="s0">let </span><span class="s1">ext</span>

	<span class="s3">// Replace &quot;tel:&quot; with &quot;tel=&quot; for parsing convenience.</span>
	<span class="s1">text = text.replace(</span><span class="s5">/^tel:/</span><span class="s1">, </span><span class="s2">'tel='</span><span class="s1">)</span>

	<span class="s0">for </span><span class="s1">(</span><span class="s0">const </span><span class="s1">part of text.split(</span><span class="s2">';'</span><span class="s1">)) {</span>
		<span class="s0">const </span><span class="s1">[name, value] = part.split(</span><span class="s2">'='</span><span class="s1">)</span>
		<span class="s0">switch </span><span class="s1">(name) {</span>
			<span class="s0">case </span><span class="s2">'tel'</span><span class="s1">:</span>
				<span class="s1">number = value</span>
				<span class="s0">break</span>
			<span class="s0">case </span><span class="s2">'ext'</span><span class="s1">:</span>
				<span class="s1">ext = value</span>
				<span class="s0">break</span>
			<span class="s0">case </span><span class="s2">'phone-context'</span><span class="s1">:</span>
				<span class="s3">// Only &quot;country contexts&quot; are supported.</span>
				<span class="s3">// &quot;Domain contexts&quot; are ignored.</span>
				<span class="s0">if </span><span class="s1">(value[</span><span class="s6">0</span><span class="s1">] === </span><span class="s2">'+'</span><span class="s1">) {</span>
					<span class="s1">number = value + number</span>
				<span class="s1">}</span>
				<span class="s0">break</span>
		<span class="s1">}</span>
	<span class="s1">}</span>

	<span class="s3">// If the phone number is not viable, then abort.</span>
	<span class="s0">if </span><span class="s1">(!isViablePhoneNumber(number)) {</span>
		<span class="s0">return </span><span class="s1">{}</span>
	<span class="s1">}</span>

	<span class="s0">const </span><span class="s1">result = { number }</span>
	<span class="s0">if </span><span class="s1">(ext) {</span>
		<span class="s1">result.ext = ext</span>
	<span class="s1">}</span>
	<span class="s0">return </span><span class="s1">result</span>
<span class="s1">}</span>

<span class="s3">/**</span>
 <span class="s3">* </span><span class="s4">@param  </span><span class="s3">{object} - `{ ?number, ?extension }`.</span>
 <span class="s3">* </span><span class="s4">@return </span><span class="s3">{string} Phone URI (RFC 3966).</span>
 <span class="s3">*/</span>
<span class="s0">export function </span><span class="s1">formatRFC3966({ number, ext }) {</span>
	<span class="s0">if </span><span class="s1">(!number) {</span>
		<span class="s0">return </span><span class="s2">''</span>
	<span class="s1">}</span>
	<span class="s0">if </span><span class="s1">(number[</span><span class="s6">0</span><span class="s1">] !== </span><span class="s2">'+'</span><span class="s1">) {</span>
		<span class="s0">throw new </span><span class="s1">Error(</span><span class="s2">`&quot;formatRFC3966()&quot; expects &quot;number&quot; to be in E.164 format.`</span><span class="s1">)</span>
	<span class="s1">}</span>
	<span class="s0">return </span><span class="s2">`tel:</span><span class="s1">${number}${ext ? </span><span class="s2">';ext=' </span><span class="s1">+ ext : </span><span class="s2">''</span><span class="s1">}</span><span class="s2">`</span>
<span class="s1">}</span></pre>
</body>
</html>