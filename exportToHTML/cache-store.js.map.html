<html>
<head>
<title>cache-store.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
cache-store.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/server/resume-data-cache/cache-store.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import {</span><span class="s3">\n  </span><span class="s1">arrayBufferToString,</span><span class="s3">\n  </span><span class="s1">stringToUint8Array,</span><span class="s3">\n</span><span class="s1">} from '../app-render/encryption-utils'</span><span class="s3">\n</span><span class="s1">import type { CacheEntry } from '../lib/cache-handlers/types'</span><span class="s3">\n</span><span class="s1">import type { CachedFetchValue } from '../response-cache/types'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* A generic cache store type that provides a subset of Map functionality</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">type CacheStore&lt;T&gt; = Pick&lt;</span><span class="s3">\n  </span><span class="s1">Map&lt;string, T&gt;,</span><span class="s3">\n  </span><span class="s1">'entries' | 'keys' | 'size' | 'get' | 'set'</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* A cache store specifically for fetch cache values</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type FetchCacheStore = CacheStore&lt;CachedFetchValue&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* A cache store for encrypted bound args of inline server functions.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type EncryptedBoundArgsCacheStore = CacheStore&lt;string&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* An in-memory-only cache store for decrypted bound args of inline server</span><span class="s3">\n </span><span class="s1">* functions.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type DecryptedBoundArgsCacheStore = CacheStore&lt;string&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Serialized format for </span><span class="s3">\&quot;</span><span class="s1">use cache</span><span class="s3">\&quot; </span><span class="s1">entries</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export interface UseCacheCacheStoreSerialized {</span><span class="s3">\n  </span><span class="s1">value: string</span><span class="s3">\n  </span><span class="s1">tags: string[]</span><span class="s3">\n  </span><span class="s1">stale: number</span><span class="s3">\n  </span><span class="s1">timestamp: number</span><span class="s3">\n  </span><span class="s1">expire: number</span><span class="s3">\n  </span><span class="s1">revalidate: number</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* A cache store specifically for </span><span class="s3">\&quot;</span><span class="s1">use cache</span><span class="s3">\&quot; </span><span class="s1">values that stores promises of</span><span class="s3">\n </span><span class="s1">* cache entries.</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export type UseCacheCacheStore = CacheStore&lt;Promise&lt;CacheEntry&gt;&gt;</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Parses serialized cache entries into a UseCacheCacheStore</span><span class="s3">\n </span><span class="s1">* @param entries - The serialized entries to parse</span><span class="s3">\n </span><span class="s1">* @returns A new UseCacheCacheStore containing the parsed entries</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export function parseUseCacheCacheStore(</span><span class="s3">\n  </span><span class="s1">entries: Iterable&lt;[string, UseCacheCacheStoreSerialized]&gt;</span><span class="s3">\n</span><span class="s1">): UseCacheCacheStore {</span><span class="s3">\n  </span><span class="s1">const store = new Map&lt;string, Promise&lt;CacheEntry&gt;&gt;()</span><span class="s3">\n\n  </span><span class="s1">for (const [</span><span class="s3">\n    </span><span class="s1">key,</span><span class="s3">\n    </span><span class="s1">{ value, tags, stale, timestamp, expire, revalidate },</span><span class="s3">\n  </span><span class="s1">] of entries) {</span><span class="s3">\n    </span><span class="s1">store.set(</span><span class="s3">\n      </span><span class="s1">key,</span><span class="s3">\n      </span><span class="s1">Promise.resolve({</span><span class="s3">\n        </span><span class="s1">// Create a ReadableStream from the Uint8Array</span><span class="s3">\n        </span><span class="s1">value: new ReadableStream&lt;Uint8Array&gt;({</span><span class="s3">\n          </span><span class="s1">start(controller) {</span><span class="s3">\n            </span><span class="s1">// Enqueue the Uint8Array to the stream</span><span class="s3">\n            </span><span class="s1">controller.enqueue(stringToUint8Array(atob(value)))</span><span class="s3">\n\n            </span><span class="s1">// Close the stream</span><span class="s3">\n            </span><span class="s1">controller.close()</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">}),</span><span class="s3">\n        </span><span class="s1">tags,</span><span class="s3">\n        </span><span class="s1">stale,</span><span class="s3">\n        </span><span class="s1">timestamp,</span><span class="s3">\n        </span><span class="s1">expire,</span><span class="s3">\n        </span><span class="s1">revalidate,</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return store</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Serializes UseCacheCacheStore entries into an array of key-value pairs</span><span class="s3">\n </span><span class="s1">* @param entries - The store entries to stringify</span><span class="s3">\n </span><span class="s1">* @returns A promise that resolves to an array of key-value pairs with serialized values</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export async function serializeUseCacheCacheStore(</span><span class="s3">\n  </span><span class="s1">entries: IterableIterator&lt;[string, Promise&lt;CacheEntry&gt;]&gt;</span><span class="s3">\n</span><span class="s1">): Promise&lt;Array&lt;[string, UseCacheCacheStoreSerialized] | null&gt;&gt; {</span><span class="s3">\n  </span><span class="s1">return Promise.all(</span><span class="s3">\n    </span><span class="s1">Array.from(entries).map(([key, value]) =&gt; {</span><span class="s3">\n      </span><span class="s1">return value</span><span class="s3">\n        </span><span class="s1">.then(async (entry) =&gt; {</span><span class="s3">\n          </span><span class="s1">const [left, right] = entry.value.tee()</span><span class="s3">\n          </span><span class="s1">entry.value = right</span><span class="s3">\n\n          </span><span class="s1">let binaryString: string = ''</span><span class="s3">\n\n          </span><span class="s1">// We want to encode the value as a string, but we aren't sure if the</span><span class="s3">\n          </span><span class="s1">// value is a a stream of UTF-8 bytes or not, so let's just encode it</span><span class="s3">\n          </span><span class="s1">// as a string using base64.</span><span class="s3">\n          </span><span class="s1">for await (const chunk of left) {</span><span class="s3">\n            </span><span class="s1">binaryString += arrayBufferToString(chunk)</span><span class="s3">\n          </span><span class="s1">}</span><span class="s3">\n\n          </span><span class="s1">return [</span><span class="s3">\n            </span><span class="s1">key,</span><span class="s3">\n            </span><span class="s1">{</span><span class="s3">\n              </span><span class="s1">// Encode the value as a base64 string.</span><span class="s3">\n              </span><span class="s1">value: btoa(binaryString),</span><span class="s3">\n              </span><span class="s1">tags: entry.tags,</span><span class="s3">\n              </span><span class="s1">stale: entry.stale,</span><span class="s3">\n              </span><span class="s1">timestamp: entry.timestamp,</span><span class="s3">\n              </span><span class="s1">expire: entry.expire,</span><span class="s3">\n              </span><span class="s1">revalidate: entry.revalidate,</span><span class="s3">\n            </span><span class="s1">},</span><span class="s3">\n          </span><span class="s1">] satisfies [string, UseCacheCacheStoreSerialized]</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n        </span><span class="s1">.catch(() =&gt; {</span><span class="s3">\n          </span><span class="s1">// Any failed cache writes should be ignored as to not discard the</span><span class="s3">\n          </span><span class="s1">// entire cache.</span><span class="s3">\n          </span><span class="s1">return null</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;parseUseCacheCacheStore&quot;</span><span class="s0">,</span><span class="s1">&quot;serializeUseCacheCacheStore&quot;</span><span class="s0">,</span><span class="s1">&quot;entries&quot;</span><span class="s0">,</span><span class="s1">&quot;store&quot;</span><span class="s0">,</span><span class="s1">&quot;Map&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;tags&quot;</span><span class="s0">,</span><span class="s1">&quot;stale&quot;</span><span class="s0">,</span><span class="s1">&quot;timestamp&quot;</span><span class="s0">,</span><span class="s1">&quot;expire&quot;</span><span class="s0">,</span><span class="s1">&quot;revalidate&quot;</span><span class="s0">,</span><span class="s1">&quot;set&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;ReadableStream&quot;</span><span class="s0">,</span><span class="s1">&quot;start&quot;</span><span class="s0">,</span><span class="s1">&quot;controller&quot;</span><span class="s0">,</span><span class="s1">&quot;enqueue&quot;</span><span class="s0">,</span><span class="s1">&quot;stringToUint8Array&quot;</span><span class="s0">,</span><span class="s1">&quot;atob&quot;</span><span class="s0">,</span><span class="s1">&quot;close&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;Array&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">,</span><span class="s1">&quot;entry&quot;</span><span class="s0">,</span><span class="s1">&quot;left&quot;</span><span class="s0">,</span><span class="s1">&quot;right&quot;</span><span class="s0">,</span><span class="s1">&quot;tee&quot;</span><span class="s0">,</span><span class="s1">&quot;binaryString&quot;</span><span class="s0">,</span><span class="s1">&quot;chunk&quot;</span><span class="s0">,</span><span class="s1">&quot;arrayBufferToString&quot;</span><span class="s0">,</span><span class="s1">&quot;btoa&quot;</span><span class="s0">,</span><span class="s1">&quot;catch&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;IAsDgBA,uBAAuB;eAAvBA;;IAuCMC,2BAA2B;eAA3BA;;;iCA1Ff;AAmDA,SAASD,wBACdE,OAAyD;IAEzD,MAAMC,QAAQ,IAAIC;IAElB,KAAK,MAAM,CACTC,KACA,EAAEC,KAAK,EAAEC,IAAI,EAAEC,KAAK,EAAEC,SAAS,EAAEC,MAAM,EAAEC,UAAU,EAAE,CACtD,IAAIT,QAAS;QACZC,MAAMS,GAAG,CACPP,KACAQ,QAAQC,OAAO,CAAC;YACd,8CAA8C;YAC9CR,OAAO,IAAIS,eAA2B;gBACpCC,OAAMC,UAAU;oBACd,uCAAuC;oBACvCA,WAAWC,OAAO,CAACC,IAAAA,mCAAkB,EAACC,KAAKd;oBAE3C,mBAAmB;oBACnBW,WAAWI,KAAK;gBAClB;YACF;YACAd;YACAC;YACAC;YACAC;YACAC;QACF;IAEJ;IAEA,OAAOR;AACT;AAOO,eAAeF,4BACpBC,OAAwD;IAExD,OAAOW,QAAQS,GAAG,CAChBC,MAAMC,IAAI,CAACtB,SAASuB,GAAG,CAAC,CAAC,CAACpB,KAAKC,MAAM;QACnC,OAAOA,MACJoB,IAAI,CAAC,OAAOC;YACX,MAAM,CAACC,MAAMC,MAAM,GAAGF,MAAMrB,KAAK,CAACwB,GAAG;YACrCH,MAAMrB,KAAK,GAAGuB;YAEd,IAAIE,eAAuB;YAE3B,qEAAqE;YACrE,qEAAqE;YACrE,4BAA4B;YAC5B,WAAW,MAAMC,SAASJ,KAAM;gBAC9BG,gBAAgBE,IAAAA,oCAAmB,EAACD;YACtC;YAEA,OAAO;gBACL3B;gBACA;oBACE,uCAAuC;oBACvCC,OAAO4B,KAAKH;oBACZxB,MAAMoB,MAAMpB,IAAI;oBAChBC,OAAOmB,MAAMnB,KAAK;oBAClBC,WAAWkB,MAAMlB,SAAS;oBAC1BC,QAAQiB,MAAMjB,MAAM;oBACpBC,YAAYgB,MAAMhB,UAAU;gBAC9B;aACD;QACH,GACCwB,KAAK,CAAC;YACL,kEAAkE;YAClE,gBAAgB;YAChB,OAAO;QACT;IACJ;AAEJ&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>