<html>
<head>
<title>gen-mapping.mjs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #067d17;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
gen-mapping.mjs</font>
</center></td></tr></table>
<pre><span class="s0">// src/set-array.ts</span>
<span class="s2">var </span><span class="s1">SetArray = </span><span class="s2">class </span><span class="s1">{</span>
  <span class="s1">constructor() {</span>
    <span class="s2">this</span><span class="s1">._indexes = { __proto__: </span><span class="s2">null </span><span class="s1">};</span>
    <span class="s2">this</span><span class="s1">.array = [];</span>
  <span class="s1">}</span>
<span class="s1">};</span>
<span class="s2">function </span><span class="s1">cast(set) {</span>
  <span class="s2">return </span><span class="s1">set;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">get(setarr, key) {</span>
  <span class="s2">return </span><span class="s1">cast(setarr)._indexes[key];</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">put(setarr, key) {</span>
  <span class="s2">const </span><span class="s1">index = get(setarr, key);</span>
  <span class="s2">if </span><span class="s1">(index !== </span><span class="s2">void </span><span class="s3">0</span><span class="s1">) </span><span class="s2">return </span><span class="s1">index;</span>
  <span class="s2">const </span><span class="s1">{ array, _indexes: indexes } = cast(setarr);</span>
  <span class="s2">const </span><span class="s1">length = array.push(key);</span>
  <span class="s2">return </span><span class="s1">indexes[key] = length - </span><span class="s3">1</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">remove(setarr, key) {</span>
  <span class="s2">const </span><span class="s1">index = get(setarr, key);</span>
  <span class="s2">if </span><span class="s1">(index === </span><span class="s2">void </span><span class="s3">0</span><span class="s1">) </span><span class="s2">return</span><span class="s1">;</span>
  <span class="s2">const </span><span class="s1">{ array, _indexes: indexes } = cast(setarr);</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = index + </span><span class="s3">1</span><span class="s1">; i &lt; array.length; i++) {</span>
    <span class="s2">const </span><span class="s1">k = array[i];</span>
    <span class="s1">array[i - </span><span class="s3">1</span><span class="s1">] = k;</span>
    <span class="s1">indexes[k]--;</span>
  <span class="s1">}</span>
  <span class="s1">indexes[key] = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
  <span class="s1">array.pop();</span>
<span class="s1">}</span>

<span class="s0">// src/gen-mapping.ts</span>
<span class="s2">import </span><span class="s1">{</span>
  <span class="s1">encode</span>
<span class="s1">} from </span><span class="s4">&quot;@jridgewell/sourcemap-codec&quot;</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{ TraceMap, decodedMappings } from </span><span class="s4">&quot;@jridgewell/trace-mapping&quot;</span><span class="s1">;</span>

<span class="s0">// src/sourcemap-segment.ts</span>
<span class="s2">var </span><span class="s1">COLUMN = </span><span class="s3">0</span><span class="s1">;</span>
<span class="s2">var </span><span class="s1">SOURCES_INDEX = </span><span class="s3">1</span><span class="s1">;</span>
<span class="s2">var </span><span class="s1">SOURCE_LINE = </span><span class="s3">2</span><span class="s1">;</span>
<span class="s2">var </span><span class="s1">SOURCE_COLUMN = </span><span class="s3">3</span><span class="s1">;</span>
<span class="s2">var </span><span class="s1">NAMES_INDEX = </span><span class="s3">4</span><span class="s1">;</span>

<span class="s0">// src/gen-mapping.ts</span>
<span class="s2">var </span><span class="s1">NO_NAME = -</span><span class="s3">1</span><span class="s1">;</span>
<span class="s2">var </span><span class="s1">GenMapping = </span><span class="s2">class </span><span class="s1">{</span>
  <span class="s1">constructor({ file, sourceRoot } = {}) {</span>
    <span class="s2">this</span><span class="s1">._names = </span><span class="s2">new </span><span class="s1">SetArray();</span>
    <span class="s2">this</span><span class="s1">._sources = </span><span class="s2">new </span><span class="s1">SetArray();</span>
    <span class="s2">this</span><span class="s1">._sourcesContent = [];</span>
    <span class="s2">this</span><span class="s1">._mappings = [];</span>
    <span class="s2">this</span><span class="s1">.file = file;</span>
    <span class="s2">this</span><span class="s1">.sourceRoot = sourceRoot;</span>
    <span class="s2">this</span><span class="s1">._ignoreList = </span><span class="s2">new </span><span class="s1">SetArray();</span>
  <span class="s1">}</span>
<span class="s1">};</span>
<span class="s2">function </span><span class="s1">cast2(map) {</span>
  <span class="s2">return </span><span class="s1">map;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">addSegment(map, genLine, genColumn, source, sourceLine, sourceColumn, name, content) {</span>
  <span class="s2">return </span><span class="s1">addSegmentInternal(</span>
    <span class="s2">false</span><span class="s1">,</span>
    <span class="s1">map,</span>
    <span class="s1">genLine,</span>
    <span class="s1">genColumn,</span>
    <span class="s1">source,</span>
    <span class="s1">sourceLine,</span>
    <span class="s1">sourceColumn,</span>
    <span class="s1">name,</span>
    <span class="s1">content</span>
  <span class="s1">);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">addMapping(map, mapping) {</span>
  <span class="s2">return </span><span class="s1">addMappingInternal(</span><span class="s2">false</span><span class="s1">, map, mapping);</span>
<span class="s1">}</span>
<span class="s2">var </span><span class="s1">maybeAddSegment = (map, genLine, genColumn, source, sourceLine, sourceColumn, name, content) =&gt; {</span>
  <span class="s2">return </span><span class="s1">addSegmentInternal(</span>
    <span class="s2">true</span><span class="s1">,</span>
    <span class="s1">map,</span>
    <span class="s1">genLine,</span>
    <span class="s1">genColumn,</span>
    <span class="s1">source,</span>
    <span class="s1">sourceLine,</span>
    <span class="s1">sourceColumn,</span>
    <span class="s1">name,</span>
    <span class="s1">content</span>
  <span class="s1">);</span>
<span class="s1">};</span>
<span class="s2">var </span><span class="s1">maybeAddMapping = (map, mapping) =&gt; {</span>
  <span class="s2">return </span><span class="s1">addMappingInternal(</span><span class="s2">true</span><span class="s1">, map, mapping);</span>
<span class="s1">};</span>
<span class="s2">function </span><span class="s1">setSourceContent(map, source, content) {</span>
  <span class="s2">const </span><span class="s1">{</span>
    <span class="s1">_sources: sources,</span>
    <span class="s1">_sourcesContent: sourcesContent</span>
    <span class="s0">// _originalScopes: originalScopes,</span>
  <span class="s1">} = cast2(map);</span>
  <span class="s2">const </span><span class="s1">index = put(sources, source);</span>
  <span class="s1">sourcesContent[index] = content;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">setIgnore(map, source, ignore = </span><span class="s2">true</span><span class="s1">) {</span>
  <span class="s2">const </span><span class="s1">{</span>
    <span class="s1">_sources: sources,</span>
    <span class="s1">_sourcesContent: sourcesContent,</span>
    <span class="s1">_ignoreList: ignoreList</span>
    <span class="s0">// _originalScopes: originalScopes,</span>
  <span class="s1">} = cast2(map);</span>
  <span class="s2">const </span><span class="s1">index = put(sources, source);</span>
  <span class="s2">if </span><span class="s1">(index === sourcesContent.length) sourcesContent[index] = </span><span class="s2">null</span><span class="s1">;</span>
  <span class="s2">if </span><span class="s1">(ignore) put(ignoreList, index);</span>
  <span class="s2">else </span><span class="s1">remove(ignoreList, index);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">toDecodedMap(map) {</span>
  <span class="s2">const </span><span class="s1">{</span>
    <span class="s1">_mappings: mappings,</span>
    <span class="s1">_sources: sources,</span>
    <span class="s1">_sourcesContent: sourcesContent,</span>
    <span class="s1">_names: names,</span>
    <span class="s1">_ignoreList: ignoreList</span>
    <span class="s0">// _originalScopes: originalScopes,</span>
    <span class="s0">// _generatedRanges: generatedRanges,</span>
  <span class="s1">} = cast2(map);</span>
  <span class="s1">removeEmptyFinalLines(mappings);</span>
  <span class="s2">return </span><span class="s1">{</span>
    <span class="s1">version: </span><span class="s3">3</span><span class="s1">,</span>
    <span class="s1">file: map.file || </span><span class="s2">void </span><span class="s3">0</span><span class="s1">,</span>
    <span class="s1">names: names.array,</span>
    <span class="s1">sourceRoot: map.sourceRoot || </span><span class="s2">void </span><span class="s3">0</span><span class="s1">,</span>
    <span class="s1">sources: sources.array,</span>
    <span class="s1">sourcesContent,</span>
    <span class="s1">mappings,</span>
    <span class="s0">// originalScopes,</span>
    <span class="s0">// generatedRanges,</span>
    <span class="s1">ignoreList: ignoreList.array</span>
  <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">toEncodedMap(map) {</span>
  <span class="s2">const </span><span class="s1">decoded = toDecodedMap(map);</span>
  <span class="s2">return </span><span class="s1">Object.assign({}, decoded, {</span>
    <span class="s0">// originalScopes: decoded.originalScopes.map((os) =&gt; encodeOriginalScopes(os)),</span>
    <span class="s0">// generatedRanges: encodeGeneratedRanges(decoded.generatedRanges as GeneratedRange[]),</span>
    <span class="s1">mappings: encode(decoded.mappings)</span>
  <span class="s1">});</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">fromMap(input) {</span>
  <span class="s2">const </span><span class="s1">map = </span><span class="s2">new </span><span class="s1">TraceMap(input);</span>
  <span class="s2">const </span><span class="s1">gen = </span><span class="s2">new </span><span class="s1">GenMapping({ file: map.file, sourceRoot: map.sourceRoot });</span>
  <span class="s1">putAll(cast2(gen)._names, map.names);</span>
  <span class="s1">putAll(cast2(gen)._sources, map.sources);</span>
  <span class="s1">cast2(gen)._sourcesContent = map.sourcesContent || map.sources.map(() =&gt; </span><span class="s2">null</span><span class="s1">);</span>
  <span class="s1">cast2(gen)._mappings = decodedMappings(map);</span>
  <span class="s2">if </span><span class="s1">(map.ignoreList) putAll(cast2(gen)._ignoreList, map.ignoreList);</span>
  <span class="s2">return </span><span class="s1">gen;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">allMappings(map) {</span>
  <span class="s2">const </span><span class="s1">out = [];</span>
  <span class="s2">const </span><span class="s1">{ _mappings: mappings, _sources: sources, _names: names } = cast2(map);</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; mappings.length; i++) {</span>
    <span class="s2">const </span><span class="s1">line = mappings[i];</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">j = </span><span class="s3">0</span><span class="s1">; j &lt; line.length; j++) {</span>
      <span class="s2">const </span><span class="s1">seg = line[j];</span>
      <span class="s2">const </span><span class="s1">generated = { line: i + </span><span class="s3">1</span><span class="s1">, column: seg[COLUMN] };</span>
      <span class="s2">let </span><span class="s1">source = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
      <span class="s2">let </span><span class="s1">original = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
      <span class="s2">let </span><span class="s1">name = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
      <span class="s2">if </span><span class="s1">(seg.length !== </span><span class="s3">1</span><span class="s1">) {</span>
        <span class="s1">source = sources.array[seg[SOURCES_INDEX]];</span>
        <span class="s1">original = { line: seg[SOURCE_LINE] + </span><span class="s3">1</span><span class="s1">, column: seg[SOURCE_COLUMN] };</span>
        <span class="s2">if </span><span class="s1">(seg.length === </span><span class="s3">5</span><span class="s1">) name = names.array[seg[NAMES_INDEX]];</span>
      <span class="s1">}</span>
      <span class="s1">out.push({ generated, source, original, name });</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">out;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">addSegmentInternal(skipable, map, genLine, genColumn, source, sourceLine, sourceColumn, name, content) {</span>
  <span class="s2">const </span><span class="s1">{</span>
    <span class="s1">_mappings: mappings,</span>
    <span class="s1">_sources: sources,</span>
    <span class="s1">_sourcesContent: sourcesContent,</span>
    <span class="s1">_names: names</span>
    <span class="s0">// _originalScopes: originalScopes,</span>
  <span class="s1">} = cast2(map);</span>
  <span class="s2">const </span><span class="s1">line = getIndex(mappings, genLine);</span>
  <span class="s2">const </span><span class="s1">index = getColumnIndex(line, genColumn);</span>
  <span class="s2">if </span><span class="s1">(!source) {</span>
    <span class="s2">if </span><span class="s1">(skipable &amp;&amp; skipSourceless(line, index)) </span><span class="s2">return</span><span class="s1">;</span>
    <span class="s2">return </span><span class="s1">insert(line, index, [genColumn]);</span>
  <span class="s1">}</span>
  <span class="s1">assert(sourceLine);</span>
  <span class="s1">assert(sourceColumn);</span>
  <span class="s2">const </span><span class="s1">sourcesIndex = put(sources, source);</span>
  <span class="s2">const </span><span class="s1">namesIndex = name ? put(names, name) : NO_NAME;</span>
  <span class="s2">if </span><span class="s1">(sourcesIndex === sourcesContent.length) sourcesContent[sourcesIndex] = content != </span><span class="s2">null </span><span class="s1">? content : </span><span class="s2">null</span><span class="s1">;</span>
  <span class="s2">if </span><span class="s1">(skipable &amp;&amp; skipSource(line, index, sourcesIndex, sourceLine, sourceColumn, namesIndex)) {</span>
    <span class="s2">return</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">insert(</span>
    <span class="s1">line,</span>
    <span class="s1">index,</span>
    <span class="s1">name ? [genColumn, sourcesIndex, sourceLine, sourceColumn, namesIndex] : [genColumn, sourcesIndex, sourceLine, sourceColumn]</span>
  <span class="s1">);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">assert(_val) {</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">getIndex(arr, index) {</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = arr.length; i &lt;= index; i++) {</span>
    <span class="s1">arr[i] = [];</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">arr[index];</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">getColumnIndex(line, genColumn) {</span>
  <span class="s2">let </span><span class="s1">index = line.length;</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = index - </span><span class="s3">1</span><span class="s1">; i &gt;= </span><span class="s3">0</span><span class="s1">; index = i--) {</span>
    <span class="s2">const </span><span class="s1">current = line[i];</span>
    <span class="s2">if </span><span class="s1">(genColumn &gt;= current[COLUMN]) </span><span class="s2">break</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s2">return </span><span class="s1">index;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">insert(array, index, value) {</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = array.length; i &gt; index; i--) {</span>
    <span class="s1">array[i] = array[i - </span><span class="s3">1</span><span class="s1">];</span>
  <span class="s1">}</span>
  <span class="s1">array[index] = value;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">removeEmptyFinalLines(mappings) {</span>
  <span class="s2">const </span><span class="s1">{ length } = mappings;</span>
  <span class="s2">let </span><span class="s1">len = length;</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = len - </span><span class="s3">1</span><span class="s1">; i &gt;= </span><span class="s3">0</span><span class="s1">; len = i, i--) {</span>
    <span class="s2">if </span><span class="s1">(mappings[i].length &gt; </span><span class="s3">0</span><span class="s1">) </span><span class="s2">break</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s2">if </span><span class="s1">(len &lt; length) mappings.length = len;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">putAll(setarr, array) {</span>
  <span class="s2">for </span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; array.length; i++) put(setarr, array[i]);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">skipSourceless(line, index) {</span>
  <span class="s2">if </span><span class="s1">(index === </span><span class="s3">0</span><span class="s1">) </span><span class="s2">return true</span><span class="s1">;</span>
  <span class="s2">const </span><span class="s1">prev = line[index - </span><span class="s3">1</span><span class="s1">];</span>
  <span class="s2">return </span><span class="s1">prev.length === </span><span class="s3">1</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">skipSource(line, index, sourcesIndex, sourceLine, sourceColumn, namesIndex) {</span>
  <span class="s2">if </span><span class="s1">(index === </span><span class="s3">0</span><span class="s1">) </span><span class="s2">return false</span><span class="s1">;</span>
  <span class="s2">const </span><span class="s1">prev = line[index - </span><span class="s3">1</span><span class="s1">];</span>
  <span class="s2">if </span><span class="s1">(prev.length === </span><span class="s3">1</span><span class="s1">) </span><span class="s2">return false</span><span class="s1">;</span>
  <span class="s2">return </span><span class="s1">sourcesIndex === prev[SOURCES_INDEX] &amp;&amp; sourceLine === prev[SOURCE_LINE] &amp;&amp; sourceColumn === prev[SOURCE_COLUMN] &amp;&amp; namesIndex === (prev.length === </span><span class="s3">5 </span><span class="s1">? prev[NAMES_INDEX] : NO_NAME);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">addMappingInternal(skipable, map, mapping) {</span>
  <span class="s2">const </span><span class="s1">{ generated, source, original, name, content } = mapping;</span>
  <span class="s2">if </span><span class="s1">(!source) {</span>
    <span class="s2">return </span><span class="s1">addSegmentInternal(</span>
      <span class="s1">skipable,</span>
      <span class="s1">map,</span>
      <span class="s1">generated.line - </span><span class="s3">1</span><span class="s1">,</span>
      <span class="s1">generated.column,</span>
      <span class="s2">null</span><span class="s1">,</span>
      <span class="s2">null</span><span class="s1">,</span>
      <span class="s2">null</span><span class="s1">,</span>
      <span class="s2">null</span><span class="s1">,</span>
      <span class="s2">null</span>
    <span class="s1">);</span>
  <span class="s1">}</span>
  <span class="s1">assert(original);</span>
  <span class="s2">return </span><span class="s1">addSegmentInternal(</span>
    <span class="s1">skipable,</span>
    <span class="s1">map,</span>
    <span class="s1">generated.line - </span><span class="s3">1</span><span class="s1">,</span>
    <span class="s1">generated.column,</span>
    <span class="s1">source,</span>
    <span class="s1">original.line - </span><span class="s3">1</span><span class="s1">,</span>
    <span class="s1">original.column,</span>
    <span class="s1">name,</span>
    <span class="s1">content</span>
  <span class="s1">);</span>
<span class="s1">}</span>
<span class="s2">export </span><span class="s1">{</span>
  <span class="s1">GenMapping,</span>
  <span class="s1">addMapping,</span>
  <span class="s1">addSegment,</span>
  <span class="s1">allMappings,</span>
  <span class="s1">fromMap,</span>
  <span class="s1">maybeAddMapping,</span>
  <span class="s1">maybeAddSegment,</span>
  <span class="s1">setIgnore,</span>
  <span class="s1">setSourceContent,</span>
  <span class="s1">toDecodedMap,</span>
  <span class="s1">toEncodedMap</span>
<span class="s1">};</span>
<span class="s0">//# sourceMappingURL=gen-mapping.mjs.map</span>
</pre>
</body>
</html>