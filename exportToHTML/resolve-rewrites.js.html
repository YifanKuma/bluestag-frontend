<html>
<head>
<title>resolve-rewrites.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
resolve-rewrites.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;default&quot;</span><span class="s1">, {</span>
    <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
    <span class="s1">get: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">resolveRewrites;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_pathmatch = require(</span><span class="s0">&quot;./path-match&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_preparedestination = require(</span><span class="s0">&quot;./prepare-destination&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_removetrailingslash = require(</span><span class="s0">&quot;./remove-trailing-slash&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_normalizelocalepath = require(</span><span class="s0">&quot;../../i18n/normalize-locale-path&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_removebasepath = require(</span><span class="s0">&quot;../../../../client/remove-base-path&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_parserelativeurl = require(</span><span class="s0">&quot;./parse-relative-url&quot;</span><span class="s1">);</span>
<span class="s2">function </span><span class="s1">resolveRewrites(asPath, pages, rewrites, query, resolveHref, locales) {</span>
    <span class="s2">let </span><span class="s1">matchedPage = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">externalDest = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">parsedAs = (</span><span class="s3">0</span><span class="s1">, _parserelativeurl.parseRelativeUrl)(asPath);</span>
    <span class="s2">let </span><span class="s1">fsPathname = (</span><span class="s3">0</span><span class="s1">, _removetrailingslash.removeTrailingSlash)((</span><span class="s3">0</span><span class="s1">, _normalizelocalepath.normalizeLocalePath)((</span><span class="s3">0</span><span class="s1">, _removebasepath.removeBasePath)(parsedAs.pathname), locales).pathname);</span>
    <span class="s2">let </span><span class="s1">resolvedHref;</span>
    <span class="s2">const </span><span class="s1">handleRewrite = (rewrite)=&gt;{</span>
        <span class="s2">const </span><span class="s1">matcher = (</span><span class="s3">0</span><span class="s1">, _pathmatch.getPathMatch)(rewrite.source + (process.env.__NEXT_TRAILING_SLASH ? </span><span class="s0">'(/)?' </span><span class="s1">: </span><span class="s0">''</span><span class="s1">), {</span>
            <span class="s1">removeUnnamedParams: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">strict: </span><span class="s2">true</span>
        <span class="s1">});</span>
        <span class="s2">let </span><span class="s1">params = matcher(parsedAs.pathname);</span>
        <span class="s2">if </span><span class="s1">((rewrite.has || rewrite.missing) &amp;&amp; params) {</span>
            <span class="s2">const </span><span class="s1">hasParams = (</span><span class="s3">0</span><span class="s1">, _preparedestination.matchHas)({</span>
                <span class="s1">headers: {</span>
                    <span class="s1">host: document.location.hostname,</span>
                    <span class="s0">'user-agent'</span><span class="s1">: navigator.userAgent</span>
                <span class="s1">},</span>
                <span class="s1">cookies: document.cookie.split(</span><span class="s0">'; '</span><span class="s1">).reduce((acc, item)=&gt;{</span>
                    <span class="s2">const </span><span class="s1">[key, ...value] = item.split(</span><span class="s0">'='</span><span class="s1">);</span>
                    <span class="s1">acc[key] = value.join(</span><span class="s0">'='</span><span class="s1">);</span>
                    <span class="s2">return </span><span class="s1">acc;</span>
                <span class="s1">}, {})</span>
            <span class="s1">}, parsedAs.query, rewrite.has, rewrite.missing);</span>
            <span class="s2">if </span><span class="s1">(hasParams) {</span>
                <span class="s1">Object.assign(params, hasParams);</span>
            <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                <span class="s1">params = </span><span class="s2">false</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(params) {</span>
            <span class="s2">if </span><span class="s1">(!rewrite.destination) {</span>
                <span class="s4">// this is a proxied rewrite which isn't handled on the client</span>
                <span class="s1">externalDest = </span><span class="s2">true</span><span class="s1">;</span>
                <span class="s2">return true</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">const </span><span class="s1">destRes = (</span><span class="s3">0</span><span class="s1">, _preparedestination.prepareDestination)({</span>
                <span class="s1">appendParamsToQuery: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">destination: rewrite.destination,</span>
                <span class="s1">params: params,</span>
                <span class="s1">query: query</span>
            <span class="s1">});</span>
            <span class="s1">parsedAs = destRes.parsedDestination;</span>
            <span class="s1">asPath = destRes.newUrl;</span>
            <span class="s1">Object.assign(query, destRes.parsedDestination.query);</span>
            <span class="s1">fsPathname = (</span><span class="s3">0</span><span class="s1">, _removetrailingslash.removeTrailingSlash)((</span><span class="s3">0</span><span class="s1">, _normalizelocalepath.normalizeLocalePath)((</span><span class="s3">0</span><span class="s1">, _removebasepath.removeBasePath)(asPath), locales).pathname);</span>
            <span class="s2">if </span><span class="s1">(pages.includes(fsPathname)) {</span>
                <span class="s4">// check if we now match a page as this means we are done</span>
                <span class="s4">// resolving the rewrites</span>
                <span class="s1">matchedPage = </span><span class="s2">true</span><span class="s1">;</span>
                <span class="s1">resolvedHref = fsPathname;</span>
                <span class="s2">return true</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s4">// check if we match a dynamic-route, if so we break the rewrites chain</span>
            <span class="s1">resolvedHref = resolveHref(fsPathname);</span>
            <span class="s2">if </span><span class="s1">(resolvedHref !== asPath &amp;&amp; pages.includes(resolvedHref)) {</span>
                <span class="s1">matchedPage = </span><span class="s2">true</span><span class="s1">;</span>
                <span class="s2">return true</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">};</span>
    <span class="s2">let </span><span class="s1">finished = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; rewrites.beforeFiles.length; i++){</span>
        <span class="s4">// we don't end after match in beforeFiles to allow</span>
        <span class="s4">// continuing through all beforeFiles rewrites</span>
        <span class="s1">handleRewrite(rewrites.beforeFiles[i]);</span>
    <span class="s1">}</span>
    <span class="s1">matchedPage = pages.includes(fsPathname);</span>
    <span class="s2">if </span><span class="s1">(!matchedPage) {</span>
        <span class="s2">if </span><span class="s1">(!finished) {</span>
            <span class="s2">for</span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; rewrites.afterFiles.length; i++){</span>
                <span class="s2">if </span><span class="s1">(handleRewrite(rewrites.afterFiles[i])) {</span>
                    <span class="s1">finished = </span><span class="s2">true</span><span class="s1">;</span>
                    <span class="s2">break</span><span class="s1">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s4">// check dynamic route before processing fallback rewrites</span>
        <span class="s2">if </span><span class="s1">(!finished) {</span>
            <span class="s1">resolvedHref = resolveHref(fsPathname);</span>
            <span class="s1">matchedPage = pages.includes(resolvedHref);</span>
            <span class="s1">finished = matchedPage;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(!finished) {</span>
            <span class="s2">for</span><span class="s1">(</span><span class="s2">let </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; rewrites.fallback.length; i++){</span>
                <span class="s2">if </span><span class="s1">(handleRewrite(rewrites.fallback[i])) {</span>
                    <span class="s1">finished = </span><span class="s2">true</span><span class="s1">;</span>
                    <span class="s2">break</span><span class="s1">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">{</span>
        <span class="s1">asPath,</span>
        <span class="s1">parsedAs,</span>
        <span class="s1">matchedPage,</span>
        <span class="s1">resolvedHref,</span>
        <span class="s1">externalDest</span>
    <span class="s1">};</span>
<span class="s1">}</span>

<span class="s4">//# sourceMappingURL=resolve-rewrites.js.map</span></pre>
</body>
</html>