<html>
<head>
<title>common.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #8c8c8c; font-style: italic;}
.s3 { color: #0033b3;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #1750eb;}
.s6 { color: #264eff;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
common.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s2">/**</span>
 <span class="s2">* This is the common logic for both the Node.js and web browser</span>
 <span class="s2">* implementations of `debug()`.</span>
 <span class="s2">*/</span>
<span class="s3">function </span><span class="s1">setup(env) {</span>
  <span class="s1">createDebug.debug = createDebug;</span>
  <span class="s1">createDebug.default = createDebug;</span>
  <span class="s1">createDebug.coerce = coerce;</span>
  <span class="s1">createDebug.disable = disable;</span>
  <span class="s1">createDebug.enable = enable;</span>
  <span class="s1">createDebug.enabled = enabled;</span>
  <span class="s1">createDebug.humanize = require(</span><span class="s0">'ms'</span><span class="s1">);</span>
  <span class="s1">Object.keys(env).forEach(</span><span class="s3">function </span><span class="s1">(key) {</span>
    <span class="s1">createDebug[key] = env[key];</span>
  <span class="s1">});</span>
  <span class="s2">/**</span>
  <span class="s2">* Active `debug` instances.</span>
  <span class="s2">*/</span>

  <span class="s1">createDebug.instances = [];</span>
  <span class="s2">/**</span>
  <span class="s2">* The currently active debug mode names, and names to skip.</span>
  <span class="s2">*/</span>

  <span class="s1">createDebug.names = [];</span>
  <span class="s1">createDebug.skips = [];</span>
  <span class="s2">/**</span>
  <span class="s2">* Map of special &quot;%n&quot; handling functions, for the debug &quot;format&quot; argument.</span>
  <span class="s2">*</span>
  <span class="s2">* Valid key names are a single, lower or upper-case letter, i.e. &quot;n&quot; and &quot;N&quot;.</span>
  <span class="s2">*/</span>

  <span class="s1">createDebug.formatters = {};</span>
  <span class="s2">/**</span>
  <span class="s2">* Selects a color for a debug namespace</span>
  <span class="s2">* </span><span class="s4">@param </span><span class="s2">{String} namespace The namespace string for the for the debug instance to be colored</span>
  <span class="s2">* </span><span class="s4">@return </span><span class="s2">{Number|String} An ANSI color code for the given namespace</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">private</span>
  <span class="s2">*/</span>

  <span class="s3">function </span><span class="s1">selectColor(namespace) {</span>
    <span class="s3">var </span><span class="s1">hash = </span><span class="s5">0</span><span class="s1">;</span>

    <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s1">i = </span><span class="s5">0</span><span class="s1">; i &lt; namespace.length; i++) {</span>
      <span class="s1">hash = (hash &lt;&lt; </span><span class="s5">5</span><span class="s1">) - hash + namespace.charCodeAt(i);</span>
      <span class="s1">hash |= </span><span class="s5">0</span><span class="s1">; </span><span class="s2">// Convert to 32bit integer</span>
    <span class="s1">}</span>

    <span class="s3">return </span><span class="s1">createDebug.colors[Math.abs(hash) % createDebug.colors.length];</span>
  <span class="s1">}</span>

  <span class="s1">createDebug.selectColor = selectColor;</span>
  <span class="s2">/**</span>
  <span class="s2">* Create a debugger with the given `namespace`.</span>
  <span class="s2">*</span>
  <span class="s2">* </span><span class="s4">@param </span><span class="s2">{String} namespace</span>
  <span class="s2">* </span><span class="s4">@return </span><span class="s2">{Function}</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">public</span>
  <span class="s2">*/</span>

  <span class="s3">function </span><span class="s1">createDebug(namespace) {</span>
    <span class="s3">var </span><span class="s1">prevTime;</span>

    <span class="s3">function </span><span class="s1">debug() {</span>
      <span class="s2">// Disabled?</span>
      <span class="s3">if </span><span class="s1">(!debug.enabled) {</span>
        <span class="s3">return</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s1">_len = arguments.length, args = </span><span class="s3">new </span><span class="s1">Array(_len), _key = </span><span class="s5">0</span><span class="s1">; _key &lt; _len; _key++) {</span>
        <span class="s1">args[_key] = arguments[_key];</span>
      <span class="s1">}</span>

      <span class="s3">var </span><span class="s1">self = debug; </span><span class="s2">// Set `diff` timestamp</span>

      <span class="s3">var </span><span class="s1">curr = Number(</span><span class="s3">new </span><span class="s1">Date());</span>
      <span class="s3">var </span><span class="s1">ms = curr - (prevTime || curr);</span>
      <span class="s1">self.diff = ms;</span>
      <span class="s1">self.prev = prevTime;</span>
      <span class="s1">self.curr = curr;</span>
      <span class="s1">prevTime = curr;</span>
      <span class="s1">args[</span><span class="s5">0</span><span class="s1">] = createDebug.coerce(args[</span><span class="s5">0</span><span class="s1">]);</span>

      <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">args[</span><span class="s5">0</span><span class="s1">] !== </span><span class="s0">'string'</span><span class="s1">) {</span>
        <span class="s2">// Anything else let's inspect with %O</span>
        <span class="s1">args.unshift(</span><span class="s0">'%O'</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s2">// Apply any `formatters` transformations</span>


      <span class="s3">var </span><span class="s1">index = </span><span class="s5">0</span><span class="s1">;</span>
      <span class="s1">args[</span><span class="s5">0</span><span class="s1">] = args[</span><span class="s5">0</span><span class="s1">].replace(</span><span class="s6">/%([a-zA-Z%])/g</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(match, format) {</span>
        <span class="s2">// If we encounter an escaped % then don't increase the array index</span>
        <span class="s3">if </span><span class="s1">(match === </span><span class="s0">'%%'</span><span class="s1">) {</span>
          <span class="s3">return </span><span class="s1">match;</span>
        <span class="s1">}</span>

        <span class="s1">index++;</span>
        <span class="s3">var </span><span class="s1">formatter = createDebug.formatters[format];</span>

        <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">formatter === </span><span class="s0">'function'</span><span class="s1">) {</span>
          <span class="s3">var </span><span class="s1">val = args[index];</span>
          <span class="s1">match = formatter.call(self, val); </span><span class="s2">// Now we need to remove `args[index]` since it's inlined in the `format`</span>

          <span class="s1">args.splice(index, </span><span class="s5">1</span><span class="s1">);</span>
          <span class="s1">index--;</span>
        <span class="s1">}</span>

        <span class="s3">return </span><span class="s1">match;</span>
      <span class="s1">}); </span><span class="s2">// Apply env-specific formatting (colors, etc.)</span>

      <span class="s1">createDebug.formatArgs.call(self, args);</span>
      <span class="s3">var </span><span class="s1">logFn = self.log || createDebug.log;</span>
      <span class="s1">logFn.apply(self, args);</span>
    <span class="s1">}</span>

    <span class="s1">debug.namespace = namespace;</span>
    <span class="s1">debug.enabled = createDebug.enabled(namespace);</span>
    <span class="s1">debug.useColors = createDebug.useColors();</span>
    <span class="s1">debug.color = selectColor(namespace);</span>
    <span class="s1">debug.destroy = destroy;</span>
    <span class="s1">debug.extend = extend; </span><span class="s2">// Debug.formatArgs = formatArgs;</span>
    <span class="s2">// debug.rawLog = rawLog;</span>
    <span class="s2">// env-specific initialization logic for debug instances</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">typeof </span><span class="s1">createDebug.init === </span><span class="s0">'function'</span><span class="s1">) {</span>
      <span class="s1">createDebug.init(debug);</span>
    <span class="s1">}</span>

    <span class="s1">createDebug.instances.push(debug);</span>
    <span class="s3">return </span><span class="s1">debug;</span>
  <span class="s1">}</span>

  <span class="s3">function </span><span class="s1">destroy() {</span>
    <span class="s3">var </span><span class="s1">index = createDebug.instances.indexOf(</span><span class="s3">this</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(index !== -</span><span class="s5">1</span><span class="s1">) {</span>
      <span class="s1">createDebug.instances.splice(index, </span><span class="s5">1</span><span class="s1">);</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s3">function </span><span class="s1">extend(namespace, delimiter) {</span>
    <span class="s3">return </span><span class="s1">createDebug(</span><span class="s3">this</span><span class="s1">.namespace + (</span><span class="s3">typeof </span><span class="s1">delimiter === </span><span class="s0">'undefined' </span><span class="s1">? </span><span class="s0">':' </span><span class="s1">: delimiter) + namespace);</span>
  <span class="s1">}</span>
  <span class="s2">/**</span>
  <span class="s2">* Enables a debug mode by namespaces. This can include modes</span>
  <span class="s2">* separated by a colon and wildcards.</span>
  <span class="s2">*</span>
  <span class="s2">* </span><span class="s4">@param </span><span class="s2">{String} namespaces</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">public</span>
  <span class="s2">*/</span>


  <span class="s3">function </span><span class="s1">enable(namespaces) {</span>
    <span class="s1">createDebug.save(namespaces);</span>
    <span class="s1">createDebug.names = [];</span>
    <span class="s1">createDebug.skips = [];</span>
    <span class="s3">var </span><span class="s1">i;</span>
    <span class="s3">var </span><span class="s1">split = (</span><span class="s3">typeof </span><span class="s1">namespaces === </span><span class="s0">'string' </span><span class="s1">? namespaces : </span><span class="s0">''</span><span class="s1">).split(</span><span class="s6">/[\s,]+/</span><span class="s1">);</span>
    <span class="s3">var </span><span class="s1">len = split.length;</span>

    <span class="s3">for </span><span class="s1">(i = </span><span class="s5">0</span><span class="s1">; i &lt; len; i++) {</span>
      <span class="s3">if </span><span class="s1">(!split[i]) {</span>
        <span class="s2">// ignore empty strings</span>
        <span class="s3">continue</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s1">namespaces = split[i].replace(</span><span class="s6">/\*/g</span><span class="s1">, </span><span class="s0">'.*?'</span><span class="s1">);</span>

      <span class="s3">if </span><span class="s1">(namespaces[</span><span class="s5">0</span><span class="s1">] === </span><span class="s0">'-'</span><span class="s1">) {</span>
        <span class="s1">createDebug.skips.push(</span><span class="s3">new </span><span class="s1">RegExp(</span><span class="s0">'^' </span><span class="s1">+ namespaces.substr(</span><span class="s5">1</span><span class="s1">) + </span><span class="s0">'$'</span><span class="s1">));</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s1">createDebug.names.push(</span><span class="s3">new </span><span class="s1">RegExp(</span><span class="s0">'^' </span><span class="s1">+ namespaces + </span><span class="s0">'$'</span><span class="s1">));</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">for </span><span class="s1">(i = </span><span class="s5">0</span><span class="s1">; i &lt; createDebug.instances.length; i++) {</span>
      <span class="s3">var </span><span class="s1">instance = createDebug.instances[i];</span>
      <span class="s1">instance.enabled = createDebug.enabled(instance.namespace);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>
  <span class="s2">/**</span>
  <span class="s2">* Disable debug output.</span>
  <span class="s2">*</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">public</span>
  <span class="s2">*/</span>


  <span class="s3">function </span><span class="s1">disable() {</span>
    <span class="s1">createDebug.enable(</span><span class="s0">''</span><span class="s1">);</span>
  <span class="s1">}</span>
  <span class="s2">/**</span>
  <span class="s2">* Returns true if the given mode name is enabled, false otherwise.</span>
  <span class="s2">*</span>
  <span class="s2">* </span><span class="s4">@param </span><span class="s2">{String} name</span>
  <span class="s2">* </span><span class="s4">@return </span><span class="s2">{Boolean}</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">public</span>
  <span class="s2">*/</span>


  <span class="s3">function </span><span class="s1">enabled(name) {</span>
    <span class="s3">if </span><span class="s1">(name[name.length - </span><span class="s5">1</span><span class="s1">] === </span><span class="s0">'*'</span><span class="s1">) {</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">var </span><span class="s1">i;</span>
    <span class="s3">var </span><span class="s1">len;</span>

    <span class="s3">for </span><span class="s1">(i = </span><span class="s5">0</span><span class="s1">, len = createDebug.skips.length; i &lt; len; i++) {</span>
      <span class="s3">if </span><span class="s1">(createDebug.skips[i].test(name)) {</span>
        <span class="s3">return false</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">for </span><span class="s1">(i = </span><span class="s5">0</span><span class="s1">, len = createDebug.names.length; i &lt; len; i++) {</span>
      <span class="s3">if </span><span class="s1">(createDebug.names[i].test(name)) {</span>
        <span class="s3">return true</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>
  <span class="s2">/**</span>
  <span class="s2">* Coerce `val`.</span>
  <span class="s2">*</span>
  <span class="s2">* </span><span class="s4">@param </span><span class="s2">{Mixed} val</span>
  <span class="s2">* </span><span class="s4">@return </span><span class="s2">{Mixed}</span>
  <span class="s2">* </span><span class="s4">@api </span><span class="s2">private</span>
  <span class="s2">*/</span>


  <span class="s3">function </span><span class="s1">coerce(val) {</span>
    <span class="s3">if </span><span class="s1">(val </span><span class="s3">instanceof </span><span class="s1">Error) {</span>
      <span class="s3">return </span><span class="s1">val.stack || val.message;</span>
    <span class="s1">}</span>

    <span class="s3">return </span><span class="s1">val;</span>
  <span class="s1">}</span>

  <span class="s1">createDebug.enable(createDebug.load());</span>
  <span class="s3">return </span><span class="s1">createDebug;</span>
<span class="s1">}</span>

<span class="s1">module.exports = setup;</span>

</pre>
</body>
</html>