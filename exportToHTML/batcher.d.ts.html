<html>
<head>
<title>batcher.d.ts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
batcher.d.ts</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">type { SchedulerFn } from </span><span class="s2">'./scheduler'</span><span class="s1">;</span>
<span class="s1">type CacheKeyFn&lt;K, C </span><span class="s0">extends </span><span class="s1">string | number | </span><span class="s0">null</span><span class="s1">&gt; = (key: K) =&gt; PromiseLike&lt;C&gt; | C;</span>
<span class="s1">type BatcherOptions&lt;K, C </span><span class="s0">extends </span><span class="s1">string | number | </span><span class="s0">null</span><span class="s1">&gt; = {</span>
    <span class="s1">cacheKeyFn?: CacheKeyFn&lt;K, C&gt;;</span>
    <span class="s1">schedulerFn?: SchedulerFn&lt;</span><span class="s0">void</span><span class="s1">&gt;;</span>
<span class="s1">};</span>
<span class="s1">type WorkFn&lt;V, C&gt; = (key: C, resolve: (value: V | PromiseLike&lt;V&gt;) =&gt; </span><span class="s0">void</span><span class="s1">) =&gt; Promise&lt;V&gt;;</span>
<span class="s3">/**</span>
 <span class="s3">* A wrapper for a function that will only allow one call to the function to</span>
 <span class="s3">* execute at a time.</span>
 <span class="s3">*/</span>
<span class="s0">export </span><span class="s1">declare </span><span class="s0">class </span><span class="s1">Batcher&lt;K, V, C </span><span class="s0">extends </span><span class="s1">string | number | </span><span class="s0">null</span><span class="s1">&gt; {</span>
    <span class="s0">private </span><span class="s1">readonly cacheKeyFn?;</span>
    <span class="s3">/**</span>
     <span class="s3">* A function that will be called to schedule the wrapped function to be</span>
     <span class="s3">* executed. This defaults to a function that will execute the function</span>
     <span class="s3">* immediately.</span>
     <span class="s3">*/</span>
    <span class="s0">private </span><span class="s1">readonly schedulerFn;</span>
    <span class="s0">private </span><span class="s1">readonly pending;</span>
    <span class="s0">protected </span><span class="s1">constructor(cacheKeyFn?: CacheKeyFn&lt;K, C&gt; | undefined, </span>
    <span class="s3">/**</span>
     <span class="s3">* A function that will be called to schedule the wrapped function to be</span>
     <span class="s3">* executed. This defaults to a function that will execute the function</span>
     <span class="s3">* immediately.</span>
     <span class="s3">*/</span>
    <span class="s1">schedulerFn?: SchedulerFn&lt;</span><span class="s0">void</span><span class="s1">&gt;);</span>
    <span class="s3">/**</span>
     <span class="s3">* Creates a new instance of PendingWrapper. If the key extends a string or</span>
     <span class="s3">* number, the key will be used as the cache key. If the key is an object, a</span>
     <span class="s3">* cache key function must be provided.</span>
     <span class="s3">*/</span>
    <span class="s0">static </span><span class="s1">create&lt;K </span><span class="s0">extends </span><span class="s1">string | number | </span><span class="s0">null</span><span class="s1">, V&gt;(options?: BatcherOptions&lt;K, K&gt;): Batcher&lt;K, V, K&gt;;</span>
    <span class="s0">static </span><span class="s1">create&lt;K, V, C </span><span class="s0">extends </span><span class="s1">string | number | </span><span class="s0">null</span><span class="s1">&gt;(options: BatcherOptions&lt;K, C&gt; &amp; Required&lt;Pick&lt;BatcherOptions&lt;K, C&gt;, </span><span class="s2">'cacheKeyFn'</span><span class="s1">&gt;&gt;): Batcher&lt;K, V, C&gt;;</span>
    <span class="s3">/**</span>
     <span class="s3">* Wraps a function in a promise that will be resolved or rejected only once</span>
     <span class="s3">* for a given key. This will allow multiple calls to the function to be</span>
     <span class="s3">* made, but only one will be executed at a time. The result of the first</span>
     <span class="s3">* call will be returned to all callers.</span>
     <span class="s3">*</span>
     <span class="s3">* </span><span class="s4">@param </span><span class="s3">key the key to use for the cache</span>
     <span class="s3">* </span><span class="s4">@param </span><span class="s3">fn the function to wrap</span>
     <span class="s3">* </span><span class="s4">@returns </span><span class="s3">a promise that resolves to the result of the function</span>
     <span class="s3">*/</span>
    <span class="s1">batch(key: K, fn: WorkFn&lt;V, C&gt;): Promise&lt;V&gt;;</span>
<span class="s1">}</span>
<span class="s0">export </span><span class="s1">{};</span>
</pre>
</body>
</html>