<html>
<head>
<title>builder.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
builder.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span><span class="s1">;Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { value: </span><span class="s2">true </span><span class="s1">});</span><span class="s2">var </span><span class="s1">_createClass = </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">defineProperties(target, props) {</span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; props.length; i++) {</span><span class="s2">var </span><span class="s1">descriptor = props[i];descriptor.enumerable = descriptor.enumerable || </span><span class="s2">false</span><span class="s1">;descriptor.configurable = </span><span class="s2">true</span><span class="s1">;</span><span class="s2">if </span><span class="s1">(</span><span class="s0">&quot;value&quot; </span><span class="s2">in </span><span class="s1">descriptor) descriptor.writable = </span><span class="s2">true</span><span class="s1">;Object.defineProperty(target, descriptor.key, descriptor);}}</span><span class="s2">return function </span><span class="s1">(Constructor, protoProps, staticProps) {</span><span class="s2">if </span><span class="s1">(protoProps) defineProperties(Constructor.prototype, protoProps);</span><span class="s2">if </span><span class="s1">(staticProps) defineProperties(Constructor, staticProps);</span><span class="s2">return </span><span class="s1">Constructor;};}();</span><span class="s2">var </span><span class="s1">_fs = require(</span><span class="s0">'fs'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_fs2 = _interopRequireDefault(_fs);</span>

<span class="s2">var </span><span class="s1">_doctrine = require(</span><span class="s0">'doctrine'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_doctrine2 = _interopRequireDefault(_doctrine);</span>

<span class="s2">var </span><span class="s1">_debug = require(</span><span class="s0">'debug'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_debug2 = _interopRequireDefault(_debug);</span>

<span class="s2">var </span><span class="s1">_parse2 = require(</span><span class="s0">'eslint-module-utils/parse'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_parse3 = _interopRequireDefault(_parse2);</span>
<span class="s2">var </span><span class="s1">_visit = require(</span><span class="s0">'eslint-module-utils/visit'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_visit2 = _interopRequireDefault(_visit);</span>
<span class="s2">var </span><span class="s1">_resolve = require(</span><span class="s0">'eslint-module-utils/resolve'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_resolve2 = _interopRequireDefault(_resolve);</span>
<span class="s2">var </span><span class="s1">_ignore = require(</span><span class="s0">'eslint-module-utils/ignore'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_ignore2 = _interopRequireDefault(_ignore);</span>

<span class="s2">var </span><span class="s1">_hash = require(</span><span class="s0">'eslint-module-utils/hash'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_unambiguous = require(</span><span class="s0">'eslint-module-utils/unambiguous'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">unambiguous = _interopRequireWildcard(_unambiguous);</span>

<span class="s2">var </span><span class="s1">_ = require(</span><span class="s0">'.'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_2 = _interopRequireDefault(_);</span>
<span class="s2">var </span><span class="s1">_childContext = require(</span><span class="s0">'./childContext'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_childContext2 = _interopRequireDefault(_childContext);</span>
<span class="s2">var </span><span class="s1">_typescript = require(</span><span class="s0">'./typescript'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_remotePath = require(</span><span class="s0">'./remotePath'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_visitor = require(</span><span class="s0">'./visitor'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_visitor2 = _interopRequireDefault(_visitor);</span><span class="s2">function </span><span class="s1">_interopRequireWildcard(obj) {</span><span class="s2">if </span><span class="s1">(obj &amp;&amp; obj.__esModule) {</span><span class="s2">return </span><span class="s1">obj;} </span><span class="s2">else </span><span class="s1">{</span><span class="s2">var </span><span class="s1">newObj = {};</span><span class="s2">if </span><span class="s1">(obj != </span><span class="s2">null</span><span class="s1">) {</span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">key </span><span class="s2">in </span><span class="s1">obj) {</span><span class="s2">if </span><span class="s1">(Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];}}newObj[</span><span class="s0">'default'</span><span class="s1">] = obj;</span><span class="s2">return </span><span class="s1">newObj;}}</span><span class="s2">function </span><span class="s1">_interopRequireDefault(obj) {</span><span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : { </span><span class="s0">'default'</span><span class="s1">: obj };}</span><span class="s2">function </span><span class="s1">_classCallCheck(instance, Constructor) {</span><span class="s2">if </span><span class="s1">(!(instance </span><span class="s2">instanceof </span><span class="s1">Constructor)) {</span><span class="s2">throw new </span><span class="s1">TypeError(</span><span class="s0">&quot;Cannot call a class as a function&quot;</span><span class="s1">);}}</span>

<span class="s2">var </span><span class="s1">log = (</span><span class="s3">0</span><span class="s1">, _debug2[</span><span class="s0">'default'</span><span class="s1">])(</span><span class="s0">'eslint-plugin-import:ExportMap'</span><span class="s1">);</span>

<span class="s2">var </span><span class="s1">exportCache = </span><span class="s2">new </span><span class="s1">Map();</span>

<span class="s4">/**</span>
                              <span class="s4">* The creation of this closure is isolated from other scopes</span>
                              <span class="s4">* to avoid over-retention of unrelated variables, which has</span>
                              <span class="s4">* caused memory leaks. See #1266.</span>
                              <span class="s4">*/</span>
<span class="s2">function </span><span class="s1">thunkFor(p, context) {</span>
  <span class="s4">// eslint-disable-next-line no-use-before-define</span>
  <span class="s2">return function </span><span class="s1">() {</span><span class="s2">return </span><span class="s1">ExportMapBuilder[</span><span class="s0">'for'</span><span class="s1">]((</span><span class="s3">0</span><span class="s1">, _childContext2[</span><span class="s0">'default'</span><span class="s1">])(p, context));};</span>
<span class="s1">}</span><span class="s2">var</span>

<span class="s1">ExportMapBuilder = </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ExportMapBuilder() {_classCallCheck(</span><span class="s2">this</span><span class="s1">, ExportMapBuilder);}_createClass(ExportMapBuilder, </span><span class="s2">null</span><span class="s1">, [{ key: </span><span class="s0">'get'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">get(</span>
      <span class="s1">source, context) {</span>
        <span class="s2">var </span><span class="s1">path = (</span><span class="s3">0</span><span class="s1">, _resolve2[</span><span class="s0">'default'</span><span class="s1">])(source, context);</span>
        <span class="s2">if </span><span class="s1">(path == </span><span class="s2">null</span><span class="s1">) {</span><span class="s2">return null</span><span class="s1">;}</span>

        <span class="s2">return </span><span class="s1">ExportMapBuilder[</span><span class="s0">'for'</span><span class="s1">]((</span><span class="s3">0</span><span class="s1">, _childContext2[</span><span class="s0">'default'</span><span class="s1">])(path, context));</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">get;}() }, { key: </span><span class="s0">'for'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">_for(</span>

      <span class="s1">context) {</span><span class="s2">var</span>
        <span class="s1">path = context.path;</span>

        <span class="s2">var </span><span class="s1">cacheKey = context.cacheKey || (</span><span class="s3">0</span><span class="s1">, _hash.hashObject)(context).digest(</span><span class="s0">'hex'</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">exportMap = exportCache.get(cacheKey);</span>

        <span class="s4">// return cached ignore</span>
        <span class="s2">if </span><span class="s1">(exportMap === </span><span class="s2">null</span><span class="s1">) {</span><span class="s2">return null</span><span class="s1">;}</span>

        <span class="s2">var </span><span class="s1">stats = _fs2[</span><span class="s0">'default'</span><span class="s1">].statSync(path);</span>
        <span class="s2">if </span><span class="s1">(exportMap != </span><span class="s2">null</span><span class="s1">) {</span>
          <span class="s4">// date equality check</span>
          <span class="s2">if </span><span class="s1">(exportMap.mtime - stats.mtime === </span><span class="s3">0</span><span class="s1">) {</span>
            <span class="s2">return </span><span class="s1">exportMap;</span>
          <span class="s1">}</span>
          <span class="s4">// future: check content equality?</span>
        <span class="s1">}</span>

        <span class="s4">// check valid extensions first</span>
        <span class="s2">if </span><span class="s1">(!(</span><span class="s3">0</span><span class="s1">, _ignore.hasValidExtension)(path, context)) {</span>
          <span class="s1">exportCache.set(cacheKey, </span><span class="s2">null</span><span class="s1">);</span>
          <span class="s2">return null</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s4">// check for and cache ignore</span>
        <span class="s2">if </span><span class="s1">((</span><span class="s3">0</span><span class="s1">, _ignore2[</span><span class="s0">'default'</span><span class="s1">])(path, context)) {</span>
          <span class="s1">log(</span><span class="s0">'ignored path due to ignore settings:'</span><span class="s1">, path);</span>
          <span class="s1">exportCache.set(cacheKey, </span><span class="s2">null</span><span class="s1">);</span>
          <span class="s2">return null</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s2">var </span><span class="s1">content = _fs2[</span><span class="s0">'default'</span><span class="s1">].readFileSync(path, { encoding: </span><span class="s0">'utf8' </span><span class="s1">});</span>

        <span class="s4">// check for and cache unambiguous modules</span>
        <span class="s2">if </span><span class="s1">(!unambiguous.test(content)) {</span>
          <span class="s1">log(</span><span class="s0">'ignored path due to unambiguous regex:'</span><span class="s1">, path);</span>
          <span class="s1">exportCache.set(cacheKey, </span><span class="s2">null</span><span class="s1">);</span>
          <span class="s2">return null</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s1">log(</span><span class="s0">'cache miss'</span><span class="s1">, cacheKey, </span><span class="s0">'for path'</span><span class="s1">, path);</span>
        <span class="s1">exportMap = ExportMapBuilder.parse(path, content, context);</span>

        <span class="s4">// ambiguous modules return null</span>
        <span class="s2">if </span><span class="s1">(exportMap == </span><span class="s2">null</span><span class="s1">) {</span>
          <span class="s1">log(</span><span class="s0">'ignored path due to ambiguous parse:'</span><span class="s1">, path);</span>
          <span class="s1">exportCache.set(cacheKey, </span><span class="s2">null</span><span class="s1">);</span>
          <span class="s2">return null</span><span class="s1">;</span>
        <span class="s1">}</span>

        <span class="s1">exportMap.mtime = stats.mtime;</span>

        <span class="s4">// If the visitor keys were not populated, then we shouldn't save anything to the cache,</span>
        <span class="s4">// since the parse results may not be reliable.</span>
        <span class="s2">if </span><span class="s1">(exportMap.visitorKeys) {</span>
          <span class="s1">exportCache.set(cacheKey, exportMap);</span>
        <span class="s1">}</span>
        <span class="s2">return </span><span class="s1">exportMap;</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">_for;}() }, { key: </span><span class="s0">'parse'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">parse(</span>

      <span class="s1">path, content, context) {</span>
        <span class="s2">var </span><span class="s1">exportMap = </span><span class="s2">new </span><span class="s1">_2[</span><span class="s0">'default'</span><span class="s1">](path);</span>
        <span class="s2">var </span><span class="s1">isEsModuleInteropTrue = (</span><span class="s3">0</span><span class="s1">, _typescript.isEsModuleInterop)(context);</span>

        <span class="s2">var </span><span class="s1">ast = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
        <span class="s2">var </span><span class="s1">visitorKeys = </span><span class="s2">void </span><span class="s3">0</span><span class="s1">;</span>
        <span class="s2">try </span><span class="s1">{</span>
          <span class="s2">var </span><span class="s1">result = (</span><span class="s3">0</span><span class="s1">, _parse3[</span><span class="s0">'default'</span><span class="s1">])(path, content, context);</span>
          <span class="s1">ast = result.ast;</span>
          <span class="s1">visitorKeys = result.visitorKeys;</span>
        <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span>
          <span class="s1">exportMap.errors.push(err);</span>
          <span class="s2">return </span><span class="s1">exportMap; </span><span class="s4">// can't continue</span>
        <span class="s1">}</span>

        <span class="s1">exportMap.visitorKeys = visitorKeys;</span>

        <span class="s2">var </span><span class="s1">hasDynamicImports = </span><span class="s2">false</span><span class="s1">;</span>

        <span class="s2">var </span><span class="s1">remotePathResolver = </span><span class="s2">new </span><span class="s1">_remotePath.RemotePath(path, context);</span>

        <span class="s2">function </span><span class="s1">processDynamicImport(source) {</span>
          <span class="s1">hasDynamicImports = </span><span class="s2">true</span><span class="s1">;</span>
          <span class="s2">if </span><span class="s1">(source.type !== </span><span class="s0">'Literal'</span><span class="s1">) {</span>
            <span class="s2">return null</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">var </span><span class="s1">p = remotePathResolver.resolve(source.value);</span>
          <span class="s2">if </span><span class="s1">(p == </span><span class="s2">null</span><span class="s1">) {</span>
            <span class="s2">return null</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s2">var </span><span class="s1">importedSpecifiers = </span><span class="s2">new </span><span class="s1">Set();</span>
          <span class="s1">importedSpecifiers.add(</span><span class="s0">'ImportNamespaceSpecifier'</span><span class="s1">);</span>
          <span class="s2">var </span><span class="s1">getter = thunkFor(p, context);</span>
          <span class="s1">exportMap.imports.set(p, {</span>
            <span class="s1">getter: getter,</span>
            <span class="s1">declarations: </span><span class="s2">new </span><span class="s1">Set([{</span>
              <span class="s1">source: {</span>
                <span class="s4">// capturing actual node reference holds full AST in memory!</span>
                <span class="s1">value: source.value,</span>
                <span class="s1">loc: source.loc },</span>

              <span class="s1">importedSpecifiers: importedSpecifiers,</span>
              <span class="s1">dynamic: </span><span class="s2">true </span><span class="s1">}]) });</span>


        <span class="s1">}</span>

        <span class="s1">(</span><span class="s3">0</span><span class="s1">, _visit2[</span><span class="s0">'default'</span><span class="s1">])(ast, visitorKeys, {</span>
          <span class="s1">ImportExpression: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">ImportExpression(node) {</span>
              <span class="s1">processDynamicImport(node.source);</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">ImportExpression;}(),</span>
          <span class="s1">CallExpression: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">CallExpression(node) {</span>
              <span class="s2">if </span><span class="s1">(node.callee.type === </span><span class="s0">'Import'</span><span class="s1">) {</span>
                <span class="s1">processDynamicImport(node.arguments[</span><span class="s3">0</span><span class="s1">]);</span>
              <span class="s1">}</span>
            <span class="s1">}</span><span class="s2">return </span><span class="s1">CallExpression;}() });</span>


        <span class="s2">var </span><span class="s1">unambiguouslyESM = unambiguous.isModule(ast);</span>
        <span class="s2">if </span><span class="s1">(!unambiguouslyESM &amp;&amp; !hasDynamicImports) {</span><span class="s2">return null</span><span class="s1">;}</span>

        <span class="s4">// attempt to collect module doc</span>
        <span class="s2">if </span><span class="s1">(ast.comments) {</span>
          <span class="s1">ast.comments.some(</span><span class="s2">function </span><span class="s1">(c) {</span>
            <span class="s2">if </span><span class="s1">(c.type !== </span><span class="s0">'Block'</span><span class="s1">) {</span><span class="s2">return false</span><span class="s1">;}</span>
            <span class="s2">try </span><span class="s1">{</span>
              <span class="s2">var </span><span class="s1">doc = _doctrine2[</span><span class="s0">'default'</span><span class="s1">].parse(c.value, { unwrap: </span><span class="s2">true </span><span class="s1">});</span>
              <span class="s2">if </span><span class="s1">(doc.tags.some(</span><span class="s2">function </span><span class="s1">(t) {</span><span class="s2">return </span><span class="s1">t.title === </span><span class="s0">'module'</span><span class="s1">;})) {</span>
                <span class="s1">exportMap.doc = doc;</span>
                <span class="s2">return true</span><span class="s1">;</span>
              <span class="s1">}</span>
            <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span><span class="s4">/* ignore */</span><span class="s1">}</span>
            <span class="s2">return false</span><span class="s1">;</span>
          <span class="s1">});</span>
        <span class="s1">}</span>

        <span class="s2">var </span><span class="s1">visitorBuilder = </span><span class="s2">new </span><span class="s1">_visitor2[</span><span class="s0">'default'</span><span class="s1">](</span>
        <span class="s1">path,</span>
        <span class="s1">context,</span>
        <span class="s1">exportMap,</span>
        <span class="s1">ExportMapBuilder,</span>
        <span class="s1">content,</span>
        <span class="s1">ast,</span>
        <span class="s1">isEsModuleInteropTrue,</span>
        <span class="s1">thunkFor);</span>

        <span class="s1">ast.body.forEach(</span><span class="s2">function </span><span class="s1">(astNode) {</span>
          <span class="s2">var </span><span class="s1">visitor = visitorBuilder.build(astNode);</span>

          <span class="s2">if </span><span class="s1">(visitor[astNode.type]) {</span>
            <span class="s1">visitor[astNode.type].call(visitorBuilder);</span>
          <span class="s1">}</span>
        <span class="s1">});</span>

        <span class="s2">if </span><span class="s1">(</span>
        <span class="s1">isEsModuleInteropTrue </span><span class="s4">// esModuleInterop is on in tsconfig</span>
        <span class="s1">&amp;&amp; exportMap.namespace.size &gt; </span><span class="s3">0 </span><span class="s4">// anything is exported</span>
        <span class="s1">&amp;&amp; !exportMap.namespace.has(</span><span class="s0">'default'</span><span class="s1">) </span><span class="s4">// and default isn't added already</span>
        <span class="s1">) {</span>
            <span class="s1">exportMap.namespace.set(</span><span class="s0">'default'</span><span class="s1">, {}); </span><span class="s4">// add default export</span>
          <span class="s1">}</span>

        <span class="s2">if </span><span class="s1">(unambiguouslyESM) {</span>
          <span class="s1">exportMap.parseGoal = </span><span class="s0">'Module'</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">return </span><span class="s1">exportMap;</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">parse;}() }]);</span><span class="s2">return </span><span class="s1">ExportMapBuilder;}();exports[</span><span class="s0">'default'</span><span class="s1">] = ExportMapBuilder;</span>
<span class="s4">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leHBvcnRNYXAvYnVpbGRlci5qcyJdLCJuYW1lcyI6WyJ1bmFtYmlndW91cyIsImxvZyIsImV4cG9ydENhY2hlIiwiTWFwIiwidGh1bmtGb3IiLCJwIiwiY29udGV4dCIsIkV4cG9ydE1hcEJ1aWxkZXIiLCJzb3VyY2UiLCJwYXRoIiwiY2FjaGVLZXkiLCJkaWdlc3QiLCJleHBvcnRNYXAiLCJnZXQiLCJzdGF0cyIsImZzIiwic3RhdFN5bmMiLCJtdGltZSIsInNldCIsImNvbnRlbnQiLCJyZWFkRmlsZVN5bmMiLCJlbmNvZGluZyIsInRlc3QiLCJwYXJzZSIsInZpc2l0b3JLZXlzIiwiRXhwb3J0TWFwIiwiaXNFc01vZHVsZUludGVyb3BUcnVlIiwiYXN0IiwicmVzdWx0IiwiZXJyIiwiZXJyb3JzIiwicHVzaCIsImhhc0R5bmFtaWNJbXBvcnRzIiwicmVtb3RlUGF0aFJlc29sdmVyIiwiUmVtb3RlUGF0aCIsInByb2Nlc3NEeW5hbWljSW1wb3J0IiwidHlwZSIsInJlc29sdmUiLCJ2YWx1ZSIsImltcG9ydGVkU3BlY2lmaWVycyIsIlNldCIsImFkZCIsImdldHRlciIsImltcG9ydHMiLCJkZWNsYXJhdGlvbnMiLCJsb2MiLCJkeW5hbWljIiwiSW1wb3J0RXhwcmVzc2lvbiIsIm5vZGUiLCJDYWxsRXhwcmVzc2lvbiIsImNhbGxlZSIsImFyZ3VtZW50cyIsInVuYW1iaWd1b3VzbHlFU00iLCJpc01vZHVsZSIsImNvbW1lbnRzIiwic29tZSIsImMiLCJkb2MiLCJkb2N0cmluZSIsInVud3JhcCIsInRhZ3MiLCJ0IiwidGl0bGUiLCJ2aXNpdG9yQnVpbGRlciIsIkltcG9ydEV4cG9ydFZpc2l0b3JCdWlsZGVyIiwiYm9keSIsImZvckVhY2giLCJhc3ROb2RlIiwidmlzaXRvciIsImJ1aWxkIiwiY2FsbCIsIm5hbWVzcGFjZSIsInNpemUiLCJoYXMiLCJwYXJzZUdvYWwiXSwibWFwcGluZ3MiOiJnbkJBQUEsd0I7O0FBRUEsb0M7O0FBRUEsOEI7O0FBRUEsbUQ7QUFDQSxrRDtBQUNBLHNEO0FBQ0Esb0Q7O0FBRUE7QUFDQSw4RCxJQUFZQSxXOztBQUVaLHFCO0FBQ0EsOEM7QUFDQTtBQUNBO0FBQ0Esb0M7O0FBRUEsSUFBTUMsTUFBTSx3QkFBTSxnQ0FBTixDQUFaOztBQUVBLElBQU1DLGNBQWMsSUFBSUMsR0FBSixFQUFwQjs7QUFFQTs7Ozs7QUFLQSxTQUFTQyxRQUFULENBQWtCQyxDQUFsQixFQUFxQkMsT0FBckIsRUFBOEI7QUFDNUI7QUFDQSxTQUFPLG9CQUFNQyx3QkFBcUIsK0JBQWFGLENBQWIsRUFBZ0JDLE9BQWhCLENBQXJCLENBQU4sRUFBUDtBQUNELEM7O0FBRW9CQyxnQjtBQUNSQyxZLEVBQVFGLE8sRUFBUztBQUMxQixZQUFNRyxPQUFPLDBCQUFRRCxNQUFSLEVBQWdCRixPQUFoQixDQUFiO0FBQ0EsWUFBSUcsUUFBUSxJQUFaLEVBQWtCLENBQUUsT0FBTyxJQUFQLENBQWM7O0FBRWxDLGVBQU9GLHdCQUFxQiwrQkFBYUUsSUFBYixFQUFtQkgsT0FBbkIsQ0FBckIsQ0FBUDtBQUNELE87O0FBRVVBLGEsRUFBUztBQUNWRyxZQURVLEdBQ0RILE9BREMsQ0FDVkcsSUFEVTs7QUFHbEIsWUFBTUMsV0FBV0osUUFBUUksUUFBUixJQUFvQixzQkFBV0osT0FBWCxFQUFvQkssTUFBcEIsQ0FBMkIsS0FBM0IsQ0FBckM7QUFDQSxZQUFJQyxZQUFZVixZQUFZVyxHQUFaLENBQWdCSCxRQUFoQixDQUFoQjs7QUFFQTtBQUNBLFlBQUlFLGNBQWMsSUFBbEIsRUFBd0IsQ0FBRSxPQUFPLElBQVAsQ0FBYzs7QUFFeEMsWUFBTUUsUUFBUUMsZ0JBQUdDLFFBQUgsQ0FBWVAsSUFBWixDQUFkO0FBQ0EsWUFBSUcsYUFBYSxJQUFqQixFQUF1QjtBQUNyQjtBQUNBLGNBQUlBLFVBQVVLLEtBQVYsR0FBa0JILE1BQU1HLEtBQXhCLEtBQWtDLENBQXRDLEVBQXlDO0FBQ3ZDLG1CQUFPTCxTQUFQO0FBQ0Q7QUFDRDtBQUNEOztBQUVEO0FBQ0EsWUFBSSxDQUFDLCtCQUFrQkgsSUFBbEIsRUFBd0JILE9BQXhCLENBQUwsRUFBdUM7QUFDckNKLHNCQUFZZ0IsR0FBWixDQUFnQlIsUUFBaEIsRUFBMEIsSUFBMUI7QUFDQSxpQkFBTyxJQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxZQUFJLHlCQUFVRCxJQUFWLEVBQWdCSCxPQUFoQixDQUFKLEVBQThCO0FBQzVCTCxjQUFJLHNDQUFKLEVBQTRDUSxJQUE1QztBQUNBUCxzQkFBWWdCLEdBQVosQ0FBZ0JSLFFBQWhCLEVBQTBCLElBQTFCO0FBQ0EsaUJBQU8sSUFBUDtBQUNEOztBQUVELFlBQU1TLFVBQVVKLGdCQUFHSyxZQUFILENBQWdCWCxJQUFoQixFQUFzQixFQUFFWSxVQUFVLE1BQVosRUFBdEIsQ0FBaEI7O0FBRUE7QUFDQSxZQUFJLENBQUNyQixZQUFZc0IsSUFBWixDQUFpQkgsT0FBakIsQ0FBTCxFQUFnQztBQUM5QmxCLGNBQUksd0NBQUosRUFBOENRLElBQTlDO0FBQ0FQLHNCQUFZZ0IsR0FBWixDQUFnQlIsUUFBaEIsRUFBMEIsSUFBMUI7QUFDQSxpQkFBTyxJQUFQO0FBQ0Q7O0FBRURULFlBQUksWUFBSixFQUFrQlMsUUFBbEIsRUFBNEIsVUFBNUIsRUFBd0NELElBQXhDO0FBQ0FHLG9CQUFZTCxpQkFBaUJnQixLQUFqQixDQUF1QmQsSUFBdkIsRUFBNkJVLE9BQTdCLEVBQXNDYixPQUF0QyxDQUFaOztBQUVBO0FBQ0EsWUFBSU0sYUFBYSxJQUFqQixFQUF1QjtBQUNyQlgsY0FBSSxzQ0FBSixFQUE0Q1EsSUFBNUM7QUFDQVAsc0JBQVlnQixHQUFaLENBQWdCUixRQUFoQixFQUEwQixJQUExQjtBQUNBLGlCQUFPLElBQVA7QUFDRDs7QUFFREUsa0JBQVVLLEtBQVYsR0FBa0JILE1BQU1HLEtBQXhCOztBQUVBO0FBQ0E7QUFDQSxZQUFJTCxVQUFVWSxXQUFkLEVBQTJCO0FBQ3pCdEIsc0JBQVlnQixHQUFaLENBQWdCUixRQUFoQixFQUEwQkUsU0FBMUI7QUFDRDtBQUNELGVBQU9BLFNBQVA7QUFDRCxPOztBQUVZSCxVLEVBQU1VLE8sRUFBU2IsTyxFQUFTO0FBQ25DLFlBQU1NLFlBQVksSUFBSWEsYUFBSixDQUFjaEIsSUFBZCxDQUFsQjtBQUNBLFlBQU1pQix3QkFBd0IsbUNBQWtCcEIsT0FBbEIsQ0FBOUI7O0FBRUEsWUFBSXFCLFlBQUo7QUFDQSxZQUFJSCxvQkFBSjtBQUNBLFlBQUk7QUFDRixjQUFNSSxTQUFTLHdCQUFNbkIsSUFBTixFQUFZVSxPQUFaLEVBQXFCYixPQUFyQixDQUFmO0FBQ0FxQixnQkFBTUMsT0FBT0QsR0FBYjtBQUNBSCx3QkFBY0ksT0FBT0osV0FBckI7QUFDRCxTQUpELENBSUUsT0FBT0ssR0FBUCxFQUFZO0FBQ1pqQixvQkFBVWtCLE1BQVYsQ0FBaUJDLElBQWpCLENBQXNCRixHQUF0QjtBQUNBLGlCQUFPakIsU0FBUCxDQUZZLENBRU07QUFDbkI7O0FBRURBLGtCQUFVWSxXQUFWLEdBQXdCQSxXQUF4Qjs7QUFFQSxZQUFJUSxvQkFBb0IsS0FBeEI7O0FBRUEsWUFBTUMscUJBQXFCLElBQUlDLHNCQUFKLENBQWV6QixJQUFmLEVBQXFCSCxPQUFyQixDQUEzQjs7QUFFQSxpQkFBUzZCLG9CQUFULENBQThCM0IsTUFBOUIsRUFBc0M7QUFDcEN3Qiw4QkFBb0IsSUFBcEI7QUFDQSxjQUFJeEIsT0FBTzRCLElBQVAsS0FBZ0IsU0FBcEIsRUFBK0I7QUFDN0IsbUJBQU8sSUFBUDtBQUNEO0FBQ0QsY0FBTS9CLElBQUk0QixtQkFBbUJJLE9BQW5CLENBQTJCN0IsT0FBTzhCLEtBQWxDLENBQVY7QUFDQSxjQUFJakMsS0FBSyxJQUFULEVBQWU7QUFDYixtQkFBTyxJQUFQO0FBQ0Q7QUFDRCxjQUFNa0MscUJBQXFCLElBQUlDLEdBQUosRUFBM0I7QUFDQUQsNkJBQW1CRSxHQUFuQixDQUF1QiwwQkFBdkI7QUFDQSxjQUFNQyxTQUFTdEMsU0FBU0MsQ0FBVCxFQUFZQyxPQUFaLENBQWY7QUFDQU0sb0JBQVUrQixPQUFWLENBQWtCekIsR0FBbEIsQ0FBc0JiLENBQXRCLEVBQXlCO0FBQ3ZCcUMsMEJBRHVCO0FBRXZCRSwwQkFBYyxJQUFJSixHQUFKLENBQVEsQ0FBQztBQUNyQmhDLHNCQUFRO0FBQ1I7QUFDRThCLHVCQUFPOUIsT0FBTzhCLEtBRlI7QUFHTk8scUJBQUtyQyxPQUFPcUMsR0FITixFQURhOztBQU1yQk4sb0RBTnFCO0FBT3JCTyx1QkFBUyxJQVBZLEVBQUQsQ0FBUixDQUZTLEVBQXpCOzs7QUFZRDs7QUFFRCxnQ0FBTW5CLEdBQU4sRUFBV0gsV0FBWCxFQUF3QjtBQUN0QnVCLDBCQURzQix5Q0FDTEMsSUFESyxFQUNDO0FBQ3JCYixtQ0FBcUJhLEtBQUt4QyxNQUExQjtBQUNELGFBSHFCO0FBSXRCeUMsd0JBSnNCLHVDQUlQRCxJQUpPLEVBSUQ7QUFDbkIsa0JBQUlBLEtBQUtFLE1BQUwsQ0FBWWQsSUFBWixLQUFxQixRQUF6QixFQUFtQztBQUNqQ0QscUNBQXFCYSxLQUFLRyxTQUFMLENBQWUsQ0FBZixDQUFyQjtBQUNEO0FBQ0YsYUFScUIsMkJBQXhCOzs7QUFXQSxZQUFNQyxtQkFBbUJwRCxZQUFZcUQsUUFBWixDQUFxQjFCLEdBQXJCLENBQXpCO0FBQ0EsWUFBSSxDQUFDeUIsZ0JBQUQsSUFBcUIsQ0FBQ3BCLGlCQUExQixFQUE2QyxDQUFFLE9BQU8sSUFBUCxDQUFjOztBQUU3RDtBQUNBLFlBQUlMLElBQUkyQixRQUFSLEVBQWtCO0FBQ2hCM0IsY0FBSTJCLFFBQUosQ0FBYUMsSUFBYixDQUFrQixVQUFDQyxDQUFELEVBQU87QUFDdkIsZ0JBQUlBLEVBQUVwQixJQUFGLEtBQVcsT0FBZixFQUF3QixDQUFFLE9BQU8sS0FBUCxDQUFlO0FBQ3pDLGdCQUFJO0FBQ0Ysa0JBQU1xQixNQUFNQyxzQkFBU25DLEtBQVQsQ0FBZWlDLEVBQUVsQixLQUFqQixFQUF3QixFQUFFcUIsUUFBUSxJQUFWLEVBQXhCLENBQVo7QUFDQSxrQkFBSUYsSUFBSUcsSUFBSixDQUFTTCxJQUFULENBQWMsVUFBQ00sQ0FBRCxVQUFPQSxFQUFFQyxLQUFGLEtBQVksUUFBbkIsRUFBZCxDQUFKLEVBQWdEO0FBQzlDbEQsMEJBQVU2QyxHQUFWLEdBQWdCQSxHQUFoQjtBQUNBLHVCQUFPLElBQVA7QUFDRDtBQUNGLGFBTkQsQ0FNRSxPQUFPNUIsR0FBUCxFQUFZLENBQUUsWUFBYztBQUM5QixtQkFBTyxLQUFQO0FBQ0QsV0FWRDtBQVdEOztBQUVELFlBQU1rQyxpQkFBaUIsSUFBSUMsb0JBQUo7QUFDckJ2RCxZQURxQjtBQUVyQkgsZUFGcUI7QUFHckJNLGlCQUhxQjtBQUlyQkwsd0JBSnFCO0FBS3JCWSxlQUxxQjtBQU1yQlEsV0FOcUI7QUFPckJELDZCQVBxQjtBQVFyQnRCLGdCQVJxQixDQUF2Qjs7QUFVQXVCLFlBQUlzQyxJQUFKLENBQVNDLE9BQVQsQ0FBaUIsVUFBVUMsT0FBVixFQUFtQjtBQUNsQyxjQUFNQyxVQUFVTCxlQUFlTSxLQUFmLENBQXFCRixPQUFyQixDQUFoQjs7QUFFQSxjQUFJQyxRQUFRRCxRQUFRL0IsSUFBaEIsQ0FBSixFQUEyQjtBQUN6QmdDLG9CQUFRRCxRQUFRL0IsSUFBaEIsRUFBc0JrQyxJQUF0QixDQUEyQlAsY0FBM0I7QUFDRDtBQUNGLFNBTkQ7O0FBUUE7QUFDRXJDLDhCQUFzQjtBQUF0QixXQUNHZCxVQUFVMkQsU0FBVixDQUFvQkMsSUFBcEIsR0FBMkIsQ0FEOUIsQ0FDZ0M7QUFEaEMsV0FFRyxDQUFDNUQsVUFBVTJELFNBQVYsQ0FBb0JFLEdBQXBCLENBQXdCLFNBQXhCLENBSE4sQ0FHeUM7QUFIekMsVUFJRTtBQUNBN0Qsc0JBQVUyRCxTQUFWLENBQW9CckQsR0FBcEIsQ0FBd0IsU0FBeEIsRUFBbUMsRUFBbkMsRUFEQSxDQUN3QztBQUN6Qzs7QUFFRCxZQUFJa0MsZ0JBQUosRUFBc0I7QUFDcEJ4QyxvQkFBVThELFNBQVYsR0FBc0IsUUFBdEI7QUFDRDtBQUNELGVBQU85RCxTQUFQO0FBQ0QsTyxzRUE5S2tCTCxnQiIsImZpbGUiOiJidWlsZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcblxuaW1wb3J0IGRvY3RyaW5lIGZyb20gJ2RvY3RyaW5lJztcblxuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJztcblxuaW1wb3J0IHBhcnNlIGZyb20gJ2VzbGludC1tb2R1bGUtdXRpbHMvcGFyc2UnO1xuaW1wb3J0IHZpc2l0IGZyb20gJ2VzbGludC1tb2R1bGUtdXRpbHMvdmlzaXQnO1xuaW1wb3J0IHJlc29sdmUgZnJvbSAnZXNsaW50LW1vZHVsZS11dGlscy9yZXNvbHZlJztcbmltcG9ydCBpc0lnbm9yZWQsIHsgaGFzVmFsaWRFeHRlbnNpb24gfSBmcm9tICdlc2xpbnQtbW9kdWxlLXV0aWxzL2lnbm9yZSc7XG5cbmltcG9ydCB7IGhhc2hPYmplY3QgfSBmcm9tICdlc2xpbnQtbW9kdWxlLXV0aWxzL2hhc2gnO1xuaW1wb3J0ICogYXMgdW5hbWJpZ3VvdXMgZnJvbSAnZXNsaW50LW1vZHVsZS11dGlscy91bmFtYmlndW91cyc7XG5cbmltcG9ydCBFeHBvcnRNYXAgZnJvbSAnLic7XG5pbXBvcnQgY2hpbGRDb250ZXh0IGZyb20gJy4vY2hpbGRDb250ZXh0JztcbmltcG9ydCB7IGlzRXNNb2R1bGVJbnRlcm9wIH0gZnJvbSAnLi90eXBlc2NyaXB0JztcbmltcG9ydCB7IFJlbW90ZVBhdGggfSBmcm9tICcuL3JlbW90ZVBhdGgnO1xuaW1wb3J0IEltcG9ydEV4cG9ydFZpc2l0b3JCdWlsZGVyIGZyb20gJy4vdmlzaXRvcic7XG5cbmNvbnN0IGxvZyA9IGRlYnVnKCdlc2xpbnQtcGx1Z2luLWltcG9ydDpFeHBvcnRNYXAnKTtcblxuY29uc3QgZXhwb3J0Q2FjaGUgPSBuZXcgTWFwKCk7XG5cbi8qKlxuICogVGhlIGNyZWF0aW9uIG9mIHRoaXMgY2xvc3VyZSBpcyBpc29sYXRlZCBmcm9tIG90aGVyIHNjb3Blc1xuICogdG8gYXZvaWQgb3Zlci1yZXRlbnRpb24gb2YgdW5yZWxhdGVkIHZhcmlhYmxlcywgd2hpY2ggaGFzXG4gKiBjYXVzZWQgbWVtb3J5IGxlYWtzLiBTZWUgIzEyNjYuXG4gKi9cbmZ1bmN0aW9uIHRodW5rRm9yKHAsIGNvbnRleHQpIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lXG4gIHJldHVybiAoKSA9PiBFeHBvcnRNYXBCdWlsZGVyLmZvcihjaGlsZENvbnRleHQocCwgY29udGV4dCkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFeHBvcnRNYXBCdWlsZGVyIHtcbiAgc3RhdGljIGdldChzb3VyY2UsIGNvbnRleHQpIHtcbiAgICBjb25zdCBwYXRoID0gcmVzb2x2ZShzb3VyY2UsIGNvbnRleHQpO1xuICAgIGlmIChwYXRoID09IG51bGwpIHsgcmV0dXJuIG51bGw7IH1cblxuICAgIHJldHVybiBFeHBvcnRNYXBCdWlsZGVyLmZvcihjaGlsZENvbnRleHQocGF0aCwgY29udGV4dCkpO1xuICB9XG5cbiAgc3RhdGljIGZvcihjb250ZXh0KSB7XG4gICAgY29uc3QgeyBwYXRoIH0gPSBjb250ZXh0O1xuXG4gICAgY29uc3QgY2FjaGVLZXkgPSBjb250ZXh0LmNhY2hlS2V5IHx8IGhhc2hPYmplY3QoY29udGV4dCkuZGlnZXN0KCdoZXgnKTtcbiAgICBsZXQgZXhwb3J0TWFwID0gZXhwb3J0Q2FjaGUuZ2V0KGNhY2hlS2V5KTtcblxuICAgIC8vIHJldHVybiBjYWNoZWQgaWdub3JlXG4gICAgaWYgKGV4cG9ydE1hcCA9PT0gbnVsbCkgeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgY29uc3Qgc3RhdHMgPSBmcy5zdGF0U3luYyhwYXRoKTtcbiAgICBpZiAoZXhwb3J0TWFwICE9IG51bGwpIHtcbiAgICAgIC8vIGRhdGUgZXF1YWxpdHkgY2hlY2tcbiAgICAgIGlmIChleHBvcnRNYXAubXRpbWUgLSBzdGF0cy5tdGltZSA9PT0gMCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0TWFwO1xuICAgICAgfVxuICAgICAgLy8gZnV0dXJlOiBjaGVjayBjb250ZW50IGVxdWFsaXR5P1xuICAgIH1cblxuICAgIC8vIGNoZWNrIHZhbGlkIGV4dGVuc2lvbnMgZmlyc3RcbiAgICBpZiAoIWhhc1ZhbGlkRXh0ZW5zaW9uKHBhdGgsIGNvbnRleHQpKSB7XG4gICAgICBleHBvcnRDYWNoZS5zZXQoY2FjaGVLZXksIG51bGwpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgZm9yIGFuZCBjYWNoZSBpZ25vcmVcbiAgICBpZiAoaXNJZ25vcmVkKHBhdGgsIGNvbnRleHQpKSB7XG4gICAgICBsb2coJ2lnbm9yZWQgcGF0aCBkdWUgdG8gaWdub3JlIHNldHRpbmdzOicsIHBhdGgpO1xuICAgICAgZXhwb3J0Q2FjaGUuc2V0KGNhY2hlS2V5LCBudWxsKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMocGF0aCwgeyBlbmNvZGluZzogJ3V0ZjgnIH0pO1xuXG4gICAgLy8gY2hlY2sgZm9yIGFuZCBjYWNoZSB1bmFtYmlndW91cyBtb2R1bGVzXG4gICAgaWYgKCF1bmFtYmlndW91cy50ZXN0KGNvbnRlbnQpKSB7XG4gICAgICBsb2coJ2lnbm9yZWQgcGF0aCBkdWUgdG8gdW5hbWJpZ3VvdXMgcmVnZXg6JywgcGF0aCk7XG4gICAgICBleHBvcnRDYWNoZS5zZXQoY2FjaGVLZXksIG51bGwpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgbG9nKCdjYWNoZSBtaXNzJywgY2FjaGVLZXksICdmb3IgcGF0aCcsIHBhdGgpO1xuICAgIGV4cG9ydE1hcCA9IEV4cG9ydE1hcEJ1aWxkZXIucGFyc2UocGF0aCwgY29udGVudCwgY29udGV4dCk7XG5cbiAgICAvLyBhbWJpZ3VvdXMgbW9kdWxlcyByZXR1cm4gbnVsbFxuICAgIGlmIChleHBvcnRNYXAgPT0gbnVsbCkge1xuICAgICAgbG9nKCdpZ25vcmVkIHBhdGggZHVlIHRvIGFtYmlndW91cyBwYXJzZTonLCBwYXRoKTtcbiAgICAgIGV4cG9ydENhY2hlLnNldChjYWNoZUtleSwgbnVsbCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBleHBvcnRNYXAubXRpbWUgPSBzdGF0cy5tdGltZTtcblxuICAgIC8vIElmIHRoZSB2aXNpdG9yIGtleXMgd2VyZSBub3QgcG9wdWxhdGVkLCB0aGVuIHdlIHNob3VsZG4ndCBzYXZlIGFueXRoaW5nIHRvIHRoZSBjYWNoZSxcbiAgICAvLyBzaW5jZSB0aGUgcGFyc2UgcmVzdWx0cyBtYXkgbm90IGJlIHJlbGlhYmxlLlxuICAgIGlmIChleHBvcnRNYXAudmlzaXRvcktleXMpIHtcbiAgICAgIGV4cG9ydENhY2hlLnNldChjYWNoZUtleSwgZXhwb3J0TWFwKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cG9ydE1hcDtcbiAgfVxuXG4gIHN0YXRpYyBwYXJzZShwYXRoLCBjb250ZW50LCBjb250ZXh0KSB7XG4gICAgY29uc3QgZXhwb3J0TWFwID0gbmV3IEV4cG9ydE1hcChwYXRoKTtcbiAgICBjb25zdCBpc0VzTW9kdWxlSW50ZXJvcFRydWUgPSBpc0VzTW9kdWxlSW50ZXJvcChjb250ZXh0KTtcblxuICAgIGxldCBhc3Q7XG4gICAgbGV0IHZpc2l0b3JLZXlzO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBwYXJzZShwYXRoLCBjb250ZW50LCBjb250ZXh0KTtcbiAgICAgIGFzdCA9IHJlc3VsdC5hc3Q7XG4gICAgICB2aXNpdG9yS2V5cyA9IHJlc3VsdC52aXNpdG9yS2V5cztcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGV4cG9ydE1hcC5lcnJvcnMucHVzaChlcnIpO1xuICAgICAgcmV0dXJuIGV4cG9ydE1hcDsgLy8gY2FuJ3QgY29udGludWVcbiAgICB9XG5cbiAgICBleHBvcnRNYXAudmlzaXRvcktleXMgPSB2aXNpdG9yS2V5cztcblxuICAgIGxldCBoYXNEeW5hbWljSW1wb3J0cyA9IGZhbHNlO1xuXG4gICAgY29uc3QgcmVtb3RlUGF0aFJlc29sdmVyID0gbmV3IFJlbW90ZVBhdGgocGF0aCwgY29udGV4dCk7XG5cbiAgICBmdW5jdGlvbiBwcm9jZXNzRHluYW1pY0ltcG9ydChzb3VyY2UpIHtcbiAgICAgIGhhc0R5bmFtaWNJbXBvcnRzID0gdHJ1ZTtcbiAgICAgIGlmIChzb3VyY2UudHlwZSAhPT0gJ0xpdGVyYWwnKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgcCA9IHJlbW90ZVBhdGhSZXNvbHZlci5yZXNvbHZlKHNvdXJjZS52YWx1ZSk7XG4gICAgICBpZiAocCA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgaW1wb3J0ZWRTcGVjaWZpZXJzID0gbmV3IFNldCgpO1xuICAgICAgaW1wb3J0ZWRTcGVjaWZpZXJzLmFkZCgnSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyJyk7XG4gICAgICBjb25zdCBnZXR0ZXIgPSB0aHVua0ZvcihwLCBjb250ZXh0KTtcbiAgICAgIGV4cG9ydE1hcC5pbXBvcnRzLnNldChwLCB7XG4gICAgICAgIGdldHRlcixcbiAgICAgICAgZGVjbGFyYXRpb25zOiBuZXcgU2V0KFt7XG4gICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgLy8gY2FwdHVyaW5nIGFjdHVhbCBub2RlIHJlZmVyZW5jZSBob2xkcyBmdWxsIEFTVCBpbiBtZW1vcnkhXG4gICAgICAgICAgICB2YWx1ZTogc291cmNlLnZhbHVlLFxuICAgICAgICAgICAgbG9jOiBzb3VyY2UubG9jLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW1wb3J0ZWRTcGVjaWZpZXJzLFxuICAgICAgICAgIGR5bmFtaWM6IHRydWUsXG4gICAgICAgIH1dKSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHZpc2l0KGFzdCwgdmlzaXRvcktleXMsIHtcbiAgICAgIEltcG9ydEV4cHJlc3Npb24obm9kZSkge1xuICAgICAgICBwcm9jZXNzRHluYW1pY0ltcG9ydChub2RlLnNvdXJjZSk7XG4gICAgICB9LFxuICAgICAgQ2FsbEV4cHJlc3Npb24obm9kZSkge1xuICAgICAgICBpZiAobm9kZS5jYWxsZWUudHlwZSA9PT0gJ0ltcG9ydCcpIHtcbiAgICAgICAgICBwcm9jZXNzRHluYW1pY0ltcG9ydChub2RlLmFyZ3VtZW50c1swXSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB1bmFtYmlndW91c2x5RVNNID0gdW5hbWJpZ3VvdXMuaXNNb2R1bGUoYXN0KTtcbiAgICBpZiAoIXVuYW1iaWd1b3VzbHlFU00gJiYgIWhhc0R5bmFtaWNJbXBvcnRzKSB7IHJldHVybiBudWxsOyB9XG5cbiAgICAvLyBhdHRlbXB0IHRvIGNvbGxlY3QgbW9kdWxlIGRvY1xuICAgIGlmIChhc3QuY29tbWVudHMpIHtcbiAgICAgIGFzdC5jb21tZW50cy5zb21lKChjKSA9PiB7XG4gICAgICAgIGlmIChjLnR5cGUgIT09ICdCbG9jaycpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZG9jID0gZG9jdHJpbmUucGFyc2UoYy52YWx1ZSwgeyB1bndyYXA6IHRydWUgfSk7XG4gICAgICAgICAgaWYgKGRvYy50YWdzLnNvbWUoKHQpID0+IHQudGl0bGUgPT09ICdtb2R1bGUnKSkge1xuICAgICAgICAgICAgZXhwb3J0TWFwLmRvYyA9IGRvYztcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7IC8qIGlnbm9yZSAqLyB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHZpc2l0b3JCdWlsZGVyID0gbmV3IEltcG9ydEV4cG9ydFZpc2l0b3JCdWlsZGVyKFxuICAgICAgcGF0aCxcbiAgICAgIGNvbnRleHQsXG4gICAgICBleHBvcnRNYXAsXG4gICAgICBFeHBvcnRNYXBCdWlsZGVyLFxuICAgICAgY29udGVudCxcbiAgICAgIGFzdCxcbiAgICAgIGlzRXNNb2R1bGVJbnRlcm9wVHJ1ZSxcbiAgICAgIHRodW5rRm9yLFxuICAgICk7XG4gICAgYXN0LmJvZHkuZm9yRWFjaChmdW5jdGlvbiAoYXN0Tm9kZSkge1xuICAgICAgY29uc3QgdmlzaXRvciA9IHZpc2l0b3JCdWlsZGVyLmJ1aWxkKGFzdE5vZGUpO1xuXG4gICAgICBpZiAodmlzaXRvclthc3ROb2RlLnR5cGVdKSB7XG4gICAgICAgIHZpc2l0b3JbYXN0Tm9kZS50eXBlXS5jYWxsKHZpc2l0b3JCdWlsZGVyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChcbiAgICAgIGlzRXNNb2R1bGVJbnRlcm9wVHJ1ZSAvLyBlc01vZHVsZUludGVyb3AgaXMgb24gaW4gdHNjb25maWdcbiAgICAgICYmIGV4cG9ydE1hcC5uYW1lc3BhY2Uuc2l6ZSA+IDAgLy8gYW55dGhpbmcgaXMgZXhwb3J0ZWRcbiAgICAgICYmICFleHBvcnRNYXAubmFtZXNwYWNlLmhhcygnZGVmYXVsdCcpIC8vIGFuZCBkZWZhdWx0IGlzbid0IGFkZGVkIGFscmVhZHlcbiAgICApIHtcbiAgICAgIGV4cG9ydE1hcC5uYW1lc3BhY2Uuc2V0KCdkZWZhdWx0Jywge30pOyAvLyBhZGQgZGVmYXVsdCBleHBvcnRcbiAgICB9XG5cbiAgICBpZiAodW5hbWJpZ3VvdXNseUVTTSkge1xuICAgICAgZXhwb3J0TWFwLnBhcnNlR29hbCA9ICdNb2R1bGUnO1xuICAgIH1cbiAgICByZXR1cm4gZXhwb3J0TWFwO1xuICB9XG59XG4iXX0=</span></pre>
</body>
</html>