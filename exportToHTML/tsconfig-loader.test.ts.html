<html>
<head>
<title>tsconfig-loader.test.ts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
tsconfig-loader.test.ts</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">{</span>
  <span class="s1">loadTsconfig,</span>
  <span class="s1">tsConfigLoader,</span>
  <span class="s1">walkForTsConfig,</span>
<span class="s1">} from </span><span class="s2">&quot;../tsconfig-loader&quot;</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ join } from </span><span class="s2">&quot;path&quot;</span><span class="s1">;</span>

<span class="s1">describe(</span><span class="s2">&quot;tsconfig-loader&quot;</span><span class="s1">, () =&gt; {</span>
  <span class="s1">it(</span><span class="s2">&quot;should find tsconfig in cwd&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">result = tsConfigLoader({</span>
      <span class="s1">cwd: </span><span class="s2">&quot;/foo/bar&quot;</span><span class="s1">,</span>
      <span class="s1">getEnv: (_: string) =&gt; undefined,</span>
      <span class="s1">loadSync: (cwd: string) =&gt; {</span>
        <span class="s0">return </span><span class="s1">{</span>
          <span class="s1">tsConfigPath: </span><span class="s2">`</span><span class="s1">${cwd}</span><span class="s2">/tsconfig.json`</span><span class="s1">,</span>
          <span class="s1">baseUrl: </span><span class="s2">&quot;./&quot;</span><span class="s1">,</span>
          <span class="s1">paths: {},</span>
        <span class="s1">};</span>
      <span class="s1">},</span>
    <span class="s1">});</span>

    <span class="s3">// assert.equal(result.tsConfigPath, &quot;/foo/bar/tsconfig.json&quot;);</span>
    <span class="s1">expect(result.tsConfigPath).toBe(</span><span class="s2">&quot;/foo/bar/tsconfig.json&quot;</span><span class="s1">);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should return loaderResult.tsConfigPath as undefined when not found&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">result = tsConfigLoader({</span>
      <span class="s1">cwd: </span><span class="s2">&quot;/foo/bar&quot;</span><span class="s1">,</span>
      <span class="s1">getEnv: (_: string) =&gt; undefined,</span>
      <span class="s1">loadSync: (_: string) =&gt; {</span>
        <span class="s0">return </span><span class="s1">{</span>
          <span class="s1">tsConfigPath: undefined,</span>
          <span class="s1">baseUrl: </span><span class="s2">&quot;./&quot;</span><span class="s1">,</span>
          <span class="s1">paths: {},</span>
        <span class="s1">};</span>
      <span class="s1">},</span>
    <span class="s1">});</span>

    <span class="s3">// assert.isUndefined(result.tsConfigPath);</span>
    <span class="s1">expect(result.tsConfigPath).toBeUndefined();</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should use TS_NODE_PROJECT env if exists&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">result = tsConfigLoader({</span>
      <span class="s1">cwd: </span><span class="s2">&quot;/foo/bar&quot;</span><span class="s1">,</span>
      <span class="s1">getEnv: (key: string) =&gt;</span>
        <span class="s1">key === </span><span class="s2">&quot;TS_NODE_PROJECT&quot; </span><span class="s1">? </span><span class="s2">&quot;/foo/baz&quot; </span><span class="s1">: undefined,</span>
      <span class="s1">loadSync: (cwd: string, fileName: string) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(cwd === </span><span class="s2">&quot;/foo/bar&quot; </span><span class="s1">&amp;&amp; fileName === </span><span class="s2">&quot;/foo/baz&quot;</span><span class="s1">) {</span>
          <span class="s0">return </span><span class="s1">{</span>
            <span class="s1">tsConfigPath: </span><span class="s2">&quot;/foo/baz/tsconfig.json&quot;</span><span class="s1">,</span>
            <span class="s1">baseUrl: </span><span class="s2">&quot;./&quot;</span><span class="s1">,</span>
            <span class="s1">paths: {},</span>
          <span class="s1">};</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s1">{</span>
          <span class="s1">tsConfigPath: undefined,</span>
          <span class="s1">baseUrl: </span><span class="s2">&quot;./&quot;</span><span class="s1">,</span>
          <span class="s1">paths: {},</span>
        <span class="s1">};</span>
      <span class="s1">},</span>
    <span class="s1">});</span>

    <span class="s3">// assert.equal(result.tsConfigPath, &quot;/foo/baz/tsconfig.json&quot;);</span>
    <span class="s1">expect(result.tsConfigPath).toBe(</span><span class="s2">&quot;/foo/baz/tsconfig.json&quot;</span><span class="s1">);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should use TS_NODE_BASEURL env if exists&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">result = tsConfigLoader({</span>
      <span class="s1">cwd: </span><span class="s2">&quot;/foo/bar&quot;</span><span class="s1">,</span>
      <span class="s1">getEnv: (key: string) =&gt;</span>
        <span class="s1">key === </span><span class="s2">&quot;TS_NODE_BASEURL&quot; </span><span class="s1">? </span><span class="s2">&quot;SOME_BASEURL&quot; </span><span class="s1">: undefined,</span>
      <span class="s1">loadSync: (_0: string, _1: string, baseUrl: string) =&gt; {</span>
        <span class="s0">return </span><span class="s1">{</span>
          <span class="s1">tsConfigPath: undefined,</span>
          <span class="s1">baseUrl,</span>
          <span class="s1">paths: {},</span>
        <span class="s1">};</span>
      <span class="s1">},</span>
    <span class="s1">});</span>

    <span class="s3">// assert.equal(result.baseUrl, &quot;SOME_BASEURL&quot;);</span>
    <span class="s1">expect(result.baseUrl).toBe(</span><span class="s2">&quot;SOME_BASEURL&quot;</span><span class="s1">);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should not use TS_NODE_BASEURL env if it does not exist&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">result = tsConfigLoader({</span>
      <span class="s1">cwd: </span><span class="s2">&quot;/foo/bar&quot;</span><span class="s1">,</span>
      <span class="s1">getEnv: (_: string) =&gt; {</span>
        <span class="s0">return </span><span class="s1">undefined;</span>
      <span class="s1">},</span>
      <span class="s1">loadSync: (_0: string, _1: string, baseUrl: string) =&gt; {</span>
        <span class="s0">return </span><span class="s1">{</span>
          <span class="s1">tsConfigPath: undefined,</span>
          <span class="s1">baseUrl,</span>
          <span class="s1">paths: {},</span>
        <span class="s1">};</span>
      <span class="s1">},</span>
    <span class="s1">});</span>

    <span class="s3">// assert.equal(result.baseUrl, undefined);</span>
    <span class="s1">expect(result.baseUrl).toBeUndefined();</span>
  <span class="s1">});</span>
<span class="s1">});</span>

<span class="s1">describe(</span><span class="s2">&quot;walkForTsConfig&quot;</span><span class="s1">, () =&gt; {</span>
  <span class="s1">it(</span><span class="s2">&quot;should find tsconfig in starting directory&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">pathToTsconfig = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">res = walkForTsConfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt; path === pathToTsconfig</span>
    <span class="s1">);</span>
    <span class="s3">// assert.equal(res, pathToTsconfig);</span>
    <span class="s1">expect(res).toBe(pathToTsconfig);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should find tsconfig in parent directory&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">pathToTsconfig = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">res = walkForTsConfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt; path === pathToTsconfig</span>
    <span class="s1">);</span>
    <span class="s3">// assert.equal(res, pathToTsconfig);</span>
    <span class="s1">expect(res).toBe(pathToTsconfig);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should return undefined when reaching the top&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">res = walkForTsConfig(join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;kalle&quot;</span><span class="s1">), () =&gt; </span><span class="s0">false</span><span class="s1">);</span>
    <span class="s3">// assert.equal(res, undefined);</span>
    <span class="s1">expect(res).toBeUndefined();</span>
  <span class="s1">});</span>
<span class="s1">});</span>

<span class="s1">describe(</span><span class="s2">&quot;loadConfig&quot;</span><span class="s1">, () =&gt; {</span>
  <span class="s1">it(</span><span class="s2">&quot;should load a config&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s2">&quot;hej&quot; </span><span class="s1">} };</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(path) =&gt; path === </span><span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(_) =&gt; JSON.stringify(config)</span>
    <span class="s1">);</span>
    <span class="s3">// assert.deepEqual(res, config);</span>
    <span class="s1">expect(res).toStrictEqual(config);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with comments&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s2">&quot;hej&quot; </span><span class="s1">} };</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(path) =&gt; path === </span><span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(_) =&gt; </span><span class="s2">`{ 
          // my comment 
          &quot;compilerOptions&quot;: {  
            &quot;baseUrl&quot;: &quot;hej&quot; 
          } 
        }`</span>
    <span class="s1">);</span>
    <span class="s3">// assert.deepEqual(res, config);</span>
    <span class="s1">expect(res).toStrictEqual(config);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with trailing commas&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">config = { compilerOptions: { baseUrl: </span><span class="s2">&quot;hej&quot; </span><span class="s1">} };</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(path) =&gt; path === </span><span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
      <span class="s1">(_) =&gt; </span><span class="s2">`{ 
          &quot;compilerOptions&quot;: {  
            &quot;baseUrl&quot;: &quot;hej&quot;, 
          }, 
        }`</span>
    <span class="s1">);</span>
    <span class="s3">// assert.deepEqual(res, config);</span>
    <span class="s1">expect(res).toStrictEqual(config);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should throw an error including the file path when encountering invalid JSON5&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s1">expect(() =&gt;</span>
      <span class="s1">loadTsconfig(</span>
        <span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
        <span class="s1">(path) =&gt; path === </span><span class="s2">&quot;/root/dir1/tsconfig.json&quot;</span><span class="s1">,</span>
        <span class="s1">(_) =&gt; </span><span class="s2">`{ 
            &quot;compilerOptions&quot;: { 
          }`</span>
      <span class="s1">)</span>
    <span class="s1">).toThrowError(</span>
      <span class="s2">&quot;/root/dir1/tsconfig.json is malformed JSON5: invalid end of input at 3:12&quot;</span>
    <span class="s1">);</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with string extends and overwrite all options&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">firstConfig = {</span>
      <span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;../base-config.json&quot;</span><span class="s1">,</span>
      <span class="s1">compilerOptions: { baseUrl: </span><span class="s2">&quot;kalle&quot;</span><span class="s1">, paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] } },</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">firstConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">baseConfig = {</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: </span><span class="s2">&quot;olle&quot;</span><span class="s1">,</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar1&quot;</span><span class="s1">] },</span>
        <span class="s1">strict: </span><span class="s0">true</span><span class="s1">,</span>
      <span class="s1">},</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">baseConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;base-config.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt; path === firstConfigPath || path === baseConfigPath,</span>
      <span class="s1">(path) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(path === firstConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(firstConfig);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === baseConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig);</span>
        <span class="s1">}</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">);</span>

    <span class="s3">// assert.deepEqual(res, {</span>
    <span class="s3">//   extends: &quot;../base-config.json&quot;,</span>
    <span class="s3">//   compilerOptions: {</span>
    <span class="s3">//     baseUrl: &quot;kalle&quot;,</span>
    <span class="s3">//     paths: { foo: [&quot;bar2&quot;] },</span>
    <span class="s3">//     strict: true,</span>
    <span class="s3">//   },</span>
    <span class="s3">// });</span>
    <span class="s1">expect(res).toEqual({</span>
      <span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;../base-config.json&quot;</span><span class="s1">,</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: </span><span class="s2">&quot;kalle&quot;</span><span class="s1">,</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] },</span>
        <span class="s1">strict: </span><span class="s0">true</span><span class="s1">,</span>
      <span class="s1">},</span>
    <span class="s1">});</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with string extends from node_modules and overwrite all options&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">firstConfig = {</span>
      <span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;my-package/base-config.json&quot;</span><span class="s1">,</span>
      <span class="s1">compilerOptions: { baseUrl: </span><span class="s2">&quot;kalle&quot;</span><span class="s1">, paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] } },</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">firstConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">baseConfig = {</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: </span><span class="s2">&quot;olle&quot;</span><span class="s1">,</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar1&quot;</span><span class="s1">] },</span>
        <span class="s1">strict: </span><span class="s0">true</span><span class="s1">,</span>
      <span class="s1">},</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">baseConfigPath = join(</span>
      <span class="s2">&quot;/root&quot;</span><span class="s1">,</span>
      <span class="s2">&quot;dir1&quot;</span><span class="s1">,</span>
      <span class="s2">&quot;node_modules&quot;</span><span class="s1">,</span>
      <span class="s2">&quot;my-package&quot;</span><span class="s1">,</span>
      <span class="s2">&quot;base-config.json&quot;</span>
    <span class="s1">);</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt; path === firstConfigPath || path === baseConfigPath,</span>
      <span class="s1">(path) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(path === firstConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(firstConfig);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === baseConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig);</span>
        <span class="s1">}</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">);</span>

    <span class="s3">// assert.deepEqual(res, {</span>
    <span class="s3">//   extends: &quot;my-package/base-config.json&quot;,</span>
    <span class="s3">//   compilerOptions: {</span>
    <span class="s3">//     baseUrl: &quot;kalle&quot;,</span>
    <span class="s3">//     paths: { foo: [&quot;bar2&quot;] },</span>
    <span class="s3">//     strict: true,</span>
    <span class="s3">//   },</span>
    <span class="s3">// });</span>
    <span class="s1">expect(res).toEqual({</span>
      <span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;my-package/base-config.json&quot;</span><span class="s1">,</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: </span><span class="s2">&quot;kalle&quot;</span><span class="s1">,</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] },</span>
        <span class="s1">strict: </span><span class="s0">true</span><span class="s1">,</span>
      <span class="s1">},</span>
    <span class="s1">});</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should use baseUrl relative to location of extended tsconfig&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">firstConfig = { compilerOptions: { baseUrl: </span><span class="s2">&quot;.&quot; </span><span class="s1">} };</span>
    <span class="s0">const </span><span class="s1">firstConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;first-config.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">secondConfig = { </span><span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;../first-config.json&quot; </span><span class="s1">};</span>
    <span class="s0">const </span><span class="s1">secondConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;second-config.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">thirdConfig = { </span><span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;../second-config.json&quot; </span><span class="s1">};</span>
    <span class="s0">const </span><span class="s1">thirdConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;dir2&quot;</span><span class="s1">, </span><span class="s2">&quot;third-config.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;dir2&quot;</span><span class="s1">, </span><span class="s2">&quot;third-config.json&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt;</span>
        <span class="s1">path === firstConfigPath ||</span>
        <span class="s1">path === secondConfigPath ||</span>
        <span class="s1">path === thirdConfigPath,</span>
      <span class="s1">(path) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(path === firstConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(firstConfig);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === secondConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(secondConfig);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === thirdConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(thirdConfig);</span>
        <span class="s1">}</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">);</span>

    <span class="s3">// assert.deepEqual(res, {</span>
    <span class="s3">//   extends: &quot;../second-config.json&quot;,</span>
    <span class="s3">//   compilerOptions: { baseUrl: join(&quot;..&quot;, &quot;..&quot;) },</span>
    <span class="s3">// });</span>
    <span class="s1">expect(res).toEqual({</span>
      <span class="s0">extends</span><span class="s1">: </span><span class="s2">&quot;../second-config.json&quot;</span><span class="s1">,</span>
      <span class="s1">compilerOptions: { baseUrl: join(</span><span class="s2">&quot;..&quot;</span><span class="s1">, </span><span class="s2">&quot;..&quot;</span><span class="s1">) },</span>
    <span class="s1">});</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with array extends and overwrite all options&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">baseConfig1 = {</span>
      <span class="s1">compilerOptions: { baseUrl: </span><span class="s2">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s2">&quot;bar&quot;</span><span class="s1">] } },</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">baseConfig1Path = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;base-config-1.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">baseConfig2 = { compilerOptions: { baseUrl: </span><span class="s2">&quot;.&quot; </span><span class="s1">} };</span>
    <span class="s0">const </span><span class="s1">baseConfig2Path = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;base-config-2.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">baseConfig3 = {</span>
      <span class="s1">compilerOptions: { baseUrl: </span><span class="s2">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] } },</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">baseConfig3Path = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;dir2&quot;</span><span class="s1">, </span><span class="s2">&quot;base-config-3.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">actualConfig = {</span>
      <span class="s0">extends</span><span class="s1">: [</span>
        <span class="s2">&quot;./base-config-1.json&quot;</span><span class="s1">,</span>
        <span class="s2">&quot;./dir1/base-config-2.json&quot;</span><span class="s1">,</span>
        <span class="s2">&quot;./dir1/dir2/base-config-3.json&quot;</span><span class="s1">,</span>
      <span class="s1">],</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">actualConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>

    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt;</span>
        <span class="s1">[</span>
          <span class="s1">baseConfig1Path,</span>
          <span class="s1">baseConfig2Path,</span>
          <span class="s1">baseConfig3Path,</span>
          <span class="s1">actualConfigPath,</span>
        <span class="s1">].indexOf(path) &gt;= </span><span class="s4">0</span><span class="s1">,</span>
      <span class="s1">(path) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(path === baseConfig1Path) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig1);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === baseConfig2Path) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig2);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === baseConfig3Path) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig3);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === actualConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(actualConfig);</span>
        <span class="s1">}</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">);</span>

    <span class="s1">expect(res).toEqual({</span>
      <span class="s0">extends</span><span class="s1">: [</span>
        <span class="s2">&quot;./base-config-1.json&quot;</span><span class="s1">,</span>
        <span class="s2">&quot;./dir1/base-config-2.json&quot;</span><span class="s1">,</span>
        <span class="s2">&quot;./dir1/dir2/base-config-3.json&quot;</span><span class="s1">,</span>
      <span class="s1">],</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: join(</span><span class="s2">&quot;dir1&quot;</span><span class="s1">, </span><span class="s2">&quot;dir2&quot;</span><span class="s1">),</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar2&quot;</span><span class="s1">] },</span>
      <span class="s1">},</span>
    <span class="s1">});</span>
  <span class="s1">});</span>

  <span class="s1">it(</span><span class="s2">&quot;should load a config with array extends without .json extension&quot;</span><span class="s1">, () =&gt; {</span>
    <span class="s0">const </span><span class="s1">baseConfig = {</span>
      <span class="s1">compilerOptions: { baseUrl: </span><span class="s2">&quot;.&quot;</span><span class="s1">, paths: { foo: [</span><span class="s2">&quot;bar&quot;</span><span class="s1">] } },</span>
    <span class="s1">};</span>
    <span class="s0">const </span><span class="s1">baseConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;base-config-1.json&quot;</span><span class="s1">);</span>
    <span class="s0">const </span><span class="s1">actualConfig = { </span><span class="s0">extends</span><span class="s1">: [</span><span class="s2">&quot;./base-config-1&quot;</span><span class="s1">] };</span>
    <span class="s0">const </span><span class="s1">actualConfigPath = join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">);</span>

    <span class="s0">const </span><span class="s1">res = loadTsconfig(</span>
      <span class="s1">join(</span><span class="s2">&quot;/root&quot;</span><span class="s1">, </span><span class="s2">&quot;tsconfig.json&quot;</span><span class="s1">),</span>
      <span class="s1">(path) =&gt; [baseConfigPath, actualConfigPath].indexOf(path) &gt;= </span><span class="s4">0</span><span class="s1">,</span>
      <span class="s1">(path) =&gt; {</span>
        <span class="s0">if </span><span class="s1">(path === baseConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(baseConfig);</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(path === actualConfigPath) {</span>
          <span class="s0">return </span><span class="s1">JSON.stringify(actualConfig);</span>
        <span class="s1">}</span>
        <span class="s0">return </span><span class="s2">&quot;&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">);</span>

    <span class="s1">expect(res).toEqual({</span>
      <span class="s0">extends</span><span class="s1">: [</span><span class="s2">&quot;./base-config-1&quot;</span><span class="s1">],</span>
      <span class="s1">compilerOptions: {</span>
        <span class="s1">baseUrl: </span><span class="s2">&quot;.&quot;</span><span class="s1">,</span>
        <span class="s1">paths: { foo: [</span><span class="s2">&quot;bar&quot;</span><span class="s1">] },</span>
      <span class="s1">},</span>
    <span class="s1">});</span>
  <span class="s1">});</span>
<span class="s1">});</span>
</pre>
</body>
</html>