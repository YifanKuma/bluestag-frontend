<html>
<head>
<title>send-payload.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
send-payload.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/server/send-payload.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { IncomingMessage, ServerResponse } from 'http'</span><span class="s3">\n</span><span class="s1">import type RenderResult from './render-result'</span><span class="s3">\n</span><span class="s1">import type { CacheControl } from './lib/cache-control'</span><span class="s3">\n\n</span><span class="s1">import { isResSent } from '../shared/lib/utils'</span><span class="s3">\n</span><span class="s1">import { generateETag } from './lib/etag'</span><span class="s3">\n</span><span class="s1">import fresh from 'next/dist/compiled/fresh'</span><span class="s3">\n</span><span class="s1">import { getCacheControlHeader } from './lib/cache-control'</span><span class="s3">\n</span><span class="s1">import { HTML_CONTENT_TYPE_HEADER } from '../lib/constants'</span><span class="s3">\n\n</span><span class="s1">export function sendEtagResponse(</span><span class="s3">\n  </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n  </span><span class="s1">res: ServerResponse,</span><span class="s3">\n  </span><span class="s1">etag: string | undefined</span><span class="s3">\n</span><span class="s1">): boolean {</span><span class="s3">\n  </span><span class="s1">if (etag) {</span><span class="s3">\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* The server generating a 304 response MUST generate any of the</span><span class="s3">\n     </span><span class="s1">* following header fields that would have been sent in a 200 (OK)</span><span class="s3">\n     </span><span class="s1">* response to the same request: Cache-Control, Content-Location, Date,</span><span class="s3">\n     </span><span class="s1">* ETag, Expires, and Vary. https://tools.ietf.org/html/rfc7232#section-4.1</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n    </span><span class="s1">res.setHeader('ETag', etag)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (fresh(req.headers, { etag })) {</span><span class="s3">\n    </span><span class="s1">res.statusCode = 304</span><span class="s3">\n    </span><span class="s1">res.end()</span><span class="s3">\n    </span><span class="s1">return true</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return false</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function sendRenderResult({</span><span class="s3">\n  </span><span class="s1">req,</span><span class="s3">\n  </span><span class="s1">res,</span><span class="s3">\n  </span><span class="s1">result,</span><span class="s3">\n  </span><span class="s1">generateEtags,</span><span class="s3">\n  </span><span class="s1">poweredByHeader,</span><span class="s3">\n  </span><span class="s1">cacheControl,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">req: IncomingMessage</span><span class="s3">\n  </span><span class="s1">res: ServerResponse</span><span class="s3">\n  </span><span class="s1">result: RenderResult</span><span class="s3">\n  </span><span class="s1">generateEtags: boolean</span><span class="s3">\n  </span><span class="s1">poweredByHeader: boolean</span><span class="s3">\n  </span><span class="s1">cacheControl: CacheControl | undefined</span><span class="s3">\n</span><span class="s1">}): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">if (isResSent(res)) {</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (poweredByHeader &amp;&amp; result.contentType === HTML_CONTENT_TYPE_HEADER) {</span><span class="s3">\n    </span><span class="s1">res.setHeader('X-Powered-By', 'Next.js')</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// If cache control is already set on the response we don't</span><span class="s3">\n  </span><span class="s1">// override it to allow users to customize it via next.config</span><span class="s3">\n  </span><span class="s1">if (cacheControl &amp;&amp; !res.getHeader('Cache-Control')) {</span><span class="s3">\n    </span><span class="s1">res.setHeader('Cache-Control', getCacheControlHeader(cacheControl))</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const payload = result.isDynamic ? null : result.toUnchunkedString()</span><span class="s3">\n\n  </span><span class="s1">if (generateEtags &amp;&amp; payload !== null) {</span><span class="s3">\n    </span><span class="s1">const etag = generateETag(payload)</span><span class="s3">\n    </span><span class="s1">if (sendEtagResponse(req, res, etag)) {</span><span class="s3">\n      </span><span class="s1">return</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (!res.getHeader('Content-Type') &amp;&amp; result.contentType) {</span><span class="s3">\n    </span><span class="s1">res.setHeader('Content-Type', result.contentType)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (payload) {</span><span class="s3">\n    </span><span class="s1">res.setHeader('Content-Length', Buffer.byteLength(payload))</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (req.method === 'HEAD') {</span><span class="s3">\n    </span><span class="s1">res.end(null)</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (payload !== null) {</span><span class="s3">\n    </span><span class="s1">res.end(payload)</span><span class="s3">\n    </span><span class="s1">return</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Pipe the render result to the response after we get a writer for it.</span><span class="s3">\n  </span><span class="s1">await result.pipeToNodeResponse(res)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;sendEtagResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;sendRenderResult&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;etag&quot;</span><span class="s0">,</span><span class="s1">&quot;setHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;fresh&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;statusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;end&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;generateEtags&quot;</span><span class="s0">,</span><span class="s1">&quot;poweredByHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;cacheControl&quot;</span><span class="s0">,</span><span class="s1">&quot;isResSent&quot;</span><span class="s0">,</span><span class="s1">&quot;contentType&quot;</span><span class="s0">,</span><span class="s1">&quot;HTML_CONTENT_TYPE_HEADER&quot;</span><span class="s0">,</span><span class="s1">&quot;getHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;getCacheControlHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;payload&quot;</span><span class="s0">,</span><span class="s1">&quot;isDynamic&quot;</span><span class="s0">,</span><span class="s1">&quot;toUnchunkedString&quot;</span><span class="s0">,</span><span class="s1">&quot;generateETag&quot;</span><span class="s0">,</span><span class="s1">&quot;Buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;byteLength&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;pipeToNodeResponse&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;IAUgBA,gBAAgB;eAAhBA;;IAwBMC,gBAAgB;eAAhBA;;;uBA9BI;sBACG;8DACX;8BACoB;2BACG;;;;;;AAElC,SAASD,iBACdE,GAAoB,EACpBC,GAAmB,EACnBC,IAAwB;IAExB,IAAIA,MAAM;QACR;;;;;KAKC,GACDD,IAAIE,SAAS,CAAC,QAAQD;IACxB;IAEA,IAAIE,IAAAA,cAAK,EAACJ,IAAIK,OAAO,EAAE;QAAEH;IAAK,IAAI;QAChCD,IAAIK,UAAU,GAAG;QACjBL,IAAIM,GAAG;QACP,OAAO;IACT;IAEA,OAAO;AACT;AAEO,eAAeR,iBAAiB,EACrCC,GAAG,EACHC,GAAG,EACHO,MAAM,EACNC,aAAa,EACbC,eAAe,EACfC,YAAY,EAQb;IACC,IAAIC,IAAAA,gBAAS,EAACX,MAAM;QAClB;IACF;IAEA,IAAIS,mBAAmBF,OAAOK,WAAW,KAAKC,mCAAwB,EAAE;QACtEb,IAAIE,SAAS,CAAC,gBAAgB;IAChC;IAEA,2DAA2D;IAC3D,6DAA6D;IAC7D,IAAIQ,gBAAgB,CAACV,IAAIc,SAAS,CAAC,kBAAkB;QACnDd,IAAIE,SAAS,CAAC,iBAAiBa,IAAAA,mCAAqB,EAACL;IACvD;IAEA,MAAMM,UAAUT,OAAOU,SAAS,GAAG,OAAOV,OAAOW,iBAAiB;IAElE,IAAIV,iBAAiBQ,YAAY,MAAM;QACrC,MAAMf,OAAOkB,IAAAA,kBAAY,EAACH;QAC1B,IAAInB,iBAAiBE,KAAKC,KAAKC,OAAO;YACpC;QACF;IACF;IAEA,IAAI,CAACD,IAAIc,SAAS,CAAC,mBAAmBP,OAAOK,WAAW,EAAE;QACxDZ,IAAIE,SAAS,CAAC,gBAAgBK,OAAOK,WAAW;IAClD;IAEA,IAAII,SAAS;QACXhB,IAAIE,SAAS,CAAC,kBAAkBkB,OAAOC,UAAU,CAACL;IACpD;IAEA,IAAIjB,IAAIuB,MAAM,KAAK,QAAQ;QACzBtB,IAAIM,GAAG,CAAC;QACR;IACF;IAEA,IAAIU,YAAY,MAAM;QACpBhB,IAAIM,GAAG,CAACU;QACR;IACF;IAEA,uEAAuE;IACvE,MAAMT,OAAOgB,kBAAkB,CAACvB;AAClC&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>