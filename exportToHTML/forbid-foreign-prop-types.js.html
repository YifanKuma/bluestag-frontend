<html>
<head>
<title>forbid-foreign-prop-types.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #8c8c8c; font-style: italic;}
.s2 { color: #080808;}
.s3 { color: #067d17;}
.s4 { color: #0033b3;}
.s5 { color: #0037a6;}
.s6 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
forbid-foreign-prop-types.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@fileoverview </span><span class="s0">Forbid using another component's propTypes</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Ian Christian Myers</span>
 <span class="s0">*/</span>

<span class="s3">'use strict'</span><span class="s2">;</span>

<span class="s4">const </span><span class="s2">docsUrl = require(</span><span class="s3">'../util/docsUrl'</span><span class="s2">);</span>
<span class="s4">const </span><span class="s2">ast = require(</span><span class="s3">'../util/ast'</span><span class="s2">);</span>
<span class="s4">const </span><span class="s2">report = require(</span><span class="s3">'../util/report'</span><span class="s2">);</span>

<span class="s4">const </span><span class="s2">messages = {</span>
  <span class="s2">forbiddenPropType: </span><span class="s3">'Using propTypes from another component is not safe because they may be removed in production builds'</span><span class="s2">,</span>
<span class="s2">};</span>

<span class="s0">/** </span><span class="s1">@type </span><span class="s0">{import('eslint').Rule.RuleModule} */</span>
<span class="s2">module.exports = {</span>
  <span class="s2">meta: {</span>
    <span class="s2">docs: {</span>
      <span class="s2">description: </span><span class="s3">'Disallow using another component</span><span class="s5">\'</span><span class="s3">s propTypes'</span><span class="s2">,</span>
      <span class="s2">category: </span><span class="s3">'Best Practices'</span><span class="s2">,</span>
      <span class="s2">recommended: </span><span class="s4">false</span><span class="s2">,</span>
      <span class="s2">url: docsUrl(</span><span class="s3">'forbid-foreign-prop-types'</span><span class="s2">),</span>
    <span class="s2">},</span>

    <span class="s2">messages,</span>

    <span class="s2">schema: [</span>
      <span class="s2">{</span>
        <span class="s2">type: </span><span class="s3">'object'</span><span class="s2">,</span>
        <span class="s2">properties: {</span>
          <span class="s2">allowInPropTypes: {</span>
            <span class="s2">type: </span><span class="s3">'boolean'</span><span class="s2">,</span>
          <span class="s2">},</span>
        <span class="s2">},</span>
        <span class="s2">additionalProperties: </span><span class="s4">false</span><span class="s2">,</span>
      <span class="s2">},</span>
    <span class="s2">],</span>
  <span class="s2">},</span>

  <span class="s2">create(context) {</span>
    <span class="s4">const </span><span class="s2">config = context.options[</span><span class="s6">0</span><span class="s2">] || {};</span>
    <span class="s4">const </span><span class="s2">allowInPropTypes = config.allowInPropTypes || </span><span class="s4">false</span><span class="s2">;</span>

    <span class="s0">// --------------------------------------------------------------------------</span>
    <span class="s0">// Helpers</span>
    <span class="s0">// --------------------------------------------------------------------------</span>

    <span class="s4">function </span><span class="s2">findParentAssignmentExpression(node) {</span>
      <span class="s4">let </span><span class="s2">parent = node.parent;</span>

      <span class="s4">while </span><span class="s2">(parent &amp;&amp; parent.type !== </span><span class="s3">'Program'</span><span class="s2">) {</span>
        <span class="s4">if </span><span class="s2">(parent.type === </span><span class="s3">'AssignmentExpression'</span><span class="s2">) {</span>
          <span class="s4">return </span><span class="s2">parent;</span>
        <span class="s2">}</span>
        <span class="s2">parent = parent.parent;</span>
      <span class="s2">}</span>
      <span class="s4">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s4">function </span><span class="s2">findParentClassProperty(node) {</span>
      <span class="s4">let </span><span class="s2">parent = node.parent;</span>

      <span class="s4">while </span><span class="s2">(parent &amp;&amp; parent.type !== </span><span class="s3">'Program'</span><span class="s2">) {</span>
        <span class="s4">if </span><span class="s2">(parent.type === </span><span class="s3">'ClassProperty' </span><span class="s2">|| parent.type === </span><span class="s3">'PropertyDefinition'</span><span class="s2">) {</span>
          <span class="s4">return </span><span class="s2">parent;</span>
        <span class="s2">}</span>
        <span class="s2">parent = parent.parent;</span>
      <span class="s2">}</span>
      <span class="s4">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s4">function </span><span class="s2">isAllowedAssignment(node) {</span>
      <span class="s4">if </span><span class="s2">(!allowInPropTypes) {</span>
        <span class="s4">return false</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s4">const </span><span class="s2">assignmentExpression = findParentAssignmentExpression(node);</span>

      <span class="s4">if </span><span class="s2">(</span>
        <span class="s2">assignmentExpression</span>
        <span class="s2">&amp;&amp; assignmentExpression.left</span>
        <span class="s2">&amp;&amp; assignmentExpression.left.property</span>
        <span class="s2">&amp;&amp; assignmentExpression.left.property.name === </span><span class="s3">'propTypes'</span>
      <span class="s2">) {</span>
        <span class="s4">return true</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s4">const </span><span class="s2">classProperty = findParentClassProperty(node);</span>

      <span class="s4">if </span><span class="s2">(</span>
        <span class="s2">classProperty</span>
        <span class="s2">&amp;&amp; classProperty.key</span>
        <span class="s2">&amp;&amp; classProperty.key.name === </span><span class="s3">'propTypes'</span>
      <span class="s2">) {</span>
        <span class="s4">return true</span><span class="s2">;</span>
      <span class="s2">}</span>
      <span class="s4">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s4">return </span><span class="s2">{</span>
      <span class="s2">MemberExpression(node) {</span>
        <span class="s4">if </span><span class="s2">(</span>
          <span class="s2">(node.property</span>
          <span class="s2">&amp;&amp; (</span>
            <span class="s2">!node.computed</span>
            <span class="s2">&amp;&amp; node.property.type === </span><span class="s3">'Identifier'</span>
            <span class="s2">&amp;&amp; node.property.name === </span><span class="s3">'propTypes'</span>
            <span class="s2">&amp;&amp; !ast.isAssignmentLHS(node)</span>
            <span class="s2">&amp;&amp; !isAllowedAssignment(node)</span>
          <span class="s2">)) || (</span>
            <span class="s0">// @ts-expect-error: The JSXText type is not present in the estree type definitions</span>
            <span class="s2">(node.property.type === </span><span class="s3">'Literal' </span><span class="s2">|| node.property.type === </span><span class="s3">'JSXText'</span><span class="s2">)</span>
            <span class="s2">&amp;&amp; </span><span class="s3">'value' </span><span class="s4">in </span><span class="s2">node.property</span>
            <span class="s2">&amp;&amp; node.property.value === </span><span class="s3">'propTypes'</span>
            <span class="s2">&amp;&amp; !ast.isAssignmentLHS(node)</span>
            <span class="s2">&amp;&amp; !isAllowedAssignment(node)</span>
          <span class="s2">)</span>
        <span class="s2">) {</span>
          <span class="s2">report(context, messages.forbiddenPropType, </span><span class="s3">'forbiddenPropType'</span><span class="s2">, {</span>
            <span class="s2">node: node.property,</span>
          <span class="s2">});</span>
        <span class="s2">}</span>
      <span class="s2">},</span>

      <span class="s2">ObjectPattern(node) {</span>
        <span class="s4">const </span><span class="s2">propTypesNode = node.properties.find((property) =&gt; (</span>
          <span class="s2">property.type === </span><span class="s3">'Property'</span>
          <span class="s2">&amp;&amp; </span><span class="s3">'name' </span><span class="s4">in </span><span class="s2">property.key</span>
          <span class="s2">&amp;&amp; property.key.name === </span><span class="s3">'propTypes'</span>
        <span class="s2">));</span>

        <span class="s4">if </span><span class="s2">(propTypesNode) {</span>
          <span class="s2">report(context, messages.forbiddenPropType, </span><span class="s3">'forbiddenPropType'</span><span class="s2">, {</span>
            <span class="s2">node: propTypesNode,</span>
          <span class="s2">});</span>
        <span class="s2">}</span>
      <span class="s2">},</span>
    <span class="s2">};</span>
  <span class="s2">},</span>
<span class="s2">};</span>
</pre>
</body>
</html>