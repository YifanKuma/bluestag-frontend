<html>
<head>
<title>detached-flush.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
detached-flush.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/telemetry/detached-flush.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import fs from 'fs'</span><span class="s3">\n</span><span class="s1">import path from 'path'</span><span class="s3">\n</span><span class="s1">import type { TelemetryEvent } from './storage'</span><span class="s3">\n</span><span class="s1">import { Telemetry } from './storage'</span><span class="s3">\n</span><span class="s1">import loadConfig from '../server/config'</span><span class="s3">\n</span><span class="s1">import { getProjectDir } from '../lib/get-project-dir'</span><span class="s3">\n</span><span class="s1">import { PHASE_DEVELOPMENT_SERVER } from '../shared/lib/constants'</span><span class="s3">\n\n</span><span class="s1">// this process should be started with following arg order</span><span class="s3">\n</span><span class="s1">// 1. mode e.g. dev, export, start</span><span class="s3">\n</span><span class="s1">// 2. project dir</span><span class="s3">\n</span><span class="s1">;(async () =&gt; {</span><span class="s3">\n  </span><span class="s1">const args = [...process.argv]</span><span class="s3">\n  </span><span class="s1">let dir = args.pop()</span><span class="s3">\n  </span><span class="s1">const mode = args.pop()</span><span class="s3">\n\n  </span><span class="s1">if (!dir || mode !== 'dev') {</span><span class="s3">\n    </span><span class="s1">throw new Error(</span><span class="s3">\n      </span><span class="s1">`Invalid flags should be run as node detached-flush dev ./path-to/project`</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">dir = getProjectDir(dir)</span><span class="s3">\n\n  </span><span class="s1">const config = await loadConfig(PHASE_DEVELOPMENT_SERVER, dir)</span><span class="s3">\n  </span><span class="s1">const distDir = path.join(dir, config.distDir || '.next')</span><span class="s3">\n  </span><span class="s1">const eventsPath = path.join(distDir, '_events.json')</span><span class="s3">\n\n  </span><span class="s1">let events: TelemetryEvent[]</span><span class="s3">\n  </span><span class="s1">try {</span><span class="s3">\n    </span><span class="s1">events = JSON.parse(fs.readFileSync(eventsPath, 'utf8'))</span><span class="s3">\n  </span><span class="s1">} catch (err: any) {</span><span class="s3">\n    </span><span class="s1">if (err.code === 'ENOENT') {</span><span class="s3">\n      </span><span class="s1">// no events to process we can exit now</span><span class="s3">\n      </span><span class="s1">process.exit(0)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">throw err</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const telemetry = new Telemetry({ distDir })</span><span class="s3">\n  </span><span class="s1">await telemetry.record(events)</span><span class="s3">\n  </span><span class="s1">await telemetry.flush()</span><span class="s3">\n\n  </span><span class="s1">// finished flushing events clean-up/exit</span><span class="s3">\n  </span><span class="s1">fs.unlinkSync(eventsPath)</span><span class="s3">\n  </span><span class="s1">process.exit(0)</span><span class="s3">\n</span><span class="s1">})()</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;args&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;argv&quot;</span><span class="s0">,</span><span class="s1">&quot;dir&quot;</span><span class="s0">,</span><span class="s1">&quot;pop&quot;</span><span class="s0">,</span><span class="s1">&quot;mode&quot;</span><span class="s0">,</span><span class="s1">&quot;Error&quot;</span><span class="s0">,</span><span class="s1">&quot;getProjectDir&quot;</span><span class="s0">,</span><span class="s1">&quot;config&quot;</span><span class="s0">,</span><span class="s1">&quot;loadConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;PHASE_DEVELOPMENT_SERVER&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;path&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;eventsPath&quot;</span><span class="s0">,</span><span class="s1">&quot;events&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;fs&quot;</span><span class="s0">,</span><span class="s1">&quot;readFileSync&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;code&quot;</span><span class="s0">,</span><span class="s1">&quot;exit&quot;</span><span class="s0">,</span><span class="s1">&quot;telemetry&quot;</span><span class="s0">,</span><span class="s1">&quot;Telemetry&quot;</span><span class="s0">,</span><span class="s1">&quot;record&quot;</span><span class="s0">,</span><span class="s1">&quot;flush&quot;</span><span class="s0">,</span><span class="s1">&quot;unlinkSync&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;2DAAe;6DACE;yBAES;+DACH;+BACO;2BACW;;;;;;AAKvC,CAAA;IACA,MAAMA,OAAO;WAAIC,QAAQC,IAAI;KAAC;IAC9B,IAAIC,MAAMH,KAAKI,GAAG;IAClB,MAAMC,OAAOL,KAAKI,GAAG;IAErB,IAAI,CAACD,OAAOE,SAAS,OAAO;QAC1B,MAAM,qBAEL,CAFK,IAAIC,MACR,CAAC,wEAAwE,CAAC,GADtE,qBAAA;mBAAA;wBAAA;0BAAA;QAEN;IACF;IACAH,MAAMI,IAAAA,4BAAa,EAACJ;IAEpB,MAAMK,SAAS,MAAMC,IAAAA,eAAU,EAACC,mCAAwB,EAAEP;IAC1D,MAAMQ,UAAUC,aAAI,CAACC,IAAI,CAACV,KAAKK,OAAOG,OAAO,IAAI;IACjD,MAAMG,aAAaF,aAAI,CAACC,IAAI,CAACF,SAAS;IAEtC,IAAII;IACJ,IAAI;QACFA,SAASC,KAAKC,KAAK,CAACC,WAAE,CAACC,YAAY,CAACL,YAAY;IAClD,EAAE,OAAOM,KAAU;QACjB,IAAIA,IAAIC,IAAI,KAAK,UAAU;YACzB,uCAAuC;YACvCpB,QAAQqB,IAAI,CAAC;QACf;QACA,MAAMF;IACR;IAEA,MAAMG,YAAY,IAAIC,kBAAS,CAAC;QAAEb;IAAQ;IAC1C,MAAMY,UAAUE,MAAM,CAACV;IACvB,MAAMQ,UAAUG,KAAK;IAErB,yCAAyC;IACzCR,WAAE,CAACS,UAAU,CAACb;IACdb,QAAQqB,IAAI,CAAC;AACf,CAAA&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>