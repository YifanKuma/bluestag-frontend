<html>
<head>
<title>formatNationalNumberUsingFormat.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #264eff;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
formatNationalNumberUsingFormat.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">applyInternationalSeparatorStyle from </span><span class="s2">'./applyInternationalSeparatorStyle.js'</span>

<span class="s3">// This was originally set to $1 but there are some countries for which the</span>
<span class="s3">// first group is not used in the national pattern (e.g. Argentina) so the $1</span>
<span class="s3">// group does not match correctly. Therefore, we use `\d`, so that the first</span>
<span class="s3">// group actually used in the pattern will be matched.</span>
<span class="s0">export const </span><span class="s1">FIRST_GROUP_PATTERN = </span><span class="s4">/(\$\d)/</span>

<span class="s0">export default function </span><span class="s1">formatNationalNumberUsingFormat(</span>
	<span class="s1">number,</span>
	<span class="s1">format,</span>
	<span class="s1">{</span>
		<span class="s1">useInternationalFormat,</span>
		<span class="s1">withNationalPrefix,</span>
		<span class="s1">carrierCode,</span>
		<span class="s1">metadata</span>
	<span class="s1">}</span>
<span class="s1">) {</span>
	<span class="s0">const </span><span class="s1">formattedNumber = number.replace(</span>
		<span class="s0">new </span><span class="s1">RegExp(format.pattern()),</span>
		<span class="s1">useInternationalFormat</span>
			<span class="s1">? format.internationalFormat()</span>
			<span class="s1">: (</span>
				<span class="s3">// This library doesn't use `domestic_carrier_code_formatting_rule`,</span>
				<span class="s3">// because that one is only used when formatting phone numbers</span>
				<span class="s3">// for dialing from a mobile phone, and this is not a dialing library.</span>
				<span class="s3">// carrierCode &amp;&amp; format.domesticCarrierCodeFormattingRule()</span>
				<span class="s3">//  // First, replace the $CC in the formatting rule with the desired carrier code.</span>
				<span class="s3">//  // Then, replace the $FG in the formatting rule with the first group</span>
				<span class="s3">//  // and the carrier code combined in the appropriate way.</span>
				<span class="s3">//  ? format.format().replace(FIRST_GROUP_PATTERN, format.domesticCarrierCodeFormattingRule().replace('$CC', carrierCode))</span>
				<span class="s3">//  : (</span>
				<span class="s3">//      withNationalPrefix &amp;&amp; format.nationalPrefixFormattingRule()</span>
				<span class="s3">//          ? format.format().replace(FIRST_GROUP_PATTERN, format.nationalPrefixFormattingRule())</span>
				<span class="s3">//          : format.format()</span>
				<span class="s3">//  )</span>
				<span class="s1">withNationalPrefix &amp;&amp; format.nationalPrefixFormattingRule()</span>
					<span class="s1">? format.format().replace(FIRST_GROUP_PATTERN, format.nationalPrefixFormattingRule())</span>
					<span class="s1">: format.format()</span>
			<span class="s1">)</span>
	<span class="s1">)</span>
	<span class="s0">if </span><span class="s1">(useInternationalFormat) {</span>
		<span class="s0">return </span><span class="s1">applyInternationalSeparatorStyle(formattedNumber)</span>
	<span class="s1">}</span>
	<span class="s0">return </span><span class="s1">formattedNumber</span>
<span class="s1">}</span></pre>
</body>
</html>