<html>
<head>
<title>DemoModal.tsx</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #174ad4;}
.s5 { color: #080808;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
DemoModal.tsx</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use client&quot;</span><span class="s1">;</span>

<span class="s2">import </span><span class="s1">{useEffect, useRef, useState} from </span><span class="s0">&quot;react&quot;</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">{PhoneCall, X, Play} from </span><span class="s0">&quot;lucide-react&quot;</span><span class="s1">;</span>
<span class="s2">import </span><span class="s1">type {Scenario} from </span><span class="s0">&quot;@/types/demo&quot;</span><span class="s1">;</span>

<span class="s2">export default function </span><span class="s1">DemoModal({</span>
                                      <span class="s1">open,</span>
                                      <span class="s1">onClose,</span>
                                      <span class="s1">scenario,</span>
                                  <span class="s1">}: {</span>
    <span class="s1">open: boolean;</span>
    <span class="s1">onClose: () =&gt; </span><span class="s2">void</span><span class="s1">;</span>
    <span class="s1">scenario: Scenario;</span>
<span class="s1">}) {</span>
    <span class="s2">const </span><span class="s1">[idx, setIdx] = useState(</span><span class="s3">0</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">[started, setStarted] = useState(</span><span class="s2">false</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">[ringing, setRinging] = useState(</span><span class="s2">false</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">ringRef = useRef&lt;HTMLAudioElement | </span><span class="s2">null</span><span class="s1">&gt;(</span><span class="s2">null</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">voiceRef = useRef&lt;HTMLAudioElement | </span><span class="s2">null</span><span class="s1">&gt;(</span><span class="s2">null</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">ticker = useRef&lt;NodeJS.Timeout | </span><span class="s2">null</span><span class="s1">&gt;(</span><span class="s2">null</span><span class="s1">);</span>

    <span class="s1">useEffect(() =&gt; {</span>
        <span class="s2">if </span><span class="s1">(open) {</span>
            <span class="s1">setIdx(</span><span class="s3">0</span><span class="s1">);</span>
            <span class="s1">setStarted(</span><span class="s2">false</span><span class="s1">);</span>
            <span class="s1">setRinging(</span><span class="s2">false</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">if </span><span class="s1">(ticker.current) clearInterval(ticker.current);</span>
            <span class="s1">ringRef.current?.pause();</span>
            <span class="s1">voiceRef.current?.pause();</span>
        <span class="s1">}</span>
    <span class="s1">}, [open]);</span>

    <span class="s2">const </span><span class="s1">startSim = () =&gt; {</span>
        <span class="s2">if </span><span class="s1">(started) </span><span class="s2">return</span><span class="s1">;</span>
        <span class="s1">setStarted(</span><span class="s2">true</span><span class="s1">);</span>
        <span class="s1">setRinging(</span><span class="s2">true</span><span class="s1">);</span>
        <span class="s1">ringRef.current?.play().catch(() =&gt; {</span>
        <span class="s1">});</span>
        <span class="s1">setTimeout(() =&gt; {</span>
            <span class="s1">setRinging(</span><span class="s2">false</span><span class="s1">);</span>
            <span class="s1">ringRef.current?.pause();</span>
            <span class="s2">if </span><span class="s1">(scenario.audio) voiceRef.current?.play().catch(() =&gt; {</span>
            <span class="s1">});</span>
            <span class="s1">ticker.current = setInterval(() =&gt; {</span>
                <span class="s1">setIdx((i) =&gt; {</span>
                    <span class="s2">if </span><span class="s1">(i + </span><span class="s3">1 </span><span class="s1">&gt;= scenario.transcript.length) {</span>
                        <span class="s2">if </span><span class="s1">(ticker.current) clearInterval(ticker.current);</span>
                        <span class="s2">return </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">;</span>
                    <span class="s1">}</span>
                    <span class="s2">return </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">;</span>
                <span class="s1">});</span>
            <span class="s1">}, </span><span class="s3">1100</span><span class="s1">);</span>
        <span class="s1">}, </span><span class="s3">1500</span><span class="s1">);</span>
    <span class="s1">};</span>

    <span class="s2">if </span><span class="s1">(!open) </span><span class="s2">return null</span><span class="s1">;</span>

    <span class="s2">return </span><span class="s1">(</span>
        <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;fixed inset-0 z-50 flex items-center justify-center p-4&quot;</span><span class="s1">&gt;</span>
            <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;absolute inset-0 bg-black/50&quot; </span><span class="s4">onClick</span><span class="s0">=</span><span class="s1">{onClose}/&gt;</span>
            <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;relative w-full max-w-2xl rounded-2xl bg-white shadow-xl border border-gray-200&quot;</span><span class="s1">&gt;</span>
                <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;flex items-center justify-between p-4 border-b border-gray-200&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;flex items-center gap-2&quot;</span><span class="s1">&gt;</span>
            <span class="s1">&lt;</span><span class="s2">span </span><span class="s4">className</span><span class="s0">=&quot;inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-blue-700&quot;</span><span class="s1">&gt;</span>
              <span class="s1">&lt;</span><span class="s2">PhoneCall </span><span class="s4">size</span><span class="s0">=</span><span class="s1">{</span><span class="s3">18</span><span class="s1">}/&gt;</span>
            <span class="s1">&lt;/</span><span class="s2">span</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;</span><span class="s2">h4 </span><span class="s4">className</span><span class="s0">=&quot;font-semibold&quot;</span><span class="s1">&gt;{scenario.title}&lt;/</span><span class="s2">h4</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;</span><span class="s2">button </span><span class="s4">onClick</span><span class="s0">=</span><span class="s1">{onClose} </span><span class="s4">className</span><span class="s0">=&quot;p-2 rounded-lg hover:bg-gray-100&quot;</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;</span><span class="s2">X </span><span class="s4">size</span><span class="s0">=</span><span class="s1">{</span><span class="s3">18</span><span class="s1">}/&gt;</span>
                    <span class="s1">&lt;/</span><span class="s2">button</span><span class="s1">&gt;</span>
                <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>

                <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;p-4&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">{!started ? (</span>
                        <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;rounded-xl border border-dashed border-gray-300 p-6 text-center text-gray-600&quot;</span><span class="s1">&gt;</span>
                            <span class="s1">&lt;</span><span class="s2">p </span><span class="s4">className</span><span class="s0">=&quot;text-sm&quot;</span><span class="s1">&gt;</span><span class="s5">Click ‚ÄúStart Demo‚Äù to simulate a 2-minute call.</span><span class="s1">&lt;/</span><span class="s2">p</span><span class="s1">&gt;</span>
                            <span class="s1">&lt;</span><span class="s2">button</span>
                                <span class="s4">onClick</span><span class="s0">=</span><span class="s1">{startSim}</span>
                                <span class="s4">className</span><span class="s0">=&quot;mt-4 inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-white hover:bg-blue-700&quot;</span>
                            <span class="s1">&gt;</span>
                                <span class="s1">&lt;</span><span class="s2">Play </span><span class="s4">size</span><span class="s0">=</span><span class="s1">{</span><span class="s3">16</span><span class="s1">}/&gt; </span><span class="s5">Start Demo</span>
                            <span class="s1">&lt;/</span><span class="s2">button</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                    <span class="s1">) : (</span>
                        <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;space-y-3 max-h-[50vh] overflow-auto pr-1&quot;</span><span class="s1">&gt;</span>
                            <span class="s1">{ringing &amp;&amp; &lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;text-center text-sm text-gray-500&quot;</span><span class="s1">&gt;</span><span class="s5">üìû Ringing‚Ä¶</span><span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;}</span>
                            <span class="s1">{scenario.transcript.slice(</span><span class="s3">0</span><span class="s1">, idx).map((m, i) =&gt; (</span>
                                <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">key</span><span class="s0">=</span><span class="s1">{i} </span><span class="s4">className</span><span class="s0">=</span><span class="s1">{</span><span class="s0">`flex </span><span class="s1">${m.who === </span><span class="s0">&quot;Agent&quot; </span><span class="s1">? </span><span class="s0">&quot;justify-start&quot; </span><span class="s1">: </span><span class="s0">&quot;justify-end&quot;</span><span class="s1">}</span><span class="s0">`</span><span class="s1">}&gt;</span>
                                    <span class="s1">&lt;</span><span class="s2">div</span>
                                        <span class="s4">className</span><span class="s0">=</span><span class="s1">{</span><span class="s0">`max-w-[80%] rounded-2xl px-4 py-2 text-sm </span><span class="s1">${</span>
                                            <span class="s1">m.who === </span><span class="s0">&quot;Agent&quot; </span><span class="s1">? </span><span class="s0">&quot;bg-gray-100 text-gray-900&quot; </span><span class="s1">: </span><span class="s0">&quot;bg-blue-600 text-white&quot;</span>
                                        <span class="s1">}</span><span class="s0">`</span><span class="s1">}</span>
                                    <span class="s1">&gt;</span>
                                        <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;text-xs opacity-70 mb-1&quot;</span><span class="s1">&gt;{m.who}&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                                        <span class="s1">&lt;</span><span class="s2">div</span><span class="s1">&gt;{m.text}&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                                    <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                                <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                            <span class="s1">))}</span>
                        <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                    <span class="s1">)}</span>
                <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>

                <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;flex items-center justify-between p-4 border-t border-gray-200&quot;</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;text-xs text-gray-500&quot;</span><span class="s1">&gt;</span><span class="s5">This is a simulated call for demo purposes.</span><span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;</span><span class="s2">div </span><span class="s4">className</span><span class="s0">=&quot;flex items-center gap-2&quot;</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;</span><span class="s2">button</span>
                            <span class="s4">onClick</span><span class="s0">=</span><span class="s1">{() =&gt; {</span>
                                <span class="s2">if </span><span class="s1">(!started) startSim();</span>
                                <span class="s2">else </span><span class="s1">setIdx((i) =&gt; Math.min(i + </span><span class="s3">1</span><span class="s1">, scenario.transcript.length));</span>
                            <span class="s1">}}</span>
                            <span class="s4">className</span><span class="s0">=&quot;rounded-xl border px-3 py-1.5 hover:bg-gray-50&quot;</span>
                        <span class="s1">&gt;</span>
                            <span class="s1">{started ? </span><span class="s0">&quot;Next line&quot; </span><span class="s1">: </span><span class="s0">&quot;Start Demo&quot;</span><span class="s1">}</span>
                        <span class="s1">&lt;/</span><span class="s2">button</span><span class="s1">&gt;</span>
                        <span class="s1">&lt;</span><span class="s2">button </span><span class="s4">onClick</span><span class="s0">=</span><span class="s1">{onClose}</span>
                                <span class="s4">className</span><span class="s0">=&quot;rounded-xl bg-blue-600 px-3 py-1.5 text-white hover:bg-blue-700&quot;</span><span class="s1">&gt;</span>
                            <span class="s5">Close</span>
                        <span class="s1">&lt;/</span><span class="s2">button</span><span class="s1">&gt;</span>
                    <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
                <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>

                <span class="s1">&lt;</span><span class="s2">audio </span><span class="s4">ref</span><span class="s0">=</span><span class="s1">{ringRef} </span><span class="s4">src</span><span class="s0">=&quot;/audio/ring.mp3&quot; </span><span class="s4">preload</span><span class="s0">=&quot;auto&quot;</span><span class="s1">/&gt;</span>
                <span class="s1">{scenario.audio &amp;&amp; &lt;</span><span class="s2">audio </span><span class="s4">ref</span><span class="s0">=</span><span class="s1">{voiceRef} </span><span class="s4">src</span><span class="s0">=</span><span class="s1">{scenario.audio} </span><span class="s4">preload</span><span class="s0">=&quot;auto&quot;</span><span class="s1">/&gt;}</span>
            <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
        <span class="s1">&lt;/</span><span class="s2">div</span><span class="s1">&gt;</span>
    <span class="s1">);</span>
<span class="s1">}</span></pre>
</body>
</html>