<html>
<head>
<title>isViablePhoneNumber.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
isViablePhoneNumber.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">{</span>
	<span class="s1">MIN_LENGTH_FOR_NSN,</span>
	<span class="s1">VALID_DIGITS,</span>
	<span class="s1">VALID_PUNCTUATION,</span>
	<span class="s1">PLUS_CHARS</span>
<span class="s1">} from </span><span class="s2">'../constants.js'</span>

<span class="s0">import </span><span class="s1">createExtensionPattern from </span><span class="s2">'./extension/createExtensionPattern.js'</span>

<span class="s3">//  Regular expression of viable phone numbers. This is location independent.</span>
<span class="s3">//  Checks we have at least three leading digits, and only valid punctuation,</span>
<span class="s3">//  alpha characters and digits in the phone number. Does not include extension</span>
<span class="s3">//  data. The symbol 'x' is allowed here as valid punctuation since it is often</span>
<span class="s3">//  used as a placeholder for carrier codes, for example in Brazilian phone</span>
<span class="s3">//  numbers. We also allow multiple '+' characters at the start.</span>
<span class="s3">//</span>
<span class="s3">//  Corresponds to the following:</span>
<span class="s3">//  [digits]{minLengthNsn}|</span>
<span class="s3">//  plus_sign*</span>
<span class="s3">//  (([punctuation]|[star])*[digits]){3,}([punctuation]|[star]|[digits]|[alpha])*</span>
<span class="s3">//</span>
<span class="s3">//  The first reg-ex is to allow short numbers (two digits long) to be parsed if</span>
<span class="s3">//  they are entered as &quot;15&quot; etc, but only if there is no punctuation in them.</span>
<span class="s3">//  The second expression restricts the number of digits to three or more, but</span>
<span class="s3">//  then allows them to be in international form, and to have alpha-characters</span>
<span class="s3">//  and punctuation. We split up the two reg-exes here and combine them when</span>
<span class="s3">//  creating the reg-ex VALID_PHONE_NUMBER_PATTERN itself so we can prefix it</span>
<span class="s3">//  with ^ and append $ to each branch.</span>
<span class="s3">//</span>
<span class="s3">//  &quot;Note VALID_PUNCTUATION starts with a -,</span>
<span class="s3">//   so must be the first in the range&quot; (c) Google devs.</span>
<span class="s3">//  (wtf did they mean by saying that; probably nothing)</span>
<span class="s3">//</span>
<span class="s0">const </span><span class="s1">MIN_LENGTH_PHONE_NUMBER_PATTERN = </span><span class="s2">'[' </span><span class="s1">+ VALID_DIGITS + </span><span class="s2">']{' </span><span class="s1">+ MIN_LENGTH_FOR_NSN + </span><span class="s2">'}'</span>
<span class="s3">//</span>
<span class="s3">// And this is the second reg-exp:</span>
<span class="s3">// (see MIN_LENGTH_PHONE_NUMBER_PATTERN for a full description of this reg-exp)</span>
<span class="s3">//</span>
<span class="s0">export const </span><span class="s1">VALID_PHONE_NUMBER =</span>
	<span class="s2">'[' </span><span class="s1">+ PLUS_CHARS + </span><span class="s2">']{0,1}' </span><span class="s1">+</span>
	<span class="s2">'(?:' </span><span class="s1">+</span>
		<span class="s2">'[' </span><span class="s1">+ VALID_PUNCTUATION + </span><span class="s2">']*' </span><span class="s1">+</span>
		<span class="s2">'[' </span><span class="s1">+ VALID_DIGITS + </span><span class="s2">']' </span><span class="s1">+</span>
	<span class="s2">'){3,}' </span><span class="s1">+</span>
	<span class="s2">'[' </span><span class="s1">+</span>
		<span class="s1">VALID_PUNCTUATION +</span>
		<span class="s1">VALID_DIGITS +</span>
	<span class="s2">']*'</span>

<span class="s3">// This regular expression isn't present in Google's `libphonenumber`</span>
<span class="s3">// and is only used to determine whether the phone number being input</span>
<span class="s3">// is too short for it to even consider it a &quot;valid&quot; number.</span>
<span class="s3">// This is just a way to differentiate between a really invalid phone</span>
<span class="s3">// number like &quot;abcde&quot; and a valid phone number that a user has just</span>
<span class="s3">// started inputting, like &quot;+1&quot; or &quot;1&quot;: both these cases would be</span>
<span class="s3">// considered `NOT_A_NUMBER` by Google's `libphonenumber`, but this</span>
<span class="s3">// library can provide a more detailed error message — whether it's</span>
<span class="s3">// really &quot;not a number&quot;, or is it just a start of a valid phone number.</span>
<span class="s0">const </span><span class="s1">VALID_PHONE_NUMBER_START_REG_EXP = </span><span class="s0">new </span><span class="s1">RegExp(</span>
	<span class="s2">'^' </span><span class="s1">+</span>
	<span class="s2">'[' </span><span class="s1">+ PLUS_CHARS + </span><span class="s2">']{0,1}' </span><span class="s1">+</span>
	<span class="s2">'(?:' </span><span class="s1">+</span>
		<span class="s2">'[' </span><span class="s1">+ VALID_PUNCTUATION + </span><span class="s2">']*' </span><span class="s1">+</span>
		<span class="s2">'[' </span><span class="s1">+ VALID_DIGITS + </span><span class="s2">']' </span><span class="s1">+</span>
	<span class="s2">'){1,2}' </span><span class="s1">+</span>
	<span class="s2">'$'</span>
<span class="s1">, </span><span class="s2">'i'</span><span class="s1">)</span>

<span class="s0">export const </span><span class="s1">VALID_PHONE_NUMBER_WITH_EXTENSION =</span>
	<span class="s1">VALID_PHONE_NUMBER +</span>
	<span class="s3">// Phone number extensions</span>
	<span class="s2">'(?:' </span><span class="s1">+ createExtensionPattern() + </span><span class="s2">')?'</span>

<span class="s3">// The combined regular expression for valid phone numbers:</span>
<span class="s3">//</span>
<span class="s0">const </span><span class="s1">VALID_PHONE_NUMBER_PATTERN = </span><span class="s0">new </span><span class="s1">RegExp(</span>
	<span class="s3">// Either a short two-digit-only phone number</span>
	<span class="s2">'^' </span><span class="s1">+</span>
		<span class="s1">MIN_LENGTH_PHONE_NUMBER_PATTERN +</span>
	<span class="s2">'$' </span><span class="s1">+</span>
	<span class="s2">'|' </span><span class="s1">+</span>
	<span class="s3">// Or a longer fully parsed phone number (min 3 characters)</span>
	<span class="s2">'^' </span><span class="s1">+</span>
		<span class="s1">VALID_PHONE_NUMBER_WITH_EXTENSION +</span>
	<span class="s2">'$'</span>
<span class="s1">, </span><span class="s2">'i'</span><span class="s1">)</span>

<span class="s3">// Checks to see if the string of characters could possibly be a phone number at</span>
<span class="s3">// all. At the moment, checks to see that the string begins with at least 2</span>
<span class="s3">// digits, ignoring any punctuation commonly found in phone numbers. This method</span>
<span class="s3">// does not require the number to be normalized in advance - but does assume</span>
<span class="s3">// that leading non-number symbols have been removed, such as by the method</span>
<span class="s3">// `extract_possible_number`.</span>
<span class="s3">//</span>
<span class="s0">export default function </span><span class="s1">isViablePhoneNumber(number) {</span>
	<span class="s0">return </span><span class="s1">number.length &gt;= MIN_LENGTH_FOR_NSN &amp;&amp;</span>
		<span class="s1">VALID_PHONE_NUMBER_PATTERN.test(number)</span>
<span class="s1">}</span>

<span class="s3">// This is just a way to differentiate between a really invalid phone</span>
<span class="s3">// number like &quot;abcde&quot; and a valid phone number that a user has just</span>
<span class="s3">// started inputting, like &quot;+1&quot; or &quot;1&quot;: both these cases would be</span>
<span class="s3">// considered `NOT_A_NUMBER` by Google's `libphonenumber`, but this</span>
<span class="s3">// library can provide a more detailed error message — whether it's</span>
<span class="s3">// really &quot;not a number&quot;, or is it just a start of a valid phone number.</span>
<span class="s0">export function </span><span class="s1">isViablePhoneNumberStart(number) {</span>
	<span class="s0">return </span><span class="s1">VALID_PHONE_NUMBER_START_REG_EXP.test(number)</span>
<span class="s1">}</span></pre>
</body>
</html>