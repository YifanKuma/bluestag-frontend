<html>
<head>
<title>output-export-prefetch-encoding.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
output-export-prefetch-encoding.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../src/shared/lib/segment-cache/output-export-prefetch-encoding.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;// In output: export mode, the build id is added to the start of the HTML</span><span class="s3">\n</span><span class="s1">// document, directly after the doctype declaration. During a prefetch, the</span><span class="s3">\n</span><span class="s1">// client performs a range request to get the build id, so it can check whether</span><span class="s3">\n</span><span class="s1">// the target page belongs to the same build.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// The first 64 bytes of the document are requested. The exact number isn't</span><span class="s3">\n</span><span class="s1">// too important; it must be larger than the build id + doctype + closing and</span><span class="s3">\n</span><span class="s1">// ending comment markers, but it doesn't need to match the end of the</span><span class="s3">\n</span><span class="s1">// comment exactly.</span><span class="s3">\n</span><span class="s1">//</span><span class="s3">\n</span><span class="s1">// Build ids are 21 bytes long in the default implementation, though this</span><span class="s3">\n</span><span class="s1">// can be overridden in the Next.js config. For the purposes of this check,</span><span class="s3">\n</span><span class="s1">// it's OK to only match the start of the id, so we'll truncate it if exceeds</span><span class="s3">\n</span><span class="s1">// a certain length.</span><span class="s3">\n\n</span><span class="s1">const DOCTYPE_PREFIX = '&lt;!DOCTYPE html&gt;' // 15 bytes</span><span class="s3">\n</span><span class="s1">const MAX_BUILD_ID_LENGTH = 24</span><span class="s3">\n\n</span><span class="s1">// Request the first 64 bytes. The Range header is inclusive of the end value.</span><span class="s3">\n</span><span class="s1">export const DOC_PREFETCH_RANGE_HEADER_VALUE = 'bytes=0-63'</span><span class="s3">\n\n</span><span class="s1">function escapeBuildId(buildId: string) {</span><span class="s3">\n  </span><span class="s1">// If the build id is longer than the given limit, it's OK for our purposes</span><span class="s3">\n  </span><span class="s1">// to only match the beginning.</span><span class="s3">\n  </span><span class="s1">const truncated = buildId.slice(0, MAX_BUILD_ID_LENGTH)</span><span class="s3">\n  </span><span class="s1">// Replace hyphens with underscores so it doesn't break the HTML comment.</span><span class="s3">\n  </span><span class="s1">// (Unlikely, but if this did happen it would break the whole document.)</span><span class="s3">\n  </span><span class="s1">return truncated.replace(/-/g, '_')</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function insertBuildIdComment(originalHtml: string, buildId: string) {</span><span class="s3">\n  </span><span class="s1">if (</span><span class="s3">\n    </span><span class="s1">// Skip if the build id contains a closing comment marker.</span><span class="s3">\n    </span><span class="s1">buildId.includes('--&gt;') ||</span><span class="s3">\n    </span><span class="s1">// React always inserts a doctype at the start of the document. Skip if it</span><span class="s3">\n    </span><span class="s1">// isn't present. Shouldn't happen; suggests an issue elsewhere.</span><span class="s3">\n    </span><span class="s1">!originalHtml.startsWith(DOCTYPE_PREFIX)</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// Return the original HTML unchanged. This means the document will not</span><span class="s3">\n    </span><span class="s1">// be prefetched.</span><span class="s3">\n    </span><span class="s1">// TODO: The build id comment is currently only used during prefetches, but</span><span class="s3">\n    </span><span class="s1">// if we eventually use this mechanism for regular navigations, we may need</span><span class="s3">\n    </span><span class="s1">// to error during build if we fail to insert it for some reason.</span><span class="s3">\n    </span><span class="s1">return originalHtml</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">// The comment must be inserted after the doctype.</span><span class="s3">\n  </span><span class="s1">return originalHtml.replace(</span><span class="s3">\n    </span><span class="s1">DOCTYPE_PREFIX,</span><span class="s3">\n    </span><span class="s1">DOCTYPE_PREFIX + '&lt;!--' + escapeBuildId(buildId) + '--&gt;'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export function doesExportedHtmlMatchBuildId(</span><span class="s3">\n  </span><span class="s1">partialHtmlDocument: string,</span><span class="s3">\n  </span><span class="s1">buildId: string</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">// Check whether the document starts with the expected buildId.</span><span class="s3">\n  </span><span class="s1">return partialHtmlDocument.startsWith(</span><span class="s3">\n    </span><span class="s1">DOCTYPE_PREFIX + '&lt;!--' + escapeBuildId(buildId) + '--&gt;'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;DOC_PREFETCH_RANGE_HEADER_VALUE&quot;</span><span class="s0">,</span><span class="s1">&quot;doesExportedHtmlMatchBuildId&quot;</span><span class="s0">,</span><span class="s1">&quot;insertBuildIdComment&quot;</span><span class="s0">,</span><span class="s1">&quot;DOCTYPE_PREFIX&quot;</span><span class="s0">,</span><span class="s1">&quot;MAX_BUILD_ID_LENGTH&quot;</span><span class="s0">,</span><span class="s1">&quot;escapeBuildId&quot;</span><span class="s0">,</span><span class="s1">&quot;buildId&quot;</span><span class="s0">,</span><span class="s1">&quot;truncated&quot;</span><span class="s0">,</span><span class="s1">&quot;slice&quot;</span><span class="s0">,</span><span class="s1">&quot;replace&quot;</span><span class="s0">,</span><span class="s1">&quot;originalHtml&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;partialHtmlDocument&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;AAAA,yEAAyE;AACzE,2EAA2E;AAC3E,+EAA+E;AAC/E,6CAA6C;AAC7C,EAAE;AACF,2EAA2E;AAC3E,6EAA6E;AAC7E,sEAAsE;AACtE,mBAAmB;AACnB,EAAE;AACF,yEAAyE;AACzE,2EAA2E;AAC3E,6EAA6E;AAC7E,oBAAoB;;;;;;;;;;;;;;;;;IAMPA,+BAA+B;eAA/BA;;IAiCGC,4BAA4B;eAA5BA;;IAtBAC,oBAAoB;eAApBA;;;AAfhB,MAAMC,iBAAiB,kBAAkB,WAAW;;AACpD,MAAMC,sBAAsB;AAGrB,MAAMJ,kCAAkC;AAE/C,SAASK,cAAcC,OAAe;IACpC,2EAA2E;IAC3E,+BAA+B;IAC/B,MAAMC,YAAYD,QAAQE,KAAK,CAAC,GAAGJ;IACnC,yEAAyE;IACzE,wEAAwE;IACxE,OAAOG,UAAUE,OAAO,CAAC,MAAM;AACjC;AAEO,SAASP,qBAAqBQ,YAAoB,EAAEJ,OAAe;IACxE,IACE,0DAA0D;IAC1DA,QAAQK,QAAQ,CAAC,UACjB,0EAA0E;IAC1E,gEAAgE;IAChE,CAACD,aAAaE,UAAU,CAACT,iBACzB;QACA,uEAAuE;QACvE,iBAAiB;QACjB,2EAA2E;QAC3E,2EAA2E;QAC3E,iEAAiE;QACjE,OAAOO;IACT;IACA,kDAAkD;IAClD,OAAOA,aAAaD,OAAO,CACzBN,gBACAA,iBAAiB,SAASE,cAAcC,WAAW;AAEvD;AAEO,SAASL,6BACdY,mBAA2B,EAC3BP,OAAe;IAEf,+DAA+D;IAC/D,OAAOO,oBAAoBD,UAAU,CACnCT,iBAAiB,SAASE,cAAcC,WAAW;AAEvD&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>