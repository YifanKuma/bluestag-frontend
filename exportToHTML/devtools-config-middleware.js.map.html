<html>
<head>
<title>devtools-config-middleware.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
devtools-config-middleware.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/next-devtools/server/devtools-config-middleware.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { IncomingMessage, ServerResponse } from 'http'</span><span class="s3">\n</span><span class="s1">import type { DevToolsConfig } from '../dev-overlay/shared'</span><span class="s3">\n\n</span><span class="s1">import { existsSync } from 'fs'</span><span class="s3">\n</span><span class="s1">import { readFile, writeFile, mkdir } from 'fs/promises'</span><span class="s3">\n</span><span class="s1">import { dirname, join } from 'path'</span><span class="s3">\n\n</span><span class="s1">import { middlewareResponse } from './middleware-response'</span><span class="s3">\n</span><span class="s1">import { devToolsConfigSchema } from '../shared/devtools-config-schema'</span><span class="s3">\n</span><span class="s1">import { deepMerge } from '../shared/deepmerge'</span><span class="s3">\n\n</span><span class="s1">const DEVTOOLS_CONFIG_FILENAME = 'next-devtools-config.json'</span><span class="s3">\n</span><span class="s1">const DEVTOOLS_CONFIG_MIDDLEWARE_ENDPOINT = '/__nextjs_devtools_config'</span><span class="s3">\n\n</span><span class="s1">export function devToolsConfigMiddleware({</span><span class="s3">\n  </span><span class="s1">distDir,</span><span class="s3">\n  </span><span class="s1">sendUpdateSignal,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">distDir: string</span><span class="s3">\n  </span><span class="s1">sendUpdateSignal: (data: DevToolsConfig) =&gt; void</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">const configPath = join(distDir, 'cache', DEVTOOLS_CONFIG_FILENAME)</span><span class="s3">\n\n  </span><span class="s1">return async function devToolsConfigMiddlewareHandler(</span><span class="s3">\n    </span><span class="s1">req: IncomingMessage,</span><span class="s3">\n    </span><span class="s1">res: ServerResponse,</span><span class="s3">\n    </span><span class="s1">next: () =&gt; void</span><span class="s3">\n  </span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n    </span><span class="s1">const { pathname } = new URL(`http://n${req.url}`)</span><span class="s3">\n\n    </span><span class="s1">if (pathname !== DEVTOOLS_CONFIG_MIDDLEWARE_ENDPOINT) {</span><span class="s3">\n      </span><span class="s1">return next()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">if (req.method !== 'POST') {</span><span class="s3">\n      </span><span class="s1">return middlewareResponse.methodNotAllowed(res)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const currentConfig = await getDevToolsConfig(distDir)</span><span class="s3">\n\n    </span><span class="s1">const chunks: Buffer[] = []</span><span class="s3">\n    </span><span class="s1">for await (const chunk of req) {</span><span class="s3">\n      </span><span class="s1">chunks.push(Buffer.from(chunk))</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let body = Buffer.concat(chunks).toString('utf8')</span><span class="s3">\n    </span><span class="s1">try {</span><span class="s3">\n      </span><span class="s1">body = JSON.parse(body)</span><span class="s3">\n    </span><span class="s1">} catch (error) {</span><span class="s3">\n      </span><span class="s1">console.error('[Next.js DevTools] Invalid config body passed:', error)</span><span class="s3">\n      </span><span class="s1">return middlewareResponse.badRequest(res)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const validation = devToolsConfigSchema.safeParse(body)</span><span class="s3">\n    </span><span class="s1">if (!validation.success) {</span><span class="s3">\n      </span><span class="s1">console.error(</span><span class="s3">\n        </span><span class="s1">'[Next.js DevTools] Invalid config passed:',</span><span class="s3">\n        </span><span class="s1">validation.error.message</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">return middlewareResponse.badRequest(res)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">const newConfig = deepMerge(currentConfig, validation.data)</span><span class="s3">\n    </span><span class="s1">await writeFile(configPath, JSON.stringify(newConfig, null, 2))</span><span class="s3">\n\n    </span><span class="s1">sendUpdateSignal(newConfig)</span><span class="s3">\n\n    </span><span class="s1">return middlewareResponse.noContent(res)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function getDevToolsConfig(</span><span class="s3">\n  </span><span class="s1">distDir: string</span><span class="s3">\n</span><span class="s1">): Promise&lt;DevToolsConfig&gt; {</span><span class="s3">\n  </span><span class="s1">const configPath = join(distDir, 'cache', DEVTOOLS_CONFIG_FILENAME)</span><span class="s3">\n\n  </span><span class="s1">if (!existsSync(configPath)) {</span><span class="s3">\n    </span><span class="s1">await mkdir(dirname(configPath), { recursive: true })</span><span class="s3">\n    </span><span class="s1">await writeFile(configPath, JSON.stringify({}))</span><span class="s3">\n    </span><span class="s1">return {}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return JSON.parse(await readFile(configPath, 'utf8'))</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;devToolsConfigMiddleware&quot;</span><span class="s0">,</span><span class="s1">&quot;getDevToolsConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;DEVTOOLS_CONFIG_FILENAME&quot;</span><span class="s0">,</span><span class="s1">&quot;DEVTOOLS_CONFIG_MIDDLEWARE_ENDPOINT&quot;</span><span class="s0">,</span><span class="s1">&quot;distDir&quot;</span><span class="s0">,</span><span class="s1">&quot;sendUpdateSignal&quot;</span><span class="s0">,</span><span class="s1">&quot;configPath&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;devToolsConfigMiddlewareHandler&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;next&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;URL&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;middlewareResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;methodNotAllowed&quot;</span><span class="s0">,</span><span class="s1">&quot;currentConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;chunks&quot;</span><span class="s0">,</span><span class="s1">&quot;chunk&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;Buffer&quot;</span><span class="s0">,</span><span class="s1">&quot;from&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;concat&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;JSON&quot;</span><span class="s0">,</span><span class="s1">&quot;parse&quot;</span><span class="s0">,</span><span class="s1">&quot;error&quot;</span><span class="s0">,</span><span class="s1">&quot;console&quot;</span><span class="s0">,</span><span class="s1">&quot;badRequest&quot;</span><span class="s0">,</span><span class="s1">&quot;validation&quot;</span><span class="s0">,</span><span class="s1">&quot;devToolsConfigSchema&quot;</span><span class="s0">,</span><span class="s1">&quot;safeParse&quot;</span><span class="s0">,</span><span class="s1">&quot;success&quot;</span><span class="s0">,</span><span class="s1">&quot;message&quot;</span><span class="s0">,</span><span class="s1">&quot;newConfig&quot;</span><span class="s0">,</span><span class="s1">&quot;deepMerge&quot;</span><span class="s0">,</span><span class="s1">&quot;data&quot;</span><span class="s0">,</span><span class="s1">&quot;writeFile&quot;</span><span class="s0">,</span><span class="s1">&quot;stringify&quot;</span><span class="s0">,</span><span class="s1">&quot;noContent&quot;</span><span class="s0">,</span><span class="s1">&quot;existsSync&quot;</span><span class="s0">,</span><span class="s1">&quot;mkdir&quot;</span><span class="s0">,</span><span class="s1">&quot;dirname&quot;</span><span class="s0">,</span><span class="s1">&quot;recursive&quot;</span><span class="s0">,</span><span class="s1">&quot;readFile&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;;;;;;;;;;;;IAcgBA,wBAAwB;eAAxBA;;IAyDMC,iBAAiB;eAAjBA;;;oBApEK;0BACgB;sBACb;oCAEK;sCACE;2BACX;AAE1B,MAAMC,2BAA2B;AACjC,MAAMC,sCAAsC;AAErC,SAASH,yBAAyB,KAMxC;IANwC,IAAA,EACvCI,OAAO,EACPC,gBAAgB,EAIjB,GANwC;IAOvC,MAAMC,aAAaC,IAAAA,UAAI,EAACH,SAAS,SAASF;IAE1C,OAAO,eAAeM,gCACpBC,GAAoB,EACpBC,GAAmB,EACnBC,IAAgB;QAEhB,MAAM,EAAEC,QAAQ,EAAE,GAAG,IAAIC,IAAI,AAAC,aAAUJ,IAAIK,GAAG;QAE/C,IAAIF,aAAaT,qCAAqC;YACpD,OAAOQ;QACT;QAEA,IAAIF,IAAIM,MAAM,KAAK,QAAQ;YACzB,OAAOC,sCAAkB,CAACC,gBAAgB,CAACP;QAC7C;QAEA,MAAMQ,gBAAgB,MAAMjB,kBAAkBG;QAE9C,MAAMe,SAAmB,EAAE;QAC3B,WAAW,MAAMC,SAASX,IAAK;YAC7BU,OAAOE,IAAI,CAACC,OAAOC,IAAI,CAACH;QAC1B;QAEA,IAAII,OAAOF,OAAOG,MAAM,CAACN,QAAQO,QAAQ,CAAC;QAC1C,IAAI;YACFF,OAAOG,KAAKC,KAAK,CAACJ;QACpB,EAAE,OAAOK,OAAO;YACdC,QAAQD,KAAK,CAAC,kDAAkDA;YAChE,OAAOb,sCAAkB,CAACe,UAAU,CAACrB;QACvC;QAEA,MAAMsB,aAAaC,0CAAoB,CAACC,SAAS,CAACV;QAClD,IAAI,CAACQ,WAAWG,OAAO,EAAE;YACvBL,QAAQD,KAAK,CACX,6CACAG,WAAWH,KAAK,CAACO,OAAO;YAE1B,OAAOpB,sCAAkB,CAACe,UAAU,CAACrB;QACvC;QAEA,MAAM2B,YAAYC,IAAAA,oBAAS,EAACpB,eAAec,WAAWO,IAAI;QAC1D,MAAMC,IAAAA,mBAAS,EAAClC,YAAYqB,KAAKc,SAAS,CAACJ,WAAW,MAAM;QAE5DhC,iBAAiBgC;QAEjB,OAAOrB,sCAAkB,CAAC0B,SAAS,CAAChC;IACtC;AACF;AAEO,eAAeT,kBACpBG,OAAe;IAEf,MAAME,aAAaC,IAAAA,UAAI,EAACH,SAAS,SAASF;IAE1C,IAAI,CAACyC,IAAAA,cAAU,EAACrC,aAAa;QAC3B,MAAMsC,IAAAA,eAAK,EAACC,IAAAA,aAAO,EAACvC,aAAa;YAAEwC,WAAW;QAAK;QACnD,MAAMN,IAAAA,mBAAS,EAAClC,YAAYqB,KAAKc,SAAS,CAAC,CAAC;QAC5C,OAAO,CAAC;IACV;IAEA,OAAOd,KAAKC,KAAK,CAAC,MAAMmB,IAAAA,kBAAQ,EAACzC,YAAY;AAC/C&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>