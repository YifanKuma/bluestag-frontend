<html>
<head>
<title>load-custom-routes.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #264eff;}
.s5 { color: #8c8c8c; font-style: italic;}
.s6 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
load-custom-routes.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s3">0 </span><span class="s1">&amp;&amp; (module.exports = {</span>
    <span class="s1">checkCustomRoutes: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s2">default</span><span class="s1">: </span><span class="s2">null</span><span class="s1">,</span>
    <span class="s1">normalizeRouteRegex: </span><span class="s2">null</span>
<span class="s1">});</span>
<span class="s2">function </span><span class="s1">_export(target, all) {</span>
    <span class="s2">for</span><span class="s1">(</span><span class="s2">var </span><span class="s1">name </span><span class="s2">in </span><span class="s1">all)Object.defineProperty(target, name, {</span>
        <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
        <span class="s1">get: all[name]</span>
    <span class="s1">});</span>
<span class="s1">}</span>
<span class="s1">_export(exports, {</span>
    <span class="s1">checkCustomRoutes: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">checkCustomRoutes;</span>
    <span class="s1">},</span>
    <span class="s2">default</span><span class="s1">: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">loadCustomRoutes;</span>
    <span class="s1">},</span>
    <span class="s1">normalizeRouteRegex: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">normalizeRouteRegex;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_picocolors = require(</span><span class="s0">&quot;./picocolors&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_escaperegexp = require(</span><span class="s0">&quot;../shared/lib/escape-regexp&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_trytoparsepath = require(</span><span class="s0">&quot;./try-to-parse-path&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_redirectstatus = require(</span><span class="s0">&quot;./redirect-status&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_url = require(</span><span class="s0">&quot;./url&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">allowedHasTypes = </span><span class="s2">new </span><span class="s1">Set([</span>
    <span class="s0">'header'</span><span class="s1">,</span>
    <span class="s0">'cookie'</span><span class="s1">,</span>
    <span class="s0">'query'</span><span class="s1">,</span>
    <span class="s0">'host'</span>
<span class="s1">]);</span>
<span class="s2">const </span><span class="s1">namedGroupsRegex = </span><span class="s4">/\(\?&lt;([a-zA-Z][a-zA-Z0-9]*)&gt;/g</span><span class="s1">;</span>
<span class="s2">function </span><span class="s1">normalizeRouteRegex(regex) {</span>
    <span class="s5">// clean up un-necessary escaping from regex.source which turns / into \\/</span>
    <span class="s2">return </span><span class="s1">regex.replace(</span><span class="s4">/\\\//g</span><span class="s1">, </span><span class="s0">'/'</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">checkRedirect(route) {</span>
    <span class="s2">const </span><span class="s1">invalidParts = [];</span>
    <span class="s2">let </span><span class="s1">hadInvalidStatus = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">if </span><span class="s1">(route.statusCode &amp;&amp; !_redirectstatus.allowedStatusCodes.has(route[</span><span class="s0">'statusCode'</span><span class="s1">])) {</span>
        <span class="s1">hadInvalidStatus = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s1">invalidParts.push(</span><span class="s0">`</span><span class="s6">\`</span><span class="s0">statusCode</span><span class="s6">\` </span><span class="s0">is not undefined or valid statusCode`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">route.permanent !== </span><span class="s0">'boolean' </span><span class="s1">&amp;&amp; !route[</span><span class="s0">'statusCode'</span><span class="s1">]) {</span>
        <span class="s1">invalidParts.push(</span><span class="s0">`</span><span class="s6">\`</span><span class="s0">permanent</span><span class="s6">\` </span><span class="s0">is not set to </span><span class="s6">\`</span><span class="s0">true</span><span class="s6">\` </span><span class="s0">or </span><span class="s6">\`</span><span class="s0">false</span><span class="s6">\`</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">{</span>
        <span class="s1">invalidParts,</span>
        <span class="s1">hadInvalidStatus</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">checkHeader(route) {</span>
    <span class="s2">const </span><span class="s1">invalidParts = [];</span>
    <span class="s2">if </span><span class="s1">(!Array.isArray(route.headers)) {</span>
        <span class="s1">invalidParts.push(</span><span class="s0">'`headers` field must be an array'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else if </span><span class="s1">(route.headers.length === </span><span class="s3">0</span><span class="s1">) {</span>
        <span class="s1">invalidParts.push(</span><span class="s0">'`headers` field cannot be empty'</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">header of route.headers){</span>
            <span class="s2">if </span><span class="s1">(!header || </span><span class="s2">typeof </span><span class="s1">header !== </span><span class="s0">'object'</span><span class="s1">) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">&quot;`headers` items must be object with { key: '', value: '' }&quot;</span><span class="s1">);</span>
                <span class="s2">break</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">header.key !== </span><span class="s0">'string'</span><span class="s1">) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`key` in header item must be string'</span><span class="s1">);</span>
                <span class="s2">break</span><span class="s1">;</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">header.value !== </span><span class="s0">'string'</span><span class="s1">) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`value` in header item must be string'</span><span class="s1">);</span>
                <span class="s2">break</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">invalidParts;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">checkCustomRoutes(routes, type) {</span>
    <span class="s2">if </span><span class="s1">(!Array.isArray(routes)) {</span>
        <span class="s1">console.error(</span><span class="s0">`Error: </span><span class="s1">${type}</span><span class="s0">s must return an array, received </span><span class="s1">${</span><span class="s2">typeof </span><span class="s1">routes}</span><span class="s0">.</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`See here for more info: https://nextjs.org/docs/messages/routes-must-be-array`</span><span class="s1">);</span>
        <span class="s1">process.exit(</span><span class="s3">1</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">let </span><span class="s1">numInvalidRoutes = </span><span class="s3">0</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">hadInvalidStatus = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">hadInvalidHas = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">let </span><span class="s1">hadInvalidMissing = </span><span class="s2">false</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">allowedKeys = </span><span class="s2">new </span><span class="s1">Set([</span>
        <span class="s0">'source'</span><span class="s1">,</span>
        <span class="s0">'locale'</span><span class="s1">,</span>
        <span class="s0">'has'</span><span class="s1">,</span>
        <span class="s0">'missing'</span>
    <span class="s1">]);</span>
    <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'rewrite'</span><span class="s1">) {</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'basePath'</span><span class="s1">);</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'destination'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'redirect'</span><span class="s1">) {</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'basePath'</span><span class="s1">);</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'statusCode'</span><span class="s1">);</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'permanent'</span><span class="s1">);</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'destination'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'header'</span><span class="s1">) {</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'basePath'</span><span class="s1">);</span>
        <span class="s1">allowedKeys.add(</span><span class="s0">'headers'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">route of routes){</span>
        <span class="s2">if </span><span class="s1">(!route || </span><span class="s2">typeof </span><span class="s1">route !== </span><span class="s0">'object'</span><span class="s1">) {</span>
            <span class="s1">console.error(</span><span class="s0">`The route </span><span class="s1">${JSON.stringify(route)} </span><span class="s0">is not a valid object with </span><span class="s6">\`</span><span class="s0">source</span><span class="s6">\`</span><span class="s1">${type !== </span><span class="s0">'middleware' </span><span class="s1">? </span><span class="s0">` and </span><span class="s6">\`</span><span class="s1">${type === </span><span class="s0">'header' </span><span class="s1">? </span><span class="s0">'headers' </span><span class="s1">: </span><span class="s0">'destination'</span><span class="s1">}</span><span class="s6">\`</span><span class="s0">` </span><span class="s1">: </span><span class="s0">''</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
            <span class="s1">numInvalidRoutes++;</span>
            <span class="s2">continue</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'rewrite' </span><span class="s1">&amp;&amp; route.basePath === </span><span class="s2">false </span><span class="s1">&amp;&amp; !(route.destination.startsWith(</span><span class="s0">'http://'</span><span class="s1">) || route.destination.startsWith(</span><span class="s0">'https://'</span><span class="s1">))) {</span>
            <span class="s1">console.error(</span><span class="s0">`The route </span><span class="s1">${route.source} </span><span class="s0">rewrites urls outside of the basePath. Please use a destination that starts with </span><span class="s6">\`</span><span class="s0">http://</span><span class="s6">\` </span><span class="s0">or </span><span class="s6">\`</span><span class="s0">https://</span><span class="s6">\` </span><span class="s0">https://nextjs.org/docs/messages/invalid-external-rewrite`</span><span class="s1">);</span>
            <span class="s1">numInvalidRoutes++;</span>
            <span class="s2">continue</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">keys = Object.keys(route);</span>
        <span class="s2">const </span><span class="s1">invalidKeys = keys.filter((key)=&gt;!allowedKeys.has(key));</span>
        <span class="s2">const </span><span class="s1">invalidParts = [];</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s0">'basePath' </span><span class="s2">in </span><span class="s1">route &amp;&amp; </span><span class="s2">typeof </span><span class="s1">route.basePath !== </span><span class="s0">'undefined' </span><span class="s1">&amp;&amp; route.basePath !== </span><span class="s2">false</span><span class="s1">) {</span>
            <span class="s1">invalidParts.push(</span><span class="s0">'`basePath` must be undefined or false'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">route.locale !== </span><span class="s0">'undefined' </span><span class="s1">&amp;&amp; route.locale !== </span><span class="s2">false</span><span class="s1">) {</span>
            <span class="s1">invalidParts.push(</span><span class="s0">'`locale` must be undefined or false'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">checkInvalidHasMissing = (items, fieldName)=&gt;{</span>
            <span class="s2">let </span><span class="s1">hadInvalidItem = </span><span class="s2">false</span><span class="s1">;</span>
            <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">items !== </span><span class="s0">'undefined' </span><span class="s1">&amp;&amp; !Array.isArray(items)) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">`</span><span class="s6">\`</span><span class="s1">${fieldName}</span><span class="s6">\` </span><span class="s0">must be undefined or valid has object`</span><span class="s1">);</span>
                <span class="s1">hadInvalidItem = </span><span class="s2">true</span><span class="s1">;</span>
            <span class="s1">} </span><span class="s2">else if </span><span class="s1">(items) {</span>
                <span class="s2">const </span><span class="s1">invalidHasItems = [];</span>
                <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">hasItem of items){</span>
                    <span class="s2">let </span><span class="s1">invalidHasParts = [];</span>
                    <span class="s2">if </span><span class="s1">(!allowedHasTypes.has(hasItem.type)) {</span>
                        <span class="s1">invalidHasParts.push(</span><span class="s0">`invalid type &quot;</span><span class="s1">${hasItem.type}</span><span class="s0">&quot;`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">hasItem.key !== </span><span class="s0">'string' </span><span class="s1">&amp;&amp; hasItem.type !== </span><span class="s0">'host'</span><span class="s1">) {</span>
                        <span class="s1">invalidHasParts.push(</span><span class="s0">`invalid key &quot;</span><span class="s1">${hasItem.key}</span><span class="s0">&quot;`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">hasItem.value !== </span><span class="s0">'undefined' </span><span class="s1">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">hasItem.value !== </span><span class="s0">'string'</span><span class="s1">) {</span>
                        <span class="s1">invalidHasParts.push(</span><span class="s0">`invalid value &quot;</span><span class="s1">${hasItem.value}</span><span class="s0">&quot;`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">hasItem.value === </span><span class="s0">'undefined' </span><span class="s1">&amp;&amp; hasItem.type === </span><span class="s0">'host'</span><span class="s1">) {</span>
                        <span class="s1">invalidHasParts.push(</span><span class="s0">`value is required for &quot;host&quot; type`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(invalidHasParts.length &gt; </span><span class="s3">0</span><span class="s1">) {</span>
                        <span class="s1">invalidHasItems.push(</span><span class="s0">`</span><span class="s1">${invalidHasParts.join(</span><span class="s0">', '</span><span class="s1">)} </span><span class="s0">for </span><span class="s1">${JSON.stringify(hasItem)}</span><span class="s0">`</span><span class="s1">);</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
                <span class="s2">if </span><span class="s1">(invalidHasItems.length &gt; </span><span class="s3">0</span><span class="s1">) {</span>
                    <span class="s1">hadInvalidItem = </span><span class="s2">true</span><span class="s1">;</span>
                    <span class="s2">const </span><span class="s1">itemStr = </span><span class="s0">`item</span><span class="s1">${invalidHasItems.length === </span><span class="s3">1 </span><span class="s1">? </span><span class="s0">'' </span><span class="s1">: </span><span class="s0">'s'</span><span class="s1">}</span><span class="s0">`</span><span class="s1">;</span>
                    <span class="s1">console.error(</span><span class="s0">`Invalid </span><span class="s6">\`</span><span class="s1">${fieldName}</span><span class="s6">\` </span><span class="s1">${itemStr}</span><span class="s0">:</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ invalidHasItems.join(</span><span class="s0">'</span><span class="s6">\n</span><span class="s0">'</span><span class="s1">));</span>
                    <span class="s1">console.error();</span>
                    <span class="s1">invalidParts.push(</span><span class="s0">`invalid </span><span class="s6">\`</span><span class="s1">${fieldName}</span><span class="s6">\` </span><span class="s1">${itemStr} </span><span class="s0">found`</span><span class="s1">);</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s1">hadInvalidItem;</span>
        <span class="s1">};</span>
        <span class="s2">if </span><span class="s1">(checkInvalidHasMissing(route.has, </span><span class="s0">'has'</span><span class="s1">)) {</span>
            <span class="s1">hadInvalidHas = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(checkInvalidHasMissing(route.missing, </span><span class="s0">'missing'</span><span class="s1">)) {</span>
            <span class="s1">hadInvalidMissing = </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(!route.source) {</span>
            <span class="s1">invalidParts.push(</span><span class="s0">'`source` is missing'</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">route.source !== </span><span class="s0">'string'</span><span class="s1">) {</span>
            <span class="s1">invalidParts.push(</span><span class="s0">'`source` is not a string'</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(!route.source.startsWith(</span><span class="s0">'/'</span><span class="s1">)) {</span>
            <span class="s1">invalidParts.push(</span><span class="s0">'`source` does not start with /'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'header'</span><span class="s1">) {</span>
            <span class="s1">invalidParts.push(...checkHeader(route));</span>
        <span class="s1">} </span><span class="s2">else if </span><span class="s1">(type !== </span><span class="s0">'middleware'</span><span class="s1">) {</span>
            <span class="s2">let </span><span class="s1">_route = route;</span>
            <span class="s2">if </span><span class="s1">(!_route.destination) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`destination` is missing'</span><span class="s1">);</span>
            <span class="s1">} </span><span class="s2">else if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">_route.destination !== </span><span class="s0">'string'</span><span class="s1">) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`destination` is not a string'</span><span class="s1">);</span>
            <span class="s1">} </span><span class="s2">else if </span><span class="s1">(type === </span><span class="s0">'rewrite' </span><span class="s1">&amp;&amp; !_route.destination.match(</span><span class="s4">/^(\/|https:\/\/|http:\/\/)/</span><span class="s1">)) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`destination` does not start with `/`, `http://`, or `https://`'</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(type === </span><span class="s0">'redirect'</span><span class="s1">) {</span>
            <span class="s2">const </span><span class="s1">result = checkRedirect(route);</span>
            <span class="s1">hadInvalidStatus = hadInvalidStatus || result.hadInvalidStatus;</span>
            <span class="s1">invalidParts.push(...result.invalidParts);</span>
        <span class="s1">}</span>
        <span class="s2">let </span><span class="s1">sourceTokens;</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">route.source === </span><span class="s0">'string' </span><span class="s1">&amp;&amp; route.source.startsWith(</span><span class="s0">'/'</span><span class="s1">)) {</span>
            <span class="s5">// only show parse error if we didn't already show error</span>
            <span class="s5">// for not being a string</span>
            <span class="s2">const </span><span class="s1">{ tokens, error, regexStr } = (</span><span class="s3">0</span><span class="s1">, _trytoparsepath.tryToParsePath)(route.source);</span>
            <span class="s2">if </span><span class="s1">(error) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`source` parse failed'</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(regexStr &amp;&amp; regexStr.length &gt; </span><span class="s3">4096</span><span class="s1">) {</span>
                <span class="s1">invalidParts.push(</span><span class="s0">'`source` exceeds max built length of 4096'</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s1">sourceTokens = tokens;</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">hasSegments = </span><span class="s2">new </span><span class="s1">Set();</span>
        <span class="s2">if </span><span class="s1">(route.has) {</span>
            <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">hasItem of route.has){</span>
                <span class="s2">if </span><span class="s1">(!hasItem.value &amp;&amp; hasItem.key) {</span>
                    <span class="s1">hasSegments.add(hasItem.key);</span>
                <span class="s1">}</span>
                <span class="s2">if </span><span class="s1">(hasItem.value) {</span>
                    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">match of hasItem.value.matchAll(namedGroupsRegex)){</span>
                        <span class="s2">if </span><span class="s1">(match[</span><span class="s3">1</span><span class="s1">]) {</span>
                            <span class="s1">hasSegments.add(match[</span><span class="s3">1</span><span class="s1">]);</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(hasItem.type === </span><span class="s0">'host'</span><span class="s1">) {</span>
                        <span class="s1">hasSegments.add(</span><span class="s0">'host'</span><span class="s1">);</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s5">// make sure no unnamed patterns are attempted to be used in the</span>
        <span class="s5">// destination as this can cause confusion and is not allowed</span>
        <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">route.destination === </span><span class="s0">'string'</span><span class="s1">) {</span>
            <span class="s2">if </span><span class="s1">(route.destination.startsWith(</span><span class="s0">'/'</span><span class="s1">) &amp;&amp; Array.isArray(sourceTokens)) {</span>
                <span class="s2">const </span><span class="s1">unnamedInDest = </span><span class="s2">new </span><span class="s1">Set();</span>
                <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">token of sourceTokens){</span>
                    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">token === </span><span class="s0">'object' </span><span class="s1">&amp;&amp; </span><span class="s2">typeof </span><span class="s1">token.name === </span><span class="s0">'number'</span><span class="s1">) {</span>
                        <span class="s2">const </span><span class="s1">unnamedIndex = </span><span class="s2">new </span><span class="s1">RegExp(</span><span class="s0">`:</span><span class="s1">${token.name}</span><span class="s0">(?!</span><span class="s6">\\</span><span class="s0">d)`</span><span class="s1">);</span>
                        <span class="s2">if </span><span class="s1">(route.destination.match(unnamedIndex)) {</span>
                            <span class="s1">unnamedInDest.add(</span><span class="s0">`:</span><span class="s1">${token.name}</span><span class="s0">`</span><span class="s1">);</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
                <span class="s2">if </span><span class="s1">(unnamedInDest.size &gt; </span><span class="s3">0</span><span class="s1">) {</span>
                    <span class="s1">invalidParts.push(</span><span class="s0">`</span><span class="s6">\`</span><span class="s0">destination</span><span class="s6">\` </span><span class="s0">has unnamed params </span><span class="s1">${[</span>
                        <span class="s1">...unnamedInDest</span>
                    <span class="s1">].join(</span><span class="s0">', '</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">);</span>
                <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                    <span class="s2">const </span><span class="s1">{ tokens: destTokens, regexStr: destRegexStr, error: destinationParseFailed } = (</span><span class="s3">0</span><span class="s1">, _trytoparsepath.tryToParsePath)(route.destination, {</span>
                        <span class="s1">handleUrl: </span><span class="s2">true</span>
                    <span class="s1">});</span>
                    <span class="s2">if </span><span class="s1">(destRegexStr &amp;&amp; destRegexStr.length &gt; </span><span class="s3">4096</span><span class="s1">) {</span>
                        <span class="s1">invalidParts.push(</span><span class="s0">'`destination` exceeds max built length of 4096'</span><span class="s1">);</span>
                    <span class="s1">}</span>
                    <span class="s2">if </span><span class="s1">(destinationParseFailed) {</span>
                        <span class="s1">invalidParts.push(</span><span class="s0">'`destination` parse failed'</span><span class="s1">);</span>
                    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
                        <span class="s2">const </span><span class="s1">sourceSegments = </span><span class="s2">new </span><span class="s1">Set(sourceTokens.map((item)=&gt;</span><span class="s2">typeof </span><span class="s1">item === </span><span class="s0">'object' </span><span class="s1">&amp;&amp; item.name).filter(Boolean));</span>
                        <span class="s2">const </span><span class="s1">invalidDestSegments = </span><span class="s2">new </span><span class="s1">Set();</span>
                        <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">token of destTokens){</span>
                            <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">token === </span><span class="s0">'object' </span><span class="s1">&amp;&amp; !sourceSegments.has(token.name) &amp;&amp; !hasSegments.has(token.name)) {</span>
                                <span class="s1">invalidDestSegments.add(token.name);</span>
                            <span class="s1">}</span>
                        <span class="s1">}</span>
                        <span class="s2">if </span><span class="s1">(invalidDestSegments.size) {</span>
                            <span class="s1">invalidParts.push(</span><span class="s0">`</span><span class="s6">\`</span><span class="s0">destination</span><span class="s6">\` </span><span class="s0">has segments not in </span><span class="s6">\`</span><span class="s0">source</span><span class="s6">\` </span><span class="s0">or </span><span class="s6">\`</span><span class="s0">has</span><span class="s6">\` </span><span class="s0">(</span><span class="s1">${[</span>
                                <span class="s1">...invalidDestSegments</span>
                            <span class="s1">].join(</span><span class="s0">', '</span><span class="s1">)}</span><span class="s0">)`</span><span class="s1">);</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">hasInvalidKeys = invalidKeys.length &gt; </span><span class="s3">0</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">hasInvalidParts = invalidParts.length &gt; </span><span class="s3">0</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(hasInvalidKeys || hasInvalidParts) {</span>
            <span class="s1">console.error(</span><span class="s0">`</span><span class="s1">${invalidParts.join(</span><span class="s0">', '</span><span class="s1">)}${invalidKeys.length ? (hasInvalidParts ? </span><span class="s0">',' </span><span class="s1">: </span><span class="s0">''</span><span class="s1">) + </span><span class="s0">` invalid field</span><span class="s1">${invalidKeys.length === </span><span class="s3">1 </span><span class="s1">? </span><span class="s0">'' </span><span class="s1">: </span><span class="s0">'s'</span><span class="s1">}</span><span class="s0">: ` </span><span class="s1">+ invalidKeys.join(</span><span class="s0">','</span><span class="s1">) : </span><span class="s0">''</span><span class="s1">} </span><span class="s0">for route </span><span class="s1">${JSON.stringify(route)}</span><span class="s0">`</span><span class="s1">);</span>
            <span class="s1">console.error();</span>
            <span class="s1">numInvalidRoutes++;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(numInvalidRoutes &gt; </span><span class="s3">0</span><span class="s1">) {</span>
        <span class="s2">if </span><span class="s1">(hadInvalidStatus) {</span>
            <span class="s1">console.error(</span><span class="s0">`</span><span class="s6">\n</span><span class="s0">Valid redirect statusCode values are </span><span class="s1">${[</span>
                <span class="s1">..._redirectstatus.allowedStatusCodes</span>
            <span class="s1">].join(</span><span class="s0">', '</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(hadInvalidHas) {</span>
            <span class="s1">console.error(</span><span class="s0">`</span><span class="s6">\n</span><span class="s0">Valid </span><span class="s6">\`</span><span class="s0">has</span><span class="s6">\` </span><span class="s0">object shape is </span><span class="s1">${JSON.stringify({</span>
                <span class="s1">type: [</span>
                    <span class="s1">...allowedHasTypes</span>
                <span class="s1">].join(</span><span class="s0">', '</span><span class="s1">),</span>
                <span class="s1">key: </span><span class="s0">'the key to check for'</span><span class="s1">,</span>
                <span class="s1">value: </span><span class="s0">'undefined or a value string to match against'</span>
            <span class="s1">}, </span><span class="s2">null</span><span class="s1">, </span><span class="s3">2</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(hadInvalidMissing) {</span>
            <span class="s1">console.error(</span><span class="s0">`</span><span class="s6">\n</span><span class="s0">Valid </span><span class="s6">\`</span><span class="s0">missing</span><span class="s6">\` </span><span class="s0">object shape is </span><span class="s1">${JSON.stringify({</span>
                <span class="s1">type: [</span>
                    <span class="s1">...allowedHasTypes</span>
                <span class="s1">].join(</span><span class="s0">', '</span><span class="s1">),</span>
                <span class="s1">key: </span><span class="s0">'the key to check for'</span><span class="s1">,</span>
                <span class="s1">value: </span><span class="s0">'undefined or a value string to match against'</span>
            <span class="s1">}, </span><span class="s2">null</span><span class="s1">, </span><span class="s3">2</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">console.error();</span>
        <span class="s1">console.error(</span><span class="s0">`Error: Invalid </span><span class="s1">${type}${numInvalidRoutes === </span><span class="s3">1 </span><span class="s1">? </span><span class="s0">'' </span><span class="s1">: </span><span class="s0">'s'</span><span class="s1">} </span><span class="s0">found`</span><span class="s1">);</span>
        <span class="s1">process.exit(</span><span class="s3">1</span><span class="s1">);</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">processRoutes(routes, config, type) {</span>
    <span class="s2">const </span><span class="s1">_routes = routes;</span>
    <span class="s2">const </span><span class="s1">newRoutes = [];</span>
    <span class="s2">const </span><span class="s1">defaultLocales = [];</span>
    <span class="s2">if </span><span class="s1">(config.i18n &amp;&amp; type === </span><span class="s0">'redirect'</span><span class="s1">) {</span>
        <span class="s2">var </span><span class="s1">_config_i18n;</span>
        <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">item of ((_config_i18n = config.i18n) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _config_i18n.domains) || []){</span>
            <span class="s1">defaultLocales.push({</span>
                <span class="s1">locale: item.defaultLocale,</span>
                <span class="s1">base: </span><span class="s0">`http</span><span class="s1">${item.http ? </span><span class="s0">'' </span><span class="s1">: </span><span class="s0">'s'</span><span class="s1">}</span><span class="s0">://</span><span class="s1">${item.domain}</span><span class="s0">`</span>
            <span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s1">defaultLocales.push({</span>
            <span class="s1">locale: config.i18n.defaultLocale,</span>
            <span class="s1">base: </span><span class="s0">''</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">r of _routes){</span>
        <span class="s2">var </span><span class="s1">_r_destination;</span>
        <span class="s2">const </span><span class="s1">srcBasePath = config.basePath &amp;&amp; r.basePath !== </span><span class="s2">false </span><span class="s1">? config.basePath : </span><span class="s0">''</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">isExternal = !((_r_destination = r.destination) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _r_destination.startsWith(</span><span class="s0">'/'</span><span class="s1">));</span>
        <span class="s2">const </span><span class="s1">destBasePath = srcBasePath &amp;&amp; !isExternal ? srcBasePath : </span><span class="s0">''</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(config.i18n &amp;&amp; r.locale !== </span><span class="s2">false</span><span class="s1">) {</span>
            <span class="s2">var </span><span class="s1">_r_destination1;</span>
            <span class="s2">if </span><span class="s1">(!isExternal) {</span>
                <span class="s1">defaultLocales.forEach((item)=&gt;{</span>
                    <span class="s2">let </span><span class="s1">destination;</span>
                    <span class="s2">if </span><span class="s1">(r.destination) {</span>
                        <span class="s1">destination = item.base ? </span><span class="s0">`</span><span class="s1">${item.base}${destBasePath}${r.destination}</span><span class="s0">` </span><span class="s1">: </span><span class="s0">`</span><span class="s1">${destBasePath}${r.destination}</span><span class="s0">`</span><span class="s1">;</span>
                    <span class="s1">}</span>
                    <span class="s1">newRoutes.push({</span>
                        <span class="s1">...r,</span>
                        <span class="s1">destination,</span>
                        <span class="s1">source: </span><span class="s0">`</span><span class="s1">${srcBasePath}</span><span class="s0">/</span><span class="s1">${item.locale}${r.source === </span><span class="s0">'/' </span><span class="s1">&amp;&amp; !config.trailingSlash ? </span><span class="s0">'' </span><span class="s1">: r.source}</span><span class="s0">`</span>
                    <span class="s1">});</span>
                <span class="s1">});</span>
            <span class="s1">}</span>
            <span class="s1">r.source = </span><span class="s0">`/:nextInternalLocale(</span><span class="s1">${config.i18n.locales.map((locale)=&gt;(</span><span class="s3">0</span><span class="s1">, _escaperegexp.escapeStringRegexp)(locale)).join(</span><span class="s0">'|'</span><span class="s1">)}</span><span class="s0">)</span><span class="s1">${r.source === </span><span class="s0">'/' </span><span class="s1">&amp;&amp; !config.trailingSlash ? </span><span class="s0">'' </span><span class="s1">: r.source}</span><span class="s0">`</span><span class="s1">;</span>
            <span class="s2">if </span><span class="s1">(r.destination &amp;&amp; ((_r_destination1 = r.destination) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _r_destination1.startsWith(</span><span class="s0">'/'</span><span class="s1">))) {</span>
                <span class="s1">r.destination = </span><span class="s0">`/:nextInternalLocale</span><span class="s1">${r.destination === </span><span class="s0">'/' </span><span class="s1">&amp;&amp; !config.trailingSlash ? </span><span class="s0">'' </span><span class="s1">: r.destination}</span><span class="s0">`</span><span class="s1">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s1">r.source = </span><span class="s0">`</span><span class="s1">${srcBasePath}${r.source === </span><span class="s0">'/' </span><span class="s1">&amp;&amp; srcBasePath ? </span><span class="s0">'' </span><span class="s1">: r.source}</span><span class="s0">`</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(r.destination) {</span>
            <span class="s1">r.destination = </span><span class="s0">`</span><span class="s1">${destBasePath}${r.destination === </span><span class="s0">'/' </span><span class="s1">&amp;&amp; destBasePath ? </span><span class="s0">'' </span><span class="s1">: r.destination}</span><span class="s0">`</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s1">newRoutes.push(r);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">newRoutes;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadRedirects(config) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">config.redirects !== </span><span class="s0">'function'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">[];</span>
    <span class="s1">}</span>
    <span class="s2">let </span><span class="s1">redirects = </span><span class="s2">await </span><span class="s1">config.redirects();</span>
    <span class="s5">// check before we process the routes and after to ensure</span>
    <span class="s5">// they are still valid</span>
    <span class="s1">checkCustomRoutes(redirects, </span><span class="s0">'redirect'</span><span class="s1">);</span>
    <span class="s5">// save original redirects before transforms</span>
    <span class="s2">if </span><span class="s1">(Array.isArray(redirects)) {</span>
        <span class="s1">config._originalRedirects = redirects.map((r)=&gt;({</span>
                <span class="s1">...r</span>
            <span class="s1">}));</span>
    <span class="s1">}</span>
    <span class="s1">redirects = processRoutes(redirects, config, </span><span class="s0">'redirect'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(redirects, </span><span class="s0">'redirect'</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">redirects;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadRewrites(config) {</span>
    <span class="s5">// If assetPrefix is set, add a rewrite for `/${assetPrefix}/_next/*`</span>
    <span class="s5">// requests so that they are handled in any of dev, start, or deploy</span>
    <span class="s5">// automatically without the user having to configure this.</span>
    <span class="s5">// If the assetPrefix is an absolute URL, we still consider the path for automatic rewrite.</span>
    <span class="s5">// but hostname routing must be handled by the user</span>
    <span class="s2">let </span><span class="s1">maybeAssetPrefixRewrite = [];</span>
    <span class="s2">if </span><span class="s1">(config.assetPrefix) {</span>
        <span class="s2">let </span><span class="s1">prefix = config.assetPrefix;</span>
        <span class="s2">if </span><span class="s1">((</span><span class="s3">0</span><span class="s1">, _url.isFullStringUrl)(config.assetPrefix) &amp;&amp; URL.canParse(config.assetPrefix)) {</span>
            <span class="s1">prefix = </span><span class="s2">new </span><span class="s1">URL(config.assetPrefix).pathname;</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(prefix &amp;&amp; prefix !== </span><span class="s0">'/'</span><span class="s1">) {</span>
            <span class="s2">const </span><span class="s1">assetPrefix = prefix.startsWith(</span><span class="s0">'/'</span><span class="s1">) ? prefix : </span><span class="s0">`/</span><span class="s1">${prefix}</span><span class="s0">`</span><span class="s1">;</span>
            <span class="s2">const </span><span class="s1">basePath = config.basePath || </span><span class="s0">''</span><span class="s1">;</span>
            <span class="s5">// If these are the same, then this would result in an infinite rewrite.</span>
            <span class="s2">if </span><span class="s1">(assetPrefix !== basePath) {</span>
                <span class="s1">maybeAssetPrefixRewrite.push({</span>
                    <span class="s1">source: </span><span class="s0">`</span><span class="s1">${assetPrefix}</span><span class="s0">/_next/:path+`</span><span class="s1">,</span>
                    <span class="s1">destination: </span><span class="s0">`</span><span class="s1">${basePath}</span><span class="s0">/_next/:path+`</span>
                <span class="s1">});</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">config.rewrites !== </span><span class="s0">'function'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">{</span>
            <span class="s1">beforeFiles: [</span>
                <span class="s1">...maybeAssetPrefixRewrite</span>
            <span class="s1">],</span>
            <span class="s1">afterFiles: [],</span>
            <span class="s1">fallback: []</span>
        <span class="s1">};</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">_rewrites = </span><span class="s2">await </span><span class="s1">config.rewrites();</span>
    <span class="s2">let </span><span class="s1">beforeFiles = [];</span>
    <span class="s2">let </span><span class="s1">afterFiles = [];</span>
    <span class="s2">let </span><span class="s1">fallback = [];</span>
    <span class="s2">if </span><span class="s1">(!Array.isArray(_rewrites) &amp;&amp; </span><span class="s2">typeof </span><span class="s1">_rewrites === </span><span class="s0">'object' </span><span class="s1">&amp;&amp; Object.keys(_rewrites).every((key)=&gt;key === </span><span class="s0">'beforeFiles' </span><span class="s1">|| key === </span><span class="s0">'afterFiles' </span><span class="s1">|| key === </span><span class="s0">'fallback'</span><span class="s1">)) {</span>
        <span class="s1">beforeFiles = _rewrites.beforeFiles || [];</span>
        <span class="s1">afterFiles = _rewrites.afterFiles || [];</span>
        <span class="s1">fallback = _rewrites.fallback || [];</span>
    <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
        <span class="s1">afterFiles = _rewrites;</span>
    <span class="s1">}</span>
    <span class="s5">// check before we process the routes and after to ensure</span>
    <span class="s5">// they are still valid</span>
    <span class="s1">checkCustomRoutes(beforeFiles, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(afterFiles, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(fallback, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s5">// save original rewrites before transforms</span>
    <span class="s1">config._originalRewrites = {</span>
        <span class="s1">beforeFiles: beforeFiles.map((r)=&gt;({</span>
                <span class="s1">...r</span>
            <span class="s1">})),</span>
        <span class="s1">afterFiles: afterFiles.map((r)=&gt;({</span>
                <span class="s1">...r</span>
            <span class="s1">})),</span>
        <span class="s1">fallback: fallback.map((r)=&gt;({</span>
                <span class="s1">...r</span>
            <span class="s1">}))</span>
    <span class="s1">};</span>
    <span class="s1">beforeFiles = [</span>
        <span class="s1">...maybeAssetPrefixRewrite,</span>
        <span class="s1">...processRoutes(beforeFiles, config, </span><span class="s0">'rewrite'</span><span class="s1">)</span>
    <span class="s1">];</span>
    <span class="s1">afterFiles = processRoutes(afterFiles, config, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">fallback = processRoutes(fallback, config, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(beforeFiles, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(afterFiles, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(fallback, </span><span class="s0">'rewrite'</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">{</span>
        <span class="s1">beforeFiles,</span>
        <span class="s1">afterFiles,</span>
        <span class="s1">fallback</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadHeaders(config) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">config.headers !== </span><span class="s0">'function'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">[];</span>
    <span class="s1">}</span>
    <span class="s2">let </span><span class="s1">headers = </span><span class="s2">await </span><span class="s1">config.headers();</span>
    <span class="s5">// check before we process the routes and after to ensure</span>
    <span class="s5">// they are still valid</span>
    <span class="s1">checkCustomRoutes(headers, </span><span class="s0">'header'</span><span class="s1">);</span>
    <span class="s1">headers = processRoutes(headers, config, </span><span class="s0">'header'</span><span class="s1">);</span>
    <span class="s1">checkCustomRoutes(headers, </span><span class="s0">'header'</span><span class="s1">);</span>
    <span class="s2">return </span><span class="s1">headers;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">loadCustomRoutes(config) {</span>
    <span class="s2">var </span><span class="s1">_config_experimental;</span>
    <span class="s2">const </span><span class="s1">[headers, rewrites, redirects] = </span><span class="s2">await </span><span class="s1">Promise.all([</span>
        <span class="s1">loadHeaders(config),</span>
        <span class="s1">loadRewrites(config),</span>
        <span class="s1">loadRedirects(config)</span>
    <span class="s1">]);</span>
    <span class="s2">const </span><span class="s1">totalRewrites = rewrites.beforeFiles.length + rewrites.afterFiles.length + rewrites.fallback.length;</span>
    <span class="s2">const </span><span class="s1">totalRoutes = headers.length + redirects.length + totalRewrites;</span>
    <span class="s2">if </span><span class="s1">(totalRoutes &gt; </span><span class="s3">1000</span><span class="s1">) {</span>
        <span class="s1">console.warn((</span><span class="s3">0</span><span class="s1">, _picocolors.bold)((</span><span class="s3">0</span><span class="s1">, _picocolors.yellow)(</span><span class="s0">`Warning: `</span><span class="s1">)) + </span><span class="s0">`total number of custom routes exceeds 1000, this can reduce performance. Route counts:</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`headers: </span><span class="s1">${headers.length}</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`rewrites: </span><span class="s1">${totalRewrites}</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`redirects: </span><span class="s1">${redirects.length}</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`See more info: https://nextjs.org/docs/messages/max-custom-routes-reached`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(((_config_experimental = config.experimental) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s3">0 </span><span class="s1">: _config_experimental.useSkewCookie) &amp;&amp; config.deploymentId) {</span>
        <span class="s1">headers.unshift({</span>
            <span class="s1">source: </span><span class="s0">'/:path*'</span><span class="s1">,</span>
            <span class="s1">headers: [</span>
                <span class="s1">{</span>
                    <span class="s1">key: </span><span class="s0">'Set-Cookie'</span><span class="s1">,</span>
                    <span class="s1">value: </span><span class="s0">`__vdpl=</span><span class="s1">${config.deploymentId}</span><span class="s0">; Path=/; HttpOnly`</span>
                <span class="s1">}</span>
            <span class="s1">]</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(!config.skipTrailingSlashRedirect) {</span>
        <span class="s2">if </span><span class="s1">(config.trailingSlash) {</span>
            <span class="s1">redirects.unshift({</span>
                <span class="s1">source: </span><span class="s0">'/:file((?!</span><span class="s6">\\</span><span class="s0">.well-known(?:/.*)?)(?:[^/]+/)*[^/]+</span><span class="s6">\\</span><span class="s0">.</span><span class="s6">\\</span><span class="s0">w+)/'</span><span class="s1">,</span>
                <span class="s1">destination: </span><span class="s0">'/:file'</span><span class="s1">,</span>
                <span class="s1">permanent: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">locale: config.i18n ? </span><span class="s2">false </span><span class="s1">: undefined,</span>
                <span class="s1">internal: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s5">// don't run this redirect for _next/data requests</span>
                <span class="s1">missing: [</span>
                    <span class="s1">{</span>
                        <span class="s1">type: </span><span class="s0">'header'</span><span class="s1">,</span>
                        <span class="s1">key: </span><span class="s0">'x-nextjs-data'</span>
                    <span class="s1">}</span>
                <span class="s1">]</span>
            <span class="s1">}, {</span>
                <span class="s1">source: </span><span class="s0">'/:notfile((?!</span><span class="s6">\\</span><span class="s0">.well-known(?:/.*)?)(?:[^/]+/)*[^/</span><span class="s6">\\</span><span class="s0">.]+)'</span><span class="s1">,</span>
                <span class="s1">destination: </span><span class="s0">'/:notfile/'</span><span class="s1">,</span>
                <span class="s1">permanent: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">locale: config.i18n ? </span><span class="s2">false </span><span class="s1">: undefined,</span>
                <span class="s1">internal: </span><span class="s2">true</span>
            <span class="s1">});</span>
            <span class="s2">if </span><span class="s1">(config.basePath) {</span>
                <span class="s1">redirects.unshift({</span>
                    <span class="s1">source: config.basePath,</span>
                    <span class="s1">destination: config.basePath + </span><span class="s0">'/'</span><span class="s1">,</span>
                    <span class="s1">permanent: </span><span class="s2">true</span><span class="s1">,</span>
                    <span class="s1">basePath: </span><span class="s2">false</span><span class="s1">,</span>
                    <span class="s1">locale: config.i18n ? </span><span class="s2">false </span><span class="s1">: undefined,</span>
                    <span class="s1">internal: </span><span class="s2">true</span>
                <span class="s1">});</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s1">redirects.unshift({</span>
                <span class="s1">source: </span><span class="s0">'/:path+/'</span><span class="s1">,</span>
                <span class="s1">destination: </span><span class="s0">'/:path+'</span><span class="s1">,</span>
                <span class="s1">permanent: </span><span class="s2">true</span><span class="s1">,</span>
                <span class="s1">locale: config.i18n ? </span><span class="s2">false </span><span class="s1">: undefined,</span>
                <span class="s1">internal: </span><span class="s2">true</span>
            <span class="s1">});</span>
            <span class="s2">if </span><span class="s1">(config.basePath) {</span>
                <span class="s1">redirects.unshift({</span>
                    <span class="s1">source: config.basePath + </span><span class="s0">'/'</span><span class="s1">,</span>
                    <span class="s1">destination: config.basePath,</span>
                    <span class="s1">permanent: </span><span class="s2">true</span><span class="s1">,</span>
                    <span class="s1">basePath: </span><span class="s2">false</span><span class="s1">,</span>
                    <span class="s1">locale: config.i18n ? </span><span class="s2">false </span><span class="s1">: undefined,</span>
                    <span class="s1">internal: </span><span class="s2">true</span>
                <span class="s1">});</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">{</span>
        <span class="s1">headers,</span>
        <span class="s1">rewrites,</span>
        <span class="s1">redirects</span>
    <span class="s1">};</span>
<span class="s1">}</span>

<span class="s5">//# sourceMappingURL=load-custom-routes.js.map</span></pre>
</body>
</html>