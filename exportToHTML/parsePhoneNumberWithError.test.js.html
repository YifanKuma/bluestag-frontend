<html>
<head>
<title>parsePhoneNumberWithError.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #0037a6;}
.s5 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
parsePhoneNumberWithError.test.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">_parsePhoneNumber from </span><span class="s2">'./parsePhoneNumberWithError.js'</span>
<span class="s0">import </span><span class="s1">metadata from </span><span class="s2">'../metadata.min.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>
<span class="s0">import </span><span class="s1">metadataFull from </span><span class="s2">'../metadata.max.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>

<span class="s0">function </span><span class="s1">parsePhoneNumber(...parameters) {</span>
	<span class="s1">parameters.push(metadata)</span>
	<span class="s0">return </span><span class="s1">_parsePhoneNumber.apply(</span><span class="s0">this</span><span class="s1">, parameters)</span>
<span class="s1">}</span>

<span class="s0">function </span><span class="s1">parsePhoneNumberFull(...parameters) {</span>
	<span class="s1">parameters.push(metadataFull)</span>
	<span class="s0">return </span><span class="s1">_parsePhoneNumber.apply(</span><span class="s0">this</span><span class="s1">, parameters)</span>
<span class="s1">}</span>

<span class="s1">describe(</span><span class="s2">'parsePhoneNumberWithError'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s2">'should parse phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'The phone number is: 8 (800) 555 35 35. Some other text.'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.country).to.equal(</span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.countryCallingCode).to.equal(</span><span class="s2">'7'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.nationalNumber).to.equal(</span><span class="s2">'8005553535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.number).to.equal(</span><span class="s2">'+78005553535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.isPossible()).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.isValid()).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s3">// phoneNumber.isValidForRegion('RU').should.equal(true)</span>
		<span class="s3">// Russian phone type regexps aren't included in default metadata.</span>
		<span class="s1">expect(parsePhoneNumberFull(</span><span class="s2">'Phone: 8 (800) 555 35 35.'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">).getType()).to.equal(</span><span class="s2">'TOLL_FREE'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'shouldn</span><span class="s4">\'</span><span class="s2">t set country when it</span><span class="s4">\'</span><span class="s2">s non-derivable'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'+7 111 555 35 35'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.country).to.be.undefined</span>
		<span class="s1">expect(phoneNumber.countryCallingCode).to.equal(</span><span class="s2">'7'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.nationalNumber).to.equal(</span><span class="s2">'1115553535'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should parse carrier code'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'0 15 21 5555-5555'</span><span class="s1">, </span><span class="s2">'BR'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.carrierCode).to.equal(</span><span class="s2">'15'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should parse phone extension'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'Phone: 8 (800) 555 35 35 ext. 1234.'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.ext).to.equal(</span><span class="s2">'1234'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should validate numbers for countries with no type regular expressions'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(parsePhoneNumber(</span><span class="s2">'+380391234567'</span><span class="s1">).isValid()).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s1">expect(parsePhoneNumber(</span><span class="s2">'+380191234567'</span><span class="s1">).isValid()).to.equal(</span><span class="s0">false</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should format numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'Phone: 8 (800) 555 35 35.'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.format(</span><span class="s2">'NATIONAL'</span><span class="s1">)).to.equal(</span><span class="s2">'8 (800) 555-35-35'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.formatNational()).to.equal(</span><span class="s2">'8 (800) 555-35-35'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.format(</span><span class="s2">'INTERNATIONAL'</span><span class="s1">)).to.equal(</span><span class="s2">'+7 800 555 35 35'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.formatInternational()).to.equal(</span><span class="s2">'+7 800 555 35 35'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should get tel: URI'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'Phone: 8 (800) 555 35 35 ext. 1234.'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.getURI()).to.equal(</span><span class="s2">'tel:+78005553535;ext=1234'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should work in edge cases'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+78005553535'</span><span class="s1">, -</span><span class="s5">1</span><span class="s1">, {})).to.throw(</span><span class="s2">'Invalid second argument'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should throw parse errors'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'8005553535'</span><span class="s1">, </span><span class="s2">'XX'</span><span class="s1">)).to.throw(</span><span class="s2">'INVALID_COUNTRY'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)).to.throw(</span><span class="s2">'NOT_A_NUMBER'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'a'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)).to.throw(</span><span class="s2">'NOT_A_NUMBER'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'1'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+4'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+44'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+443'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+370'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'88888888888888888888'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_LONG'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'8 (800) 555 35 35'</span><span class="s1">)).to.throw(</span><span class="s2">'INVALID_COUNTRY'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+9991112233'</span><span class="s1">)).to.throw(</span><span class="s2">'INVALID_COUNTRY'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'+9991112233'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">)).to.throw(</span><span class="s2">'INVALID_COUNTRY'</span><span class="s1">)</span>
		<span class="s1">expect(() =&gt; parsePhoneNumber(</span><span class="s2">'8005553535                                                                                                                                                                                                                                                 '</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">)).to.throw(</span><span class="s2">'TOO_LONG'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should parse incorrect international phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s3">// Parsing national prefixes and carrier codes</span>
		<span class="s3">// is only required for local phone numbers</span>
		<span class="s3">// but some people don't understand that</span>
		<span class="s3">// and sometimes write international phone numbers</span>
		<span class="s3">// with national prefixes (or maybe even carrier codes).</span>
		<span class="s3">// http://ucken.blogspot.ru/2016/03/trunk-prefixes-in-skype4b.html</span>
		<span class="s3">// Google's original library forgives such mistakes</span>
		<span class="s3">// and so does this library, because it has been requested:</span>
		<span class="s3">// https://github.com/catamphetamine/libphonenumber-js/issues/127</span>

		<span class="s0">let </span><span class="s1">phoneNumber</span>

		<span class="s3">// For complete numbers it should strip national prefix.</span>
		<span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'+1 1877 215 5230'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.nationalNumber).to.equal(</span><span class="s2">'8772155230'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.country).to.equal(</span><span class="s2">'US'</span><span class="s1">)</span>

		<span class="s3">// For complete numbers it should strip national prefix.</span>
		<span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'+7 8800 555 3535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.nationalNumber).to.equal(</span><span class="s2">'8005553535'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.country).to.equal(</span><span class="s2">'RU'</span><span class="s1">)</span>

		<span class="s3">// For incomplete numbers it shouldn't strip national prefix.</span>
		<span class="s1">phoneNumber = parsePhoneNumber(</span><span class="s2">'+7 8800 555 353'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.nationalNumber).to.equal(</span><span class="s2">'8800555353'</span><span class="s1">)</span>
		<span class="s1">expect(phoneNumber.country).to.be.undefined</span>
	<span class="s1">})</span>
<span class="s1">})</span>
</pre>
</body>
</html>