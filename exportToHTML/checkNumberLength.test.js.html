<html>
<head>
<title>checkNumberLength.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
checkNumberLength.test.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">Metadata from </span><span class="s2">'../metadata.js'</span>
<span class="s0">import </span><span class="s1">metadata from </span><span class="s2">'../../metadata.max.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>
<span class="s0">import </span><span class="s1">oldMetadata from </span><span class="s2">'../../test/metadata/1.0.0/metadata.min.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>

<span class="s0">import </span><span class="s1">checkNumberLength, { checkNumberLengthForType } from </span><span class="s2">'./checkNumberLength.js'</span>

<span class="s1">describe(</span><span class="s2">'checkNumberLength'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s2">'should check phone number length'</span><span class="s1">, () =&gt; {</span>
		<span class="s3">// Too short.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'800555353'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s3">// Normal.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'8005553535'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
		<span class="s3">// Too long.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'80055535355'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'TOO_LONG'</span><span class="s1">)</span>

		<span class="s3">// No such type.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'169454850'</span><span class="s1">, </span><span class="s2">'AC'</span><span class="s1">, </span><span class="s2">'VOIP'</span><span class="s1">)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>
		<span class="s3">// No such possible length.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'1694548'</span><span class="s1">, </span><span class="s2">'AD'</span><span class="s1">, undefined)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>

		<span class="s3">// FIXED_LINE_OR_MOBILE</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'1694548'</span><span class="s1">, </span><span class="s2">'AD'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>
		<span class="s3">// No mobile phones.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'8123'</span><span class="s1">, </span><span class="s2">'TA'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
		<span class="s3">// No &quot;possible lengths&quot; for &quot;mobile&quot;.</span>
		<span class="s1">expect(checkNumberLengthWithCountry(</span><span class="s2">'81234567'</span><span class="s1">, </span><span class="s2">'SZ'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should check phone number length (no `country` specified)'</span><span class="s1">, () =&gt; {</span>
		<span class="s3">// Too short.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'800555353'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'TOO_SHORT'</span><span class="s1">)</span>
		<span class="s3">// Normal.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'8005553535'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
		<span class="s3">// Too long.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'80055535355'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">)).to.equal(</span><span class="s2">'TOO_LONG'</span><span class="s1">)</span>

		<span class="s3">// No such type.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'169454850'</span><span class="s1">, </span><span class="s2">'AC'</span><span class="s1">, </span><span class="s2">'VOIP'</span><span class="s1">)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>
		<span class="s3">// No such possible length.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'1694548'</span><span class="s1">, </span><span class="s2">'AD'</span><span class="s1">, undefined)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>

		<span class="s3">// FIXED_LINE_OR_MOBILE</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'1694548'</span><span class="s1">, </span><span class="s2">'AD'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'INVALID_LENGTH'</span><span class="s1">)</span>
		<span class="s3">// No mobile phones.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'8123'</span><span class="s1">, </span><span class="s2">'TA'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
		<span class="s3">// No &quot;possible lengths&quot; for &quot;mobile&quot;.</span>
		<span class="s1">expect(checkNumberLengthWithoutCountry(</span><span class="s2">'81234567'</span><span class="s1">, </span><span class="s2">'SZ'</span><span class="s1">, </span><span class="s2">'FIXED_LINE_OR_MOBILE'</span><span class="s1">)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should work for old metadata'</span><span class="s1">, </span><span class="s0">function</span><span class="s1">() {</span>
		<span class="s0">const </span><span class="s1">_oldMetadata = </span><span class="s0">new </span><span class="s1">Metadata(oldMetadata)</span>
		<span class="s1">_oldMetadata.country(</span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(checkNumberLengthForType(</span><span class="s2">'8005553535'</span><span class="s1">, </span><span class="s2">'RU'</span><span class="s1">, </span><span class="s2">'FIXED_LINE'</span><span class="s1">, _oldMetadata)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should work for old metadata (no `country` specified)'</span><span class="s1">, </span><span class="s0">function</span><span class="s1">() {</span>
		<span class="s0">const </span><span class="s1">_oldMetadata = </span><span class="s0">new </span><span class="s1">Metadata(oldMetadata)</span>
		<span class="s1">_oldMetadata.country(</span><span class="s2">'RU'</span><span class="s1">)</span>
		<span class="s1">expect(checkNumberLengthForType(</span><span class="s2">'8005553535'</span><span class="s1">, undefined, </span><span class="s2">'FIXED_LINE'</span><span class="s1">, _oldMetadata)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should handle the cases when multiple countries share the same country calling code and a phone number is possible in non-&quot;main&quot; country and is not possible in the &quot;main&quot; country'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">const </span><span class="s1">_metadata = </span><span class="s0">new </span><span class="s1">Metadata(metadata)</span>
		<span class="s1">_metadata.country(</span><span class="s2">'US'</span><span class="s1">)</span>

		<span class="s1">expect(checkNumberLength(</span><span class="s2">'3100000'</span><span class="s1">, undefined, _metadata)).to.equal(</span><span class="s2">'TOO_SHORT'</span><span class="s1">);</span>
		<span class="s1">expect(checkNumberLength(</span><span class="s2">'3100000'</span><span class="s1">, </span><span class="s2">'US'</span><span class="s1">, _metadata)).to.equal(</span><span class="s2">'TOO_SHORT'</span><span class="s1">);</span>
		<span class="s1">expect(checkNumberLength(</span><span class="s2">'3100000'</span><span class="s1">, </span><span class="s2">'CA'</span><span class="s1">, _metadata)).to.equal(</span><span class="s2">'IS_POSSIBLE'</span><span class="s1">);</span>
	<span class="s1">})</span>
<span class="s1">})</span>

<span class="s0">function </span><span class="s1">checkNumberLengthWithCountry(number, country, type) {</span>
	<span class="s0">const </span><span class="s1">_metadata = </span><span class="s0">new </span><span class="s1">Metadata(metadata)</span>
	<span class="s1">_metadata.country(country)</span>
	<span class="s0">return </span><span class="s1">checkNumberLengthForType(number, country, type, _metadata)</span>
<span class="s1">}</span>

<span class="s0">function </span><span class="s1">checkNumberLengthWithoutCountry(number, country, type) {</span>
	<span class="s0">const </span><span class="s1">_metadata = </span><span class="s0">new </span><span class="s1">Metadata(metadata)</span>
	<span class="s1">_metadata.country(country)</span>
	<span class="s0">return </span><span class="s1">checkNumberLengthForType(number, undefined, type, _metadata)</span>
<span class="s1">}</span></pre>
</body>
</html>