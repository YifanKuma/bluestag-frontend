<html>
<head>
<title>restore-reducer.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
restore-reducer.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../../../src/client/components/router-reducer/reducers/restore-reducer.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import { createHrefFromUrl } from '../create-href-from-url'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">ReducerState,</span><span class="s3">\n  </span><span class="s1">RestoreAction,</span><span class="s3">\n</span><span class="s1">} from '../router-reducer-types'</span><span class="s3">\n</span><span class="s1">import { extractPathFromFlightRouterState } from '../compute-changed-path'</span><span class="s3">\n</span><span class="s1">import { updateCacheNodeOnPopstateRestoration } from '../ppr-navigations'</span><span class="s3">\n\n</span><span class="s1">export function restoreReducer(</span><span class="s3">\n  </span><span class="s1">state: ReadonlyReducerState,</span><span class="s3">\n  </span><span class="s1">action: RestoreAction</span><span class="s3">\n</span><span class="s1">): ReducerState {</span><span class="s3">\n  </span><span class="s1">const { url, tree } = action</span><span class="s3">\n  </span><span class="s1">const href = createHrefFromUrl(url)</span><span class="s3">\n  </span><span class="s1">// This action is used to restore the router state from the history state.</span><span class="s3">\n  </span><span class="s1">// However, it's possible that the history state no longer contains the `FlightRouterState`.</span><span class="s3">\n  </span><span class="s1">// We will copy over the internal state on pushState/replaceState events, but if a history entry</span><span class="s3">\n  </span><span class="s1">// occurred before hydration, or if the user navigated to a hash using a regular anchor link,</span><span class="s3">\n  </span><span class="s1">// the history state will not contain the `FlightRouterState`.</span><span class="s3">\n  </span><span class="s1">// In this case, we'll continue to use the existing tree so the router doesn't get into an invalid state.</span><span class="s3">\n  </span><span class="s1">const treeToRestore = tree || state.tree</span><span class="s3">\n\n  </span><span class="s1">const oldCache = state.cache</span><span class="s3">\n  </span><span class="s1">const newCache = process.env.__NEXT_PPR</span><span class="s3">\n    </span><span class="s1">? // When PPR is enabled, we update the cache to drop the prefetch</span><span class="s3">\n      </span><span class="s1">// data for any segment whose dynamic data was already received. This</span><span class="s3">\n      </span><span class="s1">// prevents an unnecessary flash back to PPR state during a</span><span class="s3">\n      </span><span class="s1">// back/forward navigation.</span><span class="s3">\n      </span><span class="s1">updateCacheNodeOnPopstateRestoration(oldCache, treeToRestore)</span><span class="s3">\n    </span><span class="s1">: oldCache</span><span class="s3">\n\n  </span><span class="s1">return {</span><span class="s3">\n    </span><span class="s1">// Set canonical url</span><span class="s3">\n    </span><span class="s1">canonicalUrl: href,</span><span class="s3">\n    </span><span class="s1">pushRef: {</span><span class="s3">\n      </span><span class="s1">pendingPush: false,</span><span class="s3">\n      </span><span class="s1">mpaNavigation: false,</span><span class="s3">\n      </span><span class="s1">// Ensures that the custom history state that was set is preserved when applying this update.</span><span class="s3">\n      </span><span class="s1">preserveCustomHistoryState: true,</span><span class="s3">\n    </span><span class="s1">},</span><span class="s3">\n    </span><span class="s1">focusAndScrollRef: state.focusAndScrollRef,</span><span class="s3">\n    </span><span class="s1">cache: newCache,</span><span class="s3">\n    </span><span class="s1">prefetchCache: state.prefetchCache,</span><span class="s3">\n    </span><span class="s1">// Restore provided tree</span><span class="s3">\n    </span><span class="s1">tree: treeToRestore,</span><span class="s3">\n    </span><span class="s1">nextUrl: extractPathFromFlightRouterState(treeToRestore) ?? url.pathname,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;restoreReducer&quot;</span><span class="s0">,</span><span class="s1">&quot;state&quot;</span><span class="s0">,</span><span class="s1">&quot;action&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;tree&quot;</span><span class="s0">,</span><span class="s1">&quot;href&quot;</span><span class="s0">,</span><span class="s1">&quot;createHrefFromUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;treeToRestore&quot;</span><span class="s0">,</span><span class="s1">&quot;oldCache&quot;</span><span class="s0">,</span><span class="s1">&quot;cache&quot;</span><span class="s0">,</span><span class="s1">&quot;newCache&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;__NEXT_PPR&quot;</span><span class="s0">,</span><span class="s1">&quot;updateCacheNodeOnPopstateRestoration&quot;</span><span class="s0">,</span><span class="s1">&quot;extractPathFromFlightRouterState&quot;</span><span class="s0">,</span><span class="s1">&quot;canonicalUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pushRef&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingPush&quot;</span><span class="s0">,</span><span class="s1">&quot;mpaNavigation&quot;</span><span class="s0">,</span><span class="s1">&quot;preserveCustomHistoryState&quot;</span><span class="s0">,</span><span class="s1">&quot;focusAndScrollRef&quot;</span><span class="s0">,</span><span class="s1">&quot;prefetchCache&quot;</span><span class="s0">,</span><span class="s1">&quot;nextUrl&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BASgBA;;;eAAAA;;;mCATkB;oCAMe;gCACI;AAE9C,SAASA,eACdC,KAA2B,EAC3BC,MAAqB;IAErB,MAAM,EAAEC,GAAG,EAAEC,IAAI,EAAE,GAAGF;IACtB,MAAMG,OAAOC,IAAAA,oCAAiB,EAACH;IAC/B,0EAA0E;IAC1E,4FAA4F;IAC5F,gGAAgG;IAChG,6FAA6F;IAC7F,8DAA8D;IAC9D,yGAAyG;IACzG,MAAMI,gBAAgBH,QAAQH,MAAMG,IAAI;IAExC,MAAMI,WAAWP,MAAMQ,KAAK;IAC5B,MAAMC,WAAWC,QAAQC,GAAG,CAACC,UAAU,GAEnC,qEAAqE;IACrE,2DAA2D;IAC3D,2BAA2B;IAC3BC,IAAAA,oDAAoC,EAACN,UAAUD,iBAC/CC;QAgBOO;IAdX,OAAO;QACL,oBAAoB;QACpBC,cAAcX;QACdY,SAAS;YACPC,aAAa;YACbC,eAAe;YACf,6FAA6F;YAC7FC,4BAA4B;QAC9B;QACAC,mBAAmBpB,MAAMoB,iBAAiB;QAC1CZ,OAAOC;QACPY,eAAerB,MAAMqB,aAAa;QAClC,wBAAwB;QACxBlB,MAAMG;QACNgB,SAASR,CAAAA,oCAAAA,IAAAA,oDAAgC,EAACR,0BAAjCQ,oCAAmDZ,IAAIqB,QAAQ;IAC1E;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>