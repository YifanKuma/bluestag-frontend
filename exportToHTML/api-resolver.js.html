<html>
<head>
<title>api-resolver.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #1750eb;}
.s6 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
api-resolver.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span>
    <span class="s1">value: </span><span class="s2">true</span>
<span class="s1">});</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;apiResolver&quot;</span><span class="s1">, {</span>
    <span class="s1">enumerable: </span><span class="s2">true</span><span class="s1">,</span>
    <span class="s1">get: </span><span class="s2">function</span><span class="s1">() {</span>
        <span class="s2">return </span><span class="s1">apiResolver;</span>
    <span class="s1">}</span>
<span class="s1">});</span>
<span class="s2">const </span><span class="s1">_bytes = </span><span class="s3">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;next/dist/compiled/bytes&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_etag = require(</span><span class="s0">&quot;../../lib/etag&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_sendpayload = require(</span><span class="s0">&quot;../../send-payload&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_stream = require(</span><span class="s0">&quot;stream&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_iserror = </span><span class="s3">/*#__PURE__*/ </span><span class="s1">_interop_require_default(require(</span><span class="s0">&quot;../../../lib/is-error&quot;</span><span class="s1">));</span>
<span class="s2">const </span><span class="s1">_utils = require(</span><span class="s0">&quot;../../../shared/lib/utils&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_interopdefault = require(</span><span class="s0">&quot;../../../lib/interop-default&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_index = require(</span><span class="s0">&quot;./../index&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_getcookieparser = require(</span><span class="s0">&quot;./../get-cookie-parser&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_constants = require(</span><span class="s0">&quot;../../../lib/constants&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_trygetpreviewdata = require(</span><span class="s0">&quot;./try-get-preview-data&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">_parsebody = require(</span><span class="s0">&quot;./parse-body&quot;</span><span class="s1">);</span>
<span class="s2">function </span><span class="s1">_interop_require_default(obj) {</span>
    <span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : {</span>
        <span class="s2">default</span><span class="s1">: obj</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">getMaxContentLength(responseLimit) {</span>
    <span class="s2">if </span><span class="s1">(responseLimit &amp;&amp; </span><span class="s2">typeof </span><span class="s1">responseLimit !== </span><span class="s0">'boolean'</span><span class="s1">) {</span>
        <span class="s2">return </span><span class="s1">_bytes.default.parse(responseLimit);</span>
    <span class="s1">}</span>
    <span class="s2">return </span><span class="s1">_index.RESPONSE_LIMIT_DEFAULT;</span>
<span class="s1">}</span>
<span class="s3">/**</span>
 <span class="s3">* Send `any` body to response</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">req request object</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">res response object</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">body of response</span>
 <span class="s3">*/ </span><span class="s2">function </span><span class="s1">sendData(req, res, body) {</span>
    <span class="s2">if </span><span class="s1">(body === </span><span class="s2">null </span><span class="s1">|| body === undefined) {</span>
        <span class="s1">res.end();</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">// strip irrelevant headers/body</span>
    <span class="s2">if </span><span class="s1">(res.statusCode === </span><span class="s5">204 </span><span class="s1">|| res.statusCode === </span><span class="s5">304</span><span class="s1">) {</span>
        <span class="s1">res.removeHeader(</span><span class="s0">'Content-Type'</span><span class="s1">);</span>
        <span class="s1">res.removeHeader(</span><span class="s0">'Content-Length'</span><span class="s1">);</span>
        <span class="s1">res.removeHeader(</span><span class="s0">'Transfer-Encoding'</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(process.env.NODE_ENV === </span><span class="s0">'development' </span><span class="s1">&amp;&amp; body) {</span>
            <span class="s1">console.warn(</span><span class="s0">`A body was attempted to be set with a 204 statusCode for </span><span class="s1">${req.url}</span><span class="s0">, this is invalid and the body was ignored.</span><span class="s6">\n</span><span class="s0">` </span><span class="s1">+ </span><span class="s0">`See more info here https://nextjs.org/docs/messages/invalid-api-status-body`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">res.end();</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">contentType = res.getHeader(</span><span class="s0">'Content-Type'</span><span class="s1">);</span>
    <span class="s2">if </span><span class="s1">(body </span><span class="s2">instanceof </span><span class="s1">_stream.Stream) {</span>
        <span class="s2">if </span><span class="s1">(!contentType) {</span>
            <span class="s1">res.setHeader(</span><span class="s0">'Content-Type'</span><span class="s1">, </span><span class="s0">'application/octet-stream'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">body.pipe(res);</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">isJSONLike = [</span>
        <span class="s0">'object'</span><span class="s1">,</span>
        <span class="s0">'number'</span><span class="s1">,</span>
        <span class="s0">'boolean'</span>
    <span class="s1">].includes(</span><span class="s2">typeof </span><span class="s1">body);</span>
    <span class="s2">const </span><span class="s1">stringifiedBody = isJSONLike ? JSON.stringify(body) : body;</span>
    <span class="s2">const </span><span class="s1">etag = (</span><span class="s5">0</span><span class="s1">, _etag.generateETag)(stringifiedBody);</span>
    <span class="s2">if </span><span class="s1">((</span><span class="s5">0</span><span class="s1">, _sendpayload.sendEtagResponse)(req, res, etag)) {</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(Buffer.isBuffer(body)) {</span>
        <span class="s2">if </span><span class="s1">(!contentType) {</span>
            <span class="s1">res.setHeader(</span><span class="s0">'Content-Type'</span><span class="s1">, </span><span class="s0">'application/octet-stream'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s1">res.setHeader(</span><span class="s0">'Content-Length'</span><span class="s1">, body.length);</span>
        <span class="s1">res.end(body);</span>
        <span class="s2">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(isJSONLike) {</span>
        <span class="s1">res.setHeader(</span><span class="s0">'Content-Type'</span><span class="s1">, _constants.JSON_CONTENT_TYPE_HEADER);</span>
    <span class="s1">}</span>
    <span class="s1">res.setHeader(</span><span class="s0">'Content-Length'</span><span class="s1">, Buffer.byteLength(stringifiedBody));</span>
    <span class="s1">res.end(stringifiedBody);</span>
<span class="s1">}</span>
<span class="s3">/**</span>
 <span class="s3">* Send `JSON` object</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">res response object</span>
 <span class="s3">* </span><span class="s4">@param </span><span class="s3">jsonBody of data</span>
 <span class="s3">*/ </span><span class="s2">function </span><span class="s1">sendJson(res, jsonBody) {</span>
    <span class="s3">// Set header to application/json</span>
    <span class="s1">res.setHeader(</span><span class="s0">'Content-Type'</span><span class="s1">, _constants.JSON_CONTENT_TYPE_HEADER);</span>
    <span class="s3">// Use send to handle request</span>
    <span class="s1">res.send(JSON.stringify(jsonBody));</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">isValidData(str) {</span>
    <span class="s2">return typeof </span><span class="s1">str === </span><span class="s0">'string' </span><span class="s1">&amp;&amp; str.length &gt;= </span><span class="s5">16</span><span class="s1">;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">setDraftMode(res, options) {</span>
    <span class="s2">if </span><span class="s1">(!isValidData(options.previewModeId)) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">'invariant: invalid previewModeId'</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E169&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">expires = options.enable ? undefined : </span><span class="s2">new </span><span class="s1">Date(</span><span class="s5">0</span><span class="s1">);</span>
    <span class="s3">// To delete a cookie, set `expires` to a date in the past:</span>
    <span class="s3">// https://tools.ietf.org/html/rfc6265#section-4.1.1</span>
    <span class="s3">// `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.</span>
    <span class="s2">const </span><span class="s1">{ serialize } = require(</span><span class="s0">'next/dist/compiled/cookie'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">previous = res.getHeader(</span><span class="s0">'Set-Cookie'</span><span class="s1">);</span>
    <span class="s1">res.setHeader(</span><span class="s0">`Set-Cookie`</span><span class="s1">, [</span>
        <span class="s1">...</span><span class="s2">typeof </span><span class="s1">previous === </span><span class="s0">'string' </span><span class="s1">? [</span>
            <span class="s1">previous</span>
        <span class="s1">] : Array.isArray(previous) ? previous : [],</span>
        <span class="s1">serialize(_index.COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {</span>
            <span class="s1">httpOnly: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">sameSite: process.env.NODE_ENV !== </span><span class="s0">'development' </span><span class="s1">? </span><span class="s0">'none' </span><span class="s1">: </span><span class="s0">'lax'</span><span class="s1">,</span>
            <span class="s1">secure: process.env.NODE_ENV !== </span><span class="s0">'development'</span><span class="s1">,</span>
            <span class="s1">path: </span><span class="s0">'/'</span><span class="s1">,</span>
            <span class="s1">expires</span>
        <span class="s1">})</span>
    <span class="s1">]);</span>
    <span class="s2">return </span><span class="s1">res;</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">setPreviewData(res, data, options) {</span>
    <span class="s2">if </span><span class="s1">(!isValidData(options.previewModeId)) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">'invariant: invalid previewModeId'</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E169&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(!isValidData(options.previewModeEncryptionKey)) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">'invariant: invalid previewModeEncryptionKey'</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E334&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(!isValidData(options.previewModeSigningKey)) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">'invariant: invalid previewModeSigningKey'</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E436&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">jsonwebtoken = require(</span><span class="s0">'next/dist/compiled/jsonwebtoken'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">{ encryptWithSecret } = require(</span><span class="s0">'../../crypto-utils'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">payload = jsonwebtoken.sign({</span>
        <span class="s1">data: encryptWithSecret(Buffer.from(options.previewModeEncryptionKey), JSON.stringify(data))</span>
    <span class="s1">}, options.previewModeSigningKey, {</span>
        <span class="s1">algorithm: </span><span class="s0">'HS256'</span><span class="s1">,</span>
        <span class="s1">...options.maxAge !== undefined ? {</span>
            <span class="s1">expiresIn: options.maxAge</span>
        <span class="s1">} : undefined</span>
    <span class="s1">});</span>
    <span class="s3">// limit preview mode cookie to 2KB since we shouldn't store too much</span>
    <span class="s3">// data here and browsers drop cookies over 4KB</span>
    <span class="s2">if </span><span class="s1">(payload.length &gt; </span><span class="s5">2048</span><span class="s1">) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">`Preview data is limited to 2KB currently, reduce how much data you are storing as preview data to continue`</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E465&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">{ serialize } = require(</span><span class="s0">'next/dist/compiled/cookie'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">previous = res.getHeader(</span><span class="s0">'Set-Cookie'</span><span class="s1">);</span>
    <span class="s1">res.setHeader(</span><span class="s0">`Set-Cookie`</span><span class="s1">, [</span>
        <span class="s1">...</span><span class="s2">typeof </span><span class="s1">previous === </span><span class="s0">'string' </span><span class="s1">? [</span>
            <span class="s1">previous</span>
        <span class="s1">] : Array.isArray(previous) ? previous : [],</span>
        <span class="s1">serialize(_index.COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {</span>
            <span class="s1">httpOnly: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">sameSite: process.env.NODE_ENV !== </span><span class="s0">'development' </span><span class="s1">? </span><span class="s0">'none' </span><span class="s1">: </span><span class="s0">'lax'</span><span class="s1">,</span>
            <span class="s1">secure: process.env.NODE_ENV !== </span><span class="s0">'development'</span><span class="s1">,</span>
            <span class="s1">path: </span><span class="s0">'/'</span><span class="s1">,</span>
            <span class="s1">...options.maxAge !== undefined ? {</span>
                <span class="s1">maxAge: options.maxAge</span>
            <span class="s1">} : undefined,</span>
            <span class="s1">...options.path !== undefined ? {</span>
                <span class="s1">path: options.path</span>
            <span class="s1">} : undefined</span>
        <span class="s1">}),</span>
        <span class="s1">serialize(_index.COOKIE_NAME_PRERENDER_DATA, payload, {</span>
            <span class="s1">httpOnly: </span><span class="s2">true</span><span class="s1">,</span>
            <span class="s1">sameSite: process.env.NODE_ENV !== </span><span class="s0">'development' </span><span class="s1">? </span><span class="s0">'none' </span><span class="s1">: </span><span class="s0">'lax'</span><span class="s1">,</span>
            <span class="s1">secure: process.env.NODE_ENV !== </span><span class="s0">'development'</span><span class="s1">,</span>
            <span class="s1">path: </span><span class="s0">'/'</span><span class="s1">,</span>
            <span class="s1">...options.maxAge !== undefined ? {</span>
                <span class="s1">maxAge: options.maxAge</span>
            <span class="s1">} : undefined,</span>
            <span class="s1">...options.path !== undefined ? {</span>
                <span class="s1">path: options.path</span>
            <span class="s1">} : undefined</span>
        <span class="s1">})</span>
    <span class="s1">]);</span>
    <span class="s2">return </span><span class="s1">res;</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">revalidate(urlPath, opts, req, context) {</span>
    <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">urlPath !== </span><span class="s0">'string' </span><span class="s1">|| !urlPath.startsWith(</span><span class="s0">'/'</span><span class="s1">)) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">`Invalid urlPath provided to revalidate(), must be a path e.g. /blog/post-1, received </span><span class="s1">${urlPath}</span><span class="s0">`</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E153&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">revalidateHeaders = {</span>
        <span class="s1">[_constants.PRERENDER_REVALIDATE_HEADER]: context.previewModeId,</span>
        <span class="s1">...opts.unstable_onlyGenerated ? {</span>
            <span class="s1">[_constants.PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER]: </span><span class="s0">'1'</span>
        <span class="s1">} : {}</span>
    <span class="s1">};</span>
    <span class="s2">const </span><span class="s1">allowedRevalidateHeaderKeys = [</span>
        <span class="s1">...context.allowedRevalidateHeaderKeys || []</span>
    <span class="s1">];</span>
    <span class="s2">if </span><span class="s1">(context.trustHostHeader || context.dev) {</span>
        <span class="s1">allowedRevalidateHeaderKeys.push(</span><span class="s0">'cookie'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(context.trustHostHeader) {</span>
        <span class="s1">allowedRevalidateHeaderKeys.push(</span><span class="s0">'x-vercel-protection-bypass'</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">key of Object.keys(req.headers)){</span>
        <span class="s2">if </span><span class="s1">(allowedRevalidateHeaderKeys.includes(key)) {</span>
            <span class="s1">revalidateHeaders[key] = req.headers[key];</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">internalRevalidate = context.internalRevalidate;</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s3">// We use the revalidate in router-server if available.</span>
        <span class="s3">// If we are operating without router-server (serverless)</span>
        <span class="s3">// we must go through network layer with fetch request</span>
        <span class="s2">if </span><span class="s1">(internalRevalidate) {</span>
            <span class="s2">return await </span><span class="s1">internalRevalidate({</span>
                <span class="s1">urlPath,</span>
                <span class="s1">revalidateHeaders,</span>
                <span class="s1">opts</span>
            <span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s2">if </span><span class="s1">(context.trustHostHeader) {</span>
            <span class="s2">const </span><span class="s1">res = </span><span class="s2">await </span><span class="s1">fetch(</span><span class="s0">`https://</span><span class="s1">${req.headers.host}${urlPath}</span><span class="s0">`</span><span class="s1">, {</span>
                <span class="s1">method: </span><span class="s0">'HEAD'</span><span class="s1">,</span>
                <span class="s1">headers: revalidateHeaders</span>
            <span class="s1">});</span>
            <span class="s3">// we use the cache header to determine successful revalidate as</span>
            <span class="s3">// a non-200 status code can be returned from a successful revalidate</span>
            <span class="s3">// e.g. notFound: true returns 404 status code but is successful</span>
            <span class="s2">const </span><span class="s1">cacheHeader = res.headers.get(</span><span class="s0">'x-vercel-cache'</span><span class="s1">) || res.headers.get(</span><span class="s0">'x-nextjs-cache'</span><span class="s1">);</span>
            <span class="s2">if </span><span class="s1">((cacheHeader == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: cacheHeader.toUpperCase()) !== </span><span class="s0">'REVALIDATED' </span><span class="s1">&amp;&amp; res.status !== </span><span class="s5">200 </span><span class="s1">&amp;&amp; !(res.status === </span><span class="s5">404 </span><span class="s1">&amp;&amp; opts.unstable_onlyGenerated)) {</span>
                <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">`Invalid response </span><span class="s1">${res.status}</span><span class="s0">`</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
                    <span class="s1">value: </span><span class="s0">&quot;E175&quot;</span><span class="s1">,</span>
                    <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
                    <span class="s1">configurable: </span><span class="s2">true</span>
                <span class="s1">});</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">`Invariant: missing internal router-server-methods this is an internal bug`</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
                <span class="s1">value: </span><span class="s0">&quot;E676&quot;</span><span class="s1">,</span>
                <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
                <span class="s1">configurable: </span><span class="s2">true</span>
            <span class="s1">});</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span>
        <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">`Failed to revalidate </span><span class="s1">${urlPath}</span><span class="s0">: </span><span class="s1">${(</span><span class="s5">0</span><span class="s1">, _iserror.default)(err) ? err.message : err}</span><span class="s0">`</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
            <span class="s1">value: </span><span class="s0">&quot;E240&quot;</span><span class="s1">,</span>
            <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
            <span class="s1">configurable: </span><span class="s2">true</span>
        <span class="s1">});</span>
    <span class="s1">}</span>
<span class="s1">}</span>
<span class="s1">async </span><span class="s2">function </span><span class="s1">apiResolver(req, res, query, resolverModule, apiContext, propagateError, dev, page, onError) {</span>
    <span class="s2">const </span><span class="s1">apiReq = req;</span>
    <span class="s2">const </span><span class="s1">apiRes = res;</span>
    <span class="s2">try </span><span class="s1">{</span>
        <span class="s2">var </span><span class="s1">_config_api, _config_api1, _config_api2;</span>
        <span class="s2">if </span><span class="s1">(!resolverModule) {</span>
            <span class="s1">res.statusCode = </span><span class="s5">404</span><span class="s1">;</span>
            <span class="s1">res.end(</span><span class="s0">'Not Found'</span><span class="s1">);</span>
            <span class="s2">return</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">config = resolverModule.config || {};</span>
        <span class="s2">const </span><span class="s1">bodyParser = ((_config_api = config.api) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: _config_api.bodyParser) !== </span><span class="s2">false</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">responseLimit = ((_config_api1 = config.api) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: _config_api1.responseLimit) ?? </span><span class="s2">true</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">externalResolver = ((_config_api2 = config.api) == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: _config_api2.externalResolver) || </span><span class="s2">false</span><span class="s1">;</span>
        <span class="s3">// Parsing of cookies</span>
        <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.setLazyProp)({</span>
            <span class="s1">req: apiReq</span>
        <span class="s1">}, </span><span class="s0">'cookies'</span><span class="s1">, (</span><span class="s5">0</span><span class="s1">, _getcookieparser.getCookieParser)(req.headers));</span>
        <span class="s3">// Parsing query string</span>
        <span class="s1">apiReq.query = query;</span>
        <span class="s3">// Parsing preview data</span>
        <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.setLazyProp)({</span>
            <span class="s1">req: apiReq</span>
        <span class="s1">}, </span><span class="s0">'previewData'</span><span class="s1">, ()=&gt;(</span><span class="s5">0</span><span class="s1">, _trygetpreviewdata.tryGetPreviewData)(req, res, apiContext, !!apiContext.multiZoneDraftMode));</span>
        <span class="s3">// Checking if preview mode is enabled</span>
        <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.setLazyProp)({</span>
            <span class="s1">req: apiReq</span>
        <span class="s1">}, </span><span class="s0">'preview'</span><span class="s1">, ()=&gt;apiReq.previewData !== </span><span class="s2">false </span><span class="s1">? </span><span class="s2">true </span><span class="s1">: undefined);</span>
        <span class="s3">// Set draftMode to the same value as preview</span>
        <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.setLazyProp)({</span>
            <span class="s1">req: apiReq</span>
        <span class="s1">}, </span><span class="s0">'draftMode'</span><span class="s1">, ()=&gt;apiReq.preview);</span>
        <span class="s3">// Parsing of body</span>
        <span class="s2">if </span><span class="s1">(bodyParser &amp;&amp; !apiReq.body) {</span>
            <span class="s1">apiReq.body = </span><span class="s2">await </span><span class="s1">(</span><span class="s5">0</span><span class="s1">, _parsebody.parseBody)(apiReq, config.api &amp;&amp; config.api.bodyParser &amp;&amp; config.api.bodyParser.sizeLimit ? config.api.bodyParser.sizeLimit : </span><span class="s0">'1mb'</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">let </span><span class="s1">contentLength = </span><span class="s5">0</span><span class="s1">;</span>
        <span class="s2">const </span><span class="s1">maxContentLength = getMaxContentLength(responseLimit);</span>
        <span class="s2">const </span><span class="s1">writeData = apiRes.write;</span>
        <span class="s2">const </span><span class="s1">endResponse = apiRes.end;</span>
        <span class="s1">apiRes.write = (...args)=&gt;{</span>
            <span class="s1">contentLength += Buffer.byteLength(args[</span><span class="s5">0</span><span class="s1">] || </span><span class="s0">''</span><span class="s1">);</span>
            <span class="s2">return </span><span class="s1">writeData.apply(apiRes, args);</span>
        <span class="s1">};</span>
        <span class="s1">apiRes.end = (...args)=&gt;{</span>
            <span class="s2">if </span><span class="s1">(args.length &amp;&amp; </span><span class="s2">typeof </span><span class="s1">args[</span><span class="s5">0</span><span class="s1">] !== </span><span class="s0">'function'</span><span class="s1">) {</span>
                <span class="s1">contentLength += Buffer.byteLength(args[</span><span class="s5">0</span><span class="s1">] || </span><span class="s0">''</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(responseLimit &amp;&amp; contentLength &gt;= maxContentLength) {</span>
                <span class="s1">console.warn(</span><span class="s0">`API response for </span><span class="s1">${req.url} </span><span class="s0">exceeds </span><span class="s1">${_bytes.default.format(maxContentLength)}</span><span class="s0">. API Routes are meant to respond quickly. https://nextjs.org/docs/messages/api-routes-response-size-limit`</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s2">return </span><span class="s1">endResponse.apply(apiRes, args);</span>
        <span class="s1">};</span>
        <span class="s1">apiRes.status = (statusCode)=&gt;(</span><span class="s5">0</span><span class="s1">, _index.sendStatusCode)(apiRes, statusCode);</span>
        <span class="s1">apiRes.send = (data)=&gt;sendData(apiReq, apiRes, data);</span>
        <span class="s1">apiRes.json = (data)=&gt;sendJson(apiRes, data);</span>
        <span class="s1">apiRes.redirect = (statusOrUrl, url)=&gt;(</span><span class="s5">0</span><span class="s1">, _index.redirect)(apiRes, statusOrUrl, url);</span>
        <span class="s1">apiRes.setDraftMode = (options = {</span>
            <span class="s1">enable: </span><span class="s2">true</span>
        <span class="s1">})=&gt;setDraftMode(apiRes, Object.assign({}, apiContext, options));</span>
        <span class="s1">apiRes.setPreviewData = (data, options = {})=&gt;setPreviewData(apiRes, data, Object.assign({}, apiContext, options));</span>
        <span class="s1">apiRes.clearPreviewData = (options = {})=&gt;(</span><span class="s5">0</span><span class="s1">, _index.clearPreviewData)(apiRes, options);</span>
        <span class="s1">apiRes.revalidate = (urlPath, opts)=&gt;revalidate(urlPath, opts || {}, req, apiContext);</span>
        <span class="s2">const </span><span class="s1">resolver = (</span><span class="s5">0</span><span class="s1">, _interopdefault.interopDefault)(resolverModule);</span>
        <span class="s2">let </span><span class="s1">wasPiped = </span><span class="s2">false</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(process.env.NODE_ENV !== </span><span class="s0">'production'</span><span class="s1">) {</span>
            <span class="s3">// listen for pipe event and don't show resolve warning</span>
            <span class="s1">res.once(</span><span class="s0">'pipe'</span><span class="s1">, ()=&gt;wasPiped = </span><span class="s2">true</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">apiRouteResult = </span><span class="s2">await </span><span class="s1">resolver(req, res);</span>
        <span class="s2">if </span><span class="s1">(process.env.NODE_ENV !== </span><span class="s0">'production'</span><span class="s1">) {</span>
            <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">apiRouteResult !== </span><span class="s0">'undefined'</span><span class="s1">) {</span>
                <span class="s2">if </span><span class="s1">(apiRouteResult </span><span class="s2">instanceof </span><span class="s1">Response) {</span>
                    <span class="s2">throw </span><span class="s1">Object.defineProperty(</span><span class="s2">new </span><span class="s1">Error(</span><span class="s0">'API route returned a Response object in the Node.js runtime, this is not supported. Please use `runtime: &quot;edge&quot;` instead: https://nextjs.org/docs/api-routes/edge-api-routes'</span><span class="s1">), </span><span class="s0">&quot;__NEXT_ERROR_CODE&quot;</span><span class="s1">, {</span>
                        <span class="s1">value: </span><span class="s0">&quot;E36&quot;</span><span class="s1">,</span>
                        <span class="s1">enumerable: </span><span class="s2">false</span><span class="s1">,</span>
                        <span class="s1">configurable: </span><span class="s2">true</span>
                    <span class="s1">});</span>
                <span class="s1">}</span>
                <span class="s1">console.warn(</span><span class="s0">`API handler should not return a value, received </span><span class="s1">${</span><span class="s2">typeof </span><span class="s1">apiRouteResult}</span><span class="s0">.`</span><span class="s1">);</span>
            <span class="s1">}</span>
            <span class="s2">if </span><span class="s1">(!externalResolver &amp;&amp; !(</span><span class="s5">0</span><span class="s1">, _utils.isResSent)(res) &amp;&amp; !wasPiped) {</span>
                <span class="s1">console.warn(</span><span class="s0">`API resolved without sending a response for </span><span class="s1">${req.url}</span><span class="s0">, this may result in stalled requests.`</span><span class="s1">);</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">} </span><span class="s2">catch </span><span class="s1">(err) {</span>
        <span class="s2">await </span><span class="s1">(onError == </span><span class="s2">null </span><span class="s1">? </span><span class="s2">void </span><span class="s5">0 </span><span class="s1">: onError(err, {</span>
            <span class="s1">method: req.method || </span><span class="s0">'GET'</span><span class="s1">,</span>
            <span class="s1">headers: req.headers,</span>
            <span class="s1">path: req.url || </span><span class="s0">'/'</span>
        <span class="s1">}, {</span>
            <span class="s1">routerKind: </span><span class="s0">'Pages Router'</span><span class="s1">,</span>
            <span class="s1">routePath: page || </span><span class="s0">''</span><span class="s1">,</span>
            <span class="s1">routeType: </span><span class="s0">'route'</span><span class="s1">,</span>
            <span class="s1">revalidateReason: undefined</span>
        <span class="s1">}));</span>
        <span class="s2">if </span><span class="s1">(err </span><span class="s2">instanceof </span><span class="s1">_index.ApiError) {</span>
            <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.sendError)(apiRes, err.statusCode, err.message);</span>
        <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
            <span class="s2">if </span><span class="s1">(dev) {</span>
                <span class="s2">if </span><span class="s1">((</span><span class="s5">0</span><span class="s1">, _iserror.default)(err)) {</span>
                    <span class="s1">err.page = page;</span>
                <span class="s1">}</span>
                <span class="s2">throw </span><span class="s1">err;</span>
            <span class="s1">}</span>
            <span class="s1">console.error(err);</span>
            <span class="s2">if </span><span class="s1">(propagateError) {</span>
                <span class="s2">throw </span><span class="s1">err;</span>
            <span class="s1">}</span>
            <span class="s1">(</span><span class="s5">0</span><span class="s1">, _index.sendError)(apiRes, </span><span class="s5">500</span><span class="s1">, </span><span class="s0">'Internal Server Error'</span><span class="s1">);</span>
        <span class="s1">}</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s3">//# sourceMappingURL=api-resolver.js.map</span></pre>
</body>
</html>