<html>
<head>
<title>scc.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
scc.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span><span class="s1">;Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { value: </span><span class="s2">true </span><span class="s1">});</span><span class="s2">var </span><span class="s1">_createClass = </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">defineProperties(target, props) {</span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">; i &lt; props.length; i++) {</span><span class="s2">var </span><span class="s1">descriptor = props[i];descriptor.enumerable = descriptor.enumerable || </span><span class="s2">false</span><span class="s1">;descriptor.configurable = </span><span class="s2">true</span><span class="s1">;</span><span class="s2">if </span><span class="s1">(</span><span class="s0">&quot;value&quot; </span><span class="s2">in </span><span class="s1">descriptor) descriptor.writable = </span><span class="s2">true</span><span class="s1">;Object.defineProperty(target, descriptor.key, descriptor);}}</span><span class="s2">return function </span><span class="s1">(Constructor, protoProps, staticProps) {</span><span class="s2">if </span><span class="s1">(protoProps) defineProperties(Constructor.prototype, protoProps);</span><span class="s2">if </span><span class="s1">(staticProps) defineProperties(Constructor, staticProps);</span><span class="s2">return </span><span class="s1">Constructor;};}();</span><span class="s2">var </span><span class="s1">_scc = require(</span><span class="s0">'@rtsao/scc'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_scc2 = _interopRequireDefault(_scc);</span>
<span class="s2">var </span><span class="s1">_hash = require(</span><span class="s0">'eslint-module-utils/hash'</span><span class="s1">);</span>
<span class="s2">var </span><span class="s1">_resolve = require(</span><span class="s0">'eslint-module-utils/resolve'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_resolve2 = _interopRequireDefault(_resolve);</span>
<span class="s2">var </span><span class="s1">_builder = require(</span><span class="s0">'./exportMap/builder'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_builder2 = _interopRequireDefault(_builder);</span>
<span class="s2">var </span><span class="s1">_childContext = require(</span><span class="s0">'./exportMap/childContext'</span><span class="s1">);</span><span class="s2">var </span><span class="s1">_childContext2 = _interopRequireDefault(_childContext);</span><span class="s2">function </span><span class="s1">_interopRequireDefault(obj) {</span><span class="s2">return </span><span class="s1">obj &amp;&amp; obj.__esModule ? obj : { </span><span class="s0">'default'</span><span class="s1">: obj };}</span><span class="s2">function </span><span class="s1">_toConsumableArray(arr) {</span><span class="s2">if </span><span class="s1">(Array.isArray(arr)) {</span><span class="s2">for </span><span class="s1">(</span><span class="s2">var </span><span class="s1">i = </span><span class="s3">0</span><span class="s1">, arr2 = Array(arr.length); i &lt; arr.length; i++) {arr2[i] = arr[i];}</span><span class="s2">return </span><span class="s1">arr2;} </span><span class="s2">else </span><span class="s1">{</span><span class="s2">return </span><span class="s1">Array.from(arr);}}</span><span class="s2">function </span><span class="s1">_classCallCheck(instance, Constructor) {</span><span class="s2">if </span><span class="s1">(!(instance </span><span class="s2">instanceof </span><span class="s1">Constructor)) {</span><span class="s2">throw new </span><span class="s1">TypeError(</span><span class="s0">&quot;Cannot call a class as a function&quot;</span><span class="s1">);}}</span>

<span class="s2">var </span><span class="s1">cache = </span><span class="s2">new </span><span class="s1">Map();</span><span class="s2">var</span>

<span class="s1">StronglyConnectedComponentsBuilder = </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">StronglyConnectedComponentsBuilder() {_classCallCheck(</span><span class="s2">this</span><span class="s1">, StronglyConnectedComponentsBuilder);}_createClass(StronglyConnectedComponentsBuilder, </span><span class="s2">null</span><span class="s1">, [{ key: </span><span class="s0">'clearCache'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">clearCache()</span>
      <span class="s1">{</span>
        <span class="s1">cache = </span><span class="s2">new </span><span class="s1">Map();</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">clearCache;}() }, { key: </span><span class="s0">'get'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">get(</span>

      <span class="s1">source, context) {</span>
        <span class="s2">var </span><span class="s1">path = (</span><span class="s3">0</span><span class="s1">, _resolve2[</span><span class="s0">'default'</span><span class="s1">])(source, context);</span>
        <span class="s2">if </span><span class="s1">(path == </span><span class="s2">null</span><span class="s1">) {</span><span class="s2">return null</span><span class="s1">;}</span>
        <span class="s2">return </span><span class="s1">StronglyConnectedComponentsBuilder[</span><span class="s0">'for'</span><span class="s1">]((</span><span class="s3">0</span><span class="s1">, _childContext2[</span><span class="s0">'default'</span><span class="s1">])(path, context));</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">get;}() }, { key: </span><span class="s0">'for'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">_for(</span>

      <span class="s1">context) {</span>
        <span class="s2">var </span><span class="s1">settingsHash = (</span><span class="s3">0</span><span class="s1">, _hash.hashObject)({</span>
          <span class="s1">settings: context.settings,</span>
          <span class="s1">parserOptions: context.parserOptions,</span>
          <span class="s1">parserPath: context.parserPath }).</span>
        <span class="s1">digest(</span><span class="s0">'hex'</span><span class="s1">);</span>
        <span class="s2">var </span><span class="s1">cacheKey = context.path + settingsHash;</span>
        <span class="s2">if </span><span class="s1">(cache.has(cacheKey)) {</span>
          <span class="s2">return </span><span class="s1">cache.get(cacheKey);</span>
        <span class="s1">}</span>
        <span class="s2">var </span><span class="s1">scc = StronglyConnectedComponentsBuilder.calculate(context);</span>
        <span class="s2">var </span><span class="s1">visitedFiles = Object.keys(scc);</span>
        <span class="s1">visitedFiles.forEach(</span><span class="s2">function </span><span class="s1">(filePath) {</span><span class="s2">return </span><span class="s1">cache.set(filePath + settingsHash, scc);});</span>
        <span class="s2">return </span><span class="s1">scc;</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">_for;}() }, { key: </span><span class="s0">'calculate'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">calculate(</span>

      <span class="s1">context) {</span>
        <span class="s2">var </span><span class="s1">exportMap = _builder2[</span><span class="s0">'default'</span><span class="s1">][</span><span class="s0">'for'</span><span class="s1">](context);</span>
        <span class="s2">var </span><span class="s1">adjacencyList = </span><span class="s2">this</span><span class="s1">.exportMapToAdjacencyList(exportMap);</span>
        <span class="s2">var </span><span class="s1">calculatedScc = (</span><span class="s3">0</span><span class="s1">, _scc2[</span><span class="s0">'default'</span><span class="s1">])(adjacencyList);</span>
        <span class="s2">return </span><span class="s1">StronglyConnectedComponentsBuilder.calculatedSccToPlainObject(calculatedScc);</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">calculate;}()</span>

    <span class="s4">/** </span><span class="s5">@returns </span><span class="s4">{Map&lt;string, Set&lt;string&gt;&gt;} for each dep, what are its direct deps */ </span><span class="s1">}, { key: </span><span class="s0">'exportMapToAdjacencyList'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">exportMapToAdjacencyList(</span>
      <span class="s1">initialExportMap) {</span>
        <span class="s2">var </span><span class="s1">adjacencyList = </span><span class="s2">new </span><span class="s1">Map();</span>
        <span class="s4">// BFS</span>
        <span class="s2">function </span><span class="s1">visitNode(exportMap) {</span>
          <span class="s2">if </span><span class="s1">(!exportMap) {</span>
            <span class="s2">return</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s1">exportMap.imports.forEach(</span><span class="s2">function </span><span class="s1">(v, importedPath) {</span>
            <span class="s2">var </span><span class="s1">from = exportMap.path;</span>
            <span class="s2">var </span><span class="s1">to = importedPath;</span>

            <span class="s4">// Ignore type-only imports, because we care only about SCCs of value imports</span>
            <span class="s2">var </span><span class="s1">toTraverse = [].concat(_toConsumableArray(v.declarations)).filter(</span><span class="s2">function </span><span class="s1">(_ref) {</span><span class="s2">var </span><span class="s1">isOnlyImportingTypes = _ref.isOnlyImportingTypes;</span><span class="s2">return </span><span class="s1">!isOnlyImportingTypes;});</span>
            <span class="s2">if </span><span class="s1">(toTraverse.length === </span><span class="s3">0</span><span class="s1">) {</span><span class="s2">return</span><span class="s1">;}</span>

            <span class="s2">if </span><span class="s1">(!adjacencyList.has(from)) {</span>
              <span class="s1">adjacencyList.set(from, </span><span class="s2">new </span><span class="s1">Set());</span>
            <span class="s1">}</span>

            <span class="s2">if </span><span class="s1">(adjacencyList.get(from).has(to)) {</span>
              <span class="s2">return</span><span class="s1">; </span><span class="s4">// prevent endless loop</span>
            <span class="s1">}</span>
            <span class="s1">adjacencyList.get(from).add(to);</span>
            <span class="s1">visitNode(v.getter());</span>
          <span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s1">visitNode(initialExportMap);</span>
        <span class="s4">// Fill gaps</span>
        <span class="s1">adjacencyList.forEach(</span><span class="s2">function </span><span class="s1">(values) {</span>
          <span class="s1">values.forEach(</span><span class="s2">function </span><span class="s1">(value) {</span>
            <span class="s2">if </span><span class="s1">(!adjacencyList.has(value)) {</span>
              <span class="s1">adjacencyList.set(value, </span><span class="s2">new </span><span class="s1">Set());</span>
            <span class="s1">}</span>
          <span class="s1">});</span>
        <span class="s1">});</span>
        <span class="s2">return </span><span class="s1">adjacencyList;</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">exportMapToAdjacencyList;}()</span>

    <span class="s4">/** </span><span class="s5">@returns </span><span class="s4">{Record&lt;string, number&gt;} for each key, its SCC's index */ </span><span class="s1">}, { key: </span><span class="s0">'calculatedSccToPlainObject'</span><span class="s1">, value: </span><span class="s2">function </span><span class="s1">() {</span><span class="s2">function </span><span class="s1">calculatedSccToPlainObject(</span>
      <span class="s1">sccs) {</span>
        <span class="s2">var </span><span class="s1">obj = {};</span>
        <span class="s1">sccs.forEach(</span><span class="s2">function </span><span class="s1">(scc, index) {</span>
          <span class="s1">scc.forEach(</span><span class="s2">function </span><span class="s1">(node) {</span>
            <span class="s1">obj[node] = index;</span>
          <span class="s1">});</span>
        <span class="s1">});</span>
        <span class="s2">return </span><span class="s1">obj;</span>
      <span class="s1">}</span><span class="s2">return </span><span class="s1">calculatedSccToPlainObject;}() }]);</span><span class="s2">return </span><span class="s1">StronglyConnectedComponentsBuilder;}();exports[</span><span class="s0">'default'</span><span class="s1">] = StronglyConnectedComponentsBuilder;</span>
<span class="s4">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zY2MuanMiXSwibmFtZXMiOlsiY2FjaGUiLCJNYXAiLCJTdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNCdWlsZGVyIiwic291cmNlIiwiY29udGV4dCIsInBhdGgiLCJzZXR0aW5nc0hhc2giLCJzZXR0aW5ncyIsInBhcnNlck9wdGlvbnMiLCJwYXJzZXJQYXRoIiwiZGlnZXN0IiwiY2FjaGVLZXkiLCJoYXMiLCJnZXQiLCJzY2MiLCJjYWxjdWxhdGUiLCJ2aXNpdGVkRmlsZXMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImZpbGVQYXRoIiwic2V0IiwiZXhwb3J0TWFwIiwiRXhwb3J0TWFwQnVpbGRlciIsImFkamFjZW5jeUxpc3QiLCJleHBvcnRNYXBUb0FkamFjZW5jeUxpc3QiLCJjYWxjdWxhdGVkU2NjIiwiY2FsY3VsYXRlZFNjY1RvUGxhaW5PYmplY3QiLCJpbml0aWFsRXhwb3J0TWFwIiwidmlzaXROb2RlIiwiaW1wb3J0cyIsInYiLCJpbXBvcnRlZFBhdGgiLCJmcm9tIiwidG8iLCJ0b1RyYXZlcnNlIiwiZGVjbGFyYXRpb25zIiwiZmlsdGVyIiwiaXNPbmx5SW1wb3J0aW5nVHlwZXMiLCJsZW5ndGgiLCJTZXQiLCJhZGQiLCJnZXR0ZXIiLCJ2YWx1ZXMiLCJ2YWx1ZSIsInNjY3MiLCJvYmoiLCJpbmRleCIsIm5vZGUiXSwibWFwcGluZ3MiOiJnbkJBQUEsaUM7QUFDQTtBQUNBLHNEO0FBQ0EsOEM7QUFDQSx3RDs7QUFFQSxJQUFJQSxRQUFRLElBQUlDLEdBQUosRUFBWixDOztBQUVxQkMsa0M7QUFDQztBQUNsQkYsZ0JBQVEsSUFBSUMsR0FBSixFQUFSO0FBQ0QsTzs7QUFFVUUsWSxFQUFRQyxPLEVBQVM7QUFDMUIsWUFBTUMsT0FBTywwQkFBUUYsTUFBUixFQUFnQkMsT0FBaEIsQ0FBYjtBQUNBLFlBQUlDLFFBQVEsSUFBWixFQUFrQixDQUFFLE9BQU8sSUFBUCxDQUFjO0FBQ2xDLGVBQU9ILDBDQUF1QywrQkFBYUcsSUFB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QWEsVUFBQ0wsR0FBRCxFQUFNaUMsS0FBTixFQUFnQjtBQUMzQmpDLGNBQUlLLE9BQUosQ0FBWSxVQUFDNkIsSUFBRCxFQUFVO0FBQ3BCRixnQkFBSUUsSUFBSixJQUFZRCxLQUFaO0FBQ0QsV0FGRDtBQUdELFNBSkQ7QUFLQSxlQUFPRCxHQUFQO0FBQ0QsTyw2R0FsRmtCNUMsa0MiLCJmaWxlIjoic2NjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNhbGN1bGF0ZVNjYyBmcm9tICdAcnRzYW8vc2NjJztcbmltcG9ydCB7IGhhc2hPYmplY3QgfSBmcm9tICdlc2xpbnQtbW9kdWxlLXV0aWxzL2hhc2gnO1xuaW1wb3J0IHJlc29sdmUgZnJvbSAnZXNsaW50LW1vZHVsZS11dGlscy9yZXNvbHZlJztcbmltcG9ydCBFeHBvcnRNYXBCdWlsZGVyIGZyb20gJy4vZXhwb3J0TWFwL2J1aWxkZXInO1xuaW1wb3J0IGNoaWxkQ29udGV4dCBmcm9tICcuL2V4cG9ydE1hcC9jaGlsZENvbnRleHQnO1xuXG5sZXQgY2FjaGUgPSBuZXcgTWFwKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50c0J1aWxkZXIge1xuICBzdGF0aWMgY2xlYXJDYWNoZSgpIHtcbiAgICBjYWNoZSA9IG5ldyBNYXAoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXQoc291cmNlLCBjb250ZXh0KSB7XG4gICAgY29uc3QgcGF0aCA9IHJlc29sdmUoc291cmNlLCBjb250ZXh0KTtcbiAgICBpZiAocGF0aCA9PSBudWxsKSB7IHJldHVybiBudWxsOyB9XG4gICAgcmV0dXJuIFN0cm9uZ2x5Q29ubmVjdGVkQ29tcG9uZW50c0J1aWxkZXIuZm9yKGNoaWxkQ29udGV4dChwYXRoLCBjb250ZXh0KSk7XG4gIH1cblxuICBzdGF0aWMgZm9yKGNvbnRleHQpIHtcbiAgICBjb25zdCBzZXR0aW5nc0hhc2ggPSBoYXNoT2JqZWN0KHtcbiAgICAgIHNldHRpbmdzOiBjb250ZXh0LnNldHRpbmdzLFxuICAgICAgcGFyc2VyT3B0aW9uczogY29udGV4dC5wYXJzZXJPcHRpb25zLFxuICAgICAgcGFyc2VyUGF0aDogY29udGV4dC5wYXJzZXJQYXRoLFxuICAgIH0pLmRpZ2VzdCgnaGV4Jyk7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBjb250ZXh0LnBhdGggKyBzZXR0aW5nc0hhc2g7XG4gICAgaWYgKGNhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQoY2FjaGVLZXkpO1xuICAgIH1cbiAgICBjb25zdCBzY2MgPSBTdHJvbmdseUNvbm5lY3RlZENvbXBvbmVudHNCdWlsZGVyLmNhbGN1bGF0ZShjb250ZXh0KTtcbiAgICBjb25zdCB2aXNpdGVkRmlsZXMgPSBPYmplY3Qua2V5cyhzY2MpO1xuICAgIHZpc2l0ZWRGaWxlcy5mb3JFYWNoKChmaWxlUGF0aCkgPT4gY2FjaGUuc2V0KGZpbGVQYXRoICsgc2V0dGluZ3NIYXNoLCBzY2MpKTtcbiAgICByZXR1cm4gc2NjO1xuICB9XG5cbiAgc3RhdGljIGNhbGN1bGF0ZShjb250ZXh0KSB7XG4gICAgY29uc3QgZXhwb3J0TWFwID0gRXhwb3J0TWFwQnVpbGRlci5mb3IoY29udGV4dCk7XG4gICAgY29uc3QgYWRqYWNlbmN5TGlzdCA9IHRoaXMuZXhwb3J0TWFwVG9BZGphY2VuY3lMaXN0KGV4cG9ydE1hcCk7XG4gICAgY29uc3QgY2FsY3VsYXRlZFNjYyA9IGNhbGN1bGF0ZVNjYyhhZGphY2VuY3lMaXN0KTtcbiAgICByZXR1cm4gU3Ryb25nbHlDb25uZWN0ZWRDb21wb25lbnRzQnVpbGRlci5jYWxjdWxhdGVkU2NjVG9QbGFpbk9iamVjdChjYWxjdWxhdGVkU2NjKTtcbiAgfVxuXG4gIC8qKiBAcmV0dXJucyB7TWFwPHN0cmluZywgU2V0PHN0cmluZz4+fSBmb3IgZWFjaCBkZXAsIHdoYXQgYXJlIGl0cyBkaXJlY3QgZGVwcyAqL1xuICBzdGF0aWMgZXhwb3J0TWFwVG9BZGphY2VuY3lMaXN0KGluaXRpYWxFeHBvcnRNYXApIHtcbiAgICBjb25zdCBhZGphY2VuY3lMaXN0ID0gbmV3IE1hcCgpO1xuICAgIC8vIEJGU1xuICAgIGZ1bmN0aW9uIHZpc2l0Tm9kZShleHBvcnRNYXApIHtcbiAgICAgIGlmICghZXhwb3J0TWFwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGV4cG9ydE1hcC5pbXBvcnRzLmZvckVhY2goKHYsIGltcG9ydGVkUGF0aCkgPT4ge1xuICAgICAgICBjb25zdCBmcm9tID0gZXhwb3J0TWFwLnBhdGg7XG4gICAgICAgIGNvbnN0IHRvID0gaW1wb3J0ZWRQYXRoO1xuXG4gICAgICAgIC8vIElnbm9yZSB0eXBlLW9ubHkgaW1wb3J0cywgYmVjYXVzZSB3ZSBjYXJlIG9ubHkgYWJvdXQgU0NDcyBvZiB2YWx1ZSBpbXBvcnRzXG4gICAgICAgIGNvbnN0IHRvVHJhdmVyc2UgPSBbLi4udi5kZWNsYXJhdGlvbnNdLmZpbHRlcigoeyBpc09ubHlJbXBvcnRpbmdUeXBlcyB9KSA9PiAhaXNPbmx5SW1wb3J0aW5nVHlwZXMpO1xuICAgICAgICBpZiAodG9UcmF2ZXJzZS5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgaWYgKCFhZGphY2VuY3lMaXN0Lmhhcyhmcm9tKSkge1xuICAgICAgICAgIGFkamFjZW5jeUxpc3Quc2V0KGZyb20sIG5ldyBTZXQoKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWRqYWNlbmN5TGlzdC5nZXQoZnJvbSkuaGFzKHRvKSkge1xuICAgICAgICAgIHJldHVybjsgLy8gcHJldmVudCBlbmRsZXNzIGxvb3BcbiAgICAgICAgfVxuICAgICAgICBhZGphY2VuY3lMaXN0LmdldChmcm9tKS5hZGQodG8pO1xuICAgICAgICB2aXNpdE5vZGUodi5nZXR0ZXIoKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgdmlzaXROb2RlKGluaXRpYWxFeHBvcnRNYXApO1xuICAgIC8vIEZpbGwgZ2Fwc1xuICAgIGFkamFjZW5jeUxpc3QuZm9yRWFjaCgodmFsdWVzKSA9PiB7XG4gICAgICB2YWx1ZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgaWYgKCFhZGphY2VuY3lMaXN0Lmhhcyh2YWx1ZSkpIHtcbiAgICAgICAgICBhZGphY2VuY3lMaXN0LnNldCh2YWx1ZSwgbmV3IFNldCgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFkamFjZW5jeUxpc3Q7XG4gIH1cblxuICAvKiogQHJldHVybnMge1JlY29yZDxzdHJpbmcsIG51bWJlcj59IGZvciBlYWNoIGtleSwgaXRzIFNDQydzIGluZGV4ICovXG4gIHN0YXRpYyBjYWxjdWxhdGVkU2NjVG9QbGFpbk9iamVjdChzY2NzKSB7XG4gICAgY29uc3Qgb2JqID0ge307XG4gICAgc2Njcy5mb3JFYWNoKChzY2MsIGluZGV4KSA9PiB7XG4gICAgICBzY2MuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICBvYmpbbm9kZV0gPSBpbmRleDtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBvYmo7XG4gIH1cbn1cbiJdfQ==</span></pre>
</body>
</html>