<html>
<head>
<title>isValid.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
isValid.test.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">metadata from </span><span class="s2">'../metadata.min.json' </span><span class="s0">with </span><span class="s1">{ type: </span><span class="s2">'json' </span><span class="s1">}</span>
<span class="s0">import </span><span class="s1">_isValidNumber from </span><span class="s2">'./isValid.js'</span>
<span class="s0">import </span><span class="s1">parsePhoneNumber from </span><span class="s2">'./parsePhoneNumber.js'</span>

<span class="s0">function </span><span class="s1">isValidNumber(...parameters) {</span>
	<span class="s0">let </span><span class="s1">v2</span>
	<span class="s0">if </span><span class="s1">(parameters.length &lt; </span><span class="s3">1</span><span class="s1">) {</span>
		<span class="s4">// `input` parameter.</span>
		<span class="s1">parameters.push(undefined)</span>
	<span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
		<span class="s4">// Convert string `input` to a `PhoneNumber` instance.</span>
		<span class="s0">if </span><span class="s1">(</span><span class="s0">typeof </span><span class="s1">parameters[</span><span class="s3">0</span><span class="s1">] === </span><span class="s2">'string'</span><span class="s1">) {</span>
			<span class="s1">v2 = </span><span class="s0">true</span>
			<span class="s1">parameters[</span><span class="s3">0</span><span class="s1">] = parsePhoneNumber(parameters[</span><span class="s3">0</span><span class="s1">], {</span>
				<span class="s1">...parameters[</span><span class="s3">1</span><span class="s1">],</span>
				<span class="s1">extract: </span><span class="s0">false</span>
			<span class="s1">}, metadata)</span>
		<span class="s1">}</span>
	<span class="s1">}</span>
	<span class="s0">if </span><span class="s1">(parameters.length &lt; </span><span class="s3">2</span><span class="s1">) {</span>
		<span class="s4">// `options` parameter.</span>
		<span class="s1">parameters.push(undefined)</span>
	<span class="s1">}</span>
	<span class="s4">// Set `v2` flag.</span>
	<span class="s1">parameters[</span><span class="s3">1</span><span class="s1">] = {</span>
		<span class="s1">v2,</span>
		<span class="s1">...parameters[</span><span class="s3">1</span><span class="s1">]</span>
	<span class="s1">}</span>
	<span class="s4">// Add `metadata` parameter.</span>
	<span class="s1">parameters.push(metadata)</span>
	<span class="s4">// Call the function.</span>
	<span class="s0">return </span><span class="s1">_isValidNumber.apply(</span><span class="s0">this</span><span class="s1">, parameters)</span>
<span class="s1">}</span>

<span class="s1">describe(</span><span class="s2">'validate'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s2">'should validate phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+1-213-373-4253'</span><span class="s1">)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+1-213-373'</span><span class="s1">)).to.equal(</span><span class="s0">false</span><span class="s1">)</span>

		<span class="s1">expect(isValidNumber(</span><span class="s2">'+1-213-373-4253'</span><span class="s1">, undefined)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s1">expect(isValidNumber(</span><span class="s2">'(213) 373-4253'</span><span class="s1">, { defaultCountry: </span><span class="s2">'US' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'(213) 37'</span><span class="s1">, { defaultCountry: </span><span class="s2">'US' </span><span class="s1">})).to.equal(</span><span class="s0">false</span><span class="s1">)</span>

		<span class="s1">expect(isValidNumber({ country: </span><span class="s2">'US'</span><span class="s1">, phone: </span><span class="s2">'2133734253' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s4">// No &quot;types&quot; info: should return `true`.</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+380972423740'</span><span class="s1">)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s1">expect(isValidNumber(</span><span class="s2">'0912345678'</span><span class="s1">, { defaultCountry: </span><span class="s2">'TW' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s4">// Moible numbers starting 07624* are Isle of Man</span>
		<span class="s4">// which has its own &quot;country code&quot; &quot;IM&quot;</span>
		<span class="s4">// which is in the &quot;GB&quot; &quot;country calling code&quot; zone.</span>
		<span class="s4">// So while this number is for &quot;IM&quot; it's still supposed to</span>
		<span class="s4">// be valid when passed &quot;GB&quot; as a default country.</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'07624369230'</span><span class="s1">, { defaultCountry: </span><span class="s2">'GB' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should refine phone number validation in case extended regular expressions are set for a country'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// Germany general validation must pass</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'961111111'</span><span class="s1">, { defaultCountry: </span><span class="s2">'UZ' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s0">const </span><span class="s1">phoneNumberTypePatterns = metadata.countries.UZ[</span><span class="s3">11</span><span class="s1">]</span>

		<span class="s4">// Different regular expressions for precise national number validation.</span>
		<span class="s4">// `types` index in compressed array is `9` for v1.</span>
		<span class="s4">// For v2 it's 10.</span>
		<span class="s4">// For v3 it's 11.</span>
		<span class="s1">metadata.countries.UZ[</span><span class="s3">11</span><span class="s1">] =</span>
		<span class="s1">[</span>
			<span class="s1">[</span><span class="s2">&quot;(?:6(?:1(?:22|3[124]|4[1-4]|5[123578]|64)|2(?:22|3[0-57-9]|41)|5(?:22|3[3-7]|5[024-8])|6</span><span class="s5">\\</span><span class="s2">d{2}|7(?:[23]</span><span class="s5">\\</span><span class="s2">d|7[69])|9(?:22|4[1-8]|6[135]))|7(?:0(?:5[4-9]|6[0146]|7[12456]|9[135-8])|1[12]</span><span class="s5">\\</span><span class="s2">d|2(?:22|3[1345789]|4[123579]|5[14])|3(?:2</span><span class="s5">\\</span><span class="s2">d|3[1578]|4[1-35-7]|5[1-57]|61)|4(?:2</span><span class="s5">\\</span><span class="s2">d|3[1-579]|7[1-79])|5(?:22|5[1-9]|6[1457])|6(?:22|3[12457]|4[13-8])|9(?:22|5[1-9])))</span><span class="s5">\\</span><span class="s2">d{5}&quot;</span><span class="s1">],</span>
			<span class="s1">[</span><span class="s2">&quot;6(?:1(?:2(?:98|2[01])|35[0-4]|50</span><span class="s5">\\</span><span class="s2">d|61[23]|7(?:[01][017]|4</span><span class="s5">\\</span><span class="s2">d|55|9[5-9]))|2(?:11</span><span class="s5">\\</span><span class="s2">d|2(?:[12]1|9[01379])|5(?:[126]</span><span class="s5">\\</span><span class="s2">d|3[0-4])|7</span><span class="s5">\\</span><span class="s2">d{2})|5(?:19[01]|2(?:27|9[26])|30</span><span class="s5">\\</span><span class="s2">d|59</span><span class="s5">\\</span><span class="s2">d|7</span><span class="s5">\\</span><span class="s2">d{2})|6(?:2(?:1[5-9]|2[0367]|38|41|52|60)|3[79]</span><span class="s5">\\</span><span class="s2">d|4(?:56|83)|7(?:[07]</span><span class="s5">\\</span><span class="s2">d|1[017]|3[07]|4[047]|5[057]|67|8[0178]|9[79])|9[0-3]</span><span class="s5">\\</span><span class="s2">d)|7(?:2(?:24|3[237]|4[5-9]|7[15-8])|5(?:7[12]|8[0589])|7(?:0</span><span class="s5">\\</span><span class="s2">d|[39][07])|9(?:0</span><span class="s5">\\</span><span class="s2">d|7[079]))|9(?:2(?:1[1267]|5</span><span class="s5">\\</span><span class="s2">d|3[01]|7[0-4])|5[67]</span><span class="s5">\\</span><span class="s2">d|6(?:2[0-26]|8</span><span class="s5">\\</span><span class="s2">d)|7</span><span class="s5">\\</span><span class="s2">d{2}))</span><span class="s5">\\</span><span class="s2">d{4}|7(?:0</span><span class="s5">\\</span><span class="s2">d{3}|1(?:13[01]|6(?:0[47]|1[67]|66)|71[3-69]|98</span><span class="s5">\\</span><span class="s2">d)|2(?:2(?:2[79]|95)|3(?:2[5-9]|6[0-6])|57</span><span class="s5">\\</span><span class="s2">d|7(?:0</span><span class="s5">\\</span><span class="s2">d|1[17]|2[27]|3[37]|44|5[057]|66|88))|3(?:2(?:1[0-6]|21|3[469]|7[159])|33</span><span class="s5">\\</span><span class="s2">d|5(?:0[0-4]|5[579]|9</span><span class="s5">\\</span><span class="s2">d)|7(?:[0-3579]</span><span class="s5">\\</span><span class="s2">d|4[0467]|6[67]|8[078])|9[4-6]</span><span class="s5">\\</span><span class="s2">d)|4(?:2(?:29|5[0257]|6[0-7]|7[1-57])|5(?:1[0-4]|8</span><span class="s5">\\</span><span class="s2">d|9[5-9])|7(?:0</span><span class="s5">\\</span><span class="s2">d|1[024589]|2[0127]|3[0137]|[46][07]|5[01]|7[5-9]|9[079])|9(?:7[015-9]|[89]</span><span class="s5">\\</span><span class="s2">d))|5(?:112|2(?:0</span><span class="s5">\\</span><span class="s2">d|2[29]|[49]4)|3[1568]</span><span class="s5">\\</span><span class="s2">d|52[6-9]|7(?:0[01578]|1[017]|[23]7|4[047]|[5-7]</span><span class="s5">\\</span><span class="s2">d|8[78]|9[079]))|6(?:2(?:2[1245]|4[2-4])|39</span><span class="s5">\\</span><span class="s2">d|41[179]|5(?:[349]</span><span class="s5">\\</span><span class="s2">d|5[0-2])|7(?:0[017]|[13]</span><span class="s5">\\</span><span class="s2">d|22|44|55|67|88))|9(?:22[128]|3(?:2[0-4]|7</span><span class="s5">\\</span><span class="s2">d)|57[05629]|7(?:2[05-9]|3[37]|4</span><span class="s5">\\</span><span class="s2">d|60|7[2579]|87|9[07])))</span><span class="s5">\\</span><span class="s2">d{4}|9[0-57-9]</span><span class="s5">\\</span><span class="s2">d{7}&quot;</span><span class="s1">]</span>
		<span class="s1">]</span>

		<span class="s4">// Extended validation must not pass for an invalid phone number</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'961111111'</span><span class="s1">, { defaultCountry: </span><span class="s2">'UZ' </span><span class="s1">})).to.equal(</span><span class="s0">false</span><span class="s1">)</span>

		<span class="s4">// Extended validation must pass for a valid phone number</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'912345678'</span><span class="s1">, { defaultCountry: </span><span class="s2">'UZ' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s1">metadata.countries.UZ[</span><span class="s3">11</span><span class="s1">] = phoneNumberTypePatterns</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should work in edge cases'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// No metadata</span>
		<span class="s0">let </span><span class="s1">thrower = () =&gt; _isValidNumber(</span><span class="s2">'+78005553535'</span><span class="s1">)</span>
		<span class="s1">expect(thrower).to.throw(</span><span class="s2">'`metadata` argument not passed'</span><span class="s1">)</span>

		<span class="s4">// // Non-phone-number characters in a phone number</span>
		<span class="s4">// isValidNumber('+499821958a').should.equal(false)</span>
		<span class="s4">// isValidNumber('88005553535x', { defaultCountry: 'RU' }).should.equal(false)</span>

		<span class="s4">// Doesn't have `types` regexps in default metadata.</span>
		<span class="s1">expect(isValidNumber({ country: </span><span class="s2">'UA'</span><span class="s1">, phone: </span><span class="s2">'300000000' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s1">expect(isValidNumber({ country: </span><span class="s2">'UA'</span><span class="s1">, phone: </span><span class="s2">'200000000' </span><span class="s1">})).to.equal(</span><span class="s0">false</span><span class="s1">)</span>

		<span class="s4">// // Numerical `value`</span>
		<span class="s4">// thrower = () =&gt; isValidNumber(88005553535, { defaultCountry: 'RU' })</span>
		<span class="s4">// thrower.should.throw('A phone number must either be a string or an object of shape { phone, [country] }.')</span>

		<span class="s4">// Long country phone code</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+3725555555'</span><span class="s1">)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>

		<span class="s4">// // Invalid country</span>
		<span class="s4">// thrower = () =&gt; isValidNumber({ phone: '8005553535', country: 'RUS' })</span>
		<span class="s4">// thrower.should.throw('Unknown country')</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should accept phone number extensions'</span><span class="s1">, () =&gt; {</span>
		<span class="s4">// International</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+12133734253 ext. 123'</span><span class="s1">)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
		<span class="s4">// National</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'88005553535 x123'</span><span class="s1">, { defaultCountry: </span><span class="s2">'RU' </span><span class="s1">})).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s2">'should validate non-geographic toll-free phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(isValidNumber(</span><span class="s2">'+80074454123'</span><span class="s1">)).to.equal(</span><span class="s0">true</span><span class="s1">)</span>
	<span class="s1">})</span>
<span class="s1">})</span></pre>
</body>
</html>