<html>
<head>
<title>keyframes.mjs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #0033b3;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #1750eb;}
.s4 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
keyframes.mjs</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">{ easeInOut, isEasingArray, easingDefinitionToFunction } from </span><span class="s2">'motion-utils'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ interpolate } from </span><span class="s2">'../../utils/interpolate.mjs'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ defaultOffset } from </span><span class="s2">'../keyframes/offsets/default.mjs'</span><span class="s1">;</span>
<span class="s0">import </span><span class="s1">{ convertOffsetToTimes } from </span><span class="s2">'../keyframes/offsets/time.mjs'</span><span class="s1">;</span>

<span class="s0">function </span><span class="s1">defaultEasing(values, easing) {</span>
    <span class="s0">return </span><span class="s1">values.map(() =&gt; easing || easeInOut).splice(</span><span class="s3">0</span><span class="s1">, values.length - </span><span class="s3">1</span><span class="s1">);</span>
<span class="s1">}</span>
<span class="s0">function </span><span class="s1">keyframes({ duration = </span><span class="s3">300</span><span class="s1">, keyframes: keyframeValues, times, ease = </span><span class="s2">&quot;easeInOut&quot;</span><span class="s1">, }) {</span>
    <span class="s4">/**</span>
     <span class="s4">* Easing functions can be externally defined as strings. Here we convert them</span>
     <span class="s4">* into actual functions.</span>
     <span class="s4">*/</span>
    <span class="s0">const </span><span class="s1">easingFunctions = isEasingArray(ease)</span>
        <span class="s1">? ease.map(easingDefinitionToFunction)</span>
        <span class="s1">: easingDefinitionToFunction(ease);</span>
    <span class="s4">/**</span>
     <span class="s4">* This is the Iterator-spec return value. We ensure it's mutable rather than using a generator</span>
     <span class="s4">* to reduce GC during animation.</span>
     <span class="s4">*/</span>
    <span class="s0">const </span><span class="s1">state = {</span>
        <span class="s1">done: </span><span class="s0">false</span><span class="s1">,</span>
        <span class="s1">value: keyframeValues[</span><span class="s3">0</span><span class="s1">],</span>
    <span class="s1">};</span>
    <span class="s4">/**</span>
     <span class="s4">* Create a times array based on the provided 0-1 offsets</span>
     <span class="s4">*/</span>
    <span class="s0">const </span><span class="s1">absoluteTimes = convertOffsetToTimes(</span>
    <span class="s4">// Only use the provided offsets if they're the correct length</span>
    <span class="s4">// TODO Maybe we should warn here if there's a length mismatch</span>
    <span class="s1">times &amp;&amp; times.length === keyframeValues.length</span>
        <span class="s1">? times</span>
        <span class="s1">: defaultOffset(keyframeValues), duration);</span>
    <span class="s0">const </span><span class="s1">mapTimeToKeyframe = interpolate(absoluteTimes, keyframeValues, {</span>
        <span class="s1">ease: Array.isArray(easingFunctions)</span>
            <span class="s1">? easingFunctions</span>
            <span class="s1">: defaultEasing(keyframeValues, easingFunctions),</span>
    <span class="s1">});</span>
    <span class="s0">return </span><span class="s1">{</span>
        <span class="s1">calculatedDuration: duration,</span>
        <span class="s1">next: (t) =&gt; {</span>
            <span class="s1">state.value = mapTimeToKeyframe(t);</span>
            <span class="s1">state.done = t &gt;= duration;</span>
            <span class="s0">return </span><span class="s1">state;</span>
        <span class="s1">},</span>
    <span class="s1">};</span>
<span class="s1">}</span>

<span class="s0">export </span><span class="s1">{ defaultEasing, keyframes };</span>
</pre>
</body>
</html>