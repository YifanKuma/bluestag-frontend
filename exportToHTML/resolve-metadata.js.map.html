<html>
<head>
<title>resolve-metadata.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
resolve-metadata.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../../src/lib/metadata/resolve-metadata.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type {</span><span class="s3">\n  </span><span class="s1">Metadata,</span><span class="s3">\n  </span><span class="s1">ResolvedMetadata,</span><span class="s3">\n  </span><span class="s1">ResolvedViewport,</span><span class="s3">\n  </span><span class="s1">ResolvingMetadata,</span><span class="s3">\n  </span><span class="s1">ResolvingViewport,</span><span class="s3">\n  </span><span class="s1">Viewport,</span><span class="s3">\n</span><span class="s1">} from './types/metadata-interface'</span><span class="s3">\n</span><span class="s1">import type { MetadataImageModule } from '../../build/webpack/loaders/metadata/types'</span><span class="s3">\n</span><span class="s1">import type { GetDynamicParamFromSegment } from '../../server/app-render/app-render'</span><span class="s3">\n</span><span class="s1">import type { Twitter } from './types/twitter-types'</span><span class="s3">\n</span><span class="s1">import type { OpenGraph } from './types/opengraph-types'</span><span class="s3">\n</span><span class="s1">import type { AppDirModules } from '../../build/webpack/loaders/next-app-loader'</span><span class="s3">\n</span><span class="s1">import type { MetadataContext } from './types/resolvers'</span><span class="s3">\n</span><span class="s1">import type { LoaderTree } from '../../server/lib/app-dir-module'</span><span class="s3">\n</span><span class="s1">import type {</span><span class="s3">\n  </span><span class="s1">AbsoluteTemplateString,</span><span class="s3">\n  </span><span class="s1">IconDescriptor,</span><span class="s3">\n  </span><span class="s1">ResolvedIcons,</span><span class="s3">\n</span><span class="s1">} from './types/metadata-types'</span><span class="s3">\n</span><span class="s1">import type { ParsedUrlQuery } from 'querystring'</span><span class="s3">\n</span><span class="s1">import type { StaticMetadata } from './types/icons'</span><span class="s3">\n</span><span class="s1">import type { WorkStore } from '../../server/app-render/work-async-storage.external'</span><span class="s3">\n</span><span class="s1">import type { Params } from '../../server/request/params'</span><span class="s3">\n\n</span><span class="s1">// eslint-disable-next-line import/no-extraneous-dependencies</span><span class="s3">\n</span><span class="s1">import 'server-only'</span><span class="s3">\n\n</span><span class="s1">import { cache } from 'react'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">createDefaultMetadata,</span><span class="s3">\n  </span><span class="s1">createDefaultViewport,</span><span class="s3">\n</span><span class="s1">} from './default-metadata'</span><span class="s3">\n</span><span class="s1">import { resolveOpenGraph, resolveTwitter } from './resolvers/resolve-opengraph'</span><span class="s3">\n</span><span class="s1">import { resolveTitle } from './resolvers/resolve-title'</span><span class="s3">\n</span><span class="s1">import { resolveAsArrayOrUndefined } from './generate/utils'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">getComponentTypeModule,</span><span class="s3">\n  </span><span class="s1">getLayoutOrPageModule,</span><span class="s3">\n</span><span class="s1">} from '../../server/lib/app-dir-module'</span><span class="s3">\n</span><span class="s1">import { interopDefault } from '../interop-default'</span><span class="s3">\n</span><span class="s1">import {</span><span class="s3">\n  </span><span class="s1">resolveAlternates,</span><span class="s3">\n  </span><span class="s1">resolveAppleWebApp,</span><span class="s3">\n  </span><span class="s1">resolveAppLinks,</span><span class="s3">\n  </span><span class="s1">resolveRobots,</span><span class="s3">\n  </span><span class="s1">resolveThemeColor,</span><span class="s3">\n  </span><span class="s1">resolveVerification,</span><span class="s3">\n  </span><span class="s1">resolveItunes,</span><span class="s3">\n  </span><span class="s1">resolveFacebook,</span><span class="s3">\n  </span><span class="s1">resolvePagination,</span><span class="s3">\n</span><span class="s1">} from './resolvers/resolve-basics'</span><span class="s3">\n</span><span class="s1">import { resolveIcons } from './resolvers/resolve-icons'</span><span class="s3">\n</span><span class="s1">import { getTracer } from '../../server/lib/trace/tracer'</span><span class="s3">\n</span><span class="s1">import { ResolveMetadataSpan } from '../../server/lib/trace/constants'</span><span class="s3">\n</span><span class="s1">import { PAGE_SEGMENT_KEY } from '../../shared/lib/segment'</span><span class="s3">\n</span><span class="s1">import * as Log from '../../build/output/log'</span><span class="s3">\n</span><span class="s1">import { createServerParamsForMetadata } from '../../server/request/params'</span><span class="s3">\n\n</span><span class="s1">type StaticIcons = Pick&lt;ResolvedIcons, 'icon' | 'apple'&gt;</span><span class="s3">\n\n</span><span class="s1">type MetadataResolver = (</span><span class="s3">\n  </span><span class="s1">parent: ResolvingMetadata</span><span class="s3">\n</span><span class="s1">) =&gt; Metadata | Promise&lt;Metadata&gt;</span><span class="s3">\n</span><span class="s1">type ViewportResolver = (</span><span class="s3">\n  </span><span class="s1">parent: ResolvingViewport</span><span class="s3">\n</span><span class="s1">) =&gt; Viewport | Promise&lt;Viewport&gt;</span><span class="s3">\n\n</span><span class="s1">export type MetadataErrorType = 'not-found' | 'forbidden' | 'unauthorized'</span><span class="s3">\n\n</span><span class="s1">export type MetadataItems = Array&lt;</span><span class="s3">\n  </span><span class="s1">[Metadata | MetadataResolver | null, StaticMetadata]</span><span class="s3">\n</span><span class="s1">&gt;</span><span class="s3">\n\n</span><span class="s1">export type ViewportItems = Array&lt;Viewport | ViewportResolver | null&gt;</span><span class="s3">\n\n</span><span class="s1">type TitleTemplates = {</span><span class="s3">\n  </span><span class="s1">title: string | null</span><span class="s3">\n  </span><span class="s1">twitter: string | null</span><span class="s3">\n  </span><span class="s1">openGraph: string | null</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type BuildState = {</span><span class="s3">\n  </span><span class="s1">warnings: Set&lt;string&gt;</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type LayoutProps = {</span><span class="s3">\n  </span><span class="s1">params: { [key: string]: any }</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">type PageProps = {</span><span class="s3">\n  </span><span class="s1">params: { [key: string]: any }</span><span class="s3">\n  </span><span class="s1">searchParams: { [key: string]: any }</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isFavicon(icon: IconDescriptor | undefined): boolean {</span><span class="s3">\n  </span><span class="s1">if (!icon) {</span><span class="s3">\n    </span><span class="s1">return false</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// turbopack appends a hash to all images</span><span class="s3">\n  </span><span class="s1">return (</span><span class="s3">\n    </span><span class="s1">(icon.url === '/favicon.ico' ||</span><span class="s3">\n      </span><span class="s1">icon.url.toString().startsWith('/favicon.ico?')) &amp;&amp;</span><span class="s3">\n    </span><span class="s1">icon.type === 'image/x-icon'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">async function mergeStaticMetadata(</span><span class="s3">\n  </span><span class="s1">source: Metadata | null,</span><span class="s3">\n  </span><span class="s1">target: ResolvedMetadata,</span><span class="s3">\n  </span><span class="s1">staticFilesMetadata: StaticMetadata,</span><span class="s3">\n  </span><span class="s1">metadataContext: MetadataContext,</span><span class="s3">\n  </span><span class="s1">titleTemplates: TitleTemplates,</span><span class="s3">\n  </span><span class="s1">leafSegmentStaticIcons: StaticIcons,</span><span class="s3">\n  </span><span class="s1">pathname: Promise&lt;string&gt;</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedMetadata&gt; {</span><span class="s3">\n  </span><span class="s1">if (!staticFilesMetadata) return target</span><span class="s3">\n  </span><span class="s1">const { icon, apple, openGraph, twitter, manifest } = staticFilesMetadata</span><span class="s3">\n\n  </span><span class="s1">// Keep updating the static icons in the most leaf node</span><span class="s3">\n\n  </span><span class="s1">if (icon) {</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons.icon = icon</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (apple) {</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons.apple = apple</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// file based metadata is specified and current level metadata twitter.images is not specified</span><span class="s3">\n  </span><span class="s1">if (twitter &amp;&amp; !source?.twitter?.hasOwnProperty('images')) {</span><span class="s3">\n    </span><span class="s1">const resolvedTwitter = resolveTwitter(</span><span class="s3">\n      </span><span class="s1">{ ...target.twitter, images: twitter } as Twitter,</span><span class="s3">\n      </span><span class="s1">target.metadataBase,</span><span class="s3">\n      </span><span class="s1">{ ...metadataContext, isStaticMetadataRouteFile: true },</span><span class="s3">\n      </span><span class="s1">titleTemplates.twitter</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">target.twitter = resolvedTwitter</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// file based metadata is specified and current level metadata openGraph.images is not specified</span><span class="s3">\n  </span><span class="s1">if (openGraph &amp;&amp; !source?.openGraph?.hasOwnProperty('images')) {</span><span class="s3">\n    </span><span class="s1">const resolvedOpenGraph = await resolveOpenGraph(</span><span class="s3">\n      </span><span class="s1">{ ...target.openGraph, images: openGraph } as OpenGraph,</span><span class="s3">\n      </span><span class="s1">target.metadataBase,</span><span class="s3">\n      </span><span class="s1">pathname,</span><span class="s3">\n      </span><span class="s1">{ ...metadataContext, isStaticMetadataRouteFile: true },</span><span class="s3">\n      </span><span class="s1">titleTemplates.openGraph</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">target.openGraph = resolvedOpenGraph</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">if (manifest) {</span><span class="s3">\n    </span><span class="s1">target.manifest = manifest</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return target</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// Merge the source metadata into the resolved target metadata.</span><span class="s3">\n</span><span class="s1">async function mergeMetadata(</span><span class="s3">\n  </span><span class="s1">route: string,</span><span class="s3">\n  </span><span class="s1">pathname: Promise&lt;string&gt;,</span><span class="s3">\n  </span><span class="s1">{</span><span class="s3">\n    </span><span class="s1">source,</span><span class="s3">\n    </span><span class="s1">target,</span><span class="s3">\n    </span><span class="s1">staticFilesMetadata,</span><span class="s3">\n    </span><span class="s1">titleTemplates,</span><span class="s3">\n    </span><span class="s1">metadataContext,</span><span class="s3">\n    </span><span class="s1">buildState,</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons,</span><span class="s3">\n  </span><span class="s1">}: {</span><span class="s3">\n    </span><span class="s1">source: Metadata | null</span><span class="s3">\n    </span><span class="s1">target: ResolvedMetadata</span><span class="s3">\n    </span><span class="s1">staticFilesMetadata: StaticMetadata</span><span class="s3">\n    </span><span class="s1">titleTemplates: TitleTemplates</span><span class="s3">\n    </span><span class="s1">metadataContext: MetadataContext</span><span class="s3">\n    </span><span class="s1">buildState: BuildState</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons: StaticIcons</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedMetadata&gt; {</span><span class="s3">\n  </span><span class="s1">// If there's override metadata, prefer it otherwise fallback to the default metadata.</span><span class="s3">\n  </span><span class="s1">const metadataBase =</span><span class="s3">\n    </span><span class="s1">typeof source?.metadataBase !== 'undefined'</span><span class="s3">\n      </span><span class="s1">? source.metadataBase</span><span class="s3">\n      </span><span class="s1">: target.metadataBase</span><span class="s3">\n  </span><span class="s1">for (const key_ in source) {</span><span class="s3">\n    </span><span class="s1">const key = key_ as keyof Metadata</span><span class="s3">\n\n    </span><span class="s1">switch (key) {</span><span class="s3">\n      </span><span class="s1">case 'title': {</span><span class="s3">\n        </span><span class="s1">target.title = resolveTitle(source.title, titleTemplates.title)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'alternates': {</span><span class="s3">\n        </span><span class="s1">target.alternates = await resolveAlternates(</span><span class="s3">\n          </span><span class="s1">source.alternates,</span><span class="s3">\n          </span><span class="s1">metadataBase,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">metadataContext</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'openGraph': {</span><span class="s3">\n        </span><span class="s1">target.openGraph = await resolveOpenGraph(</span><span class="s3">\n          </span><span class="s1">source.openGraph,</span><span class="s3">\n          </span><span class="s1">metadataBase,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">metadataContext,</span><span class="s3">\n          </span><span class="s1">titleTemplates.openGraph</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'twitter': {</span><span class="s3">\n        </span><span class="s1">target.twitter = resolveTwitter(</span><span class="s3">\n          </span><span class="s1">source.twitter,</span><span class="s3">\n          </span><span class="s1">metadataBase,</span><span class="s3">\n          </span><span class="s1">metadataContext,</span><span class="s3">\n          </span><span class="s1">titleTemplates.twitter</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'facebook':</span><span class="s3">\n        </span><span class="s1">target.facebook = resolveFacebook(source.facebook)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'verification':</span><span class="s3">\n        </span><span class="s1">target.verification = resolveVerification(source.verification)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n\n      </span><span class="s1">case 'icons': {</span><span class="s3">\n        </span><span class="s1">target.icons = resolveIcons(source.icons)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'appleWebApp':</span><span class="s3">\n        </span><span class="s1">target.appleWebApp = resolveAppleWebApp(source.appleWebApp)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'appLinks':</span><span class="s3">\n        </span><span class="s1">target.appLinks = resolveAppLinks(source.appLinks)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'robots': {</span><span class="s3">\n        </span><span class="s1">target.robots = resolveRobots(source.robots)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'archives':</span><span class="s3">\n      </span><span class="s1">case 'assets':</span><span class="s3">\n      </span><span class="s1">case 'bookmarks':</span><span class="s3">\n      </span><span class="s1">case 'keywords': {</span><span class="s3">\n        </span><span class="s1">target[key] = resolveAsArrayOrUndefined(source[key])</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'authors': {</span><span class="s3">\n        </span><span class="s1">target[key] = resolveAsArrayOrUndefined(source.authors)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'itunes': {</span><span class="s3">\n        </span><span class="s1">target[key] = await resolveItunes(</span><span class="s3">\n          </span><span class="s1">source.itunes,</span><span class="s3">\n          </span><span class="s1">metadataBase,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">metadataContext</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'pagination': {</span><span class="s3">\n        </span><span class="s1">target.pagination = await resolvePagination(</span><span class="s3">\n          </span><span class="s1">source.pagination,</span><span class="s3">\n          </span><span class="s1">metadataBase,</span><span class="s3">\n          </span><span class="s1">pathname,</span><span class="s3">\n          </span><span class="s1">metadataContext</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">// directly assign fields that fallback to null</span><span class="s3">\n      </span><span class="s1">case 'abstract':</span><span class="s3">\n      </span><span class="s1">case 'applicationName':</span><span class="s3">\n      </span><span class="s1">case 'description':</span><span class="s3">\n      </span><span class="s1">case 'generator':</span><span class="s3">\n      </span><span class="s1">case 'creator':</span><span class="s3">\n      </span><span class="s1">case 'publisher':</span><span class="s3">\n      </span><span class="s1">case 'category':</span><span class="s3">\n      </span><span class="s1">case 'classification':</span><span class="s3">\n      </span><span class="s1">case 'referrer':</span><span class="s3">\n      </span><span class="s1">case 'formatDetection':</span><span class="s3">\n      </span><span class="s1">case 'manifest':</span><span class="s3">\n      </span><span class="s1">case 'pinterest':</span><span class="s3">\n        </span><span class="s1">// @ts-ignore TODO: support inferring</span><span class="s3">\n        </span><span class="s1">target[key] = source[key] || null</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'other':</span><span class="s3">\n        </span><span class="s1">target.other = Object.assign({}, target.other, source.other)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'metadataBase':</span><span class="s3">\n        </span><span class="s1">target.metadataBase = metadataBase</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n\n      </span><span class="s1">case 'apple-touch-fullscreen': {</span><span class="s3">\n        </span><span class="s1">buildState.warnings.add(</span><span class="s3">\n          </span><span class="s1">`Use appleWebApp instead</span><span class="s3">\\</span><span class="s1">nRead more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'apple-touch-icon-precomposed': {</span><span class="s3">\n        </span><span class="s1">buildState.warnings.add(</span><span class="s3">\n          </span><span class="s1">`Use icons.apple instead</span><span class="s3">\\</span><span class="s1">nRead more: https://nextjs.org/docs/app/api-reference/functions/generate-metadata`</span><span class="s3">\n        </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'themeColor':</span><span class="s3">\n      </span><span class="s1">case 'colorScheme':</span><span class="s3">\n      </span><span class="s1">case 'viewport':</span><span class="s3">\n        </span><span class="s1">if (source[key] != null) {</span><span class="s3">\n          </span><span class="s1">buildState.warnings.add(</span><span class="s3">\n            </span><span class="s1">`Unsupported metadata ${key} is configured in metadata export in ${route}. Please move it to viewport export instead.</span><span class="s3">\\</span><span class="s1">nRead more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport`</span><span class="s3">\n          </span><span class="s1">)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default: {</span><span class="s3">\n        </span><span class="s1">key satisfies never</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return mergeStaticMetadata(</span><span class="s3">\n    </span><span class="s1">source,</span><span class="s3">\n    </span><span class="s1">target,</span><span class="s3">\n    </span><span class="s1">staticFilesMetadata,</span><span class="s3">\n    </span><span class="s1">metadataContext,</span><span class="s3">\n    </span><span class="s1">titleTemplates,</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons,</span><span class="s3">\n    </span><span class="s1">pathname</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function mergeViewport({</span><span class="s3">\n  </span><span class="s1">target,</span><span class="s3">\n  </span><span class="s1">source,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">target: ResolvedViewport</span><span class="s3">\n  </span><span class="s1">source: Viewport | null</span><span class="s3">\n</span><span class="s1">}): void {</span><span class="s3">\n  </span><span class="s1">if (!source) return</span><span class="s3">\n  </span><span class="s1">for (const key_ in source) {</span><span class="s3">\n    </span><span class="s1">const key = key_ as keyof Viewport</span><span class="s3">\n\n    </span><span class="s1">switch (key) {</span><span class="s3">\n      </span><span class="s1">case 'themeColor': {</span><span class="s3">\n        </span><span class="s1">target.themeColor = resolveThemeColor(source.themeColor)</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">case 'colorScheme':</span><span class="s3">\n        </span><span class="s1">target.colorScheme = source.colorScheme || null</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">case 'width':</span><span class="s3">\n      </span><span class="s1">case 'height':</span><span class="s3">\n      </span><span class="s1">case 'initialScale':</span><span class="s3">\n      </span><span class="s1">case 'minimumScale':</span><span class="s3">\n      </span><span class="s1">case 'maximumScale':</span><span class="s3">\n      </span><span class="s1">case 'userScalable':</span><span class="s3">\n      </span><span class="s1">case 'viewportFit':</span><span class="s3">\n      </span><span class="s1">case 'interactiveWidget':</span><span class="s3">\n        </span><span class="s1">// always override the target with the source</span><span class="s3">\n        </span><span class="s1">// @ts-ignore viewport properties</span><span class="s3">\n        </span><span class="s1">target[key] = source[key]</span><span class="s3">\n        </span><span class="s1">break</span><span class="s3">\n      </span><span class="s1">default:</span><span class="s3">\n        </span><span class="s1">key satisfies never</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function getDefinedViewport(</span><span class="s3">\n  </span><span class="s1">mod: any,</span><span class="s3">\n  </span><span class="s1">props: any,</span><span class="s3">\n  </span><span class="s1">tracingProps: { route: string }</span><span class="s3">\n</span><span class="s1">): Viewport | ViewportResolver | null {</span><span class="s3">\n  </span><span class="s1">if (typeof mod.generateViewport === 'function') {</span><span class="s3">\n    </span><span class="s1">const { route } = tracingProps</span><span class="s3">\n    </span><span class="s1">return (parent: ResolvingViewport) =&gt;</span><span class="s3">\n      </span><span class="s1">getTracer().trace(</span><span class="s3">\n        </span><span class="s1">ResolveMetadataSpan.generateViewport,</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">spanName: `generateViewport ${route}`,</span><span class="s3">\n          </span><span class="s1">attributes: {</span><span class="s3">\n            </span><span class="s1">'next.page': route,</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">() =&gt; mod.generateViewport(props, parent)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return mod.viewport || null</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function getDefinedMetadata(</span><span class="s3">\n  </span><span class="s1">mod: any,</span><span class="s3">\n  </span><span class="s1">props: any,</span><span class="s3">\n  </span><span class="s1">tracingProps: { route: string }</span><span class="s3">\n</span><span class="s1">): Metadata | MetadataResolver | null {</span><span class="s3">\n  </span><span class="s1">if (typeof mod.generateMetadata === 'function') {</span><span class="s3">\n    </span><span class="s1">const { route } = tracingProps</span><span class="s3">\n    </span><span class="s1">return (parent: ResolvingMetadata) =&gt;</span><span class="s3">\n      </span><span class="s1">getTracer().trace(</span><span class="s3">\n        </span><span class="s1">ResolveMetadataSpan.generateMetadata,</span><span class="s3">\n        </span><span class="s1">{</span><span class="s3">\n          </span><span class="s1">spanName: `generateMetadata ${route}`,</span><span class="s3">\n          </span><span class="s1">attributes: {</span><span class="s3">\n            </span><span class="s1">'next.page': route,</span><span class="s3">\n          </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">},</span><span class="s3">\n        </span><span class="s1">() =&gt; mod.generateMetadata(props, parent)</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return mod.metadata || null</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">async function collectStaticImagesFiles(</span><span class="s3">\n  </span><span class="s1">metadata: AppDirModules['metadata'],</span><span class="s3">\n  </span><span class="s1">props: any,</span><span class="s3">\n  </span><span class="s1">type: keyof NonNullable&lt;AppDirModules['metadata']&gt;</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">if (!metadata?.[type]) return undefined</span><span class="s3">\n\n  </span><span class="s1">const iconPromises = metadata[type as 'icon' | 'apple'].map(</span><span class="s3">\n    </span><span class="s1">async (imageModule: (p: any) =&gt; Promise&lt;MetadataImageModule[]&gt;) =&gt;</span><span class="s3">\n      </span><span class="s1">interopDefault(await imageModule(props))</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n\n  </span><span class="s1">return iconPromises?.length &gt; 0</span><span class="s3">\n    </span><span class="s1">? (await Promise.all(iconPromises))?.flat()</span><span class="s3">\n    </span><span class="s1">: undefined</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">async function resolveStaticMetadata(</span><span class="s3">\n  </span><span class="s1">modules: AppDirModules,</span><span class="s3">\n  </span><span class="s1">props: any</span><span class="s3">\n</span><span class="s1">): Promise&lt;StaticMetadata&gt; {</span><span class="s3">\n  </span><span class="s1">const { metadata } = modules</span><span class="s3">\n  </span><span class="s1">if (!metadata) return null</span><span class="s3">\n\n  </span><span class="s1">const [icon, apple, openGraph, twitter] = await Promise.all([</span><span class="s3">\n    </span><span class="s1">collectStaticImagesFiles(metadata, props, 'icon'),</span><span class="s3">\n    </span><span class="s1">collectStaticImagesFiles(metadata, props, 'apple'),</span><span class="s3">\n    </span><span class="s1">collectStaticImagesFiles(metadata, props, 'openGraph'),</span><span class="s3">\n    </span><span class="s1">collectStaticImagesFiles(metadata, props, 'twitter'),</span><span class="s3">\n  </span><span class="s1">])</span><span class="s3">\n\n  </span><span class="s1">const staticMetadata = {</span><span class="s3">\n    </span><span class="s1">icon,</span><span class="s3">\n    </span><span class="s1">apple,</span><span class="s3">\n    </span><span class="s1">openGraph,</span><span class="s3">\n    </span><span class="s1">twitter,</span><span class="s3">\n    </span><span class="s1">manifest: metadata.manifest,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return staticMetadata</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// [layout.metadata, static files metadata] -&gt; ... -&gt; [page.metadata, static files metadata]</span><span class="s3">\n</span><span class="s1">async function collectMetadata({</span><span class="s3">\n  </span><span class="s1">tree,</span><span class="s3">\n  </span><span class="s1">metadataItems,</span><span class="s3">\n  </span><span class="s1">errorMetadataItem,</span><span class="s3">\n  </span><span class="s1">props,</span><span class="s3">\n  </span><span class="s1">route,</span><span class="s3">\n  </span><span class="s1">errorConvention,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree</span><span class="s3">\n  </span><span class="s1">metadataItems: MetadataItems</span><span class="s3">\n  </span><span class="s1">errorMetadataItem: MetadataItems[number]</span><span class="s3">\n  </span><span class="s1">props: any</span><span class="s3">\n  </span><span class="s1">route: string</span><span class="s3">\n  </span><span class="s1">errorConvention?: MetadataErrorType</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">let mod</span><span class="s3">\n  </span><span class="s1">let modType</span><span class="s3">\n  </span><span class="s1">const hasErrorConventionComponent = Boolean(</span><span class="s3">\n    </span><span class="s1">errorConvention &amp;&amp; tree[2][errorConvention]</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">if (errorConvention) {</span><span class="s3">\n    </span><span class="s1">mod = await getComponentTypeModule(tree, 'layout')</span><span class="s3">\n    </span><span class="s1">modType = errorConvention</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">const { mod: layoutOrPageMod, modType: layoutOrPageModType } =</span><span class="s3">\n      </span><span class="s1">await getLayoutOrPageModule(tree)</span><span class="s3">\n    </span><span class="s1">mod = layoutOrPageMod</span><span class="s3">\n    </span><span class="s1">modType = layoutOrPageModType</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (modType) {</span><span class="s3">\n    </span><span class="s1">route += `/${modType}`</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const staticFilesMetadata = await resolveStaticMetadata(tree[2], props)</span><span class="s3">\n  </span><span class="s1">const metadataExport = mod ? getDefinedMetadata(mod, props, { route }) : null</span><span class="s3">\n\n  </span><span class="s1">metadataItems.push([metadataExport, staticFilesMetadata])</span><span class="s3">\n\n  </span><span class="s1">if (hasErrorConventionComponent &amp;&amp; errorConvention) {</span><span class="s3">\n    </span><span class="s1">const errorMod = await getComponentTypeModule(tree, errorConvention)</span><span class="s3">\n    </span><span class="s1">const errorMetadataExport = errorMod</span><span class="s3">\n      </span><span class="s1">? getDefinedMetadata(errorMod, props, { route })</span><span class="s3">\n      </span><span class="s1">: null</span><span class="s3">\n\n    </span><span class="s1">errorMetadataItem[0] = errorMetadataExport</span><span class="s3">\n    </span><span class="s1">errorMetadataItem[1] = staticFilesMetadata</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// [layout.metadata, static files metadata] -&gt; ... -&gt; [page.metadata, static files metadata]</span><span class="s3">\n</span><span class="s1">async function collectViewport({</span><span class="s3">\n  </span><span class="s1">tree,</span><span class="s3">\n  </span><span class="s1">viewportItems,</span><span class="s3">\n  </span><span class="s1">errorViewportItemRef,</span><span class="s3">\n  </span><span class="s1">props,</span><span class="s3">\n  </span><span class="s1">route,</span><span class="s3">\n  </span><span class="s1">errorConvention,</span><span class="s3">\n</span><span class="s1">}: {</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree</span><span class="s3">\n  </span><span class="s1">viewportItems: ViewportItems</span><span class="s3">\n  </span><span class="s1">errorViewportItemRef: ErrorViewportItemRef</span><span class="s3">\n  </span><span class="s1">props: any</span><span class="s3">\n  </span><span class="s1">route: string</span><span class="s3">\n  </span><span class="s1">errorConvention?: MetadataErrorType</span><span class="s3">\n</span><span class="s1">}) {</span><span class="s3">\n  </span><span class="s1">let mod</span><span class="s3">\n  </span><span class="s1">let modType</span><span class="s3">\n  </span><span class="s1">const hasErrorConventionComponent = Boolean(</span><span class="s3">\n    </span><span class="s1">errorConvention &amp;&amp; tree[2][errorConvention]</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">if (errorConvention) {</span><span class="s3">\n    </span><span class="s1">mod = await getComponentTypeModule(tree, 'layout')</span><span class="s3">\n    </span><span class="s1">modType = errorConvention</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">const { mod: layoutOrPageMod, modType: layoutOrPageModType } =</span><span class="s3">\n      </span><span class="s1">await getLayoutOrPageModule(tree)</span><span class="s3">\n    </span><span class="s1">mod = layoutOrPageMod</span><span class="s3">\n    </span><span class="s1">modType = layoutOrPageModType</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (modType) {</span><span class="s3">\n    </span><span class="s1">route += `/${modType}`</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const viewportExport = mod ? getDefinedViewport(mod, props, { route }) : null</span><span class="s3">\n\n  </span><span class="s1">viewportItems.push(viewportExport)</span><span class="s3">\n\n  </span><span class="s1">if (hasErrorConventionComponent &amp;&amp; errorConvention) {</span><span class="s3">\n    </span><span class="s1">const errorMod = await getComponentTypeModule(tree, errorConvention)</span><span class="s3">\n    </span><span class="s1">const errorViewportExport = errorMod</span><span class="s3">\n      </span><span class="s1">? getDefinedViewport(errorMod, props, { route })</span><span class="s3">\n      </span><span class="s1">: null</span><span class="s3">\n\n    </span><span class="s1">errorViewportItemRef.current = errorViewportExport</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">const resolveMetadataItems = cache(async function (</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const parentParams = {}</span><span class="s3">\n  </span><span class="s1">const metadataItems: MetadataItems = []</span><span class="s3">\n  </span><span class="s1">const errorMetadataItem: MetadataItems[number] = [null, null]</span><span class="s3">\n  </span><span class="s1">const treePrefix = undefined</span><span class="s3">\n  </span><span class="s1">return resolveMetadataItemsImpl(</span><span class="s3">\n    </span><span class="s1">metadataItems,</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">treePrefix,</span><span class="s3">\n    </span><span class="s1">parentParams,</span><span class="s3">\n    </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">errorMetadataItem,</span><span class="s3">\n    </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n    </span><span class="s1">workStore</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">})</span><span class="s3">\n\n</span><span class="s1">async function resolveMetadataItemsImpl(</span><span class="s3">\n  </span><span class="s1">metadataItems: MetadataItems,</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">/** Provided tree can be nested subtree, this argument says what is the path of such subtree */</span><span class="s3">\n  </span><span class="s1">treePrefix: undefined | string[],</span><span class="s3">\n  </span><span class="s1">parentParams: Params,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">errorMetadataItem: MetadataItems[number],</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore</span><span class="s3">\n</span><span class="s1">): Promise&lt;MetadataItems&gt; {</span><span class="s3">\n  </span><span class="s1">const [segment, parallelRoutes, { page }] = tree</span><span class="s3">\n  </span><span class="s1">const currentTreePrefix =</span><span class="s3">\n    </span><span class="s1">treePrefix &amp;&amp; treePrefix.length ? [...treePrefix, segment] : [segment]</span><span class="s3">\n  </span><span class="s1">const isPage = typeof page !== 'undefined'</span><span class="s3">\n\n  </span><span class="s1">// Handle dynamic segment params.</span><span class="s3">\n  </span><span class="s1">const segmentParam = getDynamicParamFromSegment(segment)</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Create object holding the parent params and current params</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">let currentParams = parentParams</span><span class="s3">\n  </span><span class="s1">if (segmentParam &amp;&amp; segmentParam.value !== null) {</span><span class="s3">\n    </span><span class="s1">currentParams = {</span><span class="s3">\n      </span><span class="s1">...parentParams,</span><span class="s3">\n      </span><span class="s1">[segmentParam.param]: segmentParam.value,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const params = createServerParamsForMetadata(currentParams, workStore)</span><span class="s3">\n\n  </span><span class="s1">let layerProps: LayoutProps | PageProps</span><span class="s3">\n  </span><span class="s1">if (isPage) {</span><span class="s3">\n    </span><span class="s1">layerProps = {</span><span class="s3">\n      </span><span class="s1">params,</span><span class="s3">\n      </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">layerProps = {</span><span class="s3">\n      </span><span class="s1">params,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">await collectMetadata({</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">metadataItems,</span><span class="s3">\n    </span><span class="s1">errorMetadataItem,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">props: layerProps,</span><span class="s3">\n    </span><span class="s1">route: currentTreePrefix</span><span class="s3">\n      </span><span class="s1">// __PAGE__ shouldn't be shown in a route</span><span class="s3">\n      </span><span class="s1">.filter((s) =&gt; s !== PAGE_SEGMENT_KEY)</span><span class="s3">\n      </span><span class="s1">.join('/'),</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">for (const key in parallelRoutes) {</span><span class="s3">\n    </span><span class="s1">const childTree = parallelRoutes[key]</span><span class="s3">\n    </span><span class="s1">await resolveMetadataItemsImpl(</span><span class="s3">\n      </span><span class="s1">metadataItems,</span><span class="s3">\n      </span><span class="s1">childTree,</span><span class="s3">\n      </span><span class="s1">currentTreePrefix,</span><span class="s3">\n      </span><span class="s1">currentParams,</span><span class="s3">\n      </span><span class="s1">searchParams,</span><span class="s3">\n      </span><span class="s1">errorConvention,</span><span class="s3">\n      </span><span class="s1">errorMetadataItem,</span><span class="s3">\n      </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n      </span><span class="s1">workStore</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (Object.keys(parallelRoutes).length === 0 &amp;&amp; errorConvention) {</span><span class="s3">\n    </span><span class="s1">// If there are no parallel routes, place error metadata as the last item.</span><span class="s3">\n    </span><span class="s1">// e.g. layout -&gt; layout -&gt; not-found</span><span class="s3">\n    </span><span class="s1">metadataItems.push(errorMetadataItem)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return metadataItems</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type ErrorViewportItemRef = { current: ViewportItems[number] }</span><span class="s3">\n</span><span class="s1">const resolveViewportItems = cache(async function (</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">const parentParams = {}</span><span class="s3">\n  </span><span class="s1">const viewportItems: ViewportItems = []</span><span class="s3">\n  </span><span class="s1">const errorViewportItemRef: ErrorViewportItemRef = {</span><span class="s3">\n    </span><span class="s1">current: null,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">const treePrefix = undefined</span><span class="s3">\n  </span><span class="s1">return resolveViewportItemsImpl(</span><span class="s3">\n    </span><span class="s1">viewportItems,</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">treePrefix,</span><span class="s3">\n    </span><span class="s1">parentParams,</span><span class="s3">\n    </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">errorViewportItemRef,</span><span class="s3">\n    </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n    </span><span class="s1">workStore</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">})</span><span class="s3">\n\n</span><span class="s1">async function resolveViewportItemsImpl(</span><span class="s3">\n  </span><span class="s1">viewportItems: ViewportItems,</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">/** Provided tree can be nested subtree, this argument says what is the path of such subtree */</span><span class="s3">\n  </span><span class="s1">treePrefix: undefined | string[],</span><span class="s3">\n  </span><span class="s1">parentParams: Params,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">errorViewportItemRef: ErrorViewportItemRef,</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore</span><span class="s3">\n</span><span class="s1">): Promise&lt;ViewportItems&gt; {</span><span class="s3">\n  </span><span class="s1">const [segment, parallelRoutes, { page }] = tree</span><span class="s3">\n  </span><span class="s1">const currentTreePrefix =</span><span class="s3">\n    </span><span class="s1">treePrefix &amp;&amp; treePrefix.length ? [...treePrefix, segment] : [segment]</span><span class="s3">\n  </span><span class="s1">const isPage = typeof page !== 'undefined'</span><span class="s3">\n\n  </span><span class="s1">// Handle dynamic segment params.</span><span class="s3">\n  </span><span class="s1">const segmentParam = getDynamicParamFromSegment(segment)</span><span class="s3">\n  </span><span class="s1">/**</span><span class="s3">\n   </span><span class="s1">* Create object holding the parent params and current params</span><span class="s3">\n   </span><span class="s1">*/</span><span class="s3">\n  </span><span class="s1">let currentParams = parentParams</span><span class="s3">\n  </span><span class="s1">if (segmentParam &amp;&amp; segmentParam.value !== null) {</span><span class="s3">\n    </span><span class="s1">currentParams = {</span><span class="s3">\n      </span><span class="s1">...parentParams,</span><span class="s3">\n      </span><span class="s1">[segmentParam.param]: segmentParam.value,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const params = createServerParamsForMetadata(currentParams, workStore)</span><span class="s3">\n\n  </span><span class="s1">let layerProps: LayoutProps | PageProps</span><span class="s3">\n  </span><span class="s1">if (isPage) {</span><span class="s3">\n    </span><span class="s1">layerProps = {</span><span class="s3">\n      </span><span class="s1">params,</span><span class="s3">\n      </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">layerProps = {</span><span class="s3">\n      </span><span class="s1">params,</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">await collectViewport({</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">viewportItems,</span><span class="s3">\n    </span><span class="s1">errorViewportItemRef,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">props: layerProps,</span><span class="s3">\n    </span><span class="s1">route: currentTreePrefix</span><span class="s3">\n      </span><span class="s1">// __PAGE__ shouldn't be shown in a route</span><span class="s3">\n      </span><span class="s1">.filter((s) =&gt; s !== PAGE_SEGMENT_KEY)</span><span class="s3">\n      </span><span class="s1">.join('/'),</span><span class="s3">\n  </span><span class="s1">})</span><span class="s3">\n\n  </span><span class="s1">for (const key in parallelRoutes) {</span><span class="s3">\n    </span><span class="s1">const childTree = parallelRoutes[key]</span><span class="s3">\n    </span><span class="s1">await resolveViewportItemsImpl(</span><span class="s3">\n      </span><span class="s1">viewportItems,</span><span class="s3">\n      </span><span class="s1">childTree,</span><span class="s3">\n      </span><span class="s1">currentTreePrefix,</span><span class="s3">\n      </span><span class="s1">currentParams,</span><span class="s3">\n      </span><span class="s1">searchParams,</span><span class="s3">\n      </span><span class="s1">errorConvention,</span><span class="s3">\n      </span><span class="s1">errorViewportItemRef,</span><span class="s3">\n      </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n      </span><span class="s1">workStore</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (Object.keys(parallelRoutes).length === 0 &amp;&amp; errorConvention) {</span><span class="s3">\n    </span><span class="s1">// If there are no parallel routes, place error metadata as the last item.</span><span class="s3">\n    </span><span class="s1">// e.g. layout -&gt; layout -&gt; not-found</span><span class="s3">\n    </span><span class="s1">viewportItems.push(errorViewportItemRef.current)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return viewportItems</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type WithTitle = { title?: AbsoluteTemplateString | null }</span><span class="s3">\n</span><span class="s1">type WithDescription = { description?: string | null }</span><span class="s3">\n\n</span><span class="s1">const isTitleTruthy = (title: AbsoluteTemplateString | null | undefined) =&gt;</span><span class="s3">\n  </span><span class="s1">!!title?.absolute</span><span class="s3">\n</span><span class="s1">const hasTitle = (metadata: WithTitle | null) =&gt; isTitleTruthy(metadata?.title)</span><span class="s3">\n\n</span><span class="s1">function inheritFromMetadata(</span><span class="s3">\n  </span><span class="s1">target: (WithTitle &amp; WithDescription) | null,</span><span class="s3">\n  </span><span class="s1">metadata: ResolvedMetadata</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">if (target) {</span><span class="s3">\n    </span><span class="s1">if (!hasTitle(target) &amp;&amp; hasTitle(metadata)) {</span><span class="s3">\n      </span><span class="s1">target.title = metadata.title</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (!target.description &amp;&amp; metadata.description) {</span><span class="s3">\n      </span><span class="s1">target.description = metadata.description</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span><span class="s3">\n</span><span class="s1">const commonOgKeys = ['title', 'description', 'images'] as const</span><span class="s3">\n</span><span class="s1">function postProcessMetadata(</span><span class="s3">\n  </span><span class="s1">metadata: ResolvedMetadata,</span><span class="s3">\n  </span><span class="s1">favicon: any,</span><span class="s3">\n  </span><span class="s1">titleTemplates: TitleTemplates,</span><span class="s3">\n  </span><span class="s1">metadataContext: MetadataContext</span><span class="s3">\n</span><span class="s1">): ResolvedMetadata {</span><span class="s3">\n  </span><span class="s1">const { openGraph, twitter } = metadata</span><span class="s3">\n\n  </span><span class="s1">if (openGraph) {</span><span class="s3">\n    </span><span class="s1">// If there's openGraph information but not configured in twitter,</span><span class="s3">\n    </span><span class="s1">// inherit them from openGraph metadata.</span><span class="s3">\n    </span><span class="s1">let autoFillProps: Partial&lt;{</span><span class="s3">\n      </span><span class="s1">[Key in (typeof commonOgKeys)[number]]: NonNullable&lt;</span><span class="s3">\n        </span><span class="s1">ResolvedMetadata['openGraph']</span><span class="s3">\n      </span><span class="s1">&gt;[Key]</span><span class="s3">\n    </span><span class="s1">}&gt; = {}</span><span class="s3">\n    </span><span class="s1">const hasTwTitle = hasTitle(twitter)</span><span class="s3">\n    </span><span class="s1">const hasTwDescription = twitter?.description</span><span class="s3">\n    </span><span class="s1">const hasTwImages = Boolean(</span><span class="s3">\n      </span><span class="s1">twitter?.hasOwnProperty('images') &amp;&amp; twitter.images</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">if (!hasTwTitle) {</span><span class="s3">\n      </span><span class="s1">if (isTitleTruthy(openGraph.title)) {</span><span class="s3">\n        </span><span class="s1">autoFillProps.title = openGraph.title</span><span class="s3">\n      </span><span class="s1">} else if (metadata.title &amp;&amp; isTitleTruthy(metadata.title)) {</span><span class="s3">\n        </span><span class="s1">autoFillProps.title = metadata.title</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">if (!hasTwDescription)</span><span class="s3">\n      </span><span class="s1">autoFillProps.description =</span><span class="s3">\n        </span><span class="s1">openGraph.description || metadata.description || undefined</span><span class="s3">\n    </span><span class="s1">if (!hasTwImages) autoFillProps.images = openGraph.images</span><span class="s3">\n\n    </span><span class="s1">if (Object.keys(autoFillProps).length &gt; 0) {</span><span class="s3">\n      </span><span class="s1">const partialTwitter = resolveTwitter(</span><span class="s3">\n        </span><span class="s1">autoFillProps,</span><span class="s3">\n        </span><span class="s1">metadata.metadataBase,</span><span class="s3">\n        </span><span class="s1">metadataContext,</span><span class="s3">\n        </span><span class="s1">titleTemplates.twitter</span><span class="s3">\n      </span><span class="s1">)</span><span class="s3">\n      </span><span class="s1">if (metadata.twitter) {</span><span class="s3">\n        </span><span class="s1">metadata.twitter = Object.assign({}, metadata.twitter, {</span><span class="s3">\n          </span><span class="s1">...(!hasTwTitle &amp;&amp; { title: partialTwitter?.title }),</span><span class="s3">\n          </span><span class="s1">...(!hasTwDescription &amp;&amp; {</span><span class="s3">\n            </span><span class="s1">description: partialTwitter?.description,</span><span class="s3">\n          </span><span class="s1">}),</span><span class="s3">\n          </span><span class="s1">...(!hasTwImages &amp;&amp; { images: partialTwitter?.images }),</span><span class="s3">\n        </span><span class="s1">})</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">metadata.twitter = partialTwitter</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// If there's no title and description configured in openGraph or twitter,</span><span class="s3">\n  </span><span class="s1">// use the title and description from metadata.</span><span class="s3">\n  </span><span class="s1">inheritFromMetadata(openGraph, metadata)</span><span class="s3">\n  </span><span class="s1">inheritFromMetadata(twitter, metadata)</span><span class="s3">\n\n  </span><span class="s1">if (favicon) {</span><span class="s3">\n    </span><span class="s1">if (!metadata.icons) {</span><span class="s3">\n      </span><span class="s1">metadata.icons = {</span><span class="s3">\n        </span><span class="s1">icon: [],</span><span class="s3">\n        </span><span class="s1">apple: [],</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">metadata.icons.icon.unshift(favicon)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return metadata</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type Result&lt;T&gt; = null | T | Promise&lt;null | T&gt; | PromiseLike&lt;null | T&gt;</span><span class="s3">\n\n</span><span class="s1">function prerenderMetadata(metadataItems: MetadataItems) {</span><span class="s3">\n  </span><span class="s1">// If the index is a function then it is a resolver and the next slot</span><span class="s3">\n  </span><span class="s1">// is the corresponding result. If the index is not a function it is the result</span><span class="s3">\n  </span><span class="s1">// itself.</span><span class="s3">\n  </span><span class="s1">const resolversAndResults: Array&lt;</span><span class="s3">\n    </span><span class="s1">((value: ResolvedMetadata) =&gt; void) | Result&lt;Metadata&gt;</span><span class="s3">\n  </span><span class="s1">&gt; = []</span><span class="s3">\n  </span><span class="s1">for (let i = 0; i &lt; metadataItems.length; i++) {</span><span class="s3">\n    </span><span class="s1">const metadataExport = metadataItems[i][0]</span><span class="s3">\n    </span><span class="s1">getResult(resolversAndResults, metadataExport)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return resolversAndResults</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function prerenderViewport(viewportItems: ViewportItems) {</span><span class="s3">\n  </span><span class="s1">// If the index is a function then it is a resolver and the next slot</span><span class="s3">\n  </span><span class="s1">// is the corresponding result. If the index is not a function it is the result</span><span class="s3">\n  </span><span class="s1">// itself.</span><span class="s3">\n  </span><span class="s1">const resolversAndResults: Array&lt;</span><span class="s3">\n    </span><span class="s1">((value: ResolvedViewport) =&gt; void) | Result&lt;Viewport&gt;</span><span class="s3">\n  </span><span class="s1">&gt; = []</span><span class="s3">\n  </span><span class="s1">for (let i = 0; i &lt; viewportItems.length; i++) {</span><span class="s3">\n    </span><span class="s1">const viewportExport = viewportItems[i]</span><span class="s3">\n    </span><span class="s1">getResult(resolversAndResults, viewportExport)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return resolversAndResults</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">type Resolved&lt;T&gt; = T extends Metadata ? ResolvedMetadata : ResolvedViewport</span><span class="s3">\n\n</span><span class="s1">function getResult&lt;T extends Metadata | Viewport&gt;(</span><span class="s3">\n  </span><span class="s1">resolversAndResults: Array&lt;((value: Resolved&lt;T&gt;) =&gt; void) | Result&lt;T&gt;&gt;,</span><span class="s3">\n  </span><span class="s1">exportForResult: null | T | ((parent: Promise&lt;Resolved&lt;T&gt;&gt;) =&gt; Result&lt;T&gt;)</span><span class="s3">\n</span><span class="s1">) {</span><span class="s3">\n  </span><span class="s1">if (typeof exportForResult === 'function') {</span><span class="s3">\n    </span><span class="s1">const result = exportForResult(</span><span class="s3">\n      </span><span class="s1">new Promise&lt;Resolved&lt;T&gt;&gt;((resolve) =&gt; resolversAndResults.push(resolve))</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n    </span><span class="s1">resolversAndResults.push(result)</span><span class="s3">\n    </span><span class="s1">if (result instanceof Promise) {</span><span class="s3">\n      </span><span class="s1">// since we eager execute generateMetadata and</span><span class="s3">\n      </span><span class="s1">// they can reject at anytime we need to ensure</span><span class="s3">\n      </span><span class="s1">// we attach the catch handler right away to</span><span class="s3">\n      </span><span class="s1">// prevent unhandled rejections crashing the process</span><span class="s3">\n      </span><span class="s1">result.catch((err) =&gt; {</span><span class="s3">\n        </span><span class="s1">return {</span><span class="s3">\n          </span><span class="s1">__nextError: err,</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">})</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">} else if (typeof exportForResult === 'object') {</span><span class="s3">\n    </span><span class="s1">resolversAndResults.push(exportForResult)</span><span class="s3">\n  </span><span class="s1">} else {</span><span class="s3">\n    </span><span class="s1">resolversAndResults.push(null)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function resolvePendingResult&lt;</span><span class="s3">\n  </span><span class="s1">ResolvedType extends ResolvedMetadata | ResolvedViewport,</span><span class="s3">\n</span><span class="s1">&gt;(</span><span class="s3">\n  </span><span class="s1">parentResult: ResolvedType,</span><span class="s3">\n  </span><span class="s1">resolveParentResult: (value: ResolvedType) =&gt; void</span><span class="s3">\n</span><span class="s1">): void {</span><span class="s3">\n  </span><span class="s1">// In dev we clone and freeze to prevent relying on mutating resolvedMetadata directly.</span><span class="s3">\n  </span><span class="s1">// In prod we just pass resolvedMetadata through without any copying.</span><span class="s3">\n  </span><span class="s1">if (process.env.NODE_ENV === 'development') {</span><span class="s3">\n    </span><span class="s1">// @ts-expect-error -- DeepReadonly&lt;T&gt; is by definition not assignable to T</span><span class="s3">\n    </span><span class="s1">// Instead, we should only accept DeepReadonly&lt;ResolvedType&gt;</span><span class="s3">\n    </span><span class="s1">parentResult = (</span><span class="s3">\n      </span><span class="s1">require('../../shared/lib/deep-freeze') as typeof import('../../shared/lib/deep-freeze')</span><span class="s3">\n    </span><span class="s1">).deepFreeze(</span><span class="s3">\n      </span><span class="s1">(</span><span class="s3">\n        </span><span class="s1">require('./clone-metadata') as typeof import('./clone-metadata')</span><span class="s3">\n      </span><span class="s1">).cloneMetadata(parentResult)</span><span class="s3">\n    </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">resolveParentResult(parentResult)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function accumulateMetadata(</span><span class="s3">\n  </span><span class="s1">route: string,</span><span class="s3">\n  </span><span class="s1">metadataItems: MetadataItems,</span><span class="s3">\n  </span><span class="s1">pathname: Promise&lt;string&gt;,</span><span class="s3">\n  </span><span class="s1">metadataContext: MetadataContext</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedMetadata&gt; {</span><span class="s3">\n  </span><span class="s1">let resolvedMetadata = createDefaultMetadata()</span><span class="s3">\n\n  </span><span class="s1">let titleTemplates: TitleTemplates = {</span><span class="s3">\n    </span><span class="s1">title: null,</span><span class="s3">\n    </span><span class="s1">twitter: null,</span><span class="s3">\n    </span><span class="s1">openGraph: null,</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const buildState = {</span><span class="s3">\n    </span><span class="s1">warnings: new Set&lt;string&gt;(),</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">let favicon</span><span class="s3">\n\n  </span><span class="s1">// Collect the static icons in the most leaf node,</span><span class="s3">\n  </span><span class="s1">// since we don't collect all the static metadata icons in the parent segments.</span><span class="s3">\n  </span><span class="s1">const leafSegmentStaticIcons = {</span><span class="s3">\n    </span><span class="s1">icon: [],</span><span class="s3">\n    </span><span class="s1">apple: [],</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">const resolversAndResults = prerenderMetadata(metadataItems)</span><span class="s3">\n  </span><span class="s1">let resultIndex = 0</span><span class="s3">\n\n  </span><span class="s1">for (let i = 0; i &lt; metadataItems.length; i++) {</span><span class="s3">\n    </span><span class="s1">const staticFilesMetadata = metadataItems[i][1]</span><span class="s3">\n    </span><span class="s1">// Treat favicon as special case, it should be the first icon in the list</span><span class="s3">\n    </span><span class="s1">// i &lt;= 1 represents root layout, and if current page is also at root</span><span class="s3">\n    </span><span class="s1">if (i &lt;= 1 &amp;&amp; isFavicon(staticFilesMetadata?.icon?.[0])) {</span><span class="s3">\n      </span><span class="s1">const iconMod = staticFilesMetadata?.icon?.shift()</span><span class="s3">\n      </span><span class="s1">if (i === 0) favicon = iconMod</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">let pendingMetadata = resolversAndResults[resultIndex++]</span><span class="s3">\n    </span><span class="s1">if (typeof pendingMetadata === 'function') {</span><span class="s3">\n      </span><span class="s1">// This metadata item had a `generateMetadata` and</span><span class="s3">\n      </span><span class="s1">// we need to provide the currently resolved metadata</span><span class="s3">\n      </span><span class="s1">// to it before we continue;</span><span class="s3">\n      </span><span class="s1">const resolveParentMetadata = pendingMetadata</span><span class="s3">\n      </span><span class="s1">// we know that the next item is a result if this item</span><span class="s3">\n      </span><span class="s1">// was a resolver</span><span class="s3">\n      </span><span class="s1">pendingMetadata = resolversAndResults[resultIndex++] as Result&lt;Metadata&gt;</span><span class="s3">\n\n      </span><span class="s1">resolvePendingResult(resolvedMetadata, resolveParentMetadata)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// Otherwise the item was either null or a static export</span><span class="s3">\n\n    </span><span class="s1">let metadata: Metadata | null</span><span class="s3">\n    </span><span class="s1">if (isPromiseLike(pendingMetadata)) {</span><span class="s3">\n      </span><span class="s1">metadata = await pendingMetadata</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">metadata = pendingMetadata</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">resolvedMetadata = await mergeMetadata(route, pathname, {</span><span class="s3">\n      </span><span class="s1">target: resolvedMetadata,</span><span class="s3">\n      </span><span class="s1">source: metadata,</span><span class="s3">\n      </span><span class="s1">metadataContext,</span><span class="s3">\n      </span><span class="s1">staticFilesMetadata,</span><span class="s3">\n      </span><span class="s1">titleTemplates,</span><span class="s3">\n      </span><span class="s1">buildState,</span><span class="s3">\n      </span><span class="s1">leafSegmentStaticIcons,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">// If the layout is the same layer with page, skip the leaf layout and leaf page</span><span class="s3">\n    </span><span class="s1">// The leaf layout and page are the last two items</span><span class="s3">\n    </span><span class="s1">if (i &lt; metadataItems.length - 2) {</span><span class="s3">\n      </span><span class="s1">titleTemplates = {</span><span class="s3">\n        </span><span class="s1">title: resolvedMetadata.title?.template || null,</span><span class="s3">\n        </span><span class="s1">openGraph: resolvedMetadata.openGraph?.title.template || null,</span><span class="s3">\n        </span><span class="s1">twitter: resolvedMetadata.twitter?.title.template || null,</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">if (</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons.icon.length &gt; 0 ||</span><span class="s3">\n    </span><span class="s1">leafSegmentStaticIcons.apple.length &gt; 0</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">if (!resolvedMetadata.icons) {</span><span class="s3">\n      </span><span class="s1">resolvedMetadata.icons = {</span><span class="s3">\n        </span><span class="s1">icon: [],</span><span class="s3">\n        </span><span class="s1">apple: [],</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">if (leafSegmentStaticIcons.icon.length &gt; 0) {</span><span class="s3">\n        </span><span class="s1">resolvedMetadata.icons.icon.unshift(...leafSegmentStaticIcons.icon)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">if (leafSegmentStaticIcons.apple.length &gt; 0) {</span><span class="s3">\n        </span><span class="s1">resolvedMetadata.icons.apple.unshift(...leafSegmentStaticIcons.apple)</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">// Only log warnings if there are any, and only once after the metadata resolving process is finished</span><span class="s3">\n  </span><span class="s1">if (buildState.warnings.size &gt; 0) {</span><span class="s3">\n    </span><span class="s1">for (const warning of buildState.warnings) {</span><span class="s3">\n      </span><span class="s1">Log.warn(warning)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n\n  </span><span class="s1">return postProcessMetadata(</span><span class="s3">\n    </span><span class="s1">resolvedMetadata,</span><span class="s3">\n    </span><span class="s1">favicon,</span><span class="s3">\n    </span><span class="s1">titleTemplates,</span><span class="s3">\n    </span><span class="s1">metadataContext</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">export async function accumulateViewport(</span><span class="s3">\n  </span><span class="s1">viewportItems: ViewportItems</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedViewport&gt; {</span><span class="s3">\n  </span><span class="s1">const resolvedViewport: ResolvedViewport = createDefaultViewport()</span><span class="s3">\n\n  </span><span class="s1">const resolversAndResults = prerenderViewport(viewportItems)</span><span class="s3">\n  </span><span class="s1">let i = 0</span><span class="s3">\n\n  </span><span class="s1">while (i &lt; resolversAndResults.length) {</span><span class="s3">\n    </span><span class="s1">let pendingViewport = resolversAndResults[i++]</span><span class="s3">\n    </span><span class="s1">if (typeof pendingViewport === 'function') {</span><span class="s3">\n      </span><span class="s1">// this viewport item had a `generateViewport` and</span><span class="s3">\n      </span><span class="s1">// we need to provide the currently resolved viewport</span><span class="s3">\n      </span><span class="s1">// to it before we continue;</span><span class="s3">\n      </span><span class="s1">const resolveParentViewport = pendingViewport</span><span class="s3">\n      </span><span class="s1">// we know that the next item is a result if this item</span><span class="s3">\n      </span><span class="s1">// was a resolver</span><span class="s3">\n      </span><span class="s1">pendingViewport = resolversAndResults[i++] as Result&lt;Viewport&gt;</span><span class="s3">\n\n      </span><span class="s1">resolvePendingResult(resolvedViewport, resolveParentViewport)</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">// Otherwise the item was either null or a static export</span><span class="s3">\n\n    </span><span class="s1">let viewport: Viewport | null</span><span class="s3">\n    </span><span class="s1">if (isPromiseLike(pendingViewport)) {</span><span class="s3">\n      </span><span class="s1">viewport = await pendingViewport</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">viewport = pendingViewport</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n\n    </span><span class="s1">mergeViewport({</span><span class="s3">\n      </span><span class="s1">target: resolvedViewport,</span><span class="s3">\n      </span><span class="s1">source: viewport,</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">return resolvedViewport</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// Exposed API for metadata component, that directly resolve the loader tree and related context as resolved metadata.</span><span class="s3">\n</span><span class="s1">export async function resolveMetadata(</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">pathname: Promise&lt;string&gt;,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore,</span><span class="s3">\n  </span><span class="s1">metadataContext: MetadataContext</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedMetadata&gt; {</span><span class="s3">\n  </span><span class="s1">const metadataItems = await resolveMetadataItems(</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n    </span><span class="s1">workStore</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">return accumulateMetadata(</span><span class="s3">\n    </span><span class="s1">workStore.route,</span><span class="s3">\n    </span><span class="s1">metadataItems,</span><span class="s3">\n    </span><span class="s1">pathname,</span><span class="s3">\n    </span><span class="s1">metadataContext</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">// Exposed API for viewport component, that directly resolve the loader tree and related context as resolved viewport.</span><span class="s3">\n</span><span class="s1">export async function resolveViewport(</span><span class="s3">\n  </span><span class="s1">tree: LoaderTree,</span><span class="s3">\n  </span><span class="s1">searchParams: Promise&lt;ParsedUrlQuery&gt;,</span><span class="s3">\n  </span><span class="s1">errorConvention: MetadataErrorType | undefined,</span><span class="s3">\n  </span><span class="s1">getDynamicParamFromSegment: GetDynamicParamFromSegment,</span><span class="s3">\n  </span><span class="s1">workStore: WorkStore</span><span class="s3">\n</span><span class="s1">): Promise&lt;ResolvedViewport&gt; {</span><span class="s3">\n  </span><span class="s1">const viewportItems = await resolveViewportItems(</span><span class="s3">\n    </span><span class="s1">tree,</span><span class="s3">\n    </span><span class="s1">searchParams,</span><span class="s3">\n    </span><span class="s1">errorConvention,</span><span class="s3">\n    </span><span class="s1">getDynamicParamFromSegment,</span><span class="s3">\n    </span><span class="s1">workStore</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n  </span><span class="s1">return accumulateViewport(viewportItems)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n\n</span><span class="s1">function isPromiseLike&lt;T&gt;(</span><span class="s3">\n  </span><span class="s1">value: unknown | PromiseLike&lt;T&gt;</span><span class="s3">\n</span><span class="s1">): value is PromiseLike&lt;T&gt; {</span><span class="s3">\n  </span><span class="s1">return (</span><span class="s3">\n    </span><span class="s1">typeof value === 'object' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">value !== null &amp;&amp;</span><span class="s3">\n    </span><span class="s1">typeof (value as PromiseLike&lt;unknown&gt;).then === 'function'</span><span class="s3">\n  </span><span class="s1">)</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;accumulateMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;accumulateViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;isFavicon&quot;</span><span class="s0">,</span><span class="s1">&quot;icon&quot;</span><span class="s0">,</span><span class="s1">&quot;url&quot;</span><span class="s0">,</span><span class="s1">&quot;toString&quot;</span><span class="s0">,</span><span class="s1">&quot;startsWith&quot;</span><span class="s0">,</span><span class="s1">&quot;type&quot;</span><span class="s0">,</span><span class="s1">&quot;mergeStaticMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;source&quot;</span><span class="s0">,</span><span class="s1">&quot;target&quot;</span><span class="s0">,</span><span class="s1">&quot;staticFilesMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;metadataContext&quot;</span><span class="s0">,</span><span class="s1">&quot;titleTemplates&quot;</span><span class="s0">,</span><span class="s1">&quot;leafSegmentStaticIcons&quot;</span><span class="s0">,</span><span class="s1">&quot;pathname&quot;</span><span class="s0">,</span><span class="s1">&quot;apple&quot;</span><span class="s0">,</span><span class="s1">&quot;openGraph&quot;</span><span class="s0">,</span><span class="s1">&quot;twitter&quot;</span><span class="s0">,</span><span class="s1">&quot;manifest&quot;</span><span class="s0">,</span><span class="s1">&quot;hasOwnProperty&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedTwitter&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveTwitter&quot;</span><span class="s0">,</span><span class="s1">&quot;images&quot;</span><span class="s0">,</span><span class="s1">&quot;metadataBase&quot;</span><span class="s0">,</span><span class="s1">&quot;isStaticMetadataRouteFile&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedOpenGraph&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveOpenGraph&quot;</span><span class="s0">,</span><span class="s1">&quot;mergeMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;route&quot;</span><span class="s0">,</span><span class="s1">&quot;buildState&quot;</span><span class="s0">,</span><span class="s1">&quot;key_&quot;</span><span class="s0">,</span><span class="s1">&quot;key&quot;</span><span class="s0">,</span><span class="s1">&quot;title&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveTitle&quot;</span><span class="s0">,</span><span class="s1">&quot;alternates&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveAlternates&quot;</span><span class="s0">,</span><span class="s1">&quot;facebook&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveFacebook&quot;</span><span class="s0">,</span><span class="s1">&quot;verification&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveVerification&quot;</span><span class="s0">,</span><span class="s1">&quot;icons&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveIcons&quot;</span><span class="s0">,</span><span class="s1">&quot;appleWebApp&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveAppleWebApp&quot;</span><span class="s0">,</span><span class="s1">&quot;appLinks&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveAppLinks&quot;</span><span class="s0">,</span><span class="s1">&quot;robots&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveRobots&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveAsArrayOrUndefined&quot;</span><span class="s0">,</span><span class="s1">&quot;authors&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveItunes&quot;</span><span class="s0">,</span><span class="s1">&quot;itunes&quot;</span><span class="s0">,</span><span class="s1">&quot;pagination&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvePagination&quot;</span><span class="s0">,</span><span class="s1">&quot;other&quot;</span><span class="s0">,</span><span class="s1">&quot;Object&quot;</span><span class="s0">,</span><span class="s1">&quot;assign&quot;</span><span class="s0">,</span><span class="s1">&quot;warnings&quot;</span><span class="s0">,</span><span class="s1">&quot;add&quot;</span><span class="s0">,</span><span class="s1">&quot;mergeViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;themeColor&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveThemeColor&quot;</span><span class="s0">,</span><span class="s1">&quot;colorScheme&quot;</span><span class="s0">,</span><span class="s1">&quot;getDefinedViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;mod&quot;</span><span class="s0">,</span><span class="s1">&quot;props&quot;</span><span class="s0">,</span><span class="s1">&quot;tracingProps&quot;</span><span class="s0">,</span><span class="s1">&quot;generateViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;parent&quot;</span><span class="s0">,</span><span class="s1">&quot;getTracer&quot;</span><span class="s0">,</span><span class="s1">&quot;trace&quot;</span><span class="s0">,</span><span class="s1">&quot;ResolveMetadataSpan&quot;</span><span class="s0">,</span><span class="s1">&quot;spanName&quot;</span><span class="s0">,</span><span class="s1">&quot;attributes&quot;</span><span class="s0">,</span><span class="s1">&quot;viewport&quot;</span><span class="s0">,</span><span class="s1">&quot;getDefinedMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;generateMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;metadata&quot;</span><span class="s0">,</span><span class="s1">&quot;collectStaticImagesFiles&quot;</span><span class="s0">,</span><span class="s1">&quot;undefined&quot;</span><span class="s0">,</span><span class="s1">&quot;iconPromises&quot;</span><span class="s0">,</span><span class="s1">&quot;map&quot;</span><span class="s0">,</span><span class="s1">&quot;imageModule&quot;</span><span class="s0">,</span><span class="s1">&quot;interopDefault&quot;</span><span class="s0">,</span><span class="s1">&quot;length&quot;</span><span class="s0">,</span><span class="s1">&quot;Promise&quot;</span><span class="s0">,</span><span class="s1">&quot;all&quot;</span><span class="s0">,</span><span class="s1">&quot;flat&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveStaticMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;modules&quot;</span><span class="s0">,</span><span class="s1">&quot;staticMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;collectMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;tree&quot;</span><span class="s0">,</span><span class="s1">&quot;metadataItems&quot;</span><span class="s0">,</span><span class="s1">&quot;errorMetadataItem&quot;</span><span class="s0">,</span><span class="s1">&quot;errorConvention&quot;</span><span class="s0">,</span><span class="s1">&quot;modType&quot;</span><span class="s0">,</span><span class="s1">&quot;hasErrorConventionComponent&quot;</span><span class="s0">,</span><span class="s1">&quot;Boolean&quot;</span><span class="s0">,</span><span class="s1">&quot;getComponentTypeModule&quot;</span><span class="s0">,</span><span class="s1">&quot;layoutOrPageMod&quot;</span><span class="s0">,</span><span class="s1">&quot;layoutOrPageModType&quot;</span><span class="s0">,</span><span class="s1">&quot;getLayoutOrPageModule&quot;</span><span class="s0">,</span><span class="s1">&quot;metadataExport&quot;</span><span class="s0">,</span><span class="s1">&quot;push&quot;</span><span class="s0">,</span><span class="s1">&quot;errorMod&quot;</span><span class="s0">,</span><span class="s1">&quot;errorMetadataExport&quot;</span><span class="s0">,</span><span class="s1">&quot;collectViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;viewportItems&quot;</span><span class="s0">,</span><span class="s1">&quot;errorViewportItemRef&quot;</span><span class="s0">,</span><span class="s1">&quot;viewportExport&quot;</span><span class="s0">,</span><span class="s1">&quot;errorViewportExport&quot;</span><span class="s0">,</span><span class="s1">&quot;current&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveMetadataItems&quot;</span><span class="s0">,</span><span class="s1">&quot;cache&quot;</span><span class="s0">,</span><span class="s1">&quot;searchParams&quot;</span><span class="s0">,</span><span class="s1">&quot;getDynamicParamFromSegment&quot;</span><span class="s0">,</span><span class="s1">&quot;workStore&quot;</span><span class="s0">,</span><span class="s1">&quot;parentParams&quot;</span><span class="s0">,</span><span class="s1">&quot;treePrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveMetadataItemsImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;segment&quot;</span><span class="s0">,</span><span class="s1">&quot;parallelRoutes&quot;</span><span class="s0">,</span><span class="s1">&quot;page&quot;</span><span class="s0">,</span><span class="s1">&quot;currentTreePrefix&quot;</span><span class="s0">,</span><span class="s1">&quot;isPage&quot;</span><span class="s0">,</span><span class="s1">&quot;segmentParam&quot;</span><span class="s0">,</span><span class="s1">&quot;currentParams&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;param&quot;</span><span class="s0">,</span><span class="s1">&quot;params&quot;</span><span class="s0">,</span><span class="s1">&quot;createServerParamsForMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;layerProps&quot;</span><span class="s0">,</span><span class="s1">&quot;filter&quot;</span><span class="s0">,</span><span class="s1">&quot;s&quot;</span><span class="s0">,</span><span class="s1">&quot;PAGE_SEGMENT_KEY&quot;</span><span class="s0">,</span><span class="s1">&quot;join&quot;</span><span class="s0">,</span><span class="s1">&quot;childTree&quot;</span><span class="s0">,</span><span class="s1">&quot;keys&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveViewportItems&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveViewportItemsImpl&quot;</span><span class="s0">,</span><span class="s1">&quot;isTitleTruthy&quot;</span><span class="s0">,</span><span class="s1">&quot;absolute&quot;</span><span class="s0">,</span><span class="s1">&quot;hasTitle&quot;</span><span class="s0">,</span><span class="s1">&quot;inheritFromMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;description&quot;</span><span class="s0">,</span><span class="s1">&quot;commonOgKeys&quot;</span><span class="s0">,</span><span class="s1">&quot;postProcessMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;favicon&quot;</span><span class="s0">,</span><span class="s1">&quot;autoFillProps&quot;</span><span class="s0">,</span><span class="s1">&quot;hasTwTitle&quot;</span><span class="s0">,</span><span class="s1">&quot;hasTwDescription&quot;</span><span class="s0">,</span><span class="s1">&quot;hasTwImages&quot;</span><span class="s0">,</span><span class="s1">&quot;partialTwitter&quot;</span><span class="s0">,</span><span class="s1">&quot;unshift&quot;</span><span class="s0">,</span><span class="s1">&quot;prerenderMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;resolversAndResults&quot;</span><span class="s0">,</span><span class="s1">&quot;i&quot;</span><span class="s0">,</span><span class="s1">&quot;getResult&quot;</span><span class="s0">,</span><span class="s1">&quot;prerenderViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;exportForResult&quot;</span><span class="s0">,</span><span class="s1">&quot;result&quot;</span><span class="s0">,</span><span class="s1">&quot;resolve&quot;</span><span class="s0">,</span><span class="s1">&quot;catch&quot;</span><span class="s0">,</span><span class="s1">&quot;err&quot;</span><span class="s0">,</span><span class="s1">&quot;__nextError&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvePendingResult&quot;</span><span class="s0">,</span><span class="s1">&quot;parentResult&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveParentResult&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NODE_ENV&quot;</span><span class="s0">,</span><span class="s1">&quot;require&quot;</span><span class="s0">,</span><span class="s1">&quot;deepFreeze&quot;</span><span class="s0">,</span><span class="s1">&quot;cloneMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;createDefaultMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;Set&quot;</span><span class="s0">,</span><span class="s1">&quot;resultIndex&quot;</span><span class="s0">,</span><span class="s1">&quot;iconMod&quot;</span><span class="s0">,</span><span class="s1">&quot;shift&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveParentMetadata&quot;</span><span class="s0">,</span><span class="s1">&quot;isPromiseLike&quot;</span><span class="s0">,</span><span class="s1">&quot;template&quot;</span><span class="s0">,</span><span class="s1">&quot;size&quot;</span><span class="s0">,</span><span class="s1">&quot;warning&quot;</span><span class="s0">,</span><span class="s1">&quot;Log&quot;</span><span class="s0">,</span><span class="s1">&quot;warn&quot;</span><span class="s0">,</span><span class="s1">&quot;resolvedViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;createDefaultViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;pendingViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;resolveParentViewport&quot;</span><span class="s0">,</span><span class="s1">&quot;then&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;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&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>