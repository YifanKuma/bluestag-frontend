<html>
<head>
<title>send-response.js.map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #080808;}
.s1 { color: #067d17;}
.s2 { color: #1750eb;}
.s3 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
send-response.js.map</font>
</center></td></tr></table>
<pre><span class="s0">{</span><span class="s1">&quot;version&quot;</span><span class="s0">:</span><span class="s2">3</span><span class="s0">,</span><span class="s1">&quot;sources&quot;</span><span class="s0">:[</span><span class="s1">&quot;../../src/server/send-response.ts&quot;</span><span class="s0">],</span><span class="s1">&quot;sourcesContent&quot;</span><span class="s0">:[</span><span class="s1">&quot;import type { BaseNextRequest, BaseNextResponse } from './base-http'</span><span class="s3">\n</span><span class="s1">import { isNodeNextResponse } from './base-http/helpers'</span><span class="s3">\n\n</span><span class="s1">import { pipeToNodeResponse } from './pipe-readable'</span><span class="s3">\n</span><span class="s1">import { splitCookiesString } from './web/utils'</span><span class="s3">\n\n</span><span class="s1">/**</span><span class="s3">\n </span><span class="s1">* Sends the response on the underlying next response object.</span><span class="s3">\n </span><span class="s1">*</span><span class="s3">\n </span><span class="s1">* @param req the underlying request object</span><span class="s3">\n </span><span class="s1">* @param res the underlying response object</span><span class="s3">\n </span><span class="s1">* @param response the response to send</span><span class="s3">\n </span><span class="s1">*/</span><span class="s3">\n</span><span class="s1">export async function sendResponse(</span><span class="s3">\n  </span><span class="s1">req: BaseNextRequest,</span><span class="s3">\n  </span><span class="s1">res: BaseNextResponse,</span><span class="s3">\n  </span><span class="s1">response: Response,</span><span class="s3">\n  </span><span class="s1">waitUntil?: Promise&lt;unknown&gt;</span><span class="s3">\n</span><span class="s1">): Promise&lt;void&gt; {</span><span class="s3">\n  </span><span class="s1">if (</span><span class="s3">\n    </span><span class="s1">// The type check here ensures that `req` is correctly typed, and the</span><span class="s3">\n    </span><span class="s1">// environment variable check provides dead code elimination.</span><span class="s3">\n    </span><span class="s1">process.env.NEXT_RUNTIME !== 'edge' &amp;&amp;</span><span class="s3">\n    </span><span class="s1">isNodeNextResponse(res)</span><span class="s3">\n  </span><span class="s1">) {</span><span class="s3">\n    </span><span class="s1">// Copy over the response status.</span><span class="s3">\n    </span><span class="s1">res.statusCode = response.status</span><span class="s3">\n    </span><span class="s1">res.statusMessage = response.statusText</span><span class="s3">\n\n    </span><span class="s1">// TODO: this is not spec-compliant behavior and we should not restrict</span><span class="s3">\n    </span><span class="s1">// headers that are allowed to appear many times.</span><span class="s3">\n    </span><span class="s1">//</span><span class="s3">\n    </span><span class="s1">// See:</span><span class="s3">\n    </span><span class="s1">// https://github.com/vercel/next.js/pull/70127</span><span class="s3">\n    </span><span class="s1">const headersWithMultipleValuesAllowed = [</span><span class="s3">\n      </span><span class="s1">// can add more headers to this list if needed</span><span class="s3">\n      </span><span class="s1">'set-cookie',</span><span class="s3">\n      </span><span class="s1">'www-authenticate',</span><span class="s3">\n      </span><span class="s1">'proxy-authenticate',</span><span class="s3">\n      </span><span class="s1">'vary',</span><span class="s3">\n    </span><span class="s1">]</span><span class="s3">\n\n    </span><span class="s1">// Copy over the response headers.</span><span class="s3">\n    </span><span class="s1">response.headers?.forEach((value, name) =&gt; {</span><span class="s3">\n      </span><span class="s1">// `x-middleware-set-cookie` is an internal header not needed for the response</span><span class="s3">\n      </span><span class="s1">if (name.toLowerCase() === 'x-middleware-set-cookie') {</span><span class="s3">\n        </span><span class="s1">return</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n\n      </span><span class="s1">// The append handling is special cased for `set-cookie`.</span><span class="s3">\n      </span><span class="s1">if (name.toLowerCase() === 'set-cookie') {</span><span class="s3">\n        </span><span class="s1">// TODO: (wyattjoh) replace with native response iteration when we can upgrade undici</span><span class="s3">\n        </span><span class="s1">for (const cookie of splitCookiesString(value)) {</span><span class="s3">\n          </span><span class="s1">res.appendHeader(name, cookie)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">} else {</span><span class="s3">\n        </span><span class="s1">// only append the header if it is either not present in the outbound response</span><span class="s3">\n        </span><span class="s1">// or if the header supports multiple values</span><span class="s3">\n        </span><span class="s1">const isHeaderPresent = typeof res.getHeader(name) !== 'undefined'</span><span class="s3">\n        </span><span class="s1">if (</span><span class="s3">\n          </span><span class="s1">headersWithMultipleValuesAllowed.includes(name.toLowerCase()) ||</span><span class="s3">\n          </span><span class="s1">!isHeaderPresent</span><span class="s3">\n        </span><span class="s1">) {</span><span class="s3">\n          </span><span class="s1">res.appendHeader(name, value)</span><span class="s3">\n        </span><span class="s1">}</span><span class="s3">\n      </span><span class="s1">}</span><span class="s3">\n    </span><span class="s1">})</span><span class="s3">\n\n    </span><span class="s1">/**</span><span class="s3">\n     </span><span class="s1">* The response can't be directly piped to the underlying response. The</span><span class="s3">\n     </span><span class="s1">* following is duplicated from the edge runtime handler.</span><span class="s3">\n     </span><span class="s1">*</span><span class="s3">\n     </span><span class="s1">* See packages/next/server/next-server.ts</span><span class="s3">\n     </span><span class="s1">*/</span><span class="s3">\n\n    </span><span class="s1">const { originalResponse } = res</span><span class="s3">\n\n    </span><span class="s1">// A response body must not be sent for HEAD requests. See https://httpwg.org/specs/rfc9110.html#HEAD</span><span class="s3">\n    </span><span class="s1">if (response.body &amp;&amp; req.method !== 'HEAD') {</span><span class="s3">\n      </span><span class="s1">await pipeToNodeResponse(response.body, originalResponse, waitUntil)</span><span class="s3">\n    </span><span class="s1">} else {</span><span class="s3">\n      </span><span class="s1">originalResponse.end()</span><span class="s3">\n    </span><span class="s1">}</span><span class="s3">\n  </span><span class="s1">}</span><span class="s3">\n</span><span class="s1">}</span><span class="s3">\n</span><span class="s1">&quot;</span><span class="s0">],</span><span class="s1">&quot;names&quot;</span><span class="s0">:[</span><span class="s1">&quot;sendResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;req&quot;</span><span class="s0">,</span><span class="s1">&quot;res&quot;</span><span class="s0">,</span><span class="s1">&quot;response&quot;</span><span class="s0">,</span><span class="s1">&quot;waitUntil&quot;</span><span class="s0">,</span><span class="s1">&quot;process&quot;</span><span class="s0">,</span><span class="s1">&quot;env&quot;</span><span class="s0">,</span><span class="s1">&quot;NEXT_RUNTIME&quot;</span><span class="s0">,</span><span class="s1">&quot;isNodeNextResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;statusCode&quot;</span><span class="s0">,</span><span class="s1">&quot;status&quot;</span><span class="s0">,</span><span class="s1">&quot;statusMessage&quot;</span><span class="s0">,</span><span class="s1">&quot;statusText&quot;</span><span class="s0">,</span><span class="s1">&quot;headersWithMultipleValuesAllowed&quot;</span><span class="s0">,</span><span class="s1">&quot;headers&quot;</span><span class="s0">,</span><span class="s1">&quot;forEach&quot;</span><span class="s0">,</span><span class="s1">&quot;value&quot;</span><span class="s0">,</span><span class="s1">&quot;name&quot;</span><span class="s0">,</span><span class="s1">&quot;toLowerCase&quot;</span><span class="s0">,</span><span class="s1">&quot;cookie&quot;</span><span class="s0">,</span><span class="s1">&quot;splitCookiesString&quot;</span><span class="s0">,</span><span class="s1">&quot;appendHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;isHeaderPresent&quot;</span><span class="s0">,</span><span class="s1">&quot;getHeader&quot;</span><span class="s0">,</span><span class="s1">&quot;includes&quot;</span><span class="s0">,</span><span class="s1">&quot;originalResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;body&quot;</span><span class="s0">,</span><span class="s1">&quot;method&quot;</span><span class="s0">,</span><span class="s1">&quot;pipeToNodeResponse&quot;</span><span class="s0">,</span><span class="s1">&quot;end&quot;</span><span class="s0">],</span><span class="s1">&quot;mappings&quot;</span><span class="s0">:</span><span class="s1">&quot;;;;;+BAasBA;;;eAAAA;;;yBAZa;8BAEA;uBACA;AAS5B,eAAeA,aACpBC,GAAoB,EACpBC,GAAqB,EACrBC,QAAkB,EAClBC,SAA4B;IAE5B,IACE,qEAAqE;IACrE,6DAA6D;IAC7DC,QAAQC,GAAG,CAACC,YAAY,KAAK,UAC7BC,IAAAA,2BAAkB,EAACN,MACnB;YAkBA,kCAAkC;QAClCC;QAlBA,iCAAiC;QACjCD,IAAIO,UAAU,GAAGN,SAASO,MAAM;QAChCR,IAAIS,aAAa,GAAGR,SAASS,UAAU;QAEvC,uEAAuE;QACvE,iDAAiD;QACjD,EAAE;QACF,OAAO;QACP,+CAA+C;QAC/C,MAAMC,mCAAmC;YACvC,8CAA8C;YAC9C;YACA;YACA;YACA;SACD;SAGDV,oBAAAA,SAASW,OAAO,qBAAhBX,kBAAkBY,OAAO,CAAC,CAACC,OAAOC;YAChC,8EAA8E;YAC9E,IAAIA,KAAKC,WAAW,OAAO,2BAA2B;gBACpD;YACF;YAEA,yDAAyD;YACzD,IAAID,KAAKC,WAAW,OAAO,cAAc;gBACvC,qFAAqF;gBACrF,KAAK,MAAMC,UAAUC,IAAAA,yBAAkB,EAACJ,OAAQ;oBAC9Cd,IAAImB,YAAY,CAACJ,MAAME;gBACzB;YACF,OAAO;gBACL,8EAA8E;gBAC9E,4CAA4C;gBAC5C,MAAMG,kBAAkB,OAAOpB,IAAIqB,SAAS,CAACN,UAAU;gBACvD,IACEJ,iCAAiCW,QAAQ,CAACP,KAAKC,WAAW,OAC1D,CAACI,iBACD;oBACApB,IAAImB,YAAY,CAACJ,MAAMD;gBACzB;YACF;QACF;QAEA;;;;;KAKC,GAED,MAAM,EAAES,gBAAgB,EAAE,GAAGvB;QAE7B,qGAAqG;QACrG,IAAIC,SAASuB,IAAI,IAAIzB,IAAI0B,MAAM,KAAK,QAAQ;YAC1C,MAAMC,IAAAA,gCAAkB,EAACzB,SAASuB,IAAI,EAAED,kBAAkBrB;QAC5D,OAAO;YACLqB,iBAAiBI,GAAG;QACtB;IACF;AACF&quot;</span><span class="s0">,</span><span class="s1">&quot;ignoreList&quot;</span><span class="s0">:[</span><span class="s2">0</span><span class="s0">]}</span></pre>
</body>
</html>