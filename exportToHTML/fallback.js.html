<html>
<head>
<title>fallback.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #1750eb;}
.s4 { color: #0037a6;}
.s5 { color: #264eff;}
.s6 { color: #8c8c8c; font-style: italic;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
fallback.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s2">const </span><span class="s1">node_child_process_1 = require(</span><span class="s0">&quot;node:child_process&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">fs = require(</span><span class="s0">&quot;node:fs&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">os = require(</span><span class="s0">&quot;node:os&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">path = require(</span><span class="s0">&quot;node:path&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">constants_js_1 = require(</span><span class="s0">&quot;./constants.js&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">helpers_js_1 = require(</span><span class="s0">&quot;./helpers.js&quot;</span><span class="s1">);</span>
<span class="s2">const </span><span class="s1">EXECUTORS = {</span>
    <span class="s1">npm: </span><span class="s0">'npx'</span><span class="s1">,</span>
    <span class="s1">pnpm: </span><span class="s0">'pnpm'</span><span class="s1">,</span>
    <span class="s1">yarn: </span><span class="s0">'yarn'</span><span class="s1">,</span>
    <span class="s1">bun: </span><span class="s0">'bun'</span><span class="s1">,</span>
    <span class="s1">deno: (args) =&gt; [</span><span class="s0">'deno'</span><span class="s1">, </span><span class="s0">'run'</span><span class="s1">, </span><span class="s0">`npm:</span><span class="s1">${args[</span><span class="s3">0</span><span class="s1">]}</span><span class="s0">`</span><span class="s1">, ...args.slice(</span><span class="s3">1</span><span class="s1">)],</span>
<span class="s1">};</span>
<span class="s2">function </span><span class="s1">constructCommand(value, args) {</span>
    <span class="s2">const </span><span class="s1">list = </span><span class="s2">typeof </span><span class="s1">value === </span><span class="s0">'function'</span>
        <span class="s1">? value(args)</span>
        <span class="s1">:</span>
            <span class="s1">[].concat(value, args);</span>
    <span class="s2">return </span><span class="s1">{</span>
        <span class="s1">command: list[</span><span class="s3">0</span><span class="s1">],</span>
        <span class="s1">args: list.slice(</span><span class="s3">1</span><span class="s1">),</span>
    <span class="s1">};</span>
<span class="s1">}</span>
<span class="s2">function </span><span class="s1">fallback(packageJsonPath, checkVersion) {</span>
    <span class="s2">const </span><span class="s1">packageJson = require(packageJsonPath);</span>
    <span class="s2">const </span><span class="s1">{ name, version: pkgVersion, optionalDependencies } = packageJson;</span>
    <span class="s2">const </span><span class="s1">{ napi, version = pkgVersion } = (</span><span class="s3">0</span><span class="s1">, helpers_js_1.getNapiInfoFromPackageJson)(packageJson, checkVersion);</span>
    <span class="s2">if </span><span class="s1">(checkVersion &amp;&amp; pkgVersion !== version) {</span>
        <span class="s2">throw new </span><span class="s1">Error((</span><span class="s3">0</span><span class="s1">, helpers_js_1.errorMessage)(</span><span class="s0">`Inconsistent package versions found for </span><span class="s4">\`</span><span class="s1">${name}</span><span class="s4">\` </span><span class="s0">v</span><span class="s1">${pkgVersion} </span><span class="s0">vs </span><span class="s4">\`</span><span class="s1">${napi.packageName}</span><span class="s4">\` </span><span class="s0">v</span><span class="s1">${version}</span><span class="s0">.`</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s2">if </span><span class="s1">(process.versions.webcontainer) {</span>
        <span class="s2">const </span><span class="s1">bindingPkgName = </span><span class="s0">`</span><span class="s1">${napi.packageName}</span><span class="s0">-</span><span class="s1">${constants_js_1.WASM32_WASI}</span><span class="s0">`</span><span class="s1">;</span>
        <span class="s2">if </span><span class="s1">(!optionalDependencies?.[bindingPkgName]) {</span>
            <span class="s2">throw new </span><span class="s1">Error((</span><span class="s3">0</span><span class="s1">, helpers_js_1.errorMessage)(</span><span class="s0">`</span><span class="s4">\`</span><span class="s1">${constants_js_1.WASM32_WASI}</span><span class="s4">\` </span><span class="s0">target is unavailable for </span><span class="s4">\`</span><span class="s1">${name}</span><span class="s4">\` </span><span class="s0">v</span><span class="s1">${version}</span><span class="s0">`</span><span class="s1">));</span>
        <span class="s1">}</span>
        <span class="s2">const </span><span class="s1">baseDir = path.resolve(os.tmpdir(), </span><span class="s0">`</span><span class="s1">${name}</span><span class="s0">-</span><span class="s1">${version}</span><span class="s0">`</span><span class="s1">);</span>
        <span class="s2">const </span><span class="s1">bindingEntry = path.resolve(baseDir, </span><span class="s0">`node_modules/</span><span class="s1">${bindingPkgName}</span><span class="s0">/</span><span class="s1">${napi.binaryName}</span><span class="s0">.wasi.cjs`</span><span class="s1">);</span>
        <span class="s2">if </span><span class="s1">(!fs.existsSync(bindingEntry)) {</span>
            <span class="s1">fs.rmSync(baseDir, { recursive: </span><span class="s2">true</span><span class="s1">, force: </span><span class="s2">true </span><span class="s1">});</span>
            <span class="s1">fs.mkdirSync(baseDir, { recursive: </span><span class="s2">true </span><span class="s1">});</span>
            <span class="s2">const </span><span class="s1">bindingPkg = </span><span class="s0">`</span><span class="s1">${bindingPkgName}</span><span class="s0">@</span><span class="s1">${version}</span><span class="s0">`</span><span class="s1">;</span>
            <span class="s1">console.log((</span><span class="s3">0</span><span class="s1">, helpers_js_1.errorMessage)(</span><span class="s0">`Downloading </span><span class="s4">\`</span><span class="s1">${bindingPkg}</span><span class="s4">\` </span><span class="s0">on WebContainer...`</span><span class="s1">));</span>
            <span class="s1">(</span><span class="s3">0</span><span class="s1">, node_child_process_1.execFileSync)(</span><span class="s0">'pnpm'</span><span class="s1">, [</span><span class="s0">'i'</span><span class="s1">, bindingPkg], {</span>
                <span class="s1">cwd: baseDir,</span>
                <span class="s1">stdio: </span><span class="s0">'inherit'</span><span class="s1">,</span>
            <span class="s1">});</span>
        <span class="s1">}</span>
        <span class="s2">return </span><span class="s1">require(bindingEntry);</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">userAgent = ((process.env.npm_config_user_agent || </span><span class="s0">''</span><span class="s1">).split(</span><span class="s0">'/'</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">] ||</span>
        <span class="s0">'npm'</span><span class="s1">);</span>
    <span class="s2">const </span><span class="s1">executor = EXECUTORS[userAgent];</span>
    <span class="s2">if </span><span class="s1">(!executor) {</span>
        <span class="s2">throw new </span><span class="s1">Error((</span><span class="s3">0</span><span class="s1">, helpers_js_1.errorMessage)(</span><span class="s0">`Unsupported package manager: </span><span class="s1">${userAgent}</span><span class="s0">. Supported managers are: </span><span class="s1">${Object.keys(EXECUTORS).join(</span><span class="s0">', '</span><span class="s1">)}</span><span class="s0">.`</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s2">const </span><span class="s1">{ command, args } = constructCommand(executor, [</span>
        <span class="s0">'napi-postinstall'</span><span class="s1">,</span>
        <span class="s1">name,</span>
        <span class="s1">version,</span>
        <span class="s1">checkVersion ? </span><span class="s0">'1' </span><span class="s1">: </span><span class="s0">'0'</span><span class="s1">,</span>
    <span class="s1">]);</span>
    <span class="s2">const </span><span class="s1">pkgDir = path.dirname(packageJsonPath);</span>
    <span class="s1">(</span><span class="s3">0</span><span class="s1">, node_child_process_1.execFileSync)(command, args, {</span>
        <span class="s1">cwd: pkgDir,</span>
        <span class="s1">stdio: </span><span class="s0">'inherit'</span><span class="s1">,</span>
    <span class="s1">});</span>
    <span class="s1">process.env[</span><span class="s0">`SKIP_</span><span class="s1">${name.replace(</span><span class="s5">/-/g</span><span class="s1">, </span><span class="s0">'_'</span><span class="s1">).toUpperCase()}</span><span class="s0">_FALLBACK`</span><span class="s1">] = </span><span class="s0">'1'</span><span class="s1">;</span>
    <span class="s2">const </span><span class="s1">PKG_RESOLVED_PATH = require.resolve(pkgDir);</span>
    <span class="s2">delete </span><span class="s1">require.cache[PKG_RESOLVED_PATH];</span>
    <span class="s2">return </span><span class="s1">require(pkgDir);</span>
<span class="s1">}</span>
<span class="s1">module.exports = fallback;</span>
<span class="s6">//# sourceMappingURL=fallback.js.map</span></pre>
</body>
</html>