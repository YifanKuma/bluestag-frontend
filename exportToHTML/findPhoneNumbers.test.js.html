<html>
<head>
<title>findPhoneNumbers.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
findPhoneNumbers.test.js</font>
</center></td></tr></table>
<pre><span class="s0">// This is a legacy function.</span>
<span class="s0">// Use `findNumbers()` instead.</span>

<span class="s2">import </span><span class="s1">findNumbers, { searchPhoneNumbers } from </span><span class="s3">'./findPhoneNumbers.js'</span>
<span class="s2">import </span><span class="s1">PhoneNumberSearch from </span><span class="s3">'./PhoneNumberSearch.js'</span>
<span class="s2">import </span><span class="s1">metadata from </span><span class="s3">'../../metadata.min.json' </span><span class="s2">with </span><span class="s1">{ type: </span><span class="s3">'json' </span><span class="s1">}</span>

<span class="s1">describe(</span><span class="s3">'findPhoneNumbers'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s3">'should find numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'2133734253'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">10</span>
		<span class="s1">}])</span>

		<span class="s1">expect(findNumbers(</span><span class="s3">'(213) 373-4253'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">14</span>
		<span class="s1">}])</span>

		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 and not (213) 373-4253 as written in the document.'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}, {</span>
			<span class="s1">phone    : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">55</span>
		<span class="s1">}])</span>

		<span class="s0">// Opening parenthesis issue.</span>
		<span class="s0">// https://github.com/catamphetamine/libphonenumber-js/issues/252</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 and not (213) 373-4253 (that</span><span class="s5">\'</span><span class="s3">s not even in the same country!) as written in the document.'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}, {</span>
			<span class="s1">phone    : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">55</span>
		<span class="s1">}])</span>

		<span class="s0">// No default country.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}])</span>

		<span class="s0">// Passing `options` and default country.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, { leniency: </span><span class="s3">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}])</span>

		<span class="s0">// Passing `options`.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 as written in the document.'</span><span class="s1">, { leniency: </span><span class="s3">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}])</span>

		<span class="s0">// Not a phone number and a phone number.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'Digits 12 are not a number, but +7 (800) 555-35-35 is.'</span><span class="s1">, { leniency: </span><span class="s3">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">32</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">50</span>
		<span class="s1">}])</span>

		<span class="s0">// Phone number extension.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'Date 02/17/2018 is not a number, but +7 (800) 555-35-35 ext. 123 is.'</span><span class="s1">, { leniency: </span><span class="s3">'VALID' </span><span class="s1">}, metadata)</span>
        <span class="s1">).to.deep.equal([{</span>
			<span class="s1">phone    : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s1">country  : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">ext      : </span><span class="s3">'123'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">37</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">64</span>
		<span class="s1">}])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'shouldn</span><span class="s5">\'</span><span class="s3">t find non-valid numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">// Not a valid phone number for US.</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'1111111111'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'should find non-European digits'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">// E.g. in Iraq they don't write `+442323234` but rather `+٤٤٢٣٢٣٢٣٤`.</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'العَرَبِيَّة‎ +٤٤٣٣٣٣٣٣٣٣٣٣عَرَبِيّ‎'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s3">'GB'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s3">'3333333333'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">27</span>
		<span class="s1">}])</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'should iterate'</span><span class="s1">, () =&gt; {</span>
		<span class="s2">const </span><span class="s1">expected_numbers = [{</span>
			<span class="s1">country : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">phone   : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s0">// number   : '+7 (800) 555-35-35',</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">}, {</span>
			<span class="s1">country : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">phone   : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s0">// number   : '(213) 373-4253',</span>
			<span class="s1">startsAt : </span><span class="s4">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">55</span>
		<span class="s1">}]</span>

		<span class="s2">for </span><span class="s1">(</span><span class="s2">const </span><span class="s1">number of searchPhoneNumbers(</span><span class="s3">'The number is +7 (800) 555-35-35 and not (213) 373-4253 as written in the document.'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)) {</span>
			<span class="s1">expect(number).to.deep.equal(expected_numbers.shift())</span>
		<span class="s1">}</span>

		<span class="s1">expect(expected_numbers.length).to.equal(</span><span class="s4">0</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'should work in edge cases'</span><span class="s1">, () =&gt; {</span>
		<span class="s2">let </span><span class="s1">thrower</span>

		<span class="s0">// No input</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">''</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s0">// No country metadata for this `require` country code</span>
		<span class="s1">thrower = () =&gt; findNumbers(</span><span class="s3">'123'</span><span class="s1">, </span><span class="s3">'ZZ'</span><span class="s1">, metadata)</span>
		<span class="s1">expect(thrower).to.throw(</span><span class="s3">'Unknown country'</span><span class="s1">)</span>

		<span class="s0">// Numerical `value`</span>
		<span class="s1">thrower = () =&gt; findNumbers(</span><span class="s4">2141111111</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">)</span>
		<span class="s1">expect(thrower).to.throw(</span><span class="s3">'A text for parsing must be a string.'</span><span class="s1">)</span>

		<span class="s0">// // No metadata</span>
		<span class="s0">// thrower = () =&gt; findNumbers('')</span>
		<span class="s0">// thrower.should.throw('`metadata` argument not passed')</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'shouldn</span><span class="s5">\'</span><span class="s3">t find phone numbers which are not phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">// A timestamp.</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'2012-01-02 08:00'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s0">// A valid number (not a complete timestamp).</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'2012-01-02 08'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s3">'2012010208'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">0</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">13</span>
		<span class="s1">}])</span>

		<span class="s0">// Invalid parens.</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'213(3734253'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s0">// Letters after phone number.</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'2133734253a'</span><span class="s1">, </span><span class="s3">'US'</span><span class="s1">, metadata)).to.deep.equal([])</span>

		<span class="s0">// Valid phone (same as the one found in the UUID below).</span>
		<span class="s1">expect(findNumbers(</span><span class="s3">'The phone number is 231354125.'</span><span class="s1">, </span><span class="s3">'FR'</span><span class="s1">, metadata)).to.deep.equal([{</span>
			<span class="s1">country  : </span><span class="s3">'FR'</span><span class="s1">,</span>
			<span class="s1">phone    : </span><span class="s3">'231354125'</span><span class="s1">,</span>
			<span class="s1">startsAt : </span><span class="s4">20</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">29</span>
		<span class="s1">}])</span>

		<span class="s0">// Not a phone number (part of a UUID).</span>
		<span class="s0">// Should parse in `{ extended: true }` mode.</span>
		<span class="s2">const </span><span class="s1">possibleNumbers = findNumbers(</span><span class="s3">'The UUID is CA801c26f98cd16e231354125ad046e40b.'</span><span class="s1">, </span><span class="s3">'FR'</span><span class="s1">, { extended: </span><span class="s2">true </span><span class="s1">}, metadata)</span>
		<span class="s1">expect(possibleNumbers.length).to.equal(</span><span class="s4">3</span><span class="s1">)</span>
		<span class="s1">expect(possibleNumbers[</span><span class="s4">1</span><span class="s1">].country).to.equal(</span><span class="s3">'FR'</span><span class="s1">)</span>
		<span class="s1">expect(possibleNumbers[</span><span class="s4">1</span><span class="s1">].phone).to.equal(</span><span class="s3">'231354125'</span><span class="s1">)</span>

		<span class="s0">// Not a phone number (part of a UUID).</span>
		<span class="s0">// Shouldn't parse by default.</span>
		<span class="s1">expect(</span>
            <span class="s1">findNumbers(</span><span class="s3">'The UUID is CA801c26f98cd16e231354125ad046e40b.'</span><span class="s1">, </span><span class="s3">'FR'</span><span class="s1">, metadata)</span>
        <span class="s1">).to.deep.equal([])</span>
	<span class="s1">})</span>
<span class="s1">})</span>

<span class="s1">describe(</span><span class="s3">'PhoneNumberSearch'</span><span class="s1">, () =&gt; {</span>
	<span class="s1">it(</span><span class="s3">'should search for phone numbers'</span><span class="s1">, () =&gt; {</span>
		<span class="s2">const </span><span class="s1">finder = </span><span class="s2">new </span><span class="s1">PhoneNumberSearch(</span><span class="s3">'The number is +7 (800) 555-35-35 and not (213) 373-4253 as written in the document.'</span><span class="s1">, { defaultCountry: </span><span class="s3">'US' </span><span class="s1">}, metadata)</span>

		<span class="s1">expect(finder.hasNext()).to.equal(</span><span class="s2">true</span><span class="s1">)</span>
		<span class="s1">expect(finder.next()).to.deep.equal({</span>
			<span class="s1">country : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">phone   : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s0">// number   : '+7 (800) 555-35-35',</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">})</span>

		<span class="s1">expect(finder.hasNext()).to.equal(</span><span class="s2">true</span><span class="s1">)</span>
		<span class="s1">expect(finder.next()).to.deep.equal({</span>
			<span class="s1">country : </span><span class="s3">'US'</span><span class="s1">,</span>
			<span class="s1">phone   : </span><span class="s3">'2133734253'</span><span class="s1">,</span>
			<span class="s0">// number   : '(213) 373-4253',</span>
			<span class="s1">startsAt : </span><span class="s4">41</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">55</span>
		<span class="s1">})</span>

		<span class="s1">expect(finder.hasNext()).to.equal(</span><span class="s2">false</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'should search for phone numbers (no options)'</span><span class="s1">, () =&gt; {</span>
		<span class="s2">const </span><span class="s1">finder = </span><span class="s2">new </span><span class="s1">PhoneNumberSearch(</span><span class="s3">'The number is +7 (800) 555-35-35'</span><span class="s1">, undefined, metadata)</span>
		<span class="s1">expect(finder.hasNext()).to.equal(</span><span class="s2">true</span><span class="s1">)</span>
		<span class="s1">expect(finder.next()).to.deep.equal({</span>
			<span class="s1">country : </span><span class="s3">'RU'</span><span class="s1">,</span>
			<span class="s1">phone   : </span><span class="s3">'8005553535'</span><span class="s1">,</span>
			<span class="s0">// number   : '+7 (800) 555-35-35',</span>
			<span class="s1">startsAt : </span><span class="s4">14</span><span class="s1">,</span>
			<span class="s1">endsAt   : </span><span class="s4">32</span>
		<span class="s1">})</span>
		<span class="s1">expect(finder.hasNext()).to.equal(</span><span class="s2">false</span><span class="s1">)</span>
	<span class="s1">})</span>

	<span class="s1">it(</span><span class="s3">'should work in edge cases'</span><span class="s1">, () =&gt; {</span>
		<span class="s0">// No options</span>
		<span class="s2">const </span><span class="s1">search = </span><span class="s2">new </span><span class="s1">PhoneNumberSearch(</span><span class="s3">''</span><span class="s1">, undefined, metadata)</span>

		<span class="s0">// No next element</span>
		<span class="s2">let </span><span class="s1">thrower = () =&gt; search.next()</span>
		<span class="s1">expect(thrower).to.throw(</span><span class="s3">'No next element'</span><span class="s1">)</span>
	<span class="s1">})</span>
<span class="s1">})</span></pre>
</body>
</html>