<html>
<head>
<title>SyncAsyncFileSystemDecorator.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #067d17;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #0033b3;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
SyncAsyncFileSystemDecorator.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
    MIT License http://www.opensource.org/licenses/mit-license.php 
    Author Tobias Koppers @sokra 
*/</span>

<span class="s2">&quot;use strict&quot;</span><span class="s1">;</span>

<span class="s0">/** </span><span class="s3">@typedef </span><span class="s0">{import(&quot;./Resolver&quot;).FileSystem} FileSystem */</span>
<span class="s0">/** </span><span class="s3">@typedef </span><span class="s0">{import(&quot;./Resolver&quot;).StringCallback} StringCallback */</span>
<span class="s0">/** </span><span class="s3">@typedef </span><span class="s0">{import(&quot;./Resolver&quot;).SyncFileSystem} SyncFileSystem */</span>

<span class="s0">// eslint-disable-next-line jsdoc/no-restricted-syntax</span>
<span class="s0">/** </span><span class="s3">@typedef </span><span class="s0">{Function} SyncOrAsyncFunction */</span>
<span class="s0">// eslint-disable-next-line jsdoc/no-restricted-syntax</span>
<span class="s0">/** </span><span class="s3">@typedef </span><span class="s0">{any} ResultOfSyncOrAsyncFunction */</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s3">@param </span><span class="s0">{SyncFileSystem} fs file system implementation</span>
 <span class="s0">* </span><span class="s3">@constructor</span>
 <span class="s0">*/</span>
<span class="s4">function </span><span class="s1">SyncAsyncFileSystemDecorator(fs) {</span>
	<span class="s4">this</span><span class="s1">.fs = fs;</span>

	<span class="s4">this</span><span class="s1">.lstat = undefined;</span>
	<span class="s4">this</span><span class="s1">.lstatSync = undefined;</span>
	<span class="s4">const </span><span class="s1">{ lstatSync } = fs;</span>
	<span class="s4">if </span><span class="s1">(lstatSync) {</span>
		<span class="s4">this</span><span class="s1">.lstat =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;lstat&quot;]} */</span>
			<span class="s1">(</span>
				<span class="s1">(arg, options, callback) =&gt; {</span>
					<span class="s4">let </span><span class="s1">result;</span>
					<span class="s4">try </span><span class="s1">{</span>
						<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
							<span class="s1">? lstatSync.call(fs, arg, options)</span>
							<span class="s1">: lstatSync.call(fs, arg);</span>
					<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
						<span class="s4">return </span><span class="s1">(callback || options)(</span>
							<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
							<span class="s1">(err),</span>
						<span class="s1">);</span>
					<span class="s1">}</span>

					<span class="s1">(callback || options)(</span>
						<span class="s4">null</span><span class="s1">,</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
						<span class="s1">(result),</span>
					<span class="s1">);</span>
				<span class="s1">}</span>
			<span class="s1">);</span>
		<span class="s4">this</span><span class="s1">.lstatSync =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;lstatSync&quot;]} */</span>
			<span class="s1">((arg, options) =&gt; lstatSync.call(fs, arg, options));</span>
	<span class="s1">}</span>

	<span class="s4">this</span><span class="s1">.stat =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;stat&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options, callback) =&gt; {</span>
				<span class="s4">let </span><span class="s1">result;</span>
				<span class="s4">try </span><span class="s1">{</span>
					<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
						<span class="s1">? fs.statSync(arg, options)</span>
						<span class="s1">: fs.statSync(arg);</span>
				<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
					<span class="s4">return </span><span class="s1">(callback || options)(</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
						<span class="s1">(err),</span>
					<span class="s1">);</span>
				<span class="s1">}</span>

				<span class="s1">(callback || options)(</span>
					<span class="s4">null</span><span class="s1">,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
					<span class="s1">(result),</span>
				<span class="s1">);</span>
			<span class="s1">}</span>
		<span class="s1">);</span>
	<span class="s4">this</span><span class="s1">.statSync =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;statSync&quot;]} */</span>
		<span class="s1">((arg, options) =&gt; fs.statSync(arg, options));</span>

	<span class="s4">this</span><span class="s1">.readdir =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;readdir&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options, callback) =&gt; {</span>
				<span class="s4">let </span><span class="s1">result;</span>
				<span class="s4">try </span><span class="s1">{</span>
					<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
						<span class="s1">? fs.readdirSync(</span>
								<span class="s1">arg,</span>
								<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Exclude&lt;Parameters&lt;FileSystem[&quot;readdir&quot;]&gt;[1], (err: NodeJS.ErrnoException | null, files: string[]) =&gt; void&gt;} */</span>
								<span class="s1">(options),</span>
							<span class="s1">)</span>
						<span class="s1">: fs.readdirSync(arg);</span>
				<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
					<span class="s4">return </span><span class="s1">(callback || options)(</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
						<span class="s1">(err),</span>
						<span class="s1">[],</span>
					<span class="s1">);</span>
				<span class="s1">}</span>

				<span class="s1">(callback || options)(</span>
					<span class="s4">null</span><span class="s1">,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
					<span class="s1">(result),</span>
				<span class="s1">);</span>
			<span class="s1">}</span>
		<span class="s1">);</span>
	<span class="s4">this</span><span class="s1">.readdirSync =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;readdirSync&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options) =&gt;</span>
				<span class="s1">fs.readdirSync(</span>
					<span class="s1">arg,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Parameters&lt;SyncFileSystem[&quot;readdirSync&quot;]&gt;[1]} */ </span><span class="s1">(options),</span>
				<span class="s1">)</span>
		<span class="s1">);</span>

	<span class="s4">this</span><span class="s1">.readFile =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;readFile&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options, callback) =&gt; {</span>
				<span class="s4">let </span><span class="s1">result;</span>
				<span class="s4">try </span><span class="s1">{</span>
					<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
						<span class="s1">? fs.readFileSync(arg, options)</span>
						<span class="s1">: fs.readFileSync(arg);</span>
				<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
					<span class="s4">return </span><span class="s1">(callback || options)(</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
						<span class="s1">(err),</span>
					<span class="s1">);</span>
				<span class="s1">}</span>

				<span class="s1">(callback || options)(</span>
					<span class="s4">null</span><span class="s1">,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
					<span class="s1">(result),</span>
				<span class="s1">);</span>
			<span class="s1">}</span>
		<span class="s1">);</span>
	<span class="s4">this</span><span class="s1">.readFileSync =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;readFileSync&quot;]} */</span>
		<span class="s1">((arg, options) =&gt; fs.readFileSync(arg, options));</span>

	<span class="s4">this</span><span class="s1">.readlink =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;readlink&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options, callback) =&gt; {</span>
				<span class="s4">let </span><span class="s1">result;</span>
				<span class="s4">try </span><span class="s1">{</span>
					<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
						<span class="s1">? fs.readlinkSync(</span>
								<span class="s1">arg,</span>
								<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Exclude&lt;Parameters&lt;FileSystem[&quot;readlink&quot;]&gt;[1], StringCallback&gt;} */</span>
								<span class="s1">(options),</span>
							<span class="s1">)</span>
						<span class="s1">: fs.readlinkSync(arg);</span>
				<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
					<span class="s4">return </span><span class="s1">(callback || options)(</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
						<span class="s1">(err),</span>
					<span class="s1">);</span>
				<span class="s1">}</span>

				<span class="s1">(callback || options)(</span>
					<span class="s4">null</span><span class="s1">,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
					<span class="s1">(result),</span>
				<span class="s1">);</span>
			<span class="s1">}</span>
		<span class="s1">);</span>
	<span class="s4">this</span><span class="s1">.readlinkSync =</span>
		<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;readlinkSync&quot;]} */</span>
		<span class="s1">(</span>
			<span class="s1">(arg, options) =&gt;</span>
				<span class="s1">fs.readlinkSync(</span>
					<span class="s1">arg,</span>
					<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Parameters&lt;SyncFileSystem[&quot;readlinkSync&quot;]&gt;[1]} */ </span><span class="s1">(</span>
						<span class="s1">options</span>
					<span class="s1">),</span>
				<span class="s1">)</span>
		<span class="s1">);</span>

	<span class="s4">this</span><span class="s1">.readJson = undefined;</span>
	<span class="s4">this</span><span class="s1">.readJsonSync = undefined;</span>
	<span class="s4">const </span><span class="s1">{ readJsonSync } = fs;</span>
	<span class="s4">if </span><span class="s1">(readJsonSync) {</span>
		<span class="s4">this</span><span class="s1">.readJson =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;readJson&quot;]} */</span>
			<span class="s1">(</span>
				<span class="s1">(arg, callback) =&gt; {</span>
					<span class="s4">let </span><span class="s1">result;</span>
					<span class="s4">try </span><span class="s1">{</span>
						<span class="s1">result = readJsonSync.call(fs, arg);</span>
					<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
						<span class="s4">return </span><span class="s1">callback(</span>
							<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | Error | null} */ </span><span class="s1">(err),</span>
						<span class="s1">);</span>
					<span class="s1">}</span>

					<span class="s1">callback(</span><span class="s4">null</span><span class="s1">, result);</span>
				<span class="s1">}</span>
			<span class="s1">);</span>
		<span class="s4">this</span><span class="s1">.readJsonSync =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;readJsonSync&quot;]} */</span>
			<span class="s1">((arg) =&gt; readJsonSync.call(fs, arg));</span>
	<span class="s1">}</span>

	<span class="s4">this</span><span class="s1">.realpath = undefined;</span>
	<span class="s4">this</span><span class="s1">.realpathSync = undefined;</span>
	<span class="s4">const </span><span class="s1">{ realpathSync } = fs;</span>
	<span class="s4">if </span><span class="s1">(realpathSync) {</span>
		<span class="s4">this</span><span class="s1">.realpath =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{FileSystem[&quot;realpath&quot;]} */</span>
			<span class="s1">(</span>
				<span class="s1">(arg, options, callback) =&gt; {</span>
					<span class="s4">let </span><span class="s1">result;</span>
					<span class="s4">try </span><span class="s1">{</span>
						<span class="s1">result = </span><span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncOrAsyncFunction | undefined} */ </span><span class="s1">(callback)</span>
							<span class="s1">? realpathSync.call(</span>
									<span class="s1">fs,</span>
									<span class="s1">arg,</span>
									<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Exclude&lt;Parameters&lt;NonNullable&lt;FileSystem[&quot;realpath&quot;]&gt;&gt;[1], StringCallback&gt;} */</span>
									<span class="s1">(options),</span>
								<span class="s1">)</span>
							<span class="s1">: realpathSync.call(fs, arg);</span>
					<span class="s1">} </span><span class="s4">catch </span><span class="s1">(err) {</span>
						<span class="s4">return </span><span class="s1">(callback || options)(</span>
							<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{NodeJS.ErrnoException | null} */</span>
							<span class="s1">(err),</span>
						<span class="s1">);</span>
					<span class="s1">}</span>

					<span class="s1">(callback || options)(</span>
						<span class="s4">null</span><span class="s1">,</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{ResultOfSyncOrAsyncFunction} */</span>
						<span class="s1">(result),</span>
					<span class="s1">);</span>
				<span class="s1">}</span>
			<span class="s1">);</span>
		<span class="s4">this</span><span class="s1">.realpathSync =</span>
			<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{SyncFileSystem[&quot;realpathSync&quot;]} */</span>
			<span class="s1">(</span>
				<span class="s1">(arg, options) =&gt;</span>
					<span class="s1">realpathSync.call(</span>
						<span class="s1">fs,</span>
						<span class="s1">arg,</span>
						<span class="s0">/** </span><span class="s3">@type </span><span class="s0">{Parameters&lt;NonNullable&lt;SyncFileSystem[&quot;realpathSync&quot;]&gt;&gt;[1]} */</span>
						<span class="s1">(options),</span>
					<span class="s1">)</span>
			<span class="s1">);</span>
	<span class="s1">}</span>
<span class="s1">}</span>

<span class="s1">module.exports = SyncAsyncFileSystemDecorator;</span>
</pre>
</body>
</html>