<html>
<head>
<title>getFunctionHeadLoc.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #8c8c8c; font-style: italic;}
.s3 { color: #0033b3;}
.s4 { color: #8c8c8c; font-style: italic;}
.s5 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
getFunctionHeadLoc.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span>
<span class="s2">// adapted from https://github.com/eslint/eslint/blob/5bdaae205c3a0089ea338b382df59e21d5b06436/lib/rules/utils/ast-utils.js#L1668-L1787</span>
<span class="s1">Object.defineProperty(exports, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, { value: </span><span class="s3">true </span><span class="s1">});</span>
<span class="s1">exports.getFunctionHeadLoc = getFunctionHeadLoc;</span>
<span class="s3">const </span><span class="s1">utils_1 = require(</span><span class="s0">&quot;@typescript-eslint/utils&quot;</span><span class="s1">);</span>
<span class="s3">const </span><span class="s1">astUtils_1 = require(</span><span class="s0">&quot;./astUtils&quot;</span><span class="s1">);</span>
<span class="s2">/**</span>
 <span class="s2">* Gets the `(` token of the given function node.</span>
 <span class="s2">* </span><span class="s4">@param </span><span class="s2">node The function node to get.</span>
 <span class="s2">* </span><span class="s4">@param </span><span class="s2">sourceCode The source code object to get tokens.</span>
 <span class="s2">* </span><span class="s4">@returns </span><span class="s2">`(` token.</span>
 <span class="s2">*/</span>
<span class="s3">function </span><span class="s1">getOpeningParenOfParams(node, sourceCode) {</span>
    <span class="s2">// If the node is an arrow function and doesn't have parens, this returns the identifier of the first param.</span>
    <span class="s3">if </span><span class="s1">(node.type === utils_1.AST_NODE_TYPES.ArrowFunctionExpression &amp;&amp;</span>
        <span class="s1">node.params.length === </span><span class="s5">1</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s1">argToken = utils_1.ESLintUtils.nullThrows(sourceCode.getFirstToken(node.params[</span><span class="s5">0</span><span class="s1">]), utils_1.ESLintUtils.NullThrowsReasons.MissingToken(</span><span class="s0">'parameter'</span><span class="s1">, </span><span class="s0">'arrow function'</span><span class="s1">));</span>
        <span class="s3">const </span><span class="s1">maybeParenToken = sourceCode.getTokenBefore(argToken);</span>
        <span class="s3">return </span><span class="s1">maybeParenToken &amp;&amp; (</span><span class="s5">0</span><span class="s1">, astUtils_1.isOpeningParenToken)(maybeParenToken)</span>
            <span class="s1">? maybeParenToken</span>
            <span class="s1">: argToken;</span>
    <span class="s1">}</span>
    <span class="s2">// Otherwise, returns paren.</span>
    <span class="s3">return </span><span class="s1">node.id != </span><span class="s3">null</span>
        <span class="s1">? utils_1.ESLintUtils.nullThrows(sourceCode.getTokenAfter(node.id, astUtils_1.isOpeningParenToken), utils_1.ESLintUtils.NullThrowsReasons.MissingToken(</span><span class="s0">'id'</span><span class="s1">, </span><span class="s0">'function'</span><span class="s1">))</span>
        <span class="s1">: utils_1.ESLintUtils.nullThrows(sourceCode.getFirstToken(node, astUtils_1.isOpeningParenToken), utils_1.ESLintUtils.NullThrowsReasons.MissingToken(</span><span class="s0">'opening parenthesis'</span><span class="s1">, </span><span class="s0">'function'</span><span class="s1">));</span>
<span class="s1">}</span>
<span class="s2">/**</span>
 <span class="s2">* Gets the location of the given function node for reporting.</span>
 <span class="s2">*</span>
 <span class="s2">* - `function foo() {}`</span>
 <span class="s2">*    ^^^^^^^^^^^^</span>
 <span class="s2">* - `(function foo() {})`</span>
 <span class="s2">*     ^^^^^^^^^^^^</span>
 <span class="s2">* - `(function() {})`</span>
 <span class="s2">*     ^^^^^^^^</span>
 <span class="s2">* - `function* foo() {}`</span>
 <span class="s2">*    ^^^^^^^^^^^^^</span>
 <span class="s2">* - `(function* foo() {})`</span>
 <span class="s2">*     ^^^^^^^^^^^^^</span>
 <span class="s2">* - `(function*() {})`</span>
 <span class="s2">*     ^^^^^^^^^</span>
 <span class="s2">* - `() =&gt; {}`</span>
 <span class="s2">*       ^^</span>
 <span class="s2">* - `async () =&gt; {}`</span>
 <span class="s2">*             ^^</span>
 <span class="s2">* - `({ foo: function foo() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ foo: function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ ['foo']: function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ [foo]: function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ foo() {} })`</span>
 <span class="s2">*       ^^^</span>
 <span class="s2">* - `({ foo: function* foo() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ foo: function*() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ ['foo']: function*() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ [foo]: function*() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ *foo() {} })`</span>
 <span class="s2">*       ^^^^</span>
 <span class="s2">* - `({ foo: async function foo() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ foo: async function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ ['foo']: async function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ [foo]: async function() {} })`</span>
 <span class="s2">*       ^^^^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `({ async foo() {} })`</span>
 <span class="s2">*       ^^^^^^^^^</span>
 <span class="s2">* - `({ get foo() {} })`</span>
 <span class="s2">*       ^^^^^^^</span>
 <span class="s2">* - `({ set foo(a) {} })`</span>
 <span class="s2">*       ^^^^^^^</span>
 <span class="s2">* - `class A { constructor() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^</span>
 <span class="s2">* - `class A { foo() {} }`</span>
 <span class="s2">*              ^^^</span>
 <span class="s2">* - `class A { *foo() {} }`</span>
 <span class="s2">*              ^^^^</span>
 <span class="s2">* - `class A { async foo() {} }`</span>
 <span class="s2">*              ^^^^^^^^^</span>
 <span class="s2">* - `class A { ['foo']() {} }`</span>
 <span class="s2">*              ^^^^^^^</span>
 <span class="s2">* - `class A { *['foo']() {} }`</span>
 <span class="s2">*              ^^^^^^^^</span>
 <span class="s2">* - `class A { async ['foo']() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { [foo]() {} }`</span>
 <span class="s2">*              ^^^^^</span>
 <span class="s2">* - `class A { *[foo]() {} }`</span>
 <span class="s2">*              ^^^^^^</span>
 <span class="s2">* - `class A { async [foo]() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^</span>
 <span class="s2">* - `class A { get foo() {} }`</span>
 <span class="s2">*              ^^^^^^^</span>
 <span class="s2">* - `class A { set foo(a) {} }`</span>
 <span class="s2">*              ^^^^^^^</span>
 <span class="s2">* - `class A { static foo() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^</span>
 <span class="s2">* - `class A { static *foo() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^</span>
 <span class="s2">* - `class A { static async foo() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { static get foo() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { static set foo(a) {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { foo = function() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { static foo = function() {} }`</span>
 <span class="s2">*              ^^^^^^^^^^^^^^^^^^^^^</span>
 <span class="s2">* - `class A { foo = (a, b) =&gt; {} }`</span>
 <span class="s2">*              ^^^^^^</span>
 <span class="s2">* </span><span class="s4">@param </span><span class="s2">node The function node to get.</span>
 <span class="s2">* </span><span class="s4">@param </span><span class="s2">sourceCode The source code object to get tokens.</span>
 <span class="s2">* </span><span class="s4">@returns </span><span class="s2">The location of the function node for reporting.</span>
 <span class="s2">*/</span>
<span class="s3">function </span><span class="s1">getFunctionHeadLoc(node, sourceCode) {</span>
    <span class="s3">const </span><span class="s1">parent = node.parent;</span>
    <span class="s3">let </span><span class="s1">start;</span>
    <span class="s3">let </span><span class="s1">end;</span>
    <span class="s3">if </span><span class="s1">(parent.type === utils_1.AST_NODE_TYPES.MethodDefinition ||</span>
        <span class="s1">parent.type === utils_1.AST_NODE_TYPES.PropertyDefinition) {</span>
        <span class="s2">// the decorator's range is included within the member</span>
        <span class="s2">// however it's usually irrelevant to the member itself - so we don't want</span>
        <span class="s2">// to highlight it ever.</span>
        <span class="s3">if </span><span class="s1">(parent.decorators.length &gt; </span><span class="s5">0</span><span class="s1">) {</span>
            <span class="s3">const </span><span class="s1">lastDecorator = parent.decorators[parent.decorators.length - </span><span class="s5">1</span><span class="s1">];</span>
            <span class="s3">const </span><span class="s1">firstTokenAfterDecorator = utils_1.ESLintUtils.nullThrows(sourceCode.getTokenAfter(lastDecorator), utils_1.ESLintUtils.NullThrowsReasons.MissingToken(</span><span class="s0">'modifier or member name'</span><span class="s1">, </span><span class="s0">'class member'</span><span class="s1">));</span>
            <span class="s1">start = firstTokenAfterDecorator.loc.start;</span>
        <span class="s1">}</span>
        <span class="s3">else </span><span class="s1">{</span>
            <span class="s1">start = parent.loc.start;</span>
        <span class="s1">}</span>
        <span class="s1">end = getOpeningParenOfParams(node, sourceCode).loc.start;</span>
    <span class="s1">}</span>
    <span class="s3">else if </span><span class="s1">(parent.type === utils_1.AST_NODE_TYPES.Property) {</span>
        <span class="s1">start = parent.loc.start;</span>
        <span class="s1">end = getOpeningParenOfParams(node, sourceCode).loc.start;</span>
    <span class="s1">}</span>
    <span class="s3">else if </span><span class="s1">(node.type === utils_1.AST_NODE_TYPES.ArrowFunctionExpression) {</span>
        <span class="s3">const </span><span class="s1">arrowToken = utils_1.ESLintUtils.nullThrows(sourceCode.getTokenBefore(node.body, astUtils_1.isArrowToken), utils_1.ESLintUtils.NullThrowsReasons.MissingToken(</span><span class="s0">'arrow token'</span><span class="s1">, </span><span class="s0">'arrow function'</span><span class="s1">));</span>
        <span class="s1">start = arrowToken.loc.start;</span>
        <span class="s1">end = arrowToken.loc.end;</span>
    <span class="s1">}</span>
    <span class="s3">else </span><span class="s1">{</span>
        <span class="s1">start = node.loc.start;</span>
        <span class="s1">end = getOpeningParenOfParams(node, sourceCode).loc.start;</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s1">{</span>
        <span class="s1">end: { ...end },</span>
        <span class="s1">start: { ...start },</span>
    <span class="s1">};</span>
<span class="s1">}</span>
</pre>
</body>
</html>