<html>
<head>
<title>coerce.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #067d17;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #8c8c8c; font-style: italic;}
.s4 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
coerce.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span>

<span class="s2">const </span><span class="s1">SemVer = require(</span><span class="s0">'../classes/semver'</span><span class="s1">)</span>
<span class="s2">const </span><span class="s1">parse = require(</span><span class="s0">'./parse'</span><span class="s1">)</span>
<span class="s2">const </span><span class="s1">{ safeRe: re, t } = require(</span><span class="s0">'../internal/re'</span><span class="s1">)</span>

<span class="s2">const </span><span class="s1">coerce = (version, options) =&gt; {</span>
  <span class="s2">if </span><span class="s1">(version </span><span class="s2">instanceof </span><span class="s1">SemVer) {</span>
    <span class="s2">return </span><span class="s1">version</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">version === </span><span class="s0">'number'</span><span class="s1">) {</span>
    <span class="s1">version = String(version)</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(</span><span class="s2">typeof </span><span class="s1">version !== </span><span class="s0">'string'</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s1">options = options || {}</span>

  <span class="s2">let </span><span class="s1">match = </span><span class="s2">null</span>
  <span class="s2">if </span><span class="s1">(!options.rtl) {</span>
    <span class="s1">match = version.match(options.includePrerelease ? re[t.COERCEFULL] : re[t.COERCE])</span>
  <span class="s1">} </span><span class="s2">else </span><span class="s1">{</span>
    <span class="s3">// Find the right-most coercible string that does not share</span>
    <span class="s3">// a terminus with a more left-ward coercible string.</span>
    <span class="s3">// Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'</span>
    <span class="s3">// With includePrerelease option set, '1.2.3.4-rc' wants to coerce '2.3.4-rc', not '2.3.4'</span>
    <span class="s3">//</span>
    <span class="s3">// Walk through the string checking with a /g regexp</span>
    <span class="s3">// Manually set the index so as to pick up overlapping matches.</span>
    <span class="s3">// Stop when we get a match that ends at the string end, since no</span>
    <span class="s3">// coercible string can be more right-ward without the same terminus.</span>
    <span class="s2">const </span><span class="s1">coerceRtlRegex = options.includePrerelease ? re[t.COERCERTLFULL] : re[t.COERCERTL]</span>
    <span class="s2">let </span><span class="s1">next</span>
    <span class="s2">while </span><span class="s1">((next = coerceRtlRegex.exec(version)) &amp;&amp;</span>
        <span class="s1">(!match || match.index + match[</span><span class="s4">0</span><span class="s1">].length !== version.length)</span>
    <span class="s1">) {</span>
      <span class="s2">if </span><span class="s1">(!match ||</span>
            <span class="s1">next.index + next[</span><span class="s4">0</span><span class="s1">].length !== match.index + match[</span><span class="s4">0</span><span class="s1">].length) {</span>
        <span class="s1">match = next</span>
      <span class="s1">}</span>
      <span class="s1">coerceRtlRegex.lastIndex = next.index + next[</span><span class="s4">1</span><span class="s1">].length + next[</span><span class="s4">2</span><span class="s1">].length</span>
    <span class="s1">}</span>
    <span class="s3">// leave it in a clean state</span>
    <span class="s1">coerceRtlRegex.lastIndex = -</span><span class="s4">1</span>
  <span class="s1">}</span>

  <span class="s2">if </span><span class="s1">(match === </span><span class="s2">null</span><span class="s1">) {</span>
    <span class="s2">return null</span>
  <span class="s1">}</span>

  <span class="s2">const </span><span class="s1">major = match[</span><span class="s4">2</span><span class="s1">]</span>
  <span class="s2">const </span><span class="s1">minor = match[</span><span class="s4">3</span><span class="s1">] || </span><span class="s0">'0'</span>
  <span class="s2">const </span><span class="s1">patch = match[</span><span class="s4">4</span><span class="s1">] || </span><span class="s0">'0'</span>
  <span class="s2">const </span><span class="s1">prerelease = options.includePrerelease &amp;&amp; match[</span><span class="s4">5</span><span class="s1">] ? </span><span class="s0">`-</span><span class="s1">${match[</span><span class="s4">5</span><span class="s1">]}</span><span class="s0">` </span><span class="s1">: </span><span class="s0">''</span>
  <span class="s2">const </span><span class="s1">build = options.includePrerelease &amp;&amp; match[</span><span class="s4">6</span><span class="s1">] ? </span><span class="s0">`+</span><span class="s1">${match[</span><span class="s4">6</span><span class="s1">]}</span><span class="s0">` </span><span class="s1">: </span><span class="s0">''</span>

  <span class="s2">return </span><span class="s1">parse(</span><span class="s0">`</span><span class="s1">${major}</span><span class="s0">.</span><span class="s1">${minor}</span><span class="s0">.</span><span class="s1">${patch}${prerelease}${build}</span><span class="s0">`</span><span class="s1">, options)</span>
<span class="s1">}</span>
<span class="s1">module.exports = coerce</span>
</pre>
</body>
</html>